[
  {
    "name": "Create Page",
    "key": "create_page",
    "type": "item-create",
    "position_x": 73,
    "position_y": 1,
    "options": {
      "permissions": "$trigger",
      "emitEvents": false,
      "collection": "{{$trigger.body.collection}}",
      "payload": "{{payload}}"
    },
    "resolve": null,
    "reject": null,
    "flow": "a23110e1-700b-41b8-9f9e-ca0998b84a76",
    "_syncId": "5b42950b-6b9e-41ca-b7b3-2f34f5b1c053"
  },
  {
    "name": "Create Redirect",
    "key": "create_redirect",
    "type": "item-create",
    "position_x": 91,
    "position_y": 1,
    "options": {
      "permissions": "$trigger",
      "emitEvents": false,
      "collection": "redirects",
      "payload": "{{format_payload}}"
    },
    "resolve": null,
    "reject": null,
    "flow": "c62ceaa5-bd09-4158-8329-98792debc5d5",
    "_syncId": "dd141b2a-329d-4ffb-ad06-e4c0b976ecdb"
  },
  {
    "name": "Duplication Fields",
    "key": "duplication_fields",
    "type": "item-read",
    "position_x": 19,
    "position_y": 1,
    "options": {
      "permissions": "$trigger",
      "emitEvents": false,
      "query": {
        "fields": [
          "item_duplication_fields"
        ]
      },
      "collection": "directus_collections",
      "key": [
        "{{$trigger.body.collection}}"
      ]
    },
    "resolve": "cd69a2b7-4fc7-40ab-80f0-edba5ce4c8db",
    "reject": null,
    "flow": "a23110e1-700b-41b8-9f9e-ca0998b84a76",
    "_syncId": "5e055582-d2e2-49a4-92cb-e387358ccb61"
  },
  {
    "name": "Form",
    "key": "form",
    "type": "item-read",
    "position_x": 19,
    "position_y": 1,
    "options": {
      "collection": "forms",
      "key": [
        "{{$trigger.payload.form}}"
      ],
      "query": {
        "fields": [
          "*",
          "fields.*"
        ]
      },
      "permissions": "$full"
    },
    "resolve": "ebe898f9-6ccf-49f6-a073-cde97e1f5fd0",
    "reject": null,
    "flow": "61757ab0-b139-4079-b5eb-4e05bb8142ac",
    "_syncId": "cfb879b8-145b-4113-ae31-69644a8584f3"
  },
  {
    "name": "Format",
    "key": "format",
    "type": "exec",
    "position_x": 37,
    "position_y": 1,
    "options": {
      "code": "module.exports = function(data) {\n\treturn {\n        ...data.$trigger,\n        body: data.render.template\n    }\n}"
    },
    "resolve": null,
    "reject": null,
    "flow": "5429ccb0-7e97-4ef5-9d65-2bbcf964f9a6",
    "_syncId": "4098666c-759c-4921-bc43-474bc72f3d8b"
  },
  {
    "name": "Format",
    "key": "format",
    "type": "exec",
    "position_x": 19,
    "position_y": 18,
    "options": {
      "code": "/**\n * Prepares email template data by matching trigger values with form fields\n * @param {Object} trigger - The trigger object containing payload values\n * @param {Object} form - The form object containing fields and email templates\n * @returns {Array} Array of prepared email template objects\n * @throws {Error} If required data is missing or invalid\n */\nfunction prepareEmailTemplateData(trigger, form) {\n  // Validate input parameters\n  if (!trigger?.payload?.values || !Array.isArray(trigger.payload.values)) {\n    throw new Error('Invalid trigger payload values');\n  }\n  \n  if (!form?.fields || !Array.isArray(form.fields)) {\n    throw new Error('Invalid form fields');\n  }\n  \n  if (!form?.emails || !Array.isArray(form.emails)) {\n    throw new Error('Invalid form emails');\n  }\n\n  // Create an object to store the field name-value pairs\n  const data = {};\n  \n  // Iterate through the trigger values and match them with form fields\n  trigger.payload.values.forEach(item => {\n    if (!item || typeof item !== 'object') {\n      throw new Error('Invalid trigger value item');\n    }\n\n    // Ensure required properties exist\n    if (!item.field && !item.field_name) {\n      throw new Error('Missing field identifier in trigger value');\n    }\n    \n    if (item.value === undefined) {\n      throw new Error('Missing value in trigger value');\n    }\n\n    // Find the corresponding field in the form\n    const formField = form.fields.find(field => field.id === item.field);\n    \n    // If a matching field is found, use its name as the key\n    if (formField && formField.name) {\n      data[formField.name] = item.value;\n    } else {\n      // Fallback to using the field_name from the trigger if no match is found\n      data[item.field_name || item.field] = item.value;\n    }\n  });\n\n  // Process and validate all email templates\n  const emailTemplates = form.emails.map(email => {\n    // Validate required email template properties\n    if (!email.subject) {\n      throw new Error('Missing email subject');\n    }\n    \n    if (!email.message) {\n      throw new Error('Missing email message template');\n    }\n    \n    if (!email.to) {\n      throw new Error('Missing email recipient');\n    }\n\n    // Normalize 'to' field to always be an array\n    const toField = Array.isArray(email.to) ? email.to : [email.to];\n    \n    // Validate each email address\n    toField.forEach(recipient => {\n      if (typeof recipient !== 'string' || !recipient.trim()) {\n        throw new Error('Invalid email recipient');\n      }\n    });\n\n    return {\n      to: toField,\n      subject: email.subject,\n      template: email.message,\n      data: data\n    };\n  });\n\n  return emailTemplates;\n}\n\nmodule.exports = function(data) {\n  if (!data?.$trigger || !data?.form) {\n    throw new Error('Missing required data');\n  }\n  \n  return prepareEmailTemplateData(data.$trigger, data.form);\n};"
    },
    "resolve": "bb95d8ef-624e-4a78-865f-9047e9a9dfcd",
    "reject": null,
    "flow": "61757ab0-b139-4079-b5eb-4e05bb8142ac",
    "_syncId": "ebe898f9-6ccf-49f6-a073-cde97e1f5fd0"
  },
  {
    "name": "Format",
    "key": "format",
    "type": "exec",
    "position_x": 37,
    "position_y": 1,
    "options": {
      "code": "module.exports = async function(data) {\n    return data.read_globals[0]\n}"
    },
    "resolve": null,
    "reject": null,
    "flow": "69e87d0b-df14-4779-bdc8-abc05f2f1e97",
    "_syncId": "71f118af-b532-4457-82dd-561b02c719ba"
  },
  {
    "name": "Format",
    "key": "format",
    "type": "exec",
    "position_x": 55,
    "position_y": 1,
    "options": {
      "code": "module.exports = function(data) {\n    const aiResponse = JSON.parse(data.write)\n\tconst payload = {}\n    payload.title = aiResponse.title\n    payload.description = aiResponse.description\n    payload.content = aiResponse.content\n    payload.slug = aiResponse.slug\n    return payload\n}"
    },
    "resolve": "71ab330a-795b-48ae-927a-c3a8b67d6674",
    "reject": null,
    "flow": "5915dd55-fff8-4d47-b48c-a0e42e5033c1",
    "_syncId": "02fbe2ea-18fb-4efb-8639-ba9a45b31c40"
  },
  {
    "name": "Format Payload",
    "key": "format_payload",
    "type": "exec",
    "position_x": 73,
    "position_y": 1,
    "options": {
      "code": "/**\n * Automatic Redirect Generator for Content URL Changes\n * \n * This function generates redirect objects when published content URLs change.\n * It works with both posts and pages collections to maintain SEO value\n * and prevent broken links when content is moved or renamed.\n */\nconst map = {\n  // Configuration for blog posts\n  posts: {\n    slugField: \"slug\",        // Field that contains the URL identifier for posts\n    routePrefix: \"/blog/\",    // Prefix added to all post URLs (e.g., /blog/my-post)\n  },\n  // Configuration for pages\n  pages: {\n    slugField: \"permalink\",   // Field that contains the URL identifier for pages\n    routePrefix: \"\",          // No prefix for pages (e.g., /about-us)\n  },\n};\n\n/**\n * Flow function executed when content URL changes\n * @param {Object} data - Data object from Directus Flow\n * @param {Object} data.$trigger - Information about what triggered the flow\n * @param {string} data.$trigger.collection - Collection name (posts/pages)\n * @param {Object} data.$trigger.payload - New data being saved\n * @param {Object} data.item - Previous version of the item before changes\n * @returns {Object} Redirect configuration object\n */\nmodule.exports = function (data) {\n  // Get the collection configuration based on whether this is a page or post\n  const collection = map[data.$trigger.collection];\n\n  const oldSlug = data.item[collection.slugField];\n  const newSlug = data.$trigger.payload[collection.slugField];\n  \n  // Build the old URL by combining the route prefix with the previous slug/permalink\n  const oldUrl = `${collection.routePrefix}${oldSlug}`;\n  \n  // Build the new URL by combining the route prefix with the new slug/permalink\n  const newUrl = `${collection.routePrefix}${newSlug}`;\n    \n  // Add a note\n  const note = `Created by Redirect automation on ${new Date().toLocaleDateString(\"en-US\")} at ${new Date().toLocaleTimeString(\"en-US\")} when a ${data.$trigger.collection} ${collection.slugField} was updated from \"${oldSlug}\" to \"${newSlug}\"`\n  \n  // Return a redirect object that will be saved to the redirects collection\n  return {\n    response_code: 301,       // Permanent redirect (best for SEO)\n    url_from: oldUrl,         // Where users were going before\n    url_to: newUrl,           // Where they should be sent now\n    note,\n  };\n};"
    },
    "resolve": "dd141b2a-329d-4ffb-ad06-e4c0b976ecdb",
    "reject": null,
    "flow": "c62ceaa5-bd09-4158-8329-98792debc5d5",
    "_syncId": "00c1bd6d-4cbf-44f7-ada1-7772ef915836"
  },
  {
    "name": "Get Editor",
    "key": "get_editor",
    "type": "item-read",
    "position_x": 38,
    "position_y": 1,
    "options": {
      "permissions": "$full",
      "collection": "directus_users",
      "key": [
        "{{$trigger.body.editor.key}}"
      ],
      "query": {
        "fields": [
          "id",
          "first_name",
          "last_name",
          "email"
        ]
      }
    },
    "resolve": "a99e39be-3a84-4bd6-a7c7-242de710cdbf",
    "reject": null,
    "flow": "3172d021-0b0f-4d4d-bcca-c5c46eb8fadf",
    "_syncId": "47562275-1b1f-42b2-8c69-755f556ba09e"
  },
  {
    "name": "Get Post",
    "key": "get_post",
    "type": "item-read",
    "position_x": 19,
    "position_y": 19,
    "options": {
      "permissions": "$full",
      "collection": "{{$trigger.body.collection}}",
      "key": "{{$trigger.body.keys}}"
    },
    "resolve": "526b4a2d-5562-485f-bd9c-77a29871277c",
    "reject": null,
    "flow": "3172d021-0b0f-4d4d-bcca-c5c46eb8fadf",
    "_syncId": "1a29dfb6-86e7-4937-818d-6ec3c3f33c96"
  },
  {
    "name": "Get User",
    "key": "get_user",
    "type": "item-read",
    "position_x": 57,
    "position_y": 1,
    "options": {
      "permissions": "$full",
      "collection": "directus_users",
      "key": [
        "{{$accountability.user}}"
      ],
      "query": {
        "fields": [
          "id",
          "first_name",
          "last_name",
          "email"
        ]
      }
    },
    "resolve": "1a29dfb6-86e7-4937-818d-6ec3c3f33c96",
    "reject": null,
    "flow": "3172d021-0b0f-4d4d-bcca-c5c46eb8fadf",
    "_syncId": "a99e39be-3a84-4bd6-a7c7-242de710cdbf"
  },
  {
    "name": "Globals",
    "key": "globals",
    "type": "trigger",
    "position_x": 19,
    "position_y": 1,
    "options": {
      "flow": "69e87d0b-df14-4779-bdc8-abc05f2f1e97"
    },
    "resolve": "cca49294-0440-4b46-9839-ece646b8f533",
    "reject": null,
    "flow": "d4bbac48-a444-49e0-aedb-9af5273b88df",
    "_syncId": "fc5254a7-b5ca-4888-b967-3c7db683b8b7"
  },
  {
    "name": "Globals",
    "key": "globals",
    "type": "trigger",
    "position_x": 19,
    "position_y": 1,
    "options": {
      "flow": "69e87d0b-df14-4779-bdc8-abc05f2f1e97"
    },
    "resolve": "47562275-1b1f-42b2-8c69-755f556ba09e",
    "reject": null,
    "flow": "3172d021-0b0f-4d4d-bcca-c5c46eb8fadf",
    "_syncId": "b7d2c902-6f00-4794-ad43-da4f46db8a98"
  },
  {
    "name": "Globals",
    "key": "globals",
    "type": "trigger",
    "position_x": 19,
    "position_y": 1,
    "options": {
      "flow": "69e87d0b-df14-4779-bdc8-abc05f2f1e97"
    },
    "resolve": "f4615767-d202-4325-9cd5-69616a142edc",
    "reject": null,
    "flow": "5915dd55-fff8-4d47-b48c-a0e42e5033c1",
    "_syncId": "642012ec-0c72-4fa0-b395-f0c737800cc2"
  },
  {
    "name": "Image",
    "key": "image",
    "type": "directus-labs-ai-image-generation",
    "position_x": 56,
    "position_y": 1,
    "options": {
      "apiKey": "{{globals.openai_api_key}}",
      "quality": "hd",
      "size": "landscape",
      "prompt": "{{prompt}}"
    },
    "resolve": "c61a7653-b706-473d-91d6-86c00dd9aa82",
    "reject": null,
    "flow": "d4bbac48-a444-49e0-aedb-9af5273b88df",
    "_syncId": "322f69c4-4901-48bb-860e-6bdb2b57508a"
  },
  {
    "name": "Import",
    "key": "import",
    "type": "request",
    "position_x": 74,
    "position_y": 1,
    "options": {
      "method": "POST",
      "url": "{{globals.directus_url}}/files/import",
      "body": "{\n  \"url\": \"{{image}}\"\n}",
      "headers": [
        {
          "header": "Authorization",
          "value": "Bearer fT6_R5in_QUpUSXlLqGIhYtbRlBnopFe"
        }
      ]
    },
    "resolve": "f5d2e740-af74-42b7-9248-4c3f740887ae",
    "reject": null,
    "flow": "d4bbac48-a444-49e0-aedb-9af5273b88df",
    "_syncId": "c61a7653-b706-473d-91d6-86c00dd9aa82"
  },
  {
    "name": "Is Published",
    "key": "is_published",
    "type": "condition",
    "position_x": 55,
    "position_y": 1,
    "options": {
      "filter": {
        "_and": [
          {
            "item": {
              "status": {
                "_eq": "published"
              }
            }
          }
        ]
      }
    },
    "resolve": "00c1bd6d-4cbf-44f7-ada1-7772ef915836",
    "reject": "832a5568-e1bb-4003-9eb7-7666acfeb935",
    "flow": "c62ceaa5-bd09-4158-8329-98792debc5d5",
    "_syncId": "bad7dfbc-ec25-4446-848e-0ca99856fa2c"
  },
  {
    "name": "Read Item",
    "key": "item",
    "type": "item-read",
    "position_x": 37,
    "position_y": 1,
    "options": {
      "permissions": "$trigger",
      "emitEvents": false,
      "collection": "{{$trigger.collection}}",
      "key": "{{$trigger.keys}}"
    },
    "resolve": "bad7dfbc-ec25-4446-848e-0ca99856fa2c",
    "reject": null,
    "flow": "c62ceaa5-bd09-4158-8329-98792debc5d5",
    "_syncId": "0d9dc062-10b7-4170-b0e6-1add523232e4"
  },
  {
    "name": "Item",
    "key": "item",
    "type": "item-read",
    "position_x": 37,
    "position_y": 1,
    "options": {
      "permissions": "$trigger",
      "emitEvents": false,
      "query": {
        "fields": "{{duplication_fields.item_duplication_fields}}"
      },
      "key": "{{$trigger.body.keys}}",
      "collection": "{{$trigger.body.collection}}"
    },
    "resolve": "3080ee3f-bd7a-4549-b47b-d5b99891ba38",
    "reject": null,
    "flow": "a23110e1-700b-41b8-9f9e-ca0998b84a76",
    "_syncId": "cd69a2b7-4fc7-40ab-80f0-edba5ce4c8db"
  },
  {
    "name": "Update Data",
    "key": "item_update_r4pr9",
    "type": "item-update",
    "position_x": 19,
    "position_y": 1,
    "options": {
      "permissions": "$trigger",
      "emitEvents": false,
      "collection": "pages",
      "query": {
        "filter": {
          "_and": [
            {
              "status": {
                "_eq": "scheduled"
              }
            },
            {
              "published_at": {
                "_lte": "$NOW"
              }
            }
          ]
        }
      },
      "payload": {
        "status": "published"
      }
    },
    "resolve": null,
    "reject": null,
    "flow": "b173f7da-99a9-49d3-810e-e10ea9f41120",
    "_syncId": "46b96dab-53e0-4284-a7aa-d97c60ce8585"
  },
  {
    "name": "Log Error",
    "key": "log_error",
    "type": "log",
    "position_x": 37,
    "position_y": 17,
    "options": {
      "message": "Trigger did NOT include a `to` address. "
    },
    "resolve": null,
    "reject": null,
    "flow": "7c8732cd-9d9e-44be-a3f6-89c0d42c7687",
    "_syncId": "32ec8236-11ca-484b-80a3-8f42fc820e54"
  },
  {
    "name": "No Change",
    "key": "no_change",
    "type": "log",
    "position_x": 37,
    "position_y": 18,
    "options": {
      "message": "No redirect was created. The item `slug` or `permalink` did not change."
    },
    "resolve": null,
    "reject": null,
    "flow": "c62ceaa5-bd09-4158-8329-98792debc5d5",
    "_syncId": "21acadd5-1143-405d-8447-403d04c2081a"
  },
  {
    "name": "Not Published",
    "key": "not_published",
    "type": "log",
    "position_x": 73,
    "position_y": 18,
    "options": {
      "message": "No redirect was created. The item `status` was not `published`."
    },
    "resolve": null,
    "reject": null,
    "flow": "c62ceaa5-bd09-4158-8329-98792debc5d5",
    "_syncId": "832a5568-e1bb-4003-9eb7-7666acfeb935"
  },
  {
    "name": "Format Payload",
    "key": "payload",
    "type": "exec",
    "position_x": 55,
    "position_y": 1,
    "options": {
      "code": "/**\n* Page Duplication Flow Function\n* \n* This function handles the duplication of a Directus page, including all its content blocks.\n* It allows specifying a new title and permalink, or automatically creates them with \"-Copy\" suffix.\n* The duplicated page is always set to draft status for review before publishing.\n* \n* @param {Object} data - Data object from Directus Flow\n* @param {Object} data.$trigger.body - Optional data passed to the flow (new title/permalink)\n* @param {Object} data.item - The original page being duplicated with all its properties\n* @returns {Object} Modified page data for creating the duplicate\n*/\nmodule.exports = function(data) {\n   // Get the data submitted with the flow trigger (if any)\n   const triggerData = data.$trigger.body;\n   \n   // Get the full data of the existing page to duplicate\n   const existingData = data.item;\n   \n   // Set the title for the duplicate:\n   // - Use the provided title if it exists in the trigger data\n   // - Otherwise, append \"- Copy\" to the original page title\n   existingData.title = triggerData.title ?? existingData.title + ' - Copy';\n   \n   // Set the permalink for the duplicate:\n   // - Use the provided permalink if it exists in the trigger data\n   // - Otherwise, append \"-copy\" to the original permalink\n   existingData.permalink = triggerData.permalink ?? existingData.permalink + '-copy';\n   \n   // Always set the duplicate page to draft status\n   // This prevents accidental publishing of duplicate content\n   existingData.status = 'draft';\n   \n   // Return the modified data to create the duplicate page\n   // Note: Directus will handle copying all related blocks/components\n   return existingData;\n}"
    },
    "resolve": "5b42950b-6b9e-41ca-b7b3-2f34f5b1c053",
    "reject": null,
    "flow": "a23110e1-700b-41b8-9f9e-ca0998b84a76",
    "_syncId": "3080ee3f-bd7a-4549-b47b-d5b99891ba38"
  },
  {
    "name": "Prompt",
    "key": "prompt",
    "type": "directus-labs-ai-writer-operation",
    "position_x": 37,
    "position_y": 1,
    "options": {
      "apiKey": "{{globals.openai_api_key}}",
      "promptKey": "custom",
      "system": "You are an expert in writing prompts for generating images through Dall‚Ä¢E 3. \n\n## Rules\nReturn only the prompt text",
      "text": "Use the following information and context to write a prompt to generate an image for a blog post.\n\nImage Style:\n{{ $trigger.body.prompt }}\n\nAspect Ratio: \n{{ $trigger.body.aspect_ratio }}\n\nColor Palette:\n{{ $trigger.body.colors }}",
      "model": "gpt-4o-mini",
      "aiProvider": "openai",
      "apiKeyOpenAi": "{{globals.openai_api_key}}"
    },
    "resolve": "322f69c4-4901-48bb-860e-6bdb2b57508a",
    "reject": null,
    "flow": "d4bbac48-a444-49e0-aedb-9af5273b88df",
    "_syncId": "cca49294-0440-4b46-9839-ece646b8f533"
  },
  {
    "name": "Read Globals",
    "key": "read_globals",
    "type": "item-read",
    "position_x": 19,
    "position_y": 1,
    "options": {
      "permissions": "$full",
      "collection": "globals"
    },
    "resolve": "71f118af-b532-4457-82dd-561b02c719ba",
    "reject": null,
    "flow": "69e87d0b-df14-4779-bdc8-abc05f2f1e97",
    "_syncId": "33fb467a-2640-45c3-85d5-858c9796269f"
  },
  {
    "name": "Render Template",
    "key": "render",
    "type": "liquidjs-operation",
    "position_x": 19,
    "position_y": 1,
    "options": {
      "publicUrl": "http://localhost:8001/",
      "mode": "custom",
      "operationMode": "single",
      "template": "{{ $trigger.template }}",
      "data": "{{ $trigger.data }}"
    },
    "resolve": "4098666c-759c-4921-bc43-474bc72f3d8b",
    "reject": null,
    "flow": "5429ccb0-7e97-4ef5-9d65-2bbcf964f9a6",
    "_syncId": "9786eca4-e837-455e-ba26-40d9cf3667e4"
  },
  {
    "name": "Render",
    "key": "render",
    "type": "trigger",
    "position_x": 41,
    "position_y": 1,
    "options": {
      "flow": "5429ccb0-7e97-4ef5-9d65-2bbcf964f9a6",
      "payload": "{{ format }}"
    },
    "resolve": "9ba85cb5-42d9-4422-a621-f3e1c664227b",
    "reject": null,
    "flow": "61757ab0-b139-4079-b5eb-4e05bb8142ac",
    "_syncId": "bb95d8ef-624e-4a78-865f-9047e9a9dfcd"
  },
  {
    "name": "Send",
    "key": "send",
    "type": "trigger",
    "position_x": 59,
    "position_y": 1,
    "options": {
      "flow": "7c8732cd-9d9e-44be-a3f6-89c0d42c7687",
      "payload": "{{ render }}"
    },
    "resolve": null,
    "reject": null,
    "flow": "61757ab0-b139-4079-b5eb-4e05bb8142ac",
    "_syncId": "9ba85cb5-42d9-4422-a621-f3e1c664227b"
  },
  {
    "name": "Send Email",
    "key": "send_email",
    "type": "mail",
    "position_x": 37,
    "position_y": 19,
    "options": {
      "to": [
        "{{get_editor.email}}"
      ],
      "subject": "üßê Review Request: {{get_post.title}} from {{get_user.first_name}} {{ get_user.last_name}}",
      "body": "Hi {{ get_editor.first_name }},\n\n{{ get_user.first_name }} {{ get_user.last_name}} has requested your review on the following content:\n\n[{{ $trigger.body.collection }} ‚Äì **{{ get_post.title }}**]({{globals.directus_url}}/admin/content/{{$trigger.body.collection}}/{{$trigger.body.keys[0]}})\n\n**Comments:**\n{{ $trigger.body.comments }}\n\n---\n\nPlease review to schedule for publishing or request changes.",
      "replyTo": [
        "{{get_user.email}}"
      ]
    },
    "resolve": null,
    "reject": null,
    "flow": "3172d021-0b0f-4d4d-bcca-c5c46eb8fadf",
    "_syncId": "526b4a2d-5562-485f-bd9c-77a29871277c"
  },
  {
    "name": "Send Email",
    "key": "send_email",
    "type": "mail",
    "position_x": 37,
    "position_y": 1,
    "options": {
      "to": "{{$trigger.to}}",
      "subject": "{{$trigger.subject}}",
      "type": "wysiwyg",
      "body": "<p>{{$trigger.body}}</p>"
    },
    "resolve": null,
    "reject": null,
    "flow": "7c8732cd-9d9e-44be-a3f6-89c0d42c7687",
    "_syncId": "9d304b44-3799-43e6-9e3a-ad2e4f063506"
  },
  {
    "name": "Did Slug Change",
    "key": "slug_changed",
    "type": "condition",
    "position_x": 19,
    "position_y": 1,
    "options": {
      "filter": {
        "_or": [
          {
            "$trigger": {
              "payload": {
                "slug": {
                  "_nnull": true
                }
              }
            }
          },
          {
            "$trigger": {
              "payload": {
                "permalink": {
                  "_nnull": true
                }
              }
            }
          }
        ]
      }
    },
    "resolve": "0d9dc062-10b7-4170-b0e6-1add523232e4",
    "reject": "21acadd5-1143-405d-8447-403d04c2081a",
    "flow": "c62ceaa5-bd09-4158-8329-98792debc5d5",
    "_syncId": "aa8a729c-dace-4936-82ca-d8f8a0c8311d"
  },
  {
    "name": "Update",
    "key": "update",
    "type": "item-update",
    "position_x": 73,
    "position_y": 1,
    "options": {
      "collection": "posts",
      "permissions": "$full",
      "key": [
        "{{$trigger.body.keys}}"
      ],
      "payload": "{{format}}"
    },
    "resolve": null,
    "reject": null,
    "flow": "5915dd55-fff8-4d47-b48c-a0e42e5033c1",
    "_syncId": "71ab330a-795b-48ae-927a-c3a8b67d6674"
  },
  {
    "name": "Update",
    "key": "update",
    "type": "item-update",
    "position_x": 92,
    "position_y": 1,
    "options": {
      "collection": "posts",
      "payload": {
        "image": "{{import.data.data.id}}"
      },
      "key": "{{$trigger.body.keys}}",
      "permissions": "$full"
    },
    "resolve": null,
    "reject": null,
    "flow": "d4bbac48-a444-49e0-aedb-9af5273b88df",
    "_syncId": "f5d2e740-af74-42b7-9248-4c3f740887ae"
  },
  {
    "name": "Verify To",
    "key": "verify_to",
    "type": "condition",
    "position_x": 19,
    "position_y": 1,
    "options": {
      "filter": {
        "$trigger": {
          "to": {
            "_nnull": true
          }
        }
      }
    },
    "resolve": "9d304b44-3799-43e6-9e3a-ad2e4f063506",
    "reject": "32ec8236-11ca-484b-80a3-8f42fc820e54",
    "flow": "7c8732cd-9d9e-44be-a3f6-89c0d42c7687",
    "_syncId": "b44b5653-ebd9-4c2e-98e6-2b3c3d1c27b3"
  },
  {
    "name": "Write",
    "key": "write",
    "type": "directus-labs-ai-writer-operation",
    "position_x": 37,
    "position_y": 1,
    "options": {
      "apiKey": "{{globals.openai_api_key}}",
      "model": "gpt-4o-mini",
      "promptKey": "custom",
      "system": "You are an expert in writing blog posts that are valuable for readers.\n\n## Rules\n- You are a human content writer. Avoid AI words like \"empower\". Avoid using prolix. Sound human.\n- ALWAYS output a JSON object that matches the sample below.\n{\n\"title\": \"Article Title\",\n\"slug\": \"formatted-slug\",\n\"description\": \"Short summary of the article to entice readers\",\n\"content\": \"Article content goes here. This needs to be properly encoded HTML string with proper line breaks, etc.\"\n}",
      "json_mode": true,
      "text": "Write an article based on this prompt.\n{{$trigger.body.prompt}}\n\n\n## Voice\nMatch this style and tone of voice when writing.\n{{ $trigger.body.voice }}",
      "aiProvider": "openai",
      "apiKeyOpenAi": "{{globals.openai_api_key}}",
      "maxToken": 8192
    },
    "resolve": "02fbe2ea-18fb-4efb-8639-ba9a45b31c40",
    "reject": null,
    "flow": "5915dd55-fff8-4d47-b48c-a0e42e5033c1",
    "_syncId": "f4615767-d202-4325-9cd5-69616a142edc"
  }
]
