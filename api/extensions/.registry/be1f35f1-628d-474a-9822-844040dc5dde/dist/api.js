import*as require$$0$1 from"url";import*as require$$1$2 from"util";import{createReadStream}from"node:fs";import fs,{appendFile}from"node:fs/promises";import{createHash}from"node:crypto";import{tmpdir}from"node:os";import path from"node:path";import{blob}from"node:stream/consumers";function getDefaultExportFromCjs(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function getAugmentedNamespace(e){if(Object.prototype.hasOwnProperty.call(e,"__esModule"))return e;var t=e.default;if("function"==typeof t){var r=function e(){var r=!1;try{r=this instanceof e}catch{}return r?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};r.prototype=t.prototype}else r={};return Object.defineProperty(r,"__esModule",{value:!0}),Object.keys(e).forEach(function(t){var n=Object.getOwnPropertyDescriptor(e,t);Object.defineProperty(r,t,n.get?n:{enumerable:!0,get:function(){return e[t]}})}),r}var ms$1,hasRequiredMs;function requireMs(){if(hasRequiredMs)return ms$1;hasRequiredMs=1;var e=1e3,t=60*e,r=60*t,n=24*r,i=7*n,s=365.25*n;function o(e,t,r,n){var i=t>=1.5*r;return Math.round(e/r)+" "+n+(i?"s":"")}return ms$1=function(a,l){l=l||{};var c=typeof a;if("string"===c&&a.length>0)return function(o){if((o=String(o)).length>100)return;var a=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(o);if(!a)return;var l=parseFloat(a[1]);switch((a[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return l*s;case"weeks":case"week":case"w":return l*i;case"days":case"day":case"d":return l*n;case"hours":case"hour":case"hrs":case"hr":case"h":return l*r;case"minutes":case"minute":case"mins":case"min":case"m":return l*t;case"seconds":case"second":case"secs":case"sec":case"s":return l*e;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return l;default:return}}(a);if("number"===c&&isFinite(a))return l.long?function(i){var s=Math.abs(i);if(s>=n)return o(i,s,n,"day");if(s>=r)return o(i,s,r,"hour");if(s>=t)return o(i,s,t,"minute");if(s>=e)return o(i,s,e,"second");return i+" ms"}(a):function(i){var s=Math.abs(i);if(s>=n)return Math.round(i/n)+"d";if(s>=r)return Math.round(i/r)+"h";if(s>=t)return Math.round(i/t)+"m";if(s>=e)return Math.round(i/e)+"s";return i+"ms"}(a);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(a))},ms$1}var msExports=requireMs(),ms=getDefaultExportFromCjs(msExports);const createError=(e,t,r=500)=>class extends Error{name="DirectusError";extensions;code=e.toUpperCase();status=r;constructor(e,r){super("string"==typeof t?t:t(e),r),this.extensions=e}toString(){return`${this.name} [${this.code}]: ${this.message}`}};let ErrorCode=function(e){return e.ContainsNullValues="CONTAINS_NULL_VALUES",e.ContentTooLarge="CONTENT_TOO_LARGE",e.Forbidden="FORBIDDEN",e.IllegalAssetTransformation="ILLEGAL_ASSET_TRANSFORMATION",e.Internal="INTERNAL_SERVER_ERROR",e.InvalidCredentials="INVALID_CREDENTIALS",e.InvalidForeignKey="INVALID_FOREIGN_KEY",e.InvalidIp="INVALID_IP",e.InvalidOtp="INVALID_OTP",e.InvalidPayload="INVALID_PAYLOAD",e.InvalidProvider="INVALID_PROVIDER",e.InvalidProviderConfig="INVALID_PROVIDER_CONFIG",e.InvalidQuery="INVALID_QUERY",e.InvalidToken="INVALID_TOKEN",e.LimitExceeded="LIMIT_EXCEEDED",e.MethodNotAllowed="METHOD_NOT_ALLOWED",e.NotNullViolation="NOT_NULL_VIOLATION",e.OutOfDate="OUT_OF_DATE",e.RangeNotSatisfiable="RANGE_NOT_SATISFIABLE",e.RecordNotUnique="RECORD_NOT_UNIQUE",e.RequestsExceeded="REQUESTS_EXCEEDED",e.RouteNotFound="ROUTE_NOT_FOUND",e.ServiceUnavailable="SERVICE_UNAVAILABLE",e.TokenExpired="TOKEN_EXPIRED",e.UnexpectedResponse="UNEXPECTED_RESPONSE",e.UnprocessableContent="UNPROCESSABLE_CONTENT",e.UnsupportedMediaType="UNSUPPORTED_MEDIA_TYPE",e.UserSuspended="USER_SUSPENDED",e.ValueOutOfRange="VALUE_OUT_OF_RANGE",e.ValueTooLong="VALUE_TOO_LONG",e}({});const messageConstructor$16=({collection:e,field:t})=>`Field "${t}" in collection "${e}" contains null values.`;createError(ErrorCode.ContainsNullValues,messageConstructor$16,400),createError(ErrorCode.ContentTooLarge,"Uploaded content is too large.",413);const messageConstructor$15=e=>e?.reason?e.reason:"You don't have permission to access this.",ForbiddenError=createError(ErrorCode.Forbidden,messageConstructor$15,403),messageConstructor$14=e=>{const t=e.reset.getTime()-Date.now();return`Too many requests, retry after ${ms(t)}.`};createError(ErrorCode.RequestsExceeded,messageConstructor$14,429),createError(ErrorCode.IllegalAssetTransformation,"Illegal asset transformation.",400),createError(ErrorCode.Internal,"An unexpected error occurred."),createError(ErrorCode.InvalidCredentials,"Invalid user credentials.",401);const messageConstructor$13=({collection:e,field:t,value:r})=>{let n="Invalid foreign key";return r&&(n+=` "${r}"`),t&&(n+=` for field "${t}"`),e&&(n+=` in collection "${e}"`),n+=".",n};createError(ErrorCode.InvalidForeignKey,messageConstructor$13,400),createError(ErrorCode.InvalidIp,"Invalid IP address.",401),createError(ErrorCode.InvalidOtp,"Invalid user OTP.",401);const messageConstructor$12=({reason:e})=>`Invalid payload. ${e}.`;createError(ErrorCode.InvalidPayload,messageConstructor$12,400),createError(ErrorCode.InvalidProviderConfig,"Invalid config.",503),createError(ErrorCode.InvalidProvider,"Invalid provider.",403);const messageConstructor$11=({reason:e})=>`Invalid query. ${e}.`;createError(ErrorCode.InvalidQuery,messageConstructor$11,400),createError(ErrorCode.InvalidToken,"Invalid token.",403);const messageConstructor$10=({category:e})=>`${e} limit exceeded.`;createError(ErrorCode.LimitExceeded,messageConstructor$10,403);const messageConstructor$9=e=>`Invalid method "${e.current}" used. Should be one of ${e.allowed.map(e=>`"${e}"`).join(", ")}.`;createError(ErrorCode.MethodNotAllowed,messageConstructor$9,405);const messageConstructor$8=({collection:e,field:t})=>{let r="Value ";return t&&(r+=`for field "${t}" `),e&&(r+=`in collection "${e}" `),r+="can't be null.",r};createError(ErrorCode.NotNullViolation,messageConstructor$8,400),createError(ErrorCode.OutOfDate,"Operation could not be executed: Your current instance of Directus is out of date.",503);const messageConstructor$7=({range:e})=>`Range "${e.start??""}-${e.end??""}" is invalid or the file's size doesn't match the requested range.`;createError(ErrorCode.RangeNotSatisfiable,messageConstructor$7,416);const messageConstructor$6=({collection:e,field:t,value:r})=>{let n="Value ";return r&&(n+=`"${r}" `),t&&(n+=`for field "${t}" `),e&&(n+=`in collection "${e}" `),n+="has to be unique.",n};createError(ErrorCode.RecordNotUnique,messageConstructor$6,400);const messageConstructor$5=({path:e})=>`Route ${e} doesn't exist.`;createError(ErrorCode.RouteNotFound,messageConstructor$5,404);const messageConstructor$4=({service:e,reason:t})=>`Service "${e}" is unavailable. ${t}.`;createError(ErrorCode.ServiceUnavailable,messageConstructor$4,503),createError(ErrorCode.TokenExpired,"Token expired.",401),createError(ErrorCode.UnexpectedResponse,"Received an unexpected response.",503);const messageConstructor$3=e=>`Can't process content. ${e.reason}.`;createError(ErrorCode.UnprocessableContent,messageConstructor$3,422);const messageConstructor$2=e=>`Unsupported media type "${e.mediaType}" in ${e.where}.`;createError(ErrorCode.UnsupportedMediaType,messageConstructor$2,415),createError(ErrorCode.UserSuspended,"User suspended.",401);const messageConstructor$1=({collection:e,field:t,value:r})=>{let n="Numeric value ";return r&&(n+=`"${r}" `),t&&(n+=`for field "${t}" `),e&&(n+=`in collection "${e}" `),n+="is out of range.",n};createError(ErrorCode.ValueOutOfRange,messageConstructor$1,400);const messageConstructor=({collection:e,field:t,value:r})=>{let n="Value ";return r&&(n+=`"${r}" `),t&&(n+=`for field "${t}" `),e&&(n+=`in collection "${e}" `),n+="is too long.",n};createError(ErrorCode.ValueTooLong,messageConstructor,400);const APP_EXTENSION_TYPES=["interface","display","layout","module","panel","theme"],API_EXTENSION_TYPES=["hook","endpoint"],HYBRID_EXTENSION_TYPES=["operation"],BUNDLE_EXTENSION_TYPES=["bundle"];var numberConstructor=(0).constructor;numberConstructor.isFinite,numberConstructor.isInteger,[].constructor.isArray;var cacheSize=1e3,Cache=function(){function e(e){this.size=e,this.reset()}return e.prototype.reset=function(){this.oldestIndex=0,this.map={},this.cachedKeys=new Array(this.size)},e.prototype.get=function(e){return this.map[e]},e.prototype.set=function(e,t){this.map[e]=t;var r=this.cachedKeys[this.oldestIndex];void 0!==r&&delete this.map[r],this.cachedKeys[this.oldestIndex]=e,this.oldestIndex++,this.oldestIndex%=this.size},e}();new Cache(cacheSize);var lib$5={},assert$1={exports:{}},assertError,hasRequiredAssertError,stringify,hasRequiredStringify,hasRequiredAssert,reach,hasRequiredReach;function requireAssertError(){return hasRequiredAssertError?assertError:(hasRequiredAssertError=1,assertError=class extends Error{name="AssertError";constructor(e,t){super(e||"Unknown error"),"function"==typeof Error.captureStackTrace&&Error.captureStackTrace(this,t)}})}function requireStringify(){return hasRequiredStringify?stringify:(hasRequiredStringify=1,stringify=function(...e){try{return JSON.stringify(...e)}catch(e){return"[Cannot display object: "+e.message+"]"}})}function requireAssert(){if(hasRequiredAssert)return assert$1.exports;hasRequiredAssert=1;const e=requireAssertError(),t=requireStringify(),r=assert$1.exports=function(n,...i){if(n)return;if(1===i.length&&i[0]instanceof Error)throw i[0];const s=i.filter(e=>""!==e).map(e=>"string"==typeof e?e:e instanceof Error?e.message:t(e));throw new e(s.join(" "),r)};return assert$1.exports}function requireReach(){if(hasRequiredReach)return reach;hasRequiredReach=1;const e=requireAssert(),t={};return reach=function(r,n,i){if(!1===n||null==n)return r;"string"==typeof(i=i||{})&&(i={separator:i});const s=Array.isArray(n);e(!s||!i.separator,"Separator option is not valid for array-based chain");const o=s?n:n.split(i.separator||".");let a=r;for(let r=0;r<o.length;++r){let s=o[r];const l=i.iterables&&t.iterables(a);if(Array.isArray(a)||"set"===l){const e=Number(s);Number.isInteger(e)&&(s=e<0?a.length+e:e)}if(!a||"function"==typeof a&&!1===i.functions||!l&&void 0===a[s]){e(!i.strict||r+1===o.length,"Missing segment",s,"in reach path ",n),e("object"==typeof a||!0===i.functions||"function"!=typeof a,"Invalid segment",s,"in reach path ",n),a=i.default;break}a=l?"set"===l?[...a][s]:a.get(s):a[s]}return a},t.iterables=function(e){return e instanceof Set?"set":e instanceof Map?"map":void 0},reach}var types={exports:{}},hasRequiredTypes;function requireTypes(){return hasRequiredTypes||(hasRequiredTypes=1,function(e,t){const r={};t=e.exports={array:Array.prototype,buffer:Buffer&&Buffer.prototype,date:Date.prototype,error:Error.prototype,generic:Object.prototype,map:Map.prototype,promise:Promise.prototype,regex:RegExp.prototype,set:Set.prototype,url:URL.prototype,weakMap:WeakMap.prototype,weakSet:WeakSet.prototype},r.typeMap=new Map([["[object Error]",t.error],["[object Map]",t.map],["[object Promise]",t.promise],["[object Set]",t.set],["[object URL]",t.url],["[object WeakMap]",t.weakMap],["[object WeakSet]",t.weakSet]]),t.getInternalProto=function(e){if(Array.isArray(e))return t.array;if(Buffer&&e instanceof Buffer)return t.buffer;if(e instanceof Date)return t.date;if(e instanceof RegExp)return t.regex;if(e instanceof Error)return t.error;const n=Object.prototype.toString.call(e);return r.typeMap.get(n)||t.generic}}(types,types.exports)),types.exports}var utils={},hasRequiredUtils,clone$1,hasRequiredClone,merge$1,hasRequiredMerge,applyToDefaults,hasRequiredApplyToDefaults,bench,hasRequiredBench,ignore,hasRequiredIgnore,block,hasRequiredBlock,deepEqual,hasRequiredDeepEqual,escapeRegex$2,hasRequiredEscapeRegex,contain,hasRequiredContain,escapeHeaderAttribute,hasRequiredEscapeHeaderAttribute,escapeHtml,hasRequiredEscapeHtml,escapeJson,hasRequiredEscapeJson,flatten,hasRequiredFlatten,intersect,hasRequiredIntersect,isPromise,hasRequiredIsPromise,once,hasRequiredOnce,reachTemplate,hasRequiredReachTemplate,wait,hasRequiredWait,hasRequiredLib$5;function requireUtils(){return hasRequiredUtils||(hasRequiredUtils=1,utils.keys=function(e,t={}){return!1!==t.symbols?Reflect.ownKeys(e):Object.getOwnPropertyNames(e)}),utils}function requireClone(){if(hasRequiredClone)return clone$1;hasRequiredClone=1;const e=requireReach(),t=requireTypes(),r=requireUtils(),n={needsProtoHack:new Set([t.set,t.map,t.weakSet,t.weakMap]),structuredCloneExists:"function"==typeof structuredClone};return clone$1=n.clone=function(e,i={},s=null){if("object"!=typeof e||null===e)return e;let o=n.clone,a=s;if(i.shallow){if(!0!==i.shallow)return n.cloneWithShallow(e,i);o=e=>e}else if(a){const t=a.get(e);if(t)return t}else a=new Map;const l=t.getInternalProto(e);switch(l){case t.buffer:return Buffer?.from(e);case t.date:return new Date(e.getTime());case t.regex:case t.url:return new l.constructor(e)}const c=n.base(e,l,i);if(c===e)return e;if(a&&a.set(e,c),l===t.set)for(const t of e)c.add(o(t,i,a));else if(l===t.map)for(const[t,r]of e)c.set(t,o(r,i,a));const u=r.keys(e,i);for(const r of u){if("__proto__"===r)continue;if(l===t.array&&"length"===r){c.length=e.length;continue}if(n.structuredCloneExists&&l===t.error&&"stack"===r)continue;const s=Object.getOwnPropertyDescriptor(e,r);s?s.get||s.set?Object.defineProperty(c,r,s):s.enumerable?c[r]=o(e[r],i,a):Object.defineProperty(c,r,{enumerable:!1,writable:!0,configurable:!0,value:o(e[r],i,a)}):Object.defineProperty(c,r,{enumerable:!0,writable:!0,configurable:!0,value:o(e[r],i,a)})}return c},n.cloneWithShallow=function(t,r){const i=r.shallow;(r=Object.assign({},r)).shallow=!1;const s=new Map;for(const r of i){const n=e(t,r);"object"!=typeof n&&"function"!=typeof n||s.set(n,n)}return n.clone(t,r,s)},n.base=function(e,r,i){if(!1===i.prototype)return n.needsProtoHack.has(r)?new r.constructor:r===t.array?[]:{};const s=Object.getPrototypeOf(e);if(s&&s.isImmutable)return e;if(r===t.array){const e=[];return s!==r&&Object.setPrototypeOf(e,s),e}if(r===t.error&&n.structuredCloneExists&&(s===r||Error.isPrototypeOf(s.constructor))){const t=structuredClone(e);return Object.getPrototypeOf(t)!==s&&Object.setPrototypeOf(t,s),t}if(n.needsProtoHack.has(r)){const e=new s.constructor;return s!==r&&Object.setPrototypeOf(e,s),e}return Object.create(s)},clone$1}function requireMerge(){if(hasRequiredMerge)return merge$1;hasRequiredMerge=1;const e=requireAssert(),t=requireClone(),r=requireUtils(),n={};return merge$1=n.merge=function(i,s,o){if(e(i&&"object"==typeof i,"Invalid target value: must be an object"),e(null==s||"object"==typeof s,"Invalid source value: must be null, undefined, or an object"),!s)return i;if(o=Object.assign({nullOverride:!0,mergeArrays:!0},o),Array.isArray(s)){e(Array.isArray(i),"Cannot merge array onto an object"),o.mergeArrays||(i.length=0);for(let e=0;e<s.length;++e)i.push(t(s[e],{symbols:o.symbols}));return i}const a=r.keys(s,o);for(let e=0;e<a.length;++e){const r=a[e];if("__proto__"===r||!Object.prototype.propertyIsEnumerable.call(s,r))continue;const l=s[r];if(l&&"object"==typeof l){if(i[r]===l)continue;!i[r]||"object"!=typeof i[r]||Array.isArray(i[r])!==Array.isArray(l)||l instanceof Date||Buffer&&Buffer.isBuffer(l)||l instanceof RegExp?i[r]=t(l,{symbols:o.symbols}):n.merge(i[r],l,o)}else(null!=l||o.nullOverride)&&(i[r]=l)}return i},merge$1}function requireApplyToDefaults(){if(hasRequiredApplyToDefaults)return applyToDefaults;hasRequiredApplyToDefaults=1;const e=requireAssert(),t=requireClone(),r=requireMerge(),n=requireReach(),i={};return applyToDefaults=function(n,s,o={}){if(e(n&&"object"==typeof n,"Invalid defaults value: must be an object"),e(!s||!0===s||"object"==typeof s,"Invalid source value: must be true, falsy or an object"),e("object"==typeof o,"Invalid options: must be an object"),!s)return null;if(o.shallow)return i.applyToDefaultsWithShallow(n,s,o);const a=t(n);if(!0===s)return a;const l=void 0!==o.nullOverride&&o.nullOverride;return r(a,s,{nullOverride:l,mergeArrays:!1})},i.applyToDefaultsWithShallow=function(s,o,a){const l=a.shallow;e(Array.isArray(l),"Invalid keys");const c=new Map,u=!0===o?null:new Set;for(let e of l){e=Array.isArray(e)?e:e.split(".");const t=n(s,e);t&&"object"==typeof t?c.set(t,u&&n(o,e)||t):u&&u.add(e)}const d=t(s,{},c);if(!u)return d;for(const e of u)i.reachCopy(d,o,e);const h=void 0!==a.nullOverride&&a.nullOverride;return r(d,o,{nullOverride:h,mergeArrays:!1})},i.reachCopy=function(e,t,r){for(const e of r){if(!(e in t))return;const r=t[e];if("object"!=typeof r||null===r)return;t=r}const n=t;let i=e;for(let e=0;e<r.length-1;++e){const t=r[e];"object"!=typeof i[t]&&(i[t]={}),i=i[t]}i[r[r.length-1]]=n},applyToDefaults}function requireBench(){if(hasRequiredBench)return bench;hasRequiredBench=1;const e={};return bench=e.Bench=class{constructor(){this.ts=0,this.reset()}reset(){this.ts=e.Bench.now()}elapsed(){return e.Bench.now()-this.ts}static now(){const e=process.hrtime();return 1e3*e[0]+e[1]/1e6}}}function requireIgnore(){return hasRequiredIgnore?ignore:(hasRequiredIgnore=1,ignore=function(){})}function requireBlock(){if(hasRequiredBlock)return block;hasRequiredBlock=1;const e=requireIgnore();return block=function(){return new Promise(e)}}function requireDeepEqual(){if(hasRequiredDeepEqual)return deepEqual;hasRequiredDeepEqual=1;const e=requireTypes(),t={mismatched:null};return deepEqual=function(e,r,n){return n=Object.assign({prototype:!0},n),!!t.isDeepEqual(e,r,n,[])},t.isDeepEqual=function(r,n,i,s){if(r===n)return 0!==r||1/r==1/n;const o=typeof r;if(o!==typeof n)return!1;if(null===r||null===n)return!1;if("function"===o){if(!i.deepFunction||r.toString()!==n.toString())return!1}else if("object"!==o)return r!=r&&n!=n;const a=t.getSharedType(r,n,!!i.prototype);switch(a){case e.buffer:return Buffer&&Buffer.prototype.equals.call(r,n);case e.promise:return r===n;case e.regex:case e.url:return r.toString()===n.toString();case t.mismatched:return!1}for(let e=s.length-1;e>=0;--e)if(s[e].isSame(r,n))return!0;s.push(new t.SeenEntry(r,n));try{return!!t.isDeepEqualObj(a,r,n,i,s)}finally{s.pop()}},t.getSharedType=function(r,n,i){if(i)return Object.getPrototypeOf(r)!==Object.getPrototypeOf(n)?t.mismatched:e.getInternalProto(r);const s=e.getInternalProto(r);return s!==e.getInternalProto(n)?t.mismatched:s},t.valueOf=function(e){const t=e.valueOf;if(void 0===t)return e;try{return t.call(e)}catch(e){return e}},t.hasOwnEnumerableProperty=function(e,t){return Object.prototype.propertyIsEnumerable.call(e,t)},t.isSetSimpleEqual=function(e,t){for(const r of Set.prototype.values.call(e))if(!Set.prototype.has.call(t,r))return!1;return!0},t.isDeepEqualObj=function(r,n,i,s,o){const{isDeepEqual:a,valueOf:l,hasOwnEnumerableProperty:c}=t,{keys:u,getOwnPropertySymbols:d}=Object;if(r===e.array){if(!s.part){if(n.length!==i.length)return!1;for(let e=0;e<n.length;++e)if(!a(n[e],i[e],s,o))return!1;return!0}for(const e of n)for(const t of i)if(a(e,t,s,o))return!0}else if(r===e.set){if(n.size!==i.size)return!1;if(!t.isSetSimpleEqual(n,i)){const e=new Set(Set.prototype.values.call(i));for(const t of Set.prototype.values.call(n)){if(e.delete(t))continue;let r=!1;for(const n of e)if(a(t,n,s,o)){e.delete(n),r=!0;break}if(!r)return!1}}}else if(r===e.map){if(n.size!==i.size)return!1;for(const[e,t]of Map.prototype.entries.call(n)){if(void 0===t&&!Map.prototype.has.call(i,e))return!1;if(!a(t,Map.prototype.get.call(i,e),s,o))return!1}}else if(r===e.error&&(n.name!==i.name||n.message!==i.message))return!1;const h=l(n),f=l(i);if((n!==h||i!==f)&&!a(h,f,s,o))return!1;const p=u(n);if(!s.part&&p.length!==u(i).length&&!s.skip)return!1;let m=0;for(const e of p)if(s.skip&&s.skip.includes(e))void 0===i[e]&&++m;else{if(!c(i,e))return!1;if(!a(n[e],i[e],s,o))return!1}if(!s.part&&p.length-m!==u(i).length)return!1;if(!1!==s.symbols){const e=d(n),t=new Set(d(i));for(const r of e){if(!s.skip?.includes(r))if(c(n,r)){if(!c(i,r))return!1;if(!a(n[r],i[r],s,o))return!1}else if(c(i,r))return!1;t.delete(r)}for(const e of t)if(c(i,e))return!1}return!0},t.SeenEntry=class{constructor(e,t){this.obj=e,this.ref=t}isSame(e,t){return this.obj===e&&this.ref===t}},deepEqual}function requireEscapeRegex(){return hasRequiredEscapeRegex||(hasRequiredEscapeRegex=1,escapeRegex$2=function(e){return e.replace(/[\^\$\.\*\+\-\?\=\!\:\|\\\/\(\)\[\]\{\}\,]/g,"\\$&")}),escapeRegex$2}function requireContain(){if(hasRequiredContain)return contain;hasRequiredContain=1;const e=requireAssert(),t=requireDeepEqual(),r=requireEscapeRegex(),n=requireUtils(),i={};return contain=function(t,r,n={}){return"object"!=typeof r&&(r=[r]),e(!Array.isArray(r)||r.length,"Values array cannot be empty"),"string"==typeof t?i.string(t,r,n):Array.isArray(t)?i.array(t,r,n):(e("object"==typeof t,"Reference must be string or an object"),i.object(t,r,n))},i.array=function(e,t,r){if(Array.isArray(t)||(t=[t]),!e.length)return!1;if(r.only&&r.once&&e.length!==t.length)return!1;let n;const s=new Map;for(const e of t)if(r.deep&&e&&"object"==typeof e){n=n??i.compare(r);let t=!1;for(const[r,i]of s.entries())if(n(r,e)){++i.allowed,t=!0;break}t||s.set(e,{allowed:1,hits:0})}else{const t=s.get(e);t?++t.allowed:s.set(e,{allowed:1,hits:0})}let o=0;for(const t of e){let e;if(r.deep&&t&&"object"==typeof t){n=n??i.compare(r);for(const[r,i]of s.entries())if(n(r,t)){e=i;break}}else e=s.get(t);if(e&&(++e.hits,++o,r.once&&e.hits>e.allowed))return!1}if(r.only&&o!==e.length)return!1;for(const e of s.values())if(e.hits!==e.allowed&&e.hits<e.allowed&&!r.part)return!1;return!!o},i.object=function(t,r,s){e(void 0===s.once,"Cannot use option once with object");const o=n.keys(t,s);if(!o.length)return!1;if(Array.isArray(r))return i.array(o,r,s);const a=Object.getOwnPropertySymbols(r).filter(e=>r.propertyIsEnumerable(e)),l=[...Object.keys(r),...a],c=i.compare(s),u=new Set(l);for(const e of o)if(u.has(e)){if(!c(r[e],t[e]))return!1;u.delete(e)}else if(s.only)return!1;return!u.size||!!s.part&&u.size<l.length},i.string=function(t,n,i){if(""===t)return 1===n.length&&""===n[0]||!i.once&&!n.some(e=>""!==e);const s=new Map,o=[];for(const t of n)if(e("string"==typeof t,"Cannot compare string reference to non-string value"),t){const e=s.get(t);e?++e.allowed:(s.set(t,{allowed:1,hits:0}),o.push(r(t)))}else if(i.once||i.only)return!1;if(!o.length)return!0;const a=new RegExp(`(${o.join("|")})`,"g"),l=t.replace(a,(e,t)=>(++s.get(t).hits,""));if(i.only&&l)return!1;let c=!1;for(const e of s.values())if(e.hits&&(c=!0),e.hits!==e.allowed){if(e.hits<e.allowed&&!i.part)return!1;if(i.once)return!1}return!!c},i.compare=function(e){if(!e.deep)return i.shallow;const r=void 0!==e.only,n=void 0!==e.part,s={prototype:r?e.only:!!n&&!e.part,part:r?!e.only:!!n&&e.part};return(e,r)=>t(e,r,s)},i.shallow=function(e,t){return e===t},contain}function requireEscapeHeaderAttribute(){if(hasRequiredEscapeHeaderAttribute)return escapeHeaderAttribute;hasRequiredEscapeHeaderAttribute=1;const e=requireAssert();return escapeHeaderAttribute=function(t){return e(/^[ \w\!#\$%&'\(\)\*\+,\-\.\/\:;<\=>\?@\[\]\^`\{\|\}~\"\\]*$/.test(t),"Bad attribute value ("+t+")"),t.replace(/\\/g,"\\\\").replace(/\"/g,'\\"')}}function requireEscapeHtml(){if(hasRequiredEscapeHtml)return escapeHtml;hasRequiredEscapeHtml=1;const e={};return escapeHtml=function(t){if(!t)return"";let r="";for(let n=0;n<t.length;++n){const i=t.charCodeAt(n);e.isSafe(i)?r+=t[n]:r+=e.escapeHtmlChar(i)}return r},e.escapeHtmlChar=function(t){const r=e.namedHtml.get(t);if(r)return r;if(t>=256)return"&#"+t+";";return`&#x${t.toString(16).padStart(2,"0")};`},e.isSafe=function(t){return e.safeCharCodes.has(t)},e.namedHtml=new Map([[38,"&amp;"],[60,"&lt;"],[62,"&gt;"],[34,"&quot;"],[160,"&nbsp;"],[162,"&cent;"],[163,"&pound;"],[164,"&curren;"],[169,"&copy;"],[174,"&reg;"]]),e.safeCharCodes=function(){const e=new Set;for(let t=32;t<123;++t)(t>=97||t>=65&&t<=90||t>=48&&t<=57||32===t||46===t||44===t||45===t||58===t||95===t)&&e.add(t);return e}(),escapeHtml}function requireEscapeJson(){if(hasRequiredEscapeJson)return escapeJson;hasRequiredEscapeJson=1;const e={};return escapeJson=function(t){return t?t.replace(/[<>&\u2028\u2029]/g,e.escape):""},e.escape=function(t){return e.replacements.get(t)},e.replacements=new Map([["<","\\u003c"],[">","\\u003e"],["&","\\u0026"],["\u2028","\\u2028"],["\u2029","\\u2029"]]),escapeJson}function requireFlatten(){if(hasRequiredFlatten)return flatten;hasRequiredFlatten=1;const e={};return flatten=e.flatten=function(t,r){const n=r||[];for(const r of t)Array.isArray(r)?e.flatten(r,n):n.push(r);return n},flatten}function requireIntersect(){if(hasRequiredIntersect)return intersect;hasRequiredIntersect=1;const e={};return intersect=function(t,r,n={}){if(!t||!r)return n.first?null:[];const i=[],s=Array.isArray(t)?new Set(t):t,o=new Set;for(const t of r)if(e.has(s,t)&&!o.has(t)){if(n.first)return t;i.push(t),o.add(t)}return n.first?null:i},e.has=function(e,t){return"function"==typeof e.has?e.has(t):void 0!==e[t]},intersect}function requireIsPromise(){return hasRequiredIsPromise?isPromise:(hasRequiredIsPromise=1,isPromise=function(e){return"function"==typeof e?.then})}function requireOnce(){if(hasRequiredOnce)return once;hasRequiredOnce=1;const e=Symbol("wrapped");return once=function(t){if(t[e])return t;let r=!1;const n=function(...e){r||(r=!0,t(...e))};return n[e]=!0,n}}function requireReachTemplate(){if(hasRequiredReachTemplate)return reachTemplate;hasRequiredReachTemplate=1;const e=requireReach();return reachTemplate=function(t,r,n){return r.replace(/{([^{}]+)}/g,(r,i)=>e(t,i,n)??"")},reachTemplate}function requireWait(){if(hasRequiredWait)return wait;hasRequiredWait=1;const e=2**31-1;return wait=function(t,r,n){if("bigint"==typeof t&&(t=Number(t)),t>=Number.MAX_SAFE_INTEGER&&(t=1/0),"number"!=typeof t&&void 0!==t)throw new TypeError("Timeout must be a number or bigint");return new Promise(i=>{const s=n?n.setTimeout:setTimeout,o=()=>{const n=Math.min(t,e);t-=n,s(()=>t>0?o():i(r),n)};t!==1/0&&o()})},wait}function requireLib$5(){return hasRequiredLib$5||(hasRequiredLib$5=1,lib$5.applyToDefaults=requireApplyToDefaults(),lib$5.assert=requireAssert(),lib$5.AssertError=requireAssertError(),lib$5.Bench=requireBench(),lib$5.block=requireBlock(),lib$5.clone=requireClone(),lib$5.contain=requireContain(),lib$5.deepEqual=requireDeepEqual(),lib$5.escapeHeaderAttribute=requireEscapeHeaderAttribute(),lib$5.escapeHtml=requireEscapeHtml(),lib$5.escapeJson=requireEscapeJson(),lib$5.escapeRegex=requireEscapeRegex(),lib$5.flatten=requireFlatten(),lib$5.ignore=requireIgnore(),lib$5.intersect=requireIntersect(),lib$5.isPromise=requireIsPromise(),lib$5.merge=requireMerge(),lib$5.once=requireOnce(),lib$5.reach=requireReach(),lib$5.reachTemplate=requireReachTemplate(),lib$5.stringify=requireStringify(),lib$5.wait=requireWait()),lib$5}var cache={},common={},version$2="18.0.1",require$$1$1={version:version$2},schemas={},hasRequiredSchemas;function requireSchemas(){if(hasRequiredSchemas)return schemas;hasRequiredSchemas=1;const e=requireLib$1(),t={};return t.wrap=e.string().min(1).max(2).allow(!1),schemas.preferences=e.object({allowUnknown:e.boolean(),abortEarly:e.boolean(),artifacts:e.boolean(),cache:e.boolean(),context:e.object(),convert:e.boolean(),dateFormat:e.valid("date","iso","string","time","utc"),debug:e.boolean(),errors:{escapeHtml:e.boolean(),label:e.valid("path","key",!1),language:[e.string(),e.object().ref()],render:e.boolean(),stack:e.boolean(),wrap:{label:t.wrap,array:t.wrap,string:t.wrap}},externals:e.boolean(),messages:e.object(),noDefaults:e.boolean(),nonEnumerables:e.boolean(),presence:e.valid("required","optional","forbidden"),skipFunctions:e.boolean(),stripUnknown:e.object({arrays:e.boolean(),objects:e.boolean()}).or("arrays","objects").allow(!0,!1),warnings:e.boolean()}).strict(),t.nameRx=/^[a-zA-Z0-9]\w*$/,t.rule=e.object({alias:e.array().items(e.string().pattern(t.nameRx)).single(),args:e.array().items(e.string(),e.object({name:e.string().pattern(t.nameRx).required(),ref:e.boolean(),assert:e.alternatives([e.function(),e.object().schema()]).conditional("ref",{is:!0,then:e.required()}),normalize:e.function(),message:e.string().when("assert",{is:e.function(),then:e.required()})})),convert:e.boolean(),manifest:e.boolean(),method:e.function().allow(!1),multi:e.boolean(),validate:e.function()}),schemas.extension=e.object({type:e.alternatives([e.string(),e.object().regex()]).required(),args:e.function(),cast:e.object().pattern(t.nameRx,e.object({from:e.function().maxArity(1).required(),to:e.function().minArity(1).maxArity(2).required()})),base:e.object().schema().when("type",{is:e.object().regex(),then:e.forbidden()}),coerce:[e.function().maxArity(3),e.object({method:e.function().maxArity(3).required(),from:e.array().items(e.string()).single()})],flags:e.object().pattern(t.nameRx,e.object({setter:e.string(),default:e.any()})),manifest:{build:e.function().arity(2)},messages:[e.object(),e.string()],modifiers:e.object().pattern(t.nameRx,e.function().minArity(1).maxArity(2)),overrides:e.object().pattern(t.nameRx,e.function()),prepare:e.function().maxArity(3),rebuild:e.function().arity(1),rules:e.object().pattern(t.nameRx,t.rule),terms:e.object().pattern(t.nameRx,e.object({init:e.array().allow(null).required(),manifest:e.object().pattern(/.+/,[e.valid("schema","single"),e.object({mapped:e.object({from:e.string().required(),to:e.string().required()}).required()})])})),validate:e.function().maxArity(3)}).strict(),schemas.extensions=e.array().items(e.object(),e.function().arity(1)).strict(),t.desc={buffer:e.object({buffer:e.string()}),func:e.object({function:e.function().required(),options:{literal:!0}}),override:e.object({override:!0}),ref:e.object({ref:e.object({type:e.valid("value","global","local"),path:e.array().required(),separator:e.string().length(1).allow(!1),ancestor:e.number().min(0).integer().allow("root"),map:e.array().items(e.array().length(2)).min(1),adjust:e.function(),iterables:e.boolean(),in:e.boolean(),render:e.boolean()}).required()}),regex:e.object({regex:e.string().min(3)}),special:e.object({special:e.valid("deep").required()}),template:e.object({template:e.string().required(),options:e.object()}),value:e.object({value:e.alternatives([e.object(),e.array()]).required()})},t.desc.entity=e.alternatives([e.array().items(e.link("...")),e.boolean(),e.function(),e.number(),e.string(),t.desc.buffer,t.desc.func,t.desc.ref,t.desc.regex,t.desc.special,t.desc.template,t.desc.value,e.link("/")]),t.desc.values=e.array().items(null,e.boolean(),e.function(),e.number().allow(1/0,-1/0),e.string().allow(""),e.symbol(),t.desc.buffer,t.desc.func,t.desc.override,t.desc.ref,t.desc.regex,t.desc.template,t.desc.value),t.desc.messages=e.object().pattern(/.+/,[e.string(),t.desc.template,e.object().pattern(/.+/,[e.string(),t.desc.template])]),schemas.description=e.object({type:e.string().required(),flags:e.object({cast:e.string(),default:e.any(),description:e.string(),empty:e.link("/"),failover:t.desc.entity,id:e.string(),label:e.string(),only:!0,presence:["optional","required","forbidden"],result:["raw","strip"],strip:e.boolean(),unit:e.string()}).unknown(),preferences:{allowUnknown:e.boolean(),abortEarly:e.boolean(),artifacts:e.boolean(),cache:e.boolean(),convert:e.boolean(),dateFormat:["date","iso","string","time","utc"],errors:{escapeHtml:e.boolean(),label:["path","key"],language:[e.string(),t.desc.ref],wrap:{label:t.wrap,array:t.wrap}},externals:e.boolean(),messages:t.desc.messages,noDefaults:e.boolean(),nonEnumerables:e.boolean(),presence:["required","optional","forbidden"],skipFunctions:e.boolean(),stripUnknown:e.object({arrays:e.boolean(),objects:e.boolean()}).or("arrays","objects").allow(!0,!1),warnings:e.boolean()},allow:t.desc.values,invalid:t.desc.values,rules:e.array().min(1).items({name:e.string().required(),args:e.object().min(1),keep:e.boolean(),message:[e.string(),t.desc.messages],warn:e.boolean()}),keys:e.object().pattern(/.*/,e.link("/")),link:t.desc.ref}).pattern(/^[a-z]\w*$/,e.any()),schemas}var messages={},template={exports:{}},lib$4={},hasRequiredLib$4;function requireLib$4(){return hasRequiredLib$4||(hasRequiredLib$4=1,function(e){const t={operators:["!","^","*","/","%","+","-","<","<=",">",">=","==","!=","&&","||","??"],operatorCharacters:["!","^","*","/","%","+","-","<","=",">","&","|","?"],operatorsOrder:[["^"],["*","/","%"],["+","-"],["<","<=",">",">="],["==","!="],["&&"],["||","??"]],operatorsPrefix:["!","n"],literals:{'"':'"',"`":"`","'":"'","[":"]"},numberRx:/^(?:[0-9]*(\.[0-9]*)?){1}$/,tokenRx:/^[\w\$\#\.\@\:\{\}]+$/,symbol:Symbol("formula"),settings:Symbol("settings")};e.Parser=class{constructor(e,r={}){if(!r[t.settings]&&r.constants)for(const e in r.constants){const t=r.constants[e];if(null!==t&&!["boolean","number","string"].includes(typeof t))throw new Error(`Formula constant ${e} contains invalid ${typeof t} value type`)}this.settings=r[t.settings]?r:Object.assign({[t.settings]:!0,constants:{},functions:{}},r),this.single=null,this._parts=null,this._parse(e)}_parse(r){let n=[],i="",s=0,o=!1;const a=r=>{if(s)throw new Error("Formula missing closing parenthesis");const a=n.length?n[n.length-1]:null;if(o||i||r){if(a&&"reference"===a.type&&")"===r)return a.type="function",a.value=this._subFormula(i,a.value),void(i="");if(")"===r){const t=new e.Parser(i,this.settings);n.push({type:"segment",value:t})}else if(o){if("]"===o)return n.push({type:"reference",value:i}),void(i="");n.push({type:"literal",value:i})}else if(t.operatorCharacters.includes(i))a&&"operator"===a.type&&t.operators.includes(a.value+i)?a.value+=i:n.push({type:"operator",value:i});else if(i.match(t.numberRx))n.push({type:"constant",value:parseFloat(i)});else if(void 0!==this.settings.constants[i])n.push({type:"constant",value:this.settings.constants[i]});else{if(!i.match(t.tokenRx))throw new Error(`Formula contains invalid token: ${i}`);n.push({type:"reference",value:i})}i=""}};for(const e of r)o?e===o?(a(),o=!1):i+=e:s?"("===e?(i+=e,++s):")"===e?(--s,s?i+=e:a(e)):i+=e:e in t.literals?o=t.literals[e]:"("===e?(a(),++s):t.operatorCharacters.includes(e)?(a(),i=e,a()):" "!==e?i+=e:a();a(),n=n.map((e,t)=>"operator"!==e.type||"-"!==e.value||t&&"operator"!==n[t-1].type?e:{type:"operator",value:"n"});let l=!1;for(const e of n){if("operator"===e.type){if(t.operatorsPrefix.includes(e.value))continue;if(!l)throw new Error("Formula contains an operator in invalid position");if(!t.operators.includes(e.value))throw new Error(`Formula contains an unknown operator ${e.value}`)}else if(l)throw new Error("Formula missing expected operator");l=!l}if(!l)throw new Error("Formula contains invalid trailing operator");1===n.length&&["reference","literal","constant"].includes(n[0].type)&&(this.single={type:"reference"===n[0].type?"reference":"value",value:n[0].value}),this._parts=n.map(e=>{if("operator"===e.type)return t.operatorsPrefix.includes(e.value)?e:e.value;if("reference"!==e.type)return e.value;if(this.settings.tokenRx&&!this.settings.tokenRx.test(e.value))throw new Error(`Formula contains invalid reference ${e.value}`);return this.settings.reference?this.settings.reference(e.value):t.reference(e.value)})}_subFormula(r,n){const i=this.settings.functions[n];if("function"!=typeof i)throw new Error(`Formula contains unknown function ${n}`);let s=[];if(r){let e="",i=0,o=!1;const a=()=>{if(!e)throw new Error(`Formula contains function ${n} with invalid arguments ${r}`);s.push(e),e=""};for(let n=0;n<r.length;++n){const s=r[n];o?(e+=s,s===o&&(o=!1)):s in t.literals&&!i?(e+=s,o=t.literals[s]):","!==s||i?(e+=s,"("===s?++i:")"===s&&--i):a()}a()}return s=s.map(t=>new e.Parser(t,this.settings)),function(e){const t=[];for(const r of s)t.push(r.evaluate(e));return i.call(e,...t)}}evaluate(e){const r=this._parts.slice();for(let n=r.length-2;n>=0;--n){const i=r[n];if(i&&"operator"===i.type){const s=r[n+1];r.splice(n+1,1);const o=t.evaluate(s,e);r[n]=t.single(i.value,o)}}return t.operatorsOrder.forEach(n=>{for(let i=1;i<r.length-1;)if(n.includes(r[i])){const n=r[i],s=t.evaluate(r[i-1],e),o=t.evaluate(r[i+1],e);r.splice(i,2);const a=t.calculate(n,s,o);r[i-1]=0===a?0:a}else i+=2}),t.evaluate(r[0],e)}},e.Parser.prototype[t.symbol]=!0,t.reference=function(e){return function(t){return t&&void 0!==t[e]?t[e]:null}},t.evaluate=function(e,r){return null===e?null:"function"==typeof e?e(r):e[t.symbol]?e.evaluate(r):e},t.single=function(e,t){if("!"===e)return!t;const r=-t;return 0===r?0:r},t.calculate=function(e,r,n){if("??"===e)return t.exists(r)?r:n;if("string"==typeof r||"string"==typeof n){if("+"===e)return(r=t.exists(r)?r:"")+(n=t.exists(n)?n:"")}else switch(e){case"^":return Math.pow(r,n);case"*":return r*n;case"/":return r/n;case"%":return r%n;case"+":return r+n;case"-":return r-n}switch(e){case"<":return r<n;case"<=":return r<=n;case">":return r>n;case">=":return r>=n;case"==":return r===n;case"!=":return r!==n;case"&&":return r&&n;case"||":return r||n}return null},t.exists=function(e){return null!=e}}(lib$4)),lib$4}var errors={},annotate={},hasRequiredAnnotate,hasRequiredErrors;function requireAnnotate(){if(hasRequiredAnnotate)return annotate;hasRequiredAnnotate=1;const{clone:e}=requireLib$5(),t=requireCommon(),r={annotations:Symbol("annotations")};return annotate.error=function(n){if(!this._original||"object"!=typeof this._original)return this.details[0].message;const i=n?"":"[31m",s=n?"":"[41m",o=n?"":"[0m",a=e(this._original);for(let e=this.details.length-1;e>=0;--e){const n=e+1,i=this.details[e],s=i.path;let o=a;for(let e=0;;++e){const a=s[e];if(t.isSchema(o)&&(o=o.clone()),!(e+1<s.length&&"string"!=typeof o[a])){const e=o[r.annotations]||{errors:{},missing:{}};o[r.annotations]=e;const t=a||i.context.key;void 0!==o[a]?(e.errors[t]=e.errors[t]||[],e.errors[t].push(n)):e.missing[t]=n;break}o=o[a]}}const l=/_\$key\$_([, \d]+)_\$end\$_"/g,c=/"_\$miss\$_([^|]+)\|(\d+)_\$end\$_": "__missing__"/g,u=/\s*"_\$idx\$_([, \d]+)_\$end\$_",?\n(.*)/g,d=/"\[(NaN|Symbol.*|-?Infinity|function.*|\(.*)]"/g;let h=r.safeStringify(a,2).replace(l,(e,t)=>`" ${i}[${t}]${o}`).replace(c,(e,t,r)=>`${s}"${t}"${o}${i} [${r}]: -- missing --${o}`).replace(u,(e,t,r)=>`\n${r} ${i}[${t}]${o}`).replace(d,(e,t)=>t);h=`${h}\n${i}`;for(let e=0;e<this.details.length;++e){h=`${h}\n[${e+1}] ${this.details[e].message}`}return h+=o,h},r.safeStringify=function(e,t){return JSON.stringify(e,r.serializer(),t)},r.serializer=function(){const e=[],t=[],n=(r,n)=>t[0]===n?"[Circular ~]":"[Circular ~."+e.slice(0,t.indexOf(n)).join(".")+"]";return function(i,s){if(t.length>0){const r=t.indexOf(this);~r?(t.length=r+1,e.length=r+1,e[r]=i):(t.push(this),e.push(i)),~t.indexOf(s)&&(s=n.call(this,i,s))}else t.push(s);if(s){const e=s[r.annotations];if(e){if(Array.isArray(s)){const t=[];for(let r=0;r<s.length;++r)e.errors[r]&&t.push(`_$idx$_${e.errors[r].sort().join(", ")}_$end$_`),t.push(s[r]);s=t}else{for(const t in e.errors)s[`${t}_$key$_${e.errors[t].sort().join(", ")}_$end$_`]=s[t],s[t]=void 0;for(const t in e.missing)s[`_$miss$_${t}|${e.missing[t]}_$end$_`]="__missing__"}return s}}return s===1/0||s===-1/0||Number.isNaN(s)||"function"==typeof s||"symbol"==typeof s?"["+s.toString()+"]":s}},annotate}function requireErrors(){return hasRequiredErrors||(hasRequiredErrors=1,function(e){const t=requireAnnotate(),r=requireCommon(),n=requireTemplate();e.Report=class{constructor(t,r,n,i,s,o,a){if(this.code=t,this.flags=i,this.messages=s,this.path=o.path,this.prefs=a,this.state=o,this.value=r,this.message=null,this.template=null,this.local=n||{},this.local.label=e.label(this.flags,this.state,this.prefs,this.messages),void 0===this.value||this.local.hasOwnProperty("value")||(this.local.value=this.value),this.path.length){const e=this.path[this.path.length-1];"object"!=typeof e&&(this.local.key=e)}}_setTemplate(e){if(this.template=e,!this.flags.label&&0===this.path.length){const e=this._template(this.template,"root");e&&(this.local.label=e)}}toString(){if(this.message)return this.message;const e=this.code;if(!this.prefs.errors.render)return this.code;const t=this._template(this.template)||this._template(this.prefs.messages)||this._template(this.messages);return void 0===t?`Error code "${e}" is not defined, your custom type is missing the correct messages definition`:(this.message=t.render(this.value,this.state,this.prefs,this.local,{errors:this.prefs.errors,messages:[this.prefs.messages,this.messages]}),this.prefs.errors.label||(this.message=this.message.replace(/^"" /,"").trim()),this.message)}_template(t,r){return e.template(this.value,t,r||this.code,this.state,this.prefs)}},e.path=function(e){let t="";for(const r of e)"object"!=typeof r&&("string"==typeof r?(t&&(t+="."),t+=r):t+=`[${r}]`);return t},e.template=function(e,t,i,s,o){if(!t)return;if(n.isTemplate(t))return"root"!==i?t:null;let a=o.errors.language;if(r.isResolvable(a)&&(a=a.resolve(e,s,o)),a&&t[a]){if(void 0!==t[a][i])return t[a][i];if(void 0!==t[a]["*"])return t[a]["*"]}return t[i]?t[i]:t["*"]},e.label=function(t,r,n,i){if(!n.errors.label)return"";if(t.label)return t.label;let s=r.path;"key"===n.errors.label&&r.path.length>1&&(s=r.path.slice(-1));const o=e.path(s);return o||(e.template(null,n.messages,"root",r,n)||i&&e.template(null,i,"root",r,n)||"value")},e.process=function(t,r,n){if(!t)return null;const{override:i,message:s,details:o}=e.details(t);if(i)return i;if(n.errors.stack)return new e.ValidationError(s,o,r);const a=Error.stackTraceLimit;Error.stackTraceLimit=0;const l=new e.ValidationError(s,o,r);return Error.stackTraceLimit=a,l},e.details=function(e,t={}){let r=[];const n=[];for(const i of e){if(i instanceof Error){if(!1!==t.override)return{override:i};const e=i.toString();r.push(e),n.push({message:e,type:"override",context:{error:i}});continue}const e=i.toString();r.push(e),n.push({message:e,path:i.path.filter(e=>"object"!=typeof e),type:i.code,context:i.local})}return r.length>1&&(r=[...new Set(r)]),{message:r.join(". "),details:n}},e.ValidationError=class extends Error{constructor(e,t,r){super(e),this._original=r,this.details=t}static isError(t){return t instanceof e.ValidationError}},e.ValidationError.prototype.isJoi=!0,e.ValidationError.prototype.name="ValidationError",e.ValidationError.prototype.annotate=t.error}(errors)),errors}var ref={},hasRequiredRef,hasRequiredTemplate,hasRequiredMessages,hasRequiredCommon,hasRequiredCache;function requireRef(){return hasRequiredRef||(hasRequiredRef=1,function(e){const{assert:t,clone:r,reach:n}=requireLib$5(),i=requireCommon();let s;const o={symbol:Symbol("ref"),defaults:{adjust:null,in:!1,iterables:null,map:null,separator:".",type:"value"}};e.create=function(e,r={}){t("string"==typeof e,"Invalid reference key:",e),i.assertOptions(r,["adjust","ancestor","in","iterables","map","prefix","render","separator"]),t(!r.prefix||"object"==typeof r.prefix,"options.prefix must be of type object");const n=Object.assign({},o.defaults,r);delete n.prefix;const s=n.separator,a=o.context(e,s,r.prefix);if(n.type=a.type,e=a.key,"value"===n.type)if(a.root&&(t(!s||e[0]!==s,"Cannot specify relative path with root prefix"),n.ancestor="root",e||(e=null)),s&&s===e)e=null,n.ancestor=0;else if(void 0!==n.ancestor)t(!s||!e||e[0]!==s,"Cannot combine prefix with ancestor option");else{const[t,r]=o.ancestor(e,s);r&&""===(e=e.slice(r))&&(e=null),n.ancestor=t}return n.path=s?null===e?[]:e.split(s):[e],new o.Ref(n)},e.in=function(t,r={}){return e.create(t,{...r,in:!0})},e.isRef=function(e){return!!e&&!!e[i.symbols.ref]},o.Ref=class{constructor(e){t("object"==typeof e,"Invalid reference construction"),i.assertOptions(e,["adjust","ancestor","in","iterables","map","path","render","separator","type","depth","key","root","display"]),t([!1,void 0].includes(e.separator)||"string"==typeof e.separator&&1===e.separator.length,"Invalid separator"),t(!e.adjust||"function"==typeof e.adjust,"options.adjust must be a function"),t(!e.map||Array.isArray(e.map),"options.map must be an array"),t(!e.map||!e.adjust,"Cannot set both map and adjust options"),Object.assign(this,o.defaults,e),t("value"===this.type||void 0===this.ancestor,"Non-value references cannot reference ancestors"),Array.isArray(this.map)&&(this.map=new Map(this.map)),this.depth=this.path.length,this.key=this.path.length?this.path.join(this.separator):null,this.root=this.path[0],this.updateDisplay()}resolve(e,r,n,i,s={}){return t(!this.in||s.in,"Invalid in() reference usage"),"global"===this.type?this._resolve(n.context,r,s):"local"===this.type?this._resolve(i,r,s):this.ancestor?"root"===this.ancestor?this._resolve(r.ancestors[r.ancestors.length-1],r,s):(t(this.ancestor<=r.ancestors.length,"Invalid reference exceeds the schema root:",this.display),this._resolve(r.ancestors[this.ancestor-1],r,s)):this._resolve(e,r,s)}_resolve(e,t,r){let i;if("value"===this.type&&t.mainstay.shadow&&!1!==r.shadow&&(i=t.mainstay.shadow.get(this.absolute(t))),void 0===i&&(i=n(e,this.path,{iterables:this.iterables,functions:!0})),this.adjust&&(i=this.adjust(i)),this.map){const e=this.map.get(i);void 0!==e&&(i=e)}return t.mainstay&&t.mainstay.tracer.resolve(t,this,i),i}toString(){return this.display}absolute(e){return[...e.path.slice(0,-this.ancestor),...this.path]}clone(){return new o.Ref(this)}describe(){const e={path:this.path};"value"!==this.type&&(e.type=this.type),"."!==this.separator&&(e.separator=this.separator),"value"===this.type&&1!==this.ancestor&&(e.ancestor=this.ancestor),this.map&&(e.map=[...this.map]);for(const t of["adjust","iterables","render"])null!==this[t]&&void 0!==this[t]&&(e[t]=this[t]);return!1!==this.in&&(e.in=!0),{ref:e}}updateDisplay(){const e=null!==this.key?this.key:"";if("value"!==this.type)return void(this.display=`ref:${this.type}:${e}`);if(!this.separator)return void(this.display=`ref:${e}`);if(!this.ancestor)return void(this.display=`ref:${this.separator}${e}`);if("root"===this.ancestor)return void(this.display=`ref:root:${e}`);if(1===this.ancestor)return void(this.display=`ref:${e||".."}`);const t=new Array(this.ancestor+1).fill(this.separator).join("");this.display=`ref:${t}${e||""}`}},o.Ref.prototype[i.symbols.ref]=!0,e.build=function(e){return"value"===(e=Object.assign({},o.defaults,e)).type&&void 0===e.ancestor&&(e.ancestor=1),new o.Ref(e)},o.context=function(e,t,r={}){if(e=e.trim(),r){const n=void 0===r.global?"$":r.global;if(n!==t&&e.startsWith(n))return{key:e.slice(n.length),type:"global"};const i=void 0===r.local?"#":r.local;if(i!==t&&e.startsWith(i))return{key:e.slice(i.length),type:"local"};const s=void 0===r.root?"/":r.root;if(s!==t&&e.startsWith(s))return{key:e.slice(s.length),type:"value",root:!0}}return{key:e,type:"value"}},o.ancestor=function(e,t){if(!t)return[1,0];if(e[0]!==t)return[1,0];if(e[1]!==t)return[0,1];let r=2;for(;e[r]===t;)++r;return[r-1,r]},e.toSibling=0,e.toParent=1,e.Manager=class{constructor(){this.refs=[]}register(t,r){if(t)if(r=void 0===r?e.toParent:r,Array.isArray(t))for(const e of t)this.register(e,r);else if(i.isSchema(t))for(const e of t._refs.refs)e.ancestor-r>=0&&this.refs.push({ancestor:e.ancestor-r,root:e.root});else e.isRef(t)&&"value"===t.type&&t.ancestor-r>=0&&this.refs.push({ancestor:t.ancestor-r,root:t.root}),s=s||requireTemplate(),s.isTemplate(t)&&this.register(t.refs(),r)}get length(){return this.refs.length}clone(){const t=new e.Manager;return t.refs=r(this.refs),t}reset(){this.refs=[]}roots(){return this.refs.filter(e=>!e.ancestor).map(e=>e.root)}}}(ref)),ref}function requireTemplate(){return hasRequiredTemplate||(hasRequiredTemplate=1,function(e){const{assert:t,clone:r,escapeHtml:n}=requireLib$5(),i=requireLib$4(),s=requireCommon(),o=requireErrors(),a=requireRef(),l={symbol:Symbol("template"),opens:new Array(1e3).join("\0"),closes:new Array(1e3).join(""),dateFormat:{date:Date.prototype.toDateString,iso:Date.prototype.toISOString,string:Date.prototype.toString,time:Date.prototype.toTimeString,utc:Date.prototype.toUTCString}};e.exports=l.Template=class{constructor(e,n){if(t("string"==typeof e,"Template source must be a string"),t(!e.includes("\0")&&!e.includes(""),"Template source cannot contain reserved control characters"),this.source=e,this.rendered=e,this._template=null,n){const{functions:e,...i}=n;this._settings=Object.keys(i).length?r(i):void 0,this._functions=e,this._functions&&(t(Object.keys(this._functions).every(e=>"string"==typeof e),"Functions keys must be strings"),t(Object.values(this._functions).every(e=>"function"==typeof e),"Functions values must be functions"))}else this._settings=void 0,this._functions=void 0;this._parse()}_parse(){if(!this.source.includes("{"))return;const e=l.encode(this.source),t=l.split(e);let r=!1;const n=[],i=t.shift();i&&n.push(i);for(const e of t){const t="{"!==e[0],i=t?"}":"}}",s=e.indexOf(i);if(-1===s||"{"===e[1]){n.push(`{${l.decode(e)}`);continue}let o=e.slice(t?0:1,s);const a=":"===o[0];a&&(o=o.slice(1));const c=this._ref(l.decode(o),{raw:t,wrapped:a});n.push(c),"string"!=typeof c&&(r=!0);const u=e.slice(s+i.length);u&&n.push(l.decode(u))}r?this._template=n:this.rendered=n.join("")}static date(e,t){return l.dateFormat[t.dateFormat].call(e)}describe(e={}){if(!this._settings&&e.compact)return this.source;const t={template:this.source};return this._settings&&(t.options=this._settings),this._functions&&(t.functions=this._functions),t}static build(e){return new l.Template(e.template,e.options||e.functions?{...e.options,functions:e.functions}:void 0)}isDynamic(){return!!this._template}static isTemplate(e){return!!e&&!!e[s.symbols.template]}refs(){if(!this._template)return;const e=[];for(const t of this._template)"string"!=typeof t&&e.push(...t.refs);return e}resolve(e,t,r,n){return this._template&&1===this._template.length?this._part(this._template[0],e,t,r,n,{}):this.render(e,t,r,n)}_part(e,...t){return e.ref?e.ref.resolve(...t):e.formula.evaluate(t)}render(e,t,r,i,s={}){if(!this.isDynamic())return this.rendered;const o=[];for(const a of this._template)if("string"==typeof a)o.push(a);else{const c=this._part(a,e,t,r,i,s),u=l.stringify(c,e,t,r,i,s);if(void 0!==u){const e=a.raw||!1===(s.errors&&s.errors.escapeHtml)?u:n(u);o.push(l.wrap(e,a.wrapped&&r.errors.wrap.label))}}return o.join("")}_ref(e,{raw:t,wrapped:r}){const n=[],s=e=>{const t=a.create(e,this._settings);return n.push(t),e=>{const r=t.resolve(...e);return void 0!==r?r:null}};try{const t=this._functions?{...l.functions,...this._functions}:l.functions;var o=new i.Parser(e,{reference:s,functions:t,constants:l.constants})}catch(t){throw t.message=`Invalid template variable "${e}" fails due to: ${t.message}`,t}if(o.single){if("reference"===o.single.type){const e=n[0];return{ref:e,raw:t,refs:n,wrapped:r||"local"===e.type&&"label"===e.key}}return l.stringify(o.single.value)}return{formula:o,raw:t,refs:n}}toString(){return this.source}},l.Template.prototype[s.symbols.template]=!0,l.Template.prototype.isImmutable=!0,l.encode=function(e){return e.replace(/\\(\{+)/g,(e,t)=>l.opens.slice(0,t.length)).replace(/\\(\}+)/g,(e,t)=>l.closes.slice(0,t.length))},l.decode=function(e){return e.replace(/\u0000/g,"{").replace(/\u0001/g,"}")},l.split=function(e){const t=[];let r="";for(let n=0;n<e.length;++n){const i=e[n];if("{"===i){let i="";for(;n+1<e.length&&"{"===e[n+1];)i+="{",++n;t.push(r),r=i}else r+=i}return t.push(r),t},l.wrap=function(e,t){return t?1===t.length?`${t}${e}${t}`:`${t[0]}${e}${t[1]}`:e},l.stringify=function(e,t,r,n,i,s={}){const o=typeof e,c=n&&n.errors&&n.errors.wrap||{};let u=!1;if(a.isRef(e)&&e.render&&(u=e.in,e=e.resolve(t,r,n,i,{in:e.in,...s})),null===e)return"null";if("string"===o)return l.wrap(e,s.arrayItems&&c.string);if("number"===o||"function"===o||"symbol"===o)return e.toString();if("object"!==o)return JSON.stringify(e);if(e instanceof Date)return l.Template.date(e,n);if(e instanceof Map){const t=[];for(const[r,n]of e.entries())t.push(`${r.toString()} -> ${n.toString()}`);e=t}if(!Array.isArray(e))return e.toString();const d=[];for(const o of e)d.push(l.stringify(o,t,r,n,i,{arrayItems:!0,...s}));return l.wrap(d.join(", "),!u&&c.array)},l.constants={true:!0,false:!1,null:null,second:1e3,minute:6e4,hour:36e5,day:864e5},l.functions={if:(e,t,r)=>e?t:r,length:e=>"string"==typeof e?e.length:e&&"object"==typeof e?Array.isArray(e)?e.length:Object.keys(e).length:null,msg(e){const[t,r,n,i,s]=this,a=s.messages;if(!a)return"";const l=o.template(t,a[0],e,r,n)||o.template(t,a[1],e,r,n);return l?l.render(t,r,n,i,s):""},number:e=>"number"==typeof e?e:"string"==typeof e?parseFloat(e):"boolean"==typeof e?e?1:0:e instanceof Date?e.getTime():null}}(template)),template.exports}function requireMessages(){return hasRequiredMessages||(hasRequiredMessages=1,function(e){const{assert:t,clone:r}=requireLib$5(),n=requireTemplate();e.compile=function(e,i){if("string"==typeof e)return t(!i,"Cannot set single message string"),new n(e);if(n.isTemplate(e))return t(!i,"Cannot set single message template"),e;t("object"==typeof e&&!Array.isArray(e),"Invalid message options"),i=i?r(i):{};for(let r in e){const s=e[r];if("root"===r||n.isTemplate(s)){i[r]=s;continue}if("string"==typeof s){i[r]=new n(s);continue}t("object"==typeof s&&!Array.isArray(s),"Invalid message for",r);const o=r;for(r in i[o]=i[o]||{},s){const e=s[r];"root"===r||n.isTemplate(e)?i[o][r]=e:(t("string"==typeof e,"Invalid message for",r,"in",o),i[o][r]=new n(e))}}return i},e.decompile=function(e){const t={};for(let r in e){const i=e[r];if("root"===r){t.root=i;continue}if(n.isTemplate(i)){t[r]=i.describe({compact:!0});continue}const s=r;for(r in t[s]={},i){const e=i[r];"root"!==r?t[s][r]=e.describe({compact:!0}):t[s].root=e}}return t},e.merge=function(i,s){if(!i)return e.compile(s);if(!s)return i;if("string"==typeof s)return new n(s);if(n.isTemplate(s))return s;const o=r(i);for(let e in s){const r=s[e];if("root"===e||n.isTemplate(r)){o[e]=r;continue}if("string"==typeof r){o[e]=new n(r);continue}t("object"==typeof r&&!Array.isArray(r),"Invalid message for",e);const i=e;for(e in o[i]=o[i]||{},r){const s=r[e];"root"===e||n.isTemplate(s)?o[i][e]=s:(t("string"==typeof s,"Invalid message for",e,"in",i),o[i][e]=new n(s))}}return o}}(messages)),messages}function requireCommon(){return hasRequiredCommon||(hasRequiredCommon=1,function(e){const{assert:t,AssertError:r}=requireLib$5(),n=require$$1$1;let i,s;const o={isoDate:/^(?:[-+]\d{2})?(?:\d{4}(?!\d{2}\b))(?:(-?)(?:(?:0[1-9]|1[0-2])(?:\1(?:[12]\d|0[1-9]|3[01]))?|W(?:[0-4]\d|5[0-2])(?:-?[1-7])?|(?:00[1-9]|0[1-9]\d|[12]\d{2}|3(?:[0-5]\d|6[1-6])))(?![T]$|[T][\d]+Z$)(?:[T\s](?:(?:(?:[01]\d|2[0-3])(?:(:?)[0-5]\d)?|24\:?00)(?:[.,]\d+(?!:))?)(?:\2[0-5]\d(?:[.,]\d+)?)?(?:[Z]|(?:[+-])(?:[01]\d|2[0-3])(?::?[0-5]\d)?)?)?)?$/};e.version=n.version,e.defaults={abortEarly:!0,allowUnknown:!1,artifacts:!1,cache:!0,context:null,convert:!0,dateFormat:"iso",errors:{escapeHtml:!1,label:"path",language:null,render:!0,stack:!1,wrap:{label:'"',array:"[]"}},externals:!0,messages:{},nonEnumerables:!1,noDefaults:!1,presence:"optional",skipFunctions:!1,stripUnknown:!1,warnings:!1},e.symbols={any:Symbol.for("@hapi/joi/schema"),arraySingle:Symbol("arraySingle"),deepDefault:Symbol("deepDefault"),errors:Symbol("errors"),literal:Symbol("literal"),override:Symbol("override"),parent:Symbol("parent"),prefs:Symbol("prefs"),ref:Symbol("ref"),template:Symbol("template"),values:Symbol("values")},e.assertOptions=function(e,r,n="Options"){t(e&&"object"==typeof e&&!Array.isArray(e),"Options must be of type object");const i=Object.keys(e).filter(e=>!r.includes(e));t(0===i.length,`${n} contain unknown keys: ${i}`)},e.checkPreferences=function(e){s=s||requireSchemas();const t=s.preferences.validate(e);if(t.error)throw new r([t.error.details[0].message])},e.compare=function(e,t,r){switch(r){case"=":return e===t;case">":return e>t;case"<":return e<t;case">=":return e>=t;case"<=":return e<=t}},e.default=function(e,t){return void 0===e?t:e},e.isIsoDate=function(e){return o.isoDate.test(e)},e.isNumber=function(e){return"number"==typeof e&&!isNaN(e)},e.isResolvable=function(t){return!!t&&(t[e.symbols.ref]||t[e.symbols.template])},e.isSchema=function(r,n={}){const i=r&&r[e.symbols.any];return!!i&&(t(n.legacy||i.version===e.version,"Cannot mix different versions of joi schemas"),!0)},e.isValues=function(t){return t[e.symbols.values]},e.limit=function(e){return Number.isSafeInteger(e)&&e>=0},e.preferences=function(t,r){i=i||requireMessages(),t=t||{},r=r||{};const n=Object.assign({},t,r);return r.errors&&t.errors&&(n.errors=Object.assign({},t.errors,r.errors),n.errors.wrap=Object.assign({},t.errors.wrap,r.errors.wrap)),r.messages&&(n.messages=i.compile(r.messages,t.messages)),delete n[e.symbols.prefs],n},e.tryWithPath=function(e,t,r={}){try{return e()}catch(e){throw void 0!==e.path?e.path=t+"."+e.path:e.path=t,r.append&&(e.message=`${e.message} (${e.path})`),e}},e.validateArg=function(t,r,{assert:n,message:i}){if(e.isSchema(n)){const e=n.validate(t);if(!e.error)return;return e.error.message}if(!n(t))return r?`${r} ${i}`:i},e.verifyFlat=function(e,r){for(const n of e)t(!Array.isArray(n),"Method no longer accepts array arguments:",r)}}(common)),common}function requireCache(){if(hasRequiredCache)return cache;hasRequiredCache=1;const{assert:e,clone:t}=requireLib$5(),r=requireCommon(),n={max:1e3,supported:new Set(["undefined","boolean","number","string"])};return cache.provider={provision:e=>new n.Cache(e)},n.Cache=class{constructor(t={}){r.assertOptions(t,["max"]),e(void 0===t.max||t.max&&t.max>0&&isFinite(t.max),"Invalid max cache size"),this._max=t.max||n.max,this._map=new Map,this._list=new n.List}get length(){return this._map.size}set(e,t){if(null!==e&&!n.supported.has(typeof e))return;let r=this._map.get(e);if(r)return r.value=t,void this._list.first(r);r=this._list.unshift({key:e,value:t}),this._map.set(e,r),this._compact()}get(e){const r=this._map.get(e);if(r)return this._list.first(r),t(r.value)}_compact(){if(this._map.size>this._max){const e=this._list.pop();this._map.delete(e.key)}}},n.List=class{constructor(){this.tail=null,this.head=null}unshift(e){return e.next=null,e.prev=this.head,this.head&&(this.head.next=e),this.head=e,this.tail||(this.tail=e),e}first(e){e!==this.head&&(this._remove(e),this.unshift(e))}pop(){return this._remove(this.tail)}_remove(e){const{next:t,prev:r}=e;return t.prev=r,r&&(r.next=t),e===this.tail&&(this.tail=t),e.prev=null,e.next=null,e}},cache}var compile={},hasRequiredCompile;function requireCompile(){return hasRequiredCompile||(hasRequiredCompile=1,function(e){const{assert:t}=requireLib$5(),r=requireCommon(),n=requireRef(),i={};e.schema=function(e,t,n={}){r.assertOptions(n,["appendPath","override"]);try{return i.schema(e,t,n)}catch(e){throw n.appendPath&&void 0!==e.path&&(e.message=`${e.message} (${e.path})`),e}},i.schema=function(e,n,s){t(void 0!==n,"Invalid undefined schema"),Array.isArray(n)&&(t(n.length,"Invalid empty array schema"),1===n.length&&(n=n[0]));const o=(t,...r)=>!1!==s.override?t.valid(e.override,...r):t.valid(...r);if(i.simple(n))return o(e,n);if("function"==typeof n)return e.custom(n);if(t("object"==typeof n,"Invalid schema content:",typeof n),r.isResolvable(n))return o(e,n);if(r.isSchema(n))return n;if(Array.isArray(n)){for(const t of n)if(!i.simple(t))return e.alternatives().try(...n);return o(e,...n)}return n instanceof RegExp?e.string().regex(n):n instanceof Date?o(e.date(),n):(t(Object.getPrototypeOf(n)===Object.getPrototypeOf({}),"Schema can only contain plain objects"),e.object().keys(n))},e.ref=function(e,t){return n.isRef(e)?e:n.create(e,t)},e.compile=function(n,s,o={}){r.assertOptions(o,["legacy"]);const a=s&&s[r.symbols.any];if(a)return t(o.legacy||a.version===r.version,"Cannot mix different versions of joi schemas:",a.version,r.version),s;if("object"!=typeof s||!o.legacy)return e.schema(n,s,{appendPath:!0});const l=i.walk(s);return l?l.compile(l.root,s):e.schema(n,s,{appendPath:!0})},i.walk=function(e){if("object"!=typeof e)return null;if(Array.isArray(e)){for(const t of e){const e=i.walk(t);if(e)return e}return null}const n=e[r.symbols.any];if(n)return{root:e[n.root],compile:n.compile};t(Object.getPrototypeOf(e)===Object.getPrototypeOf({}),"Schema can only contain plain objects");for(const t in e){const r=i.walk(e[t]);if(r)return r}return null},i.simple=function(e){return null===e||["boolean","string","number"].includes(typeof e)},e.when=function(s,o,a){if(void 0===a&&(t(o&&"object"==typeof o,"Missing options"),a=o,o=n.create(".")),Array.isArray(a)&&(a={switch:a}),r.assertOptions(a,["is","not","then","otherwise","switch","break"]),r.isSchema(o))return t(void 0===a.is,'"is" can not be used with a schema condition'),t(void 0===a.not,'"not" can not be used with a schema condition'),t(void 0===a.switch,'"switch" can not be used with a schema condition'),i.condition(s,{is:o,then:a.then,otherwise:a.otherwise,break:a.break});if(t(n.isRef(o)||"string"==typeof o,"Invalid condition:",o),t(void 0===a.not||void 0===a.is,'Cannot combine "is" with "not"'),void 0===a.switch){let l=a;void 0!==a.not&&(l={is:a.not,then:a.otherwise,otherwise:a.then,break:a.break});let c=void 0!==l.is?s.$_compile(l.is):s.$_root.invalid(null,!1,0,"").required();return t(void 0!==l.then||void 0!==l.otherwise,'options must have at least one of "then", "otherwise", or "switch"'),t(void 0===l.break||void 0===l.then||void 0===l.otherwise,"Cannot specify then, otherwise, and break all together"),void 0===a.is||n.isRef(a.is)||r.isSchema(a.is)||(c=c.required()),i.condition(s,{ref:e.ref(o),is:c,then:l.then,otherwise:l.otherwise,break:l.break})}t(Array.isArray(a.switch),'"switch" must be an array'),t(void 0===a.is,'Cannot combine "switch" with "is"'),t(void 0===a.not,'Cannot combine "switch" with "not"'),t(void 0===a.then,'Cannot combine "switch" with "then"');const l={ref:e.ref(o),switch:[],break:a.break};for(let e=0;e<a.switch.length;++e){const i=a.switch[e],o=e===a.switch.length-1;r.assertOptions(i,o?["is","then","otherwise"]:["is","then"]),t(void 0!==i.is,'Switch statement missing "is"'),t(void 0!==i.then,'Switch statement missing "then"');const c={is:s.$_compile(i.is),then:s.$_compile(i.then)};if(n.isRef(i.is)||r.isSchema(i.is)||(c.is=c.is.required()),o){t(void 0===a.otherwise||void 0===i.otherwise,'Cannot specify "otherwise" inside and outside a "switch"');const e=void 0!==a.otherwise?a.otherwise:i.otherwise;void 0!==e&&(t(void 0===l.break,"Cannot specify both otherwise and break"),c.otherwise=s.$_compile(e))}l.switch.push(c)}return l},i.condition=function(e,t){for(const r of["then","otherwise"])void 0===t[r]?delete t[r]:t[r]=e.$_compile(t[r]);return t}}(compile)),compile}var extend$1={},hasRequiredExtend;function requireExtend(){if(hasRequiredExtend)return extend$1;hasRequiredExtend=1;const{assert:e,clone:t}=requireLib$5(),r=requireCommon(),n=requireMessages(),i={};return extend$1.type=function(s,o){const a=Object.getPrototypeOf(s),l=t(a),c=s._assign(Object.create(l)),u=Object.assign({},o);delete u.base,l._definition=u;const d=a._definition||{};u.messages=n.merge(d.messages,u.messages),u.properties=Object.assign({},d.properties,u.properties),c.type=u.type,u.flags=Object.assign({},d.flags,u.flags);const h=Object.assign({},d.terms);if(u.terms)for(const t in u.terms){const r=u.terms[t];e(void 0===c.$_terms[t],"Invalid term override for",u.type,t),c.$_terms[t]=r.init,h[t]=r}u.terms=h,u.args||(u.args=d.args),u.prepare=i.prepare(u.prepare,d.prepare),u.coerce&&("function"==typeof u.coerce&&(u.coerce={method:u.coerce}),u.coerce.from&&!Array.isArray(u.coerce.from)&&(u.coerce={method:u.coerce.method,from:[].concat(u.coerce.from)})),u.coerce=i.coerce(u.coerce,d.coerce),u.validate=i.validate(u.validate,d.validate);const f=Object.assign({},d.rules);if(u.rules)for(const t in u.rules){const n=u.rules[t];e("object"==typeof n,"Invalid rule definition for",u.type,t);let i=n.method;if(void 0===i&&(i=function(){return this.$_addRule(t)}),i&&(e(!l[t],"Rule conflict in",u.type,t),l[t]=i),e(!f[t],"Rule conflict in",u.type,t),f[t]=n,n.alias){const e=[].concat(n.alias);for(const t of e)l[t]=n.method}n.args&&(n.argsByName=new Map,n.args=n.args.map(t=>("string"==typeof t&&(t={name:t}),e(!n.argsByName.has(t.name),"Duplicated argument name",t.name),r.isSchema(t.assert)&&(t.assert=t.assert.strict().label(t.name)),n.argsByName.set(t.name,t),t)))}u.rules=f;const p=Object.assign({},d.modifiers);if(u.modifiers)for(const t in u.modifiers){e(!l[t],"Rule conflict in",u.type,t);const r=u.modifiers[t];e("function"==typeof r,"Invalid modifier definition for",u.type,t);const n=function(e){return this.rule({[t]:e})};l[t]=n,p[t]=r}if(u.modifiers=p,u.overrides){l._super=a,c.$_super={};for(const t in u.overrides)e(a[t],"Cannot override missing",t),u.overrides[t][r.symbols.parent]=a[t],c.$_super[t]=a[t].bind(c);Object.assign(l,u.overrides)}u.cast=Object.assign({},d.cast,u.cast);const m=Object.assign({},d.manifest,u.manifest);return m.build=i.build(u.manifest&&u.manifest.build,d.manifest&&d.manifest.build),u.manifest=m,u.rebuild=i.rebuild(u.rebuild,d.rebuild),c},i.build=function(e,t){return e&&t?function(r,n){return t(e(r,n),n)}:e||t},i.coerce=function(e,t){return e&&t?{from:e.from&&t.from?[...new Set([...e.from,...t.from])]:null,method(r,n){let i;if((!t.from||t.from.includes(typeof r))&&(i=t.method(r,n),i)){if(i.errors||void 0===i.value)return i;r=i.value}if(!e.from||e.from.includes(typeof r)){const t=e.method(r,n);if(t)return t}return i}}:e||t},i.prepare=function(e,t){return e&&t?function(r,n){const i=e(r,n);if(i){if(i.errors||void 0===i.value)return i;r=i.value}return t(r,n)||i}:e||t},i.rebuild=function(e,t){return e&&t?function(r){t(r),e(r)}:e||t},i.validate=function(e,t){return e&&t?function(r,n){const i=t(r,n);if(i){if(i.errors&&(!Array.isArray(i.errors)||i.errors.length))return i;r=i.value}return e(r,n)||i}:e||t},extend$1}var manifest={},hasRequiredManifest;function requireManifest(){if(hasRequiredManifest)return manifest;hasRequiredManifest=1;const{assert:e,clone:t}=requireLib$5(),r=requireCommon(),n=requireMessages(),i=requireRef(),s=requireTemplate();let o;const a={};return manifest.describe=function(i){const s=i._definition,o={type:i.type,flags:{},rules:[]};for(const e in i._flags)"_"!==e[0]&&(o.flags[e]=a.describe(i._flags[e]));Object.keys(o.flags).length||delete o.flags,i._preferences&&(o.preferences=t(i._preferences,{shallow:["messages"]}),delete o.preferences[r.symbols.prefs],o.preferences.messages&&(o.preferences.messages=n.decompile(o.preferences.messages))),i._valids&&(o.allow=i._valids.describe()),i._invalids&&(o.invalid=i._invalids.describe());for(const e of i._rules){if(!1===s.rules[e.name].manifest)continue;const t={name:e.name};for(const r in s.modifiers)void 0!==e[r]&&(t[r]=a.describe(e[r]));if(e.args){t.args={};for(const r in e.args){const n=e.args[r];("options"!==r||Object.keys(n).length)&&(t.args[r]=a.describe(n,{assign:r}))}Object.keys(t.args).length||delete t.args}o.rules.push(t)}o.rules.length||delete o.rules;for(const t in i.$_terms){if("_"===t[0])continue;e(!o[t],"Cannot describe schema due to internal name conflict with",t);const n=i.$_terms[t];if(!n)continue;if(n instanceof Map){n.size&&(o[t]=[...n.entries()]);continue}if(r.isValues(n)){o[t]=n.describe();continue}e(s.terms[t],"Term",t,"missing configuration");const l=s.terms[t].manifest,c="object"==typeof l;if(!n.length&&!c)continue;const u=[];for(const e of n)u.push(a.describe(e));if(c){const{from:e,to:r}=l.mapped;o[t]={};for(const n of u)o[t][n[r]]=n[e];continue}"single"!==l?o[t]=u:(e(1===u.length,"Term",t,"contains more than one item"),o[t]=u[0])}return a.validate(i.$_root,o),o},a.describe=function(e,n={}){if(Array.isArray(e))return e.map(a.describe);if(e===r.symbols.deepDefault)return{special:"deep"};if("object"!=typeof e||null===e)return e;if("options"===n.assign)return t(e);if(Buffer&&Buffer.isBuffer(e))return{buffer:e.toString("binary")};if(e instanceof Date)return e.toISOString();if(e instanceof Error)return e;if(e instanceof RegExp)return"regex"===n.assign?e.toString():{regex:e.toString()};if(e[r.symbols.literal])return{function:e.literal};if("function"==typeof e.describe)return"ref"===n.assign?e.describe().ref:e.describe();const i={};for(const t in e){const r=e[t];void 0!==r&&(i[t]=a.describe(r,{assign:t}))}return i},manifest.build=function(e,t){return new a.Builder(e).parse(t)},a.Builder=class{constructor(e){this.joi=e}parse(t){a.validate(this.joi,t);let r=this.joi[t.type]()._bare();const n=r._definition;if(t.flags)for(const i in t.flags){const s=n.flags[i]&&n.flags[i].setter||i;e("function"==typeof r[s],"Invalid flag",i,"for type",t.type),r=r[s](this.build(t.flags[i]))}if(t.preferences&&(r=r.preferences(this.build(t.preferences))),t.allow&&(r=r.allow(...this.build(t.allow))),t.invalid&&(r=r.invalid(...this.build(t.invalid))),t.rules)for(const i of t.rules){e("function"==typeof r[i.name],"Invalid rule",i.name,"for type",t.type);const s=[];if(i.args){const r={};for(const e in i.args)r[e]=this.build(i.args[e],{assign:e});const o=Object.keys(r),a=n.rules[i.name].args;if(a){e(o.length<=a.length,"Invalid number of arguments for",t.type,i.name,"(expected up to",a.length,", found",o.length,")");for(const{name:e}of a)s.push(r[e])}else e(1===o.length,"Invalid number of arguments for",t.type,i.name,"(expected up to 1, found",o.length,")"),s.push(r[o[0]])}r=r[i.name](...s);const o={};for(const e in n.modifiers)void 0!==i[e]&&(o[e]=this.build(i[e]));Object.keys(o).length&&(r=r.rule(o))}const i={};for(const r in t){if(["allow","flags","invalid","whens","preferences","rules","type"].includes(r))continue;e(n.terms[r],"Term",r,"missing configuration");const s=n.terms[r].manifest;if("schema"!==s)if("values"!==s)if("single"!==s)if("object"!=typeof s)i[r]=this.build(t[r]);else{i[r]={};for(const e in t[r]){const n=t[r][e];i[r][e]=this.parse(n)}}else i[r]=this.build(t[r]);else i[r]=t[r].map(e=>this.build(e));else i[r]=t[r].map(e=>this.parse(e))}return t.whens&&(i.whens=t.whens.map(e=>this.build(e))),r=n.manifest.build(r,i),r.$_temp.ruleset=!1,r}build(n,o={}){if(null===n)return null;if(Array.isArray(n))return n.map(e=>this.build(e));if(n instanceof Error)return n;if("options"===o.assign)return t(n);if("regex"===o.assign)return a.regex(n);if("ref"===o.assign)return i.build(n);if("object"!=typeof n)return n;if(1===Object.keys(n).length){if(n.buffer)return e(Buffer,"Buffers are not supported"),Buffer&&Buffer.from(n.buffer,"binary");if(n.function)return{[r.symbols.literal]:!0,literal:n.function};if(n.override)return r.symbols.override;if(n.ref)return i.build(n.ref);if(n.regex)return a.regex(n.regex);if(n.special)return e(["deep"].includes(n.special),"Unknown special value",n.special),r.symbols.deepDefault;if(n.value)return t(n.value)}if(n.type)return this.parse(n);if(n.template)return s.build(n);const l={};for(const e in n)l[e]=this.build(n[e],{assign:e});return l}},a.regex=function(e){const t=e.lastIndexOf("/"),r=e.slice(1,t),n=e.slice(t+1);return new RegExp(r,n)},a.validate=function(e,t){o=o||requireSchemas(),e.assert(t,o.description)},manifest}var trace={},lib$3={},hasRequiredLib$3,hasRequiredTrace;function requireLib$3(){return hasRequiredLib$3||(hasRequiredLib$3=1,lib$3.location=function(e=0){const t=Error.prepareStackTrace;Error.prepareStackTrace=(e,t)=>t;const r={};Error.captureStackTrace(r,this);const n=r.stack[e+1];return Error.prepareStackTrace=t,{filename:n.getFileName(),line:n.getLineNumber()}}),lib$3}function requireTrace(){if(hasRequiredTrace)return trace;hasRequiredTrace=1;const{deepEqual:e}=requireLib$5(),t=requireLib$3(),r=requireErrors(),n={codes:{error:1,pass:2,full:3},labels:{0:"never used",1:"always error",2:"always pass"}};return trace.setup=function(e){const t=function(){return e._tracer=e._tracer||new n.Tracer,e._tracer};e.trace=t,e[Symbol.for("@hapi/lab/coverage/initialize")]=t,e.untrace=()=>{e._tracer=null}},trace.location=function(e){return e.$_setFlag("_tracerLocation",t.location(2))},n.Tracer=class{constructor(){this.name="Joi",this._schemas=new Map}_register(e){const r=this._schemas.get(e);if(r)return r.store;const i=new n.Store(e),{filename:s,line:o}=e._flags._tracerLocation||t.location(5);return this._schemas.set(e,{filename:s,line:o,store:i}),i}_combine(e,t){for(const{store:r}of this._schemas.values())r._combine(e,t)}report(e){const t=[];for(const{filename:r,line:i,store:s}of this._schemas.values()){if(e&&e!==r)continue;const o=[],a=[];for(const[e,t]of s._sources.entries()){if(n.sub(t.paths,a))continue;if(!t.entry){o.push({status:"never reached",paths:[...t.paths]}),a.push(...t.paths);continue}for(const r of["valid","invalid"]){const n=e[`_${r}s`];if(!n)continue;const i=new Set(n._values),s=new Set(n._refs);for(const{value:e,ref:n}of t[r])i.delete(e),s.delete(n);(i.size||s.size)&&o.push({status:[...i,...[...s].map(e=>e.display)],rule:`${r}s`})}const r=e._rules.map(e=>e.name);for(const t of["default","failover"])void 0!==e._flags[t]&&r.push(t);for(const e of r){const r=n.labels[t.rule[e]||0];if(r){const n={rule:e,status:r};t.paths.size&&(n.paths=[...t.paths]),o.push(n)}}}o.length&&t.push({filename:r,line:i,missing:o,severity:"error",message:`Schema missing tests for ${o.map(n.message).join(", ")}`})}return t.length?t:null}},n.Store=class{constructor(e){this.active=!0,this._sources=new Map,this._combos=new Map,this._scan(e)}debug(e,t,r,n){e.mainstay.debug&&e.mainstay.debug.push({type:t,name:r,result:n,path:e.path})}entry(e,t){n.debug(t,{type:"entry"}),this._record(e,e=>{e.entry=!0})}filter(e,t,r,i){n.debug(t,{type:r,...i}),this._record(e,e=>{e[r].add(i)})}log(e,t,r,i,s){n.debug(t,{type:r,name:i,result:"full"===s?"pass":s}),this._record(e,e=>{e[r][i]=e[r][i]||0,e[r][i]|=n.codes[s]})}resolve(e,t,r){if(!e.mainstay.debug)return;const n={type:"resolve",ref:t.display,to:r,path:e.path};e.mainstay.debug.push(n)}value(t,r,n,i,s){if(!t.mainstay.debug||e(n,i))return;const o={type:"value",by:r,from:n,to:i,path:t.path};s&&(o.name=s),t.mainstay.debug.push(o)}_record(e,t){const r=this._sources.get(e);if(r)return void t(r);const n=this._combos.get(e);for(const e of n)this._record(e,t)}_scan(e,t){const r=t||[];let i=this._sources.get(e);i||(i={paths:new Set,entry:!1,rule:{},valid:new Set,invalid:new Set},this._sources.set(e,i)),r.length&&i.paths.add(r);e.$_modify({each:(e,t)=>{const i=n.id(e,t);this._scan(e,r.concat(i))},ref:!1})}_combine(e,t){this._combos.set(e,t)}},n.message=function(e){return`${e.paths?r.path(e.paths[0])+(e.rule?":":""):""}${e.rule||""} (${e.status})`},n.id=function(e,{source:t,name:r,path:n,key:i}){return e._flags.id?e._flags.id:i||(r=`@${r}`,"terms"===t?[r,n[Math.min(n.length-1,1)]]:r)},n.sub=function(t,r){for(const n of t)for(const t of r)if(e(n.slice(0,t.length),t))return!0;return!1},n.debug=function(e,t){e.mainstay.debug&&(t.path=e.debug?[...e.path,e.debug]:e.path,e.mainstay.debug.push(t))},trace}var modify={},hasRequiredModify;function requireModify(){return hasRequiredModify||(hasRequiredModify=1,function(e){const{assert:t}=requireLib$5(),r=requireCommon(),n=requireRef(),i={};e.Ids=i.Ids=class{constructor(){this._byId=new Map,this._byKey=new Map,this._schemaChain=!1}clone(){const e=new i.Ids;return e._byId=new Map(this._byId),e._byKey=new Map(this._byKey),e._schemaChain=this._schemaChain,e}concat(e){e._schemaChain&&(this._schemaChain=!0);for(const[r,n]of e._byId.entries())t(!this._byKey.has(r),"Schema id conflicts with existing key:",r),this._byId.set(r,n);for(const[r,n]of e._byKey.entries())t(!this._byId.has(r),"Schema key conflicts with existing id:",r),this._byKey.set(r,n)}fork(e,n,s){const o=this._collect(e);o.push({schema:s});const a=o.shift();let l={id:a.id,schema:n(a.schema)};t(r.isSchema(l.schema),"adjuster function failed to return a joi schema type");for(const e of o)l={id:e.id,schema:i.fork(e.schema,l.id,l.schema)};return l.schema}labels(e,t=[]){const r=e[0],n=this._get(r);if(!n)return[...t,...e].join(".");const i=e.slice(1);return t=[...t,n.schema._flags.label||r],i.length?n.schema._ids.labels(i,t):t.join(".")}reach(e,r=[]){const n=e[0],i=this._get(n);t(i,"Schema does not contain path",[...r,...e].join("."));const s=e.slice(1);return s.length?i.schema._ids.reach(s,[...r,n]):i.schema}register(e,{key:n}={}){if(!e||!r.isSchema(e))return;(e.$_property("schemaChain")||e._ids._schemaChain)&&(this._schemaChain=!0);const i=e._flags.id;if(i){const r=this._byId.get(i);t(!r||r.schema===e,"Cannot add different schemas with the same id:",i),t(!this._byKey.has(i),"Schema id conflicts with existing key:",i),this._byId.set(i,{schema:e,id:i})}n&&(t(!this._byKey.has(n),"Schema already contains key:",n),t(!this._byId.has(n),"Schema key conflicts with existing id:",n),this._byKey.set(n,{schema:e,id:n}))}reset(){this._byId=new Map,this._byKey=new Map,this._schemaChain=!1}_collect(e,r=[],n=[]){const i=e[0],s=this._get(i);t(s,"Schema does not contain path",[...r,...e].join(".")),n=[s,...n];const o=e.slice(1);return o.length?s.schema._ids._collect(o,[...r,i],n):n}_get(e){return this._byId.get(e)||this._byKey.get(e)}},i.fork=function(t,r,n){const i=e.schema(t,{each:(e,{key:t})=>{if(r===(e._flags.id||t))return n},ref:!1});return i?i.$_mutateRebuild():t},e.schema=function(e,t){let r;for(const n in e._flags){if("_"===n[0])continue;const s=i.scan(e._flags[n],{source:"flags",name:n},t);void 0!==s&&(r=r||e.clone(),r._flags[n]=s)}for(let n=0;n<e._rules.length;++n){const s=e._rules[n],o=i.scan(s.args,{source:"rules",name:s.name},t);if(void 0!==o){r=r||e.clone();const t=Object.assign({},s);t.args=o,r._rules[n]=t;r._singleRules.get(s.name)===s&&r._singleRules.set(s.name,t)}}for(const n in e.$_terms){if("_"===n[0])continue;const s=i.scan(e.$_terms[n],{source:"terms",name:n},t);void 0!==s&&(r=r||e.clone(),r.$_terms[n]=s)}return r},i.scan=function(e,t,s,o,a){const l=o||[];if(null===e||"object"!=typeof e)return;let c;if(Array.isArray(e)){for(let r=0;r<e.length;++r){const n="terms"===t.source&&"keys"===t.name&&e[r].key,o=i.scan(e[r],t,s,[r,...l],n);void 0!==o&&(c=c||e.slice(),c[r]=o)}return c}if(!1!==s.schema&&r.isSchema(e)||!1!==s.ref&&n.isRef(e)){const r=s.each(e,{...t,path:l,key:a});if(r===e)return;return r}for(const r in e){if("_"===r[0])continue;const n=i.scan(e[r],t,s,[r,...l],a);void 0!==n&&(c=c||Object.assign({},e),c[r]=n)}return c}}(modify)),modify}var validator={},state,hasRequiredState,hasRequiredValidator,values,hasRequiredValues,base,hasRequiredBase,any,hasRequiredAny,alternatives,hasRequiredAlternatives,array$1,hasRequiredArray,boolean$2,hasRequiredBoolean,date$2,hasRequiredDate;function requireState(){if(hasRequiredState)return state;hasRequiredState=1;const{clone:e,reach:t}=requireLib$5(),r=requireCommon(),n={value:Symbol("value")};return state=n.State=class{constructor(e,t,r){this.path=e,this.ancestors=t,this.mainstay=r.mainstay,this.schemas=r.schemas,this.debug=null}localize(e,t=null,r=null){const i=new n.State(e,t,this);return r&&i.schemas&&(i.schemas=[n.schemas(r),...i.schemas]),i}nest(e,t){const r=new n.State(this.path,this.ancestors,this);return r.schemas=r.schemas&&[n.schemas(e),...r.schemas],r.debug=t,r}shadow(e,t){this.mainstay.shadow=this.mainstay.shadow||new n.Shadow,this.mainstay.shadow.set(this.path,e,t)}snapshot(){this.mainstay.shadow&&(this._snapshot=e(this.mainstay.shadow.node(this.path))),this.mainstay.snapshot()}restore(){this.mainstay.shadow&&(this.mainstay.shadow.override(this.path,this._snapshot),this._snapshot=void 0),this.mainstay.restore()}commit(){this.mainstay.shadow&&(this.mainstay.shadow.override(this.path,this._snapshot),this._snapshot=void 0),this.mainstay.commit()}},n.schemas=function(e){return r.isSchema(e)?{schema:e}:e},n.Shadow=class{constructor(){this._values=null}set(e,t,r){if(!e.length)return;if("strip"===r&&"number"==typeof e[e.length-1])return;this._values=this._values||new Map;let i=this._values;for(let t=0;t<e.length;++t){const r=e[t];let n=i.get(r);n||(n=new Map,i.set(r,n)),i=n}i[n.value]=t}get(e){const t=this.node(e);if(t)return t[n.value]}node(e){if(this._values)return t(this._values,e,{iterables:!0})}override(e,r){if(!this._values)return;const n=e.slice(0,-1),i=e[e.length-1],s=t(this._values,n,{iterables:!0});r?s.set(i,r):s&&s.delete(i)}},state}function requireValidator(){return hasRequiredValidator||(hasRequiredValidator=1,function(e){const{assert:t,clone:r,ignore:n,reach:i}=requireLib$5(),s=requireCommon(),o=requireErrors(),a=requireState(),l={result:Symbol("result")};e.entry=function(e,r,n){let i=s.defaults;n&&(t(void 0===n.warnings,"Cannot override warnings preference in synchronous validation"),t(void 0===n.artifacts,"Cannot override artifacts preference in synchronous validation"),i=s.preferences(s.defaults,n));const a=l.entry(e,r,i);t(!a.mainstay.externals.length,"Schema with external rules must use validateAsync()");const c={value:a.value};return a.error&&(c.error=a.error),a.mainstay.warnings.length&&(c.warning=o.details(a.mainstay.warnings)),a.mainstay.debug&&(c.debug=a.mainstay.debug),a.mainstay.artifacts&&(c.artifacts=a.mainstay.artifacts),c},e.entryAsync=async function(e,t,r){let n=s.defaults;r&&(n=s.preferences(s.defaults,r));const a=l.entry(e,t,n),c=a.mainstay;if(a.error)throw c.debug&&(a.error.debug=c.debug),a.error;if(c.externals.length){let t=a.value;const u=[];for(const a of c.externals){const d=a.state.path,h="link"===a.schema.type?c.links.get(a.schema):null;let f,p,m=t;const _=d.length?[t]:[],g=d.length?i(e,d):e;if(d.length){f=d[d.length-1];let e=t;for(const t of d.slice(0,-1))e=e[t],_.unshift(e);p=_[0],m=p[f]}try{const e=(e,t)=>(h||a.schema).$_createError(e,m,t,a.state,n),i=await a.method(m,{schema:a.schema,linked:h,state:a.state,prefs:r,original:g,error:e,errorsArray:l.errorsArray,warn:(e,t)=>c.warnings.push((h||a.schema).$_createError(e,m,t,a.state,n)),message:(e,t)=>(h||a.schema).$_createError("external",m,t,a.state,n,{messages:e})});if(void 0===i||i===m)continue;if(i instanceof o.Report){if(c.tracer.log(a.schema,a.state,"rule","external","error"),u.push(i),n.abortEarly)break;continue}if(Array.isArray(i)&&i[s.symbols.errors]){if(c.tracer.log(a.schema,a.state,"rule","external","error"),u.push(...i),n.abortEarly)break;continue}p?(c.tracer.value(a.state,"rule",m,i,"external"),p[f]=i):(c.tracer.value(a.state,"rule",t,i,"external"),t=i)}catch(e){throw n.errors.label&&(e.message+=` (${a.label})`),e}}if(a.value=t,u.length)throw a.error=o.process(u,e,n),c.debug&&(a.error.debug=c.debug),a.error}if(!n.warnings&&!n.debug&&!n.artifacts)return a.value;const u={value:a.value};return c.warnings.length&&(u.warning=o.details(c.warnings)),c.debug&&(u.debug=c.debug),c.artifacts&&(u.artifacts=c.artifacts),u},e.standard=function(t,r){return r.isAsync()?e.entryAsync(t,r):e.entry(t,r)},l.Mainstay=class{constructor(e,t,r){this.externals=[],this.warnings=[],this.tracer=e,this.debug=t,this.links=r,this.shadow=null,this.artifacts=null,this._snapshots=[]}snapshot(){this._snapshots.push({externals:this.externals.slice(),warnings:this.warnings.slice()})}restore(){const e=this._snapshots.pop();this.externals=e.externals,this.warnings=e.warnings}commit(){this._snapshots.pop()}},l.entry=function(t,r,n){const{tracer:i,cleanup:s}=l.tracer(r,n),c=n.debug?[]:null,u=r._ids._schemaChain?new Map:null,d=new l.Mainstay(i,c,u),h=r._ids._schemaChain?[{schema:r}]:null,f=new a([],[],{mainstay:d,schemas:h}),p=e.validate(t,r,f,n);s&&r.$_root.untrace();const m=o.process(p.errors,t,n);return{value:p.value,error:m,mainstay:d}},l.tracer=function(e,r){return e.$_root._tracer?{tracer:e.$_root._tracer._register(e)}:r.debug?(t(e.$_root.trace,"Debug mode not supported"),{tracer:e.$_root.trace()._register(e),cleanup:!0}):{tracer:l.ignore}},e.validate=function(e,t,r,n,i={}){if(t.$_terms.whens&&(t=t._generate(e,r,n).schema),t._preferences&&(n=l.prefs(t,n)),t._cache&&n.cache){const n=t._cache.get(e);if(r.mainstay.tracer.debug(r,"validate","cached",!!n),n)return n}const o=(i,s,o)=>t.$_createError(i,e,s,o||r,n),a={original:e,prefs:n,schema:t,state:r,error:o,errorsArray:l.errorsArray,warn:(e,t,n)=>r.mainstay.warnings.push(o(e,t,n)),message:(i,s)=>t.$_createError("custom",e,s,r,n,{messages:i})};r.mainstay.tracer.entry(t,r);const c=t._definition;if(c.prepare&&void 0!==e&&n.convert){const t=c.prepare(e,a);if(t){if(r.mainstay.tracer.value(r,"prepare",e,t.value),t.errors)return l.finalize(t.value,[].concat(t.errors),a);e=t.value}}if(c.coerce&&void 0!==e&&n.convert&&(!c.coerce.from||c.coerce.from.includes(typeof e))){const t=c.coerce.method(e,a);if(t){if(r.mainstay.tracer.value(r,"coerced",e,t.value),t.errors)return l.finalize(t.value,[].concat(t.errors),a);e=t.value}}const u=t._flags.empty;u&&u.$_match(l.trim(e,t),r.nest(u),s.defaults)&&(r.mainstay.tracer.value(r,"empty",e,void 0),e=void 0);const d=i.presence||t._flags.presence||(t._flags._endedSwitch?null:n.presence);if(void 0===e){if("forbidden"===d)return l.finalize(e,null,a);if("required"===d)return l.finalize(e,[t.$_createError("any.required",e,null,r,n)],a);if("optional"===d){if(t._flags.default!==s.symbols.deepDefault)return l.finalize(e,null,a);r.mainstay.tracer.value(r,"default",e,{}),e={}}}else if("forbidden"===d)return l.finalize(e,[t.$_createError("any.unknown",e,null,r,n)],a);const h=[];if(t._valids){const i=t._valids.get(e,r,n,t._flags.insensitive);if(i)return n.convert&&(r.mainstay.tracer.value(r,"valids",e,i.value),e=i.value),r.mainstay.tracer.filter(t,r,"valid",i),l.finalize(e,null,a);if(t._flags.only){const i=t.$_createError("any.only",e,{valids:t._valids.values({display:!0})},r,n);if(n.abortEarly)return l.finalize(e,[i],a);h.push(i)}}if(t._invalids){const i=t._invalids.get(e,r,n,t._flags.insensitive);if(i){r.mainstay.tracer.filter(t,r,"invalid",i);const s=t.$_createError("any.invalid",e,{invalids:t._invalids.values({display:!0})},r,n);if(n.abortEarly)return l.finalize(e,[s],a);h.push(s)}}if(c.validate){const t=c.validate(e,a);if(t&&(r.mainstay.tracer.value(r,"base",e,t.value),e=t.value,t.errors)){if(!Array.isArray(t.errors))return h.push(t.errors),l.finalize(e,h,a);if(t.errors.length)return h.push(...t.errors),l.finalize(e,h,a)}}return t._rules.length?l.rules(e,h,a):l.finalize(e,h,a)},l.rules=function(e,t,r){const{schema:n,state:i,prefs:o}=r;for(const a of n._rules){const c=n._definition.rules[a.method];if(c.convert&&o.convert){i.mainstay.tracer.log(n,i,"rule",a.name,"full");continue}let u,d=a.args;if(a._resolve.length){d=Object.assign({},d);for(const t of a._resolve){const r=c.argsByName.get(t),a=d[t].resolve(e,i,o),l=r.normalize?r.normalize(a):a,h=s.validateArg(l,null,r);if(h){u=n.$_createError("any.ref",a,{arg:t,ref:d[t],reason:h},i,o);break}d[t]=l}}u=u||c.validate(e,r,d,a);const h=l.rule(u,a);if(h.errors){if(i.mainstay.tracer.log(n,i,"rule",a.name,"error"),a.warn){i.mainstay.warnings.push(...h.errors);continue}if(o.abortEarly)return l.finalize(e,h.errors,r);t.push(...h.errors)}else i.mainstay.tracer.log(n,i,"rule",a.name,"pass"),i.mainstay.tracer.value(i,"rule",e,h.value,a.name),e=h.value}return l.finalize(e,t,r)},l.rule=function(e,t){return e instanceof o.Report?(l.error(e,t),{errors:[e],value:null}):Array.isArray(e)&&e[s.symbols.errors]?(e.forEach(e=>l.error(e,t)),{errors:e,value:null}):{errors:null,value:e}},l.error=function(e,t){return t.message&&e._setTemplate(t.message),e},l.finalize=function(e,r,n){r=r||[];const{schema:i,state:s,prefs:a}=n;if(r.length){const t=l.default("failover",void 0,r,n);void 0!==t&&(s.mainstay.tracer.value(s,"failover",e,t),e=t,r=[])}if(r.length&&i._flags.error)if("function"==typeof i._flags.error){r=i._flags.error(r),Array.isArray(r)||(r=[r]);for(const e of r)t(e instanceof Error||e instanceof o.Report,"error() must return an Error object")}else r=[i._flags.error];if(void 0===e){const t=l.default("default",e,r,n);s.mainstay.tracer.value(s,"default",e,t),e=t}if(i._flags.cast&&void 0!==e){const t=i._definition.cast[i._flags.cast];if(t.from(e)){const r=t.to(e,n);s.mainstay.tracer.value(s,"cast",e,r,i._flags.cast),e=r}}if(i.$_terms.externals&&a.externals&&!1!==a._externals)for(const{method:e}of i.$_terms.externals)s.mainstay.externals.push({method:e,schema:i,state:s,label:o.label(i._flags,s,a)});const c={value:e,errors:r.length?r:null};return i._flags.result&&(c.value="strip"===i._flags.result?void 0:n.original,s.mainstay.tracer.value(s,i._flags.result,e,c.value),s.shadow(e,i._flags.result)),i._cache&&!1!==a.cache&&!i._refs.length&&i._cache.set(n.original,c),void 0===e||c.errors||void 0===i._flags.artifact||(s.mainstay.artifacts=s.mainstay.artifacts||new Map,s.mainstay.artifacts.has(i._flags.artifact)||s.mainstay.artifacts.set(i._flags.artifact,[]),s.mainstay.artifacts.get(i._flags.artifact).push(s.path)),c},l.prefs=function(e,t){const r=t===s.defaults;return r&&e._preferences[s.symbols.prefs]?e._preferences[s.symbols.prefs]:(t=s.preferences(t,e._preferences),r&&(e._preferences[s.symbols.prefs]=t),t)},l.default=function(e,t,n,i){const{schema:o,state:a,prefs:l}=i,c=o._flags[e];if(l.noDefaults||void 0===c)return t;if(a.mainstay.tracer.log(o,a,"rule",e,"full"),!c)return c;if("function"==typeof c){const t=c.length?[r(a.ancestors[0]),i]:[];try{return c(...t)}catch(t){return void n.push(o.$_createError(`any.${e}`,null,{error:t},a,l))}}return"object"!=typeof c?c:c[s.symbols.literal]?c.literal:s.isResolvable(c)?c.resolve(t,a,l):r(c)},l.trim=function(e,t){if("string"!=typeof e)return e;const r=t.$_getRule("trim");return r&&r.args.enabled?e.trim():e},l.ignore={active:!1,debug:n,entry:n,filter:n,log:n,resolve:n,value:n},l.errorsArray=function(){const e=[];return e[s.symbols.errors]=!0,e}}(validator)),validator}function requireValues(){if(hasRequiredValues)return values;hasRequiredValues=1;const{assert:e,deepEqual:t}=requireLib$5(),r=requireCommon(),n={};return values=n.Values=class{constructor(e,t){this._values=new Set(e),this._refs=new Set(t),this._lowercase=n.lowercases(e),this._override=!1}get length(){return this._values.size+this._refs.size}add(e,t){r.isResolvable(e)?this._refs.has(e)||(this._refs.add(e),t&&t.register(e)):this.has(e,null,null,!1)||(this._values.add(e),"string"==typeof e&&this._lowercase.set(e.toLowerCase(),e))}static merge(e,t,r){if(e=e||new n.Values,t){if(t._override)return t.clone();for(const r of[...t._values,...t._refs])e.add(r)}if(r)for(const t of[...r._values,...r._refs])e.remove(t);return e.length?e:null}remove(e){r.isResolvable(e)?this._refs.delete(e):(this._values.delete(e),"string"==typeof e&&this._lowercase.delete(e.toLowerCase()))}has(e,t,r,n){return!!this.get(e,t,r,n)}get(e,r,n,i){if(!this.length)return!1;if(this._values.has(e))return{value:e};if("string"==typeof e&&e&&i){const t=this._lowercase.get(e.toLowerCase());if(t)return{value:t}}if(!this._refs.size&&"object"!=typeof e)return!1;if("object"==typeof e)for(const r of this._values)if(t(r,e))return{value:r};if(r)for(const s of this._refs){const o=s.resolve(e,r,n,null,{in:!0});if(void 0===o)continue;const a=s.in&&"object"==typeof o?Array.isArray(o)?o:Object.keys(o):[o];for(const r of a)if(typeof r==typeof e)if(i&&e&&"string"==typeof e){if(r.toLowerCase()===e.toLowerCase())return{value:r,ref:s}}else if(t(r,e))return{value:r,ref:s}}return!1}override(){this._override=!0}values(e){if(e&&e.display){const e=[];for(const t of[...this._values,...this._refs])void 0!==t&&e.push(t);return e}return Array.from([...this._values,...this._refs])}clone(){const e=new n.Values(this._values,this._refs);return e._override=this._override,e}concat(t){e(!t._override,"Cannot concat override set of values");const r=new n.Values([...this._values,...t._values],[...this._refs,...t._refs]);return r._override=this._override,r}describe(){const e=[];this._override&&e.push({override:!0});for(const t of this._values.values())e.push(t&&"object"==typeof t?{value:t}:t);for(const t of this._refs.values())e.push(t.describe());return e}},n.Values.prototype[r.symbols.values]=!0,n.Values.prototype.slice=n.Values.prototype.clone,n.lowercases=function(e){const t=new Map;if(e)for(const r of e)"string"==typeof r&&t.set(r.toLowerCase(),r);return t},values}function requireBase(){if(hasRequiredBase)return base;hasRequiredBase=1;const{assert:e,clone:t,deepEqual:r,merge:n}=requireLib$5(),i=requireCache(),s=requireCommon(),o=requireCompile(),a=requireErrors(),l=requireExtend(),c=requireManifest(),u=requireMessages(),d=requireModify(),h=requireRef(),f=requireTrace(),p=requireValidator(),m=requireValues(),_={Base:class{constructor(e){this.type=e,this.$_root=null,this._definition={},this._reset()}_reset(){this._ids=new d.Ids,this._preferences=null,this._refs=new h.Manager,this._cache=null,this._valids=null,this._invalids=null,this._flags={},this._rules=[],this._singleRules=new Map,this.$_terms={},this.$_temp={ruleset:null,whens:{}}}describe(){return e("function"==typeof c.describe,"Manifest functionality disabled"),c.describe(this)}allow(...e){return s.verifyFlat(e,"allow"),this._values(e,"_valids")}alter(t){e(t&&"object"==typeof t&&!Array.isArray(t),"Invalid targets argument"),e(!this._inRuleset(),"Cannot set alterations inside a ruleset");const r=this.clone();r.$_terms.alterations=r.$_terms.alterations||[];for(const n in t){const i=t[n];e("function"==typeof i,"Alteration adjuster for",n,"must be a function"),r.$_terms.alterations.push({target:n,adjuster:i})}return r.$_temp.ruleset=!1,r}artifact(t){return e(void 0!==t,"Artifact cannot be undefined"),e(!this._cache,"Cannot set an artifact with a rule cache"),this.$_setFlag("artifact",t)}cast(t){return e(!1===t||"string"==typeof t,"Invalid to value"),e(!1===t||this._definition.cast[t],"Type",this.type,"does not support casting to",t),this.$_setFlag("cast",!1===t?void 0:t)}default(e,t){return this._default("default",e,t)}description(t){return e(t&&"string"==typeof t,"Description must be a non-empty string"),this.$_setFlag("description",t)}empty(e){const t=this.clone();return void 0!==e&&(e=t.$_compile(e,{override:!1})),t.$_setFlag("empty",e,{clone:!1})}error(t){return e(t,"Missing error"),e(t instanceof Error||"function"==typeof t,"Must provide a valid Error object or a function"),this.$_setFlag("error",t)}example(t,r={}){return e(void 0!==t,"Missing example"),s.assertOptions(r,["override"]),this._inner("examples",t,{single:!0,override:r.override})}external(t,r){return"object"==typeof t&&(e(!r,"Cannot combine options with description"),r=t.description,t=t.method),e("function"==typeof t,"Method must be a function"),e(void 0===r||r&&"string"==typeof r,"Description must be a non-empty string"),this._inner("externals",{method:t,description:r},{single:!0})}failover(e,t){return this._default("failover",e,t)}forbidden(){return this.presence("forbidden")}id(t){return t?(e("string"==typeof t,"id must be a non-empty string"),e(/^[^\.]+$/.test(t),"id cannot contain period character"),this.$_setFlag("id",t)):this.$_setFlag("id",void 0)}invalid(...e){return this._values(e,"_invalids")}label(t){return e(t&&"string"==typeof t,"Label name must be a non-empty string"),this.$_setFlag("label",t)}meta(t){return e(void 0!==t,"Meta cannot be undefined"),this._inner("metas",t,{single:!0})}note(...t){e(t.length,"Missing notes");for(const r of t)e(r&&"string"==typeof r,"Notes must be non-empty strings");return this._inner("notes",t)}only(t=!0){return e("boolean"==typeof t,"Invalid mode:",t),this.$_setFlag("only",t)}optional(){return this.presence("optional")}prefs(t){e(t,"Missing preferences"),e(void 0===t.context,"Cannot override context"),e(void 0===t.externals,"Cannot override externals"),e(void 0===t.warnings,"Cannot override warnings"),e(void 0===t.debug,"Cannot override debug"),s.checkPreferences(t);const r=this.clone();return r._preferences=s.preferences(r._preferences,t),r}presence(t){return e(["optional","required","forbidden"].includes(t),"Unknown presence mode",t),this.$_setFlag("presence",t)}raw(e=!0){return this.$_setFlag("result",e?"raw":void 0)}result(t){return e(["raw","strip"].includes(t),"Unknown result mode",t),this.$_setFlag("result",t)}required(){return this.presence("required")}strict(e){const t=this.clone(),r=void 0!==e&&!e;return t._preferences=s.preferences(t._preferences,{convert:r}),t}strip(e=!0){return this.$_setFlag("result",e?"strip":void 0)}tag(...t){e(t.length,"Missing tags");for(const r of t)e(r&&"string"==typeof r,"Tags must be non-empty strings");return this._inner("tags",t)}unit(t){return e(t&&"string"==typeof t,"Unit name must be a non-empty string"),this.$_setFlag("unit",t)}valid(...e){s.verifyFlat(e,"valid");const t=this.allow(...e);return t.$_setFlag("only",!!t._valids,{clone:!1}),t}when(t,r){const n=this.clone();n.$_terms.whens||(n.$_terms.whens=[]);const i=o.when(n,t,r);if(!["any","link"].includes(n.type)){const t=i.is?[i]:i.switch;for(const r of t)e(!r.then||"any"===r.then.type||r.then.type===n.type,"Cannot combine",n.type,"with",r.then&&r.then.type),e(!r.otherwise||"any"===r.otherwise.type||r.otherwise.type===n.type,"Cannot combine",n.type,"with",r.otherwise&&r.otherwise.type)}return n.$_terms.whens.push(i),n.$_mutateRebuild()}cache(t){e(!this._inRuleset(),"Cannot set caching inside a ruleset"),e(!this._cache,"Cannot override schema cache"),e(void 0===this._flags.artifact,"Cannot cache a rule with an artifact");const r=this.clone();return r._cache=t||i.provider.provision(),r.$_temp.ruleset=!1,r}clone(){const e=Object.create(Object.getPrototypeOf(this));return this._assign(e)}concat(t){e(s.isSchema(t),"Invalid schema object"),e("any"===this.type||"any"===t.type||t.type===this.type,"Cannot merge type",this.type,"with another type:",t.type),e(!this._inRuleset(),"Cannot concatenate onto a schema with open ruleset"),e(!t._inRuleset(),"Cannot concatenate a schema with open ruleset");let r=this.clone();if("any"===this.type&&"any"!==t.type){const e=t.clone();for(const t of Object.keys(r))"type"!==t&&(e[t]=r[t]);r=e}r._ids.concat(t._ids),r._refs.register(t,h.toSibling),r._preferences=r._preferences?s.preferences(r._preferences,t._preferences):t._preferences,r._valids=m.merge(r._valids,t._valids,t._invalids),r._invalids=m.merge(r._invalids,t._invalids,t._valids);for(const e of t._singleRules.keys())r._singleRules.has(e)&&(r._rules=r._rules.filter(t=>t.keep||t.name!==e),r._singleRules.delete(e));for(const e of t._rules)t._definition.rules[e.method].multi||r._singleRules.set(e.name,e),r._rules.push(e);if(r._flags.empty&&t._flags.empty){r._flags.empty=r._flags.empty.concat(t._flags.empty);const e=Object.assign({},t._flags);delete e.empty,n(r._flags,e)}else if(t._flags.empty){r._flags.empty=t._flags.empty;const e=Object.assign({},t._flags);delete e.empty,n(r._flags,e)}else n(r._flags,t._flags);for(const e in t.$_terms){const n=t.$_terms[e];n?r.$_terms[e]?r.$_terms[e]=r.$_terms[e].concat(n):r.$_terms[e]=n.slice():r.$_terms[e]||(r.$_terms[e]=n)}return this.$_root._tracer&&this.$_root._tracer._combine(r,[this,t]),r.$_mutateRebuild()}extend(t){return e(!t.base,"Cannot extend type with another base"),l.type(this,t)}extract(e){return e=Array.isArray(e)?e:e.split("."),this._ids.reach(e)}fork(t,r){e(!this._inRuleset(),"Cannot fork inside a ruleset");let n=this;for(let e of[].concat(t))e=Array.isArray(e)?e:e.split("."),n=n._ids.fork(e,r,n);return n.$_temp.ruleset=!1,n}isAsync(){if(Boolean(this.$_terms.externals?.length))return!0;if(this.$_terms.whens)for(const e of this.$_terms.whens){if(e.then?.isAsync())return!0;if(e.otherwise?.isAsync())return!0;if(e.switch)for(const t of e.switch){if(t.then?.isAsync())return!0;if(t.otherwise?.isAsync())return!0}}return!1}rule(r){const n=this._definition;s.assertOptions(r,Object.keys(n.modifiers)),e(!1!==this.$_temp.ruleset,"Cannot apply rules to empty ruleset or the last rule added does not support rule properties");const i=null===this.$_temp.ruleset?this._rules.length-1:this.$_temp.ruleset;e(i>=0&&i<this._rules.length,"Cannot apply rules to empty ruleset");const o=this.clone();for(let s=i;s<o._rules.length;++s){const i=o._rules[s],a=t(i);for(const t in r)n.modifiers[t](a,r[t]),e(a.name===i.name,"Cannot change rule name");o._rules[s]=a,o._singleRules.get(a.name)===i&&o._singleRules.set(a.name,a)}return o.$_temp.ruleset=!1,o.$_mutateRebuild()}get ruleset(){e(!this._inRuleset(),"Cannot start a new ruleset without closing the previous one");const t=this.clone();return t.$_temp.ruleset=t._rules.length,t}get $(){return this.ruleset}tailor(t){t=[].concat(t),e(!this._inRuleset(),"Cannot tailor inside a ruleset");let r=this;if(this.$_terms.alterations)for(const{target:n,adjuster:i}of this.$_terms.alterations)t.includes(n)&&(r=i(r),e(s.isSchema(r),"Alteration adjuster for",n,"failed to return a schema object"));return r=r.$_modify({each:e=>e.tailor(t),ref:!1}),r.$_temp.ruleset=!1,r.$_mutateRebuild()}tracer(){return f.location?f.location(this):this}validate(e,t){return p.entry(e,this,t)}validateAsync(e,t){return p.entryAsync(e,this,t)}$_addRule(t){"string"==typeof t&&(t={name:t}),e(t&&"object"==typeof t,"Invalid options"),e(t.name&&"string"==typeof t.name,"Invalid rule name");for(const r in t)e("_"!==r[0],"Cannot set private rule properties");const r=Object.assign({},t);r._resolve=[],r.method=r.method||r.name;const n=this._definition.rules[r.method],i=r.args;e(n,"Unknown rule",r.method);const o=this.clone();if(i){e(1===Object.keys(i).length||Object.keys(i).length===this._definition.rules[r.name].args.length,"Invalid rule definition for",this.type,r.name);for(const t in i){let a=i[t];if(n.argsByName){const l=n.argsByName.get(t);if(l.ref&&s.isResolvable(a))r._resolve.push(t),o.$_mutateRegister(a);else if(l.normalize&&(a=l.normalize(a),i[t]=a),l.assert){const r=s.validateArg(a,t,l);e(!r,r,"or reference")}}void 0!==a?i[t]=a:delete i[t]}}return n.multi||(o._ruleRemove(r.name,{clone:!1}),o._singleRules.set(r.name,r)),!1===o.$_temp.ruleset&&(o.$_temp.ruleset=null),n.priority?o._rules.unshift(r):o._rules.push(r),o}$_compile(e,t){return o.schema(this.$_root,e,t)}$_createError(e,t,r,n,i,s={}){const o=!1!==s.flags?this._flags:{},l=s.messages?u.merge(this._definition.messages,s.messages):this._definition.messages;return new a.Report(e,t,r,o,l,n,i)}$_getFlag(e){return this._flags[e]}$_getRule(e){return this._singleRules.get(e)}$_mapLabels(e){return e=Array.isArray(e)?e:e.split("."),this._ids.labels(e)}$_match(e,t,r,n){(r=Object.assign({},r)).abortEarly=!0,r._externals=!1,t.snapshot();const i=!p.validate(e,this,t,r,n).errors;return t.restore(),i}$_modify(e){return s.assertOptions(e,["each","once","ref","schema"]),d.schema(this,e)||this}$_mutateRebuild(){e(!this._inRuleset(),"Cannot add this rule inside a ruleset"),this._refs.reset(),this._ids.reset();return this.$_modify({each:(e,{source:t,name:r,path:n,key:i})=>{const s=this._definition[t][r]&&this._definition[t][r].register;!1!==s&&this.$_mutateRegister(e,{family:s,key:i})}}),this._definition.rebuild&&this._definition.rebuild(this),this.$_temp.ruleset=!1,this}$_mutateRegister(e,{family:t,key:r}={}){this._refs.register(e,t),this._ids.register(e,{key:r})}$_property(e){return this._definition.properties[e]}$_reach(e){return this._ids.reach(e)}$_rootReferences(){return this._refs.roots()}$_setFlag(t,n,i={}){e("_"===t[0]||!this._inRuleset(),"Cannot set flag inside a ruleset");const s=this._definition.flags[t]||{};if(r(n,s.default)&&(n=void 0),r(n,this._flags[t]))return this;const o=!1!==i.clone?this.clone():this;return void 0!==n?(o._flags[t]=n,o.$_mutateRegister(n)):delete o._flags[t],"_"!==t[0]&&(o.$_temp.ruleset=!1),o}$_parent(e,...t){return this[e][s.symbols.parent].call(this,...t)}$_validate(e,t,r){return p.validate(e,this,t,r)}_assign(e){e.type=this.type,e.$_root=this.$_root,e.$_temp=Object.assign({},this.$_temp),e.$_temp.whens={},e._ids=this._ids.clone(),e._preferences=this._preferences,e._valids=this._valids&&this._valids.clone(),e._invalids=this._invalids&&this._invalids.clone(),e._rules=this._rules.slice(),e._singleRules=t(this._singleRules,{shallow:!0}),e._refs=this._refs.clone(),e._flags=Object.assign({},this._flags),e._cache=null,e.$_terms={};for(const t in this.$_terms)e.$_terms[t]=this.$_terms[t]?this.$_terms[t].slice():null;e.$_super={};for(const t in this.$_super)e.$_super[t]=this._super[t].bind(e);return e}_bare(){const e=this.clone();e._reset();const t=e._definition.terms;for(const r in t){const n=t[r];e.$_terms[r]=n.init}return e.$_mutateRebuild()}_default(t,r,n={}){s.assertOptions(n,"literal"),e(void 0!==r,"Missing",t,"value"),e("function"==typeof r||!n.literal,"Only function value supports literal option"),"function"==typeof r&&n.literal&&(r={[s.symbols.literal]:!0,literal:r});return this.$_setFlag(t,r)}_generate(e,t,r){if(!this.$_terms.whens)return{schema:this};const n=[],i=[];for(let s=0;s<this.$_terms.whens.length;++s){const o=this.$_terms.whens[s];if(o.concat){n.push(o.concat),i.push(`${s}.concat`);continue}const a=o.ref?o.ref.resolve(e,t,r):e,l=o.is?[o]:o.switch,c=i.length;for(let c=0;c<l.length;++c){const{is:u,then:d,otherwise:h}=l[c],f=`${s}${o.switch?"."+c:""}`;if(u.$_match(a,t.nest(u,`${f}.is`),r)){if(d){const s=t.localize([...t.path,`${f}.then`],t.ancestors,t.schemas),{schema:o,id:a}=d._generate(e,s,r);n.push(o),i.push(`${f}.then${a?`(${a})`:""}`);break}}else if(h){const s=t.localize([...t.path,`${f}.otherwise`],t.ancestors,t.schemas),{schema:o,id:a}=h._generate(e,s,r);n.push(o),i.push(`${f}.otherwise${a?`(${a})`:""}`);break}}if(o.break&&i.length>c)break}const s=i.join(", ");if(t.mainstay.tracer.debug(t,"rule","when",s),!s)return{schema:this};if(!t.mainstay.tracer.active&&this.$_temp.whens[s])return{schema:this.$_temp.whens[s],id:s};let o=this;this._definition.generate&&(o=this._definition.generate(this,e,t,r));for(const e of n)o=o.concat(e);return this.$_root._tracer&&this.$_root._tracer._combine(o,[this,...n]),this.$_temp.whens[s]=o,{schema:o,id:s}}_inner(t,r,n={}){e(!this._inRuleset(),`Cannot set ${t} inside a ruleset`);const i=this.clone();return i.$_terms[t]&&!n.override||(i.$_terms[t]=[]),n.single?i.$_terms[t].push(r):i.$_terms[t].push(...r),i.$_temp.ruleset=!1,i}_inRuleset(){return null!==this.$_temp.ruleset&&!1!==this.$_temp.ruleset}_ruleRemove(e,t={}){if(!this._singleRules.has(e))return this;const r=!1!==t.clone?this.clone():this;r._singleRules.delete(e);const n=[];for(let t=0;t<r._rules.length;++t){const i=r._rules[t];i.name!==e||i.keep?n.push(i):r._inRuleset()&&t<r.$_temp.ruleset&&--r.$_temp.ruleset}return r._rules=n,r}_values(t,r){s.verifyFlat(t,r.slice(1,-1));const n=this.clone(),i=t[0]===s.symbols.override;if(i&&(t=t.slice(1)),!n[r]&&t.length?n[r]=new m:i&&(n[r]=t.length?new m:null,n.$_mutateRebuild()),!n[r])return n;i&&n[r].override();for(const i of t){e(void 0!==i,"Cannot call allow/valid/invalid with undefined"),e(i!==s.symbols.override,"Override must be the first value");const t="_invalids"===r?"_valids":"_invalids";n[t]&&(n[t].remove(i),n[t].length||(e("_valids"===r||!n._flags.only,"Setting invalid value",i,"leaves schema rejecting all values due to previous valid rule"),n[t]=null)),n[r].add(i,n._refs)}return n}get"~standard"(){const e=e=>{let t;return t=a.ValidationError.isError(e)?e.details.map(({message:e,path:t})=>({message:e,path:t})):[{message:e.message}],{issues:t}},t=e=>({value:e});return{version:1,vendor:"joi",validate:r=>{const n=p.standard(r,this);return n instanceof Promise?n.then(t,e):n.error?e(n.error):t(n.value)}}}}};return _.Base.prototype[s.symbols.any]={version:s.version,compile:o.compile,root:"$_root"},_.Base.prototype.isImmutable=!0,_.Base.prototype.deny=_.Base.prototype.invalid,_.Base.prototype.disallow=_.Base.prototype.invalid,_.Base.prototype.equal=_.Base.prototype.valid,_.Base.prototype.exist=_.Base.prototype.required,_.Base.prototype.not=_.Base.prototype.invalid,_.Base.prototype.options=_.Base.prototype.prefs,_.Base.prototype.preferences=_.Base.prototype.prefs,base=new _.Base}function requireAny(){if(hasRequiredAny)return any;hasRequiredAny=1;const{assert:e}=requireLib$5(),t=requireBase(),r=requireCommon(),n=requireMessages();return any=t.extend({type:"any",flags:{only:{default:!1}},terms:{alterations:{init:null},examples:{init:null},externals:{init:null},metas:{init:[]},notes:{init:[]},shared:{init:null},tags:{init:[]},whens:{init:null}},rules:{custom:{method(t,r){return e("function"==typeof t,"Method must be a function"),e(void 0===r||r&&"string"==typeof r,"Description must be a non-empty string"),this.$_addRule({name:"custom",args:{method:t,description:r}})},validate(e,t,{method:r}){try{return r(e,t)}catch(e){return t.error("any.custom",{error:e})}},args:["method","description"],multi:!0},messages:{method(e){return this.prefs({messages:e})}},shared:{method(t){e(r.isSchema(t)&&t._flags.id,"Schema must be a schema with an id");const n=this.clone();return n.$_terms.shared=n.$_terms.shared||[],n.$_terms.shared.push(t),n.$_mutateRegister(t),n}},warning:{method(t,r){return e(t&&"string"==typeof t,"Invalid warning code"),this.$_addRule({name:"warning",args:{code:t,local:r},warn:!0})},validate:(e,t,{code:r,local:n})=>t.error(r,n),args:["code","local"],multi:!0}},modifiers:{keep(e,t=!0){e.keep=t},message(e,t){e.message=n.compile(t)},warn(e,t=!0){e.warn=t}},manifest:{build(e,t){for(const r in t){const n=t[r];if(["examples","externals","metas","notes","tags"].includes(r))for(const t of n)e=e[r.slice(0,-1)](t);else{if("alterations"===r){const t={};for(const{target:e,adjuster:r}of n)t[e]=r;e=e.alter(t);continue}if("whens"!==r){if("shared"===r)for(const t of n)e=e.shared(t)}else for(const t of n){const{ref:r,is:n,not:i,then:s,otherwise:o,concat:a}=t;e=a?e.concat(a):r?e.when(r,{is:n,not:i,then:s,otherwise:o,switch:t.switch,break:t.break}):e.when(n,{then:s,otherwise:o,break:t.break})}}}return e}},messages:{"any.custom":"{{#label}} failed custom validation because {{#error.message}}","any.default":"{{#label}} threw an error when running default method","any.failover":"{{#label}} threw an error when running failover method","any.invalid":"{{#label}} contains an invalid value","any.only":'{{#label}} must be {if(#valids.length == 1, "", "one of ")}{{#valids}}',"any.ref":"{{#label}} {{#arg}} references {{:#ref}} which {{#reason}}","any.required":"{{#label}} is required","any.unknown":"{{#label}} is not allowed"}}),any}function requireAlternatives(){if(hasRequiredAlternatives)return alternatives;hasRequiredAlternatives=1;const{assert:e,merge:t}=requireLib$5(),r=requireAny(),n=requireCommon(),i=requireCompile(),s=requireErrors(),o=requireRef(),a={};return alternatives=r.extend({type:"alternatives",flags:{match:{default:"any"}},terms:{matches:{init:[],register:o.toSibling}},args:(e,...t)=>1===t.length&&Array.isArray(t[0])?e.try(...t[0]):e.try(...t),validate(e,r){const{schema:n,error:i,state:o,prefs:l}=r;if(n._flags.match){const r=[],a=[];for(let t=0;t<n.$_terms.matches.length;++t){const i=n.$_terms.matches[t],s=o.nest(i.schema,`match.${t}`);s.snapshot();const c=i.schema.$_validate(e,s,l);c.errors?(a.push(c.errors),s.restore()):(r.push(c.value),s.commit())}if(0===r.length){const e={details:a.map(e=>s.details(e,{override:!1}))};return{errors:i("alternatives.any",e)}}if("one"===n._flags.match)return 1===r.length?{value:r[0]}:{errors:i("alternatives.one")};if(r.length!==n.$_terms.matches.length){const e={details:a.map(e=>s.details(e,{override:!1}))};return{errors:i("alternatives.all",e)}}const c=e=>e.$_terms.matches.some(e=>"object"===e.schema.type||"alternatives"===e.schema.type&&c(e.schema));return c(n)?{value:r.reduce((e,r)=>t(e,r,{mergeArrays:!1}))}:{value:r[r.length-1]}}const c=[];for(let t=0;t<n.$_terms.matches.length;++t){const r=n.$_terms.matches[t];if(r.schema){const n=o.nest(r.schema,`match.${t}`);n.snapshot();const i=r.schema.$_validate(e,n,l);if(!i.errors)return n.commit(),i;n.restore(),c.push({schema:r.schema,reports:i.errors});continue}const i=r.ref?r.ref.resolve(e,o,l):e,s=r.is?[r]:r.switch;for(let n=0;n<s.length;++n){const a=s[n],{is:c,then:u,otherwise:d}=a,h=`match.${t}${r.switch?"."+n:""}`;if(c.$_match(i,o.nest(c,`${h}.is`),l)){if(u)return u.$_validate(e,o.nest(u,`${h}.then`),l)}else if(d)return d.$_validate(e,o.nest(d,`${h}.otherwise`),l)}}return a.errors(c,r)},rules:{conditional:{method(t,r){e(!this._flags._endedSwitch,"Unreachable condition"),e(!this._flags.match,"Cannot combine match mode",this._flags.match,"with conditional rule"),e(void 0===r.break,"Cannot use break option with alternatives conditional");const n=this.clone(),s=i.when(n,t,r),o=s.is?[s]:s.switch;for(const e of o)if(e.then&&e.otherwise){n.$_setFlag("_endedSwitch",!0,{clone:!1});break}return n.$_terms.matches.push(s),n.$_mutateRebuild()}},match:{method(t){if(e(["any","one","all"].includes(t),"Invalid alternatives match mode",t),"any"!==t)for(const r of this.$_terms.matches)e(r.schema,"Cannot combine match mode",t,"with conditional rules");return this.$_setFlag("match",t)}},try:{method(...t){e(t.length,"Missing alternative schemas"),n.verifyFlat(t,"try"),e(!this._flags._endedSwitch,"Unreachable condition");const r=this.clone();for(const e of t)r.$_terms.matches.push({schema:r.$_compile(e)});return r.$_mutateRebuild()}}},overrides:{label(e){return this.$_parent("label",e).$_modify({each:(t,r)=>"is"!==r.path[0]&&"string"!=typeof t._flags.label?t.label(e):void 0,ref:!1})},isAsync(){if(this.$_terms.externals?.length)return!0;for(const e of this.$_terms.matches){if(e.schema?.isAsync())return!0;if(e.then?.isAsync())return!0;if(e.otherwise?.isAsync())return!0}return!1}},rebuild(e){e.$_modify({each:t=>{n.isSchema(t)&&"array"===t.type&&e.$_setFlag("_arrayItems",!0,{clone:!1})}})},manifest:{build(e,t){if(t.matches)for(const r of t.matches){const{schema:t,ref:n,is:i,not:s,then:o,otherwise:a}=r;e=t?e.try(t):n?e.conditional(n,{is:i,then:o,not:s,otherwise:a,switch:r.switch}):e.conditional(i,{then:o,otherwise:a})}return e}},messages:{"alternatives.all":"{{#label}} does not match all of the required types","alternatives.any":"{{#label}} does not match any of the allowed types","alternatives.match":"{{#label}} does not match any of the allowed types","alternatives.one":"{{#label}} matches more than one allowed type","alternatives.types":"{{#label}} must be one of {{#types}}"}}),a.errors=function(e,{error:t,state:r}){if(!e.length)return{errors:t("alternatives.any")};if(1===e.length)return{errors:e[0].reports};const n=new Set,i=[];for(const{reports:o,schema:l}of e){if(o.length>1)return a.unmatched(e,t);const c=o[0];if(c instanceof s.Report==!1)return a.unmatched(e,t);if(c.state.path.length!==r.path.length){i.push({type:l.type,report:c});continue}if("any.only"===c.code){for(const e of c.local.valids)n.add(e);continue}const[u,d]=c.code.split(".");"base"!==d?i.push({type:l.type,report:c}):"object.base"===c.code?n.add(c.local.type):n.add(u)}return i.length?1===i.length?{errors:i[0].report}:a.unmatched(e,t):{errors:t("alternatives.types",{types:[...n]})}},a.unmatched=function(e,t){const r=[];for(const t of e)r.push(...t.reports);return{errors:t("alternatives.match",s.details(r,{override:!1}))}},alternatives}function requireArray(){if(hasRequiredArray)return array$1;hasRequiredArray=1;const{assert:e,deepEqual:t,reach:r}=requireLib$5(),n=requireAny(),i=requireCommon(),s=requireCompile(),o={};return array$1=n.extend({type:"array",flags:{single:{default:!1},sparse:{default:!1}},terms:{items:{init:[],manifest:"schema"},ordered:{init:[],manifest:"schema"},_exclusions:{init:[]},_inclusions:{init:[]},_requireds:{init:[]}},coerce:{from:"object",method(e,{schema:t,state:r,prefs:n}){if(!Array.isArray(e))return;const i=t.$_getRule("sort");return i?o.sort(t,e,i.args.options,r,n):void 0}},validate(e,{schema:t,error:r}){if(!Array.isArray(e)){if(t._flags.single){const t=[e];return t[i.symbols.arraySingle]=!0,{value:t}}return{errors:r("array.base")}}if(t.$_getRule("items")||t.$_terms.externals)return{value:e.slice()}},rules:{has:{method(e){e=this.$_compile(e,{appendPath:!0});const t=this.$_addRule({name:"has",args:{schema:e}});return t.$_mutateRegister(e),t},validate(e,{state:t,prefs:r,error:n},{schema:i}){const s=[e,...t.ancestors];for(let n=0;n<e.length;++n){const o=t.localize([...t.path,n],s,i);if(i.$_match(e[n],o,r))return e}const o=i._flags.label;return o?n("array.hasKnown",{patternLabel:o}):n("array.hasUnknown",null)},multi:!0},items:{method(...e){i.verifyFlat(e,"items");const t=this.$_addRule("items");for(let r=0;r<e.length;++r){const n=i.tryWithPath(()=>this.$_compile(e[r]),r,{append:!0});t.$_terms.items.push(n)}return t.$_mutateRebuild()},validate(e,{schema:t,error:r,state:n,prefs:s,errorsArray:a}){const l=t.$_terms._requireds.slice(),c=t.$_terms.ordered.slice(),u=[...t.$_terms._inclusions,...l],d=!e[i.symbols.arraySingle];delete e[i.symbols.arraySingle];const h=a();let f=e.length;for(let i=0;i<f;++i){const a=e[i];let p=!1,m=!1;const _=d?i:new Number(i),g=[...n.path,_];if(!t._flags.sparse&&void 0===a){if(h.push(r("array.sparse",{key:_,path:g,pos:i,value:void 0},n.localize(g))),s.abortEarly)return h;c.shift();continue}const y=[e,...n.ancestors];for(const e of t.$_terms._exclusions)if(e.$_match(a,n.localize(g,y,e),s,{presence:"ignore"})){if(h.push(r("array.excludes",{pos:i,value:a},n.localize(g))),s.abortEarly)return h;p=!0,c.shift();break}if(p)continue;if(t.$_terms.ordered.length){if(c.length){const l=c.shift(),u=l.$_validate(a,n.localize(g,y,l),s);if(u.errors){if(h.push(...u.errors),s.abortEarly)return h}else if("strip"===l._flags.result)o.fastSplice(e,i),--i,--f;else{if(!t._flags.sparse&&void 0===u.value){if(h.push(r("array.sparse",{key:_,path:g,pos:i,value:void 0},n.localize(g))),s.abortEarly)return h;continue}e[i]=u.value}continue}if(!t.$_terms.items.length){if(h.push(r("array.orderedLength",{pos:i,limit:t.$_terms.ordered.length})),s.abortEarly)return h;break}}const v=[];let b=l.length;for(let c=0;c<b;++c){const u=n.localize(g,y,l[c]);u.snapshot();const d=l[c].$_validate(a,u,s);if(v[c]=d,!d.errors){if(u.commit(),e[i]=d.value,m=!0,o.fastSplice(l,c),--c,--b,!t._flags.sparse&&void 0===d.value&&(h.push(r("array.sparse",{key:_,path:g,pos:i,value:void 0},n.localize(g))),s.abortEarly))return h;break}u.restore()}if(m)continue;const w=s.stripUnknown&&!!s.stripUnknown.arrays||!1;b=u.length;for(const c of u){let u;const d=l.indexOf(c);if(-1!==d)u=v[d];else{const l=n.localize(g,y,c);if(l.snapshot(),u=c.$_validate(a,l,s),!u.errors){l.commit(),"strip"===c._flags.result?(o.fastSplice(e,i),--i,--f):t._flags.sparse||void 0!==u.value?e[i]=u.value:(h.push(r("array.sparse",{key:_,path:g,pos:i,value:void 0},n.localize(g))),p=!0),m=!0;break}l.restore()}if(1===b){if(w){o.fastSplice(e,i),--i,--f,m=!0;break}if(h.push(...u.errors),s.abortEarly)return h;p=!0;break}}if(!p&&((t.$_terms._inclusions.length||t.$_terms._requireds.length)&&!m)){if(w){o.fastSplice(e,i),--i,--f;continue}if(h.push(r("array.includes",{pos:i,value:a},n.localize(g))),s.abortEarly)return h}}return l.length&&o.fillMissedErrors(t,h,l,e,n,s),c.length&&(o.fillOrderedErrors(t,h,c,e,n,s),h.length||o.fillDefault(c,e,n,s)),h.length?h:e},priority:!0,manifest:!1},length:{method(e){return this.$_addRule({name:"length",args:{limit:e},operator:"="})},validate:(e,t,{limit:r},{name:n,operator:s,args:o})=>i.compare(e.length,r,s)?e:t.error("array."+n,{limit:o.limit,value:e}),args:[{name:"limit",ref:!0,assert:i.limit,message:"must be a positive integer"}]},max:{method(e){return this.$_addRule({name:"max",method:"length",args:{limit:e},operator:"<="})}},min:{method(e){return this.$_addRule({name:"min",method:"length",args:{limit:e},operator:">="})}},ordered:{method(...e){i.verifyFlat(e,"ordered");const t=this.$_addRule("items");for(let r=0;r<e.length;++r){const n=i.tryWithPath(()=>this.$_compile(e[r]),r,{append:!0});o.validateSingle(n,t),t.$_mutateRegister(n),t.$_terms.ordered.push(n)}return t.$_mutateRebuild()}},single:{method(t){const r=void 0===t||!!t;return e(!r||!this._flags._arrayItems,"Cannot specify single rule when array has array items"),this.$_setFlag("single",r)}},sort:{method(t={}){i.assertOptions(t,["by","order"]);const r={order:t.order||"ascending"};return t.by&&(r.by=s.ref(t.by,{ancestor:0}),e(!r.by.ancestor,"Cannot sort by ancestor")),this.$_addRule({name:"sort",args:{options:r}})},validate(e,{error:t,state:r,prefs:n,schema:i},{options:s}){const{value:a,errors:l}=o.sort(i,e,s,r,n);if(l)return l;for(let r=0;r<e.length;++r)if(e[r]!==a[r])return t("array.sort",{order:s.order,by:s.by?s.by.key:"value"});return e},convert:!0},sparse:{method(e){const t=void 0===e||!!e;if(this._flags.sparse===t)return this;return(t?this.clone():this.$_addRule("items")).$_setFlag("sparse",t,{clone:!1})}},unique:{method(t,r={}){e(!t||"function"==typeof t||"string"==typeof t,"comparator must be a function or a string"),i.assertOptions(r,["ignoreUndefined","separator"]);const n={name:"unique",args:{options:r,comparator:t}};if(t)if("string"==typeof t){const e=i.default(r.separator,".");n.path=e?t.split(e):[t]}else n.comparator=t;return this.$_addRule(n)},validate(n,{state:i,error:s,schema:o},{comparator:a,options:l},{comparator:c,path:u}){const d={string:Object.create(null),number:Object.create(null),undefined:Object.create(null),boolean:Object.create(null),bigint:Object.create(null),object:new Map,function:new Map,custom:new Map},h=c||t,f=l.ignoreUndefined;for(let t=0;t<n.length;++t){const o=u?r(n[t],u):n[t],l=c?d.custom:d[typeof o];if(e(l,"Failed to find unique map container for type",typeof o),l instanceof Map){const e=l.entries();let r;for(;!(r=e.next()).done;)if(h(r.value[0],o)){const e=i.localize([...i.path,t],[n,...i.ancestors]),o={pos:t,value:n[t],dupePos:r.value[1],dupeValue:n[r.value[1]]};return u&&(o.path=a),s("array.unique",o,e)}l.set(o,t)}else{if((!f||void 0!==o)&&void 0!==l[o]){const e={pos:t,value:n[t],dupePos:l[o],dupeValue:n[l[o]]};u&&(e.path=a);return s("array.unique",e,i.localize([...i.path,t],[n,...i.ancestors]))}l[o]=t}}return n},args:["comparator","options"],multi:!0}},overrides:{isAsync(){if(this.$_terms.externals?.length)return!0;for(const e of this.$_terms.items)if(e.isAsync())return!0;for(const e of this.$_terms.ordered)if(e.isAsync())return!0;return!1}},cast:{set:{from:Array.isArray,to:(e,t)=>new Set(e)}},rebuild(e){e.$_terms._inclusions=[],e.$_terms._exclusions=[],e.$_terms._requireds=[];for(const t of e.$_terms.items)o.validateSingle(t,e),"required"===t._flags.presence?e.$_terms._requireds.push(t):"forbidden"===t._flags.presence?e.$_terms._exclusions.push(t):e.$_terms._inclusions.push(t);for(const t of e.$_terms.ordered)o.validateSingle(t,e)},manifest:{build:(e,t)=>(t.items&&(e=e.items(...t.items)),t.ordered&&(e=e.ordered(...t.ordered)),e)},messages:{"array.base":"{{#label}} must be an array","array.excludes":"{{#label}} contains an excluded value","array.hasKnown":"{{#label}} does not contain at least one required match for type {:#patternLabel}","array.hasUnknown":"{{#label}} does not contain at least one required match","array.includes":"{{#label}} does not match any of the allowed types","array.includesRequiredBoth":"{{#label}} does not contain {{#knownMisses}} and {{#unknownMisses}} other required value(s)","array.includesRequiredKnowns":"{{#label}} does not contain {{#knownMisses}}","array.includesRequiredUnknowns":"{{#label}} does not contain {{#unknownMisses}} required value(s)","array.length":"{{#label}} must contain {{#limit}} items","array.max":"{{#label}} must contain less than or equal to {{#limit}} items","array.min":"{{#label}} must contain at least {{#limit}} items","array.orderedLength":"{{#label}} must contain at most {{#limit}} items","array.sort":"{{#label}} must be sorted in {#order} order by {{#by}}","array.sort.mismatching":"{{#label}} cannot be sorted due to mismatching types","array.sort.unsupported":"{{#label}} cannot be sorted due to unsupported type {#type}","array.sparse":"{{#label}} must not be a sparse array item","array.unique":"{{#label}} contains a duplicate value"}}),o.fillMissedErrors=function(e,t,r,n,i,s){const o=[];let a=0;for(const e of r){const t=e._flags.label;t?o.push(t):++a}o.length?a?t.push(e.$_createError("array.includesRequiredBoth",n,{knownMisses:o,unknownMisses:a},i,s)):t.push(e.$_createError("array.includesRequiredKnowns",n,{knownMisses:o},i,s)):t.push(e.$_createError("array.includesRequiredUnknowns",n,{unknownMisses:a},i,s))},o.fillOrderedErrors=function(e,t,r,n,i,s){const a=[];for(const e of r)"required"===e._flags.presence&&a.push(e);a.length&&o.fillMissedErrors(e,t,a,n,i,s)},o.fillDefault=function(e,t,r,n){const i=[];let s=!0;for(let o=e.length-1;o>=0;--o){const a=e[o],l=[t,...r.ancestors],c=a.$_validate(void 0,r.localize(r.path,l,a),n).value;if(s){if(void 0===c)continue;s=!1}i.unshift(c)}i.length&&t.push(...i)},o.fastSplice=function(e,t){let r=t;for(;r<e.length;)e[r++]=e[r];--e.length},o.validateSingle=function(t,r){("array"===t.type||t._flags._arrayItems)&&(e(!r._flags.single,"Cannot specify array item with single rule enabled"),r.$_setFlag("_arrayItems",!0,{clone:!1}))},o.sort=function(e,t,r,n,i){const s="ascending"===r.order?1:-1,a=-1*s,l=s,c=(c,u)=>{let d=o.compare(c,u,a,l);if(null!==d)return d;if(r.by&&(c=r.by.resolve(c,n,i),u=r.by.resolve(u,n,i)),d=o.compare(c,u,a,l),null!==d)return d;const h=typeof c;if(h!==typeof u)throw e.$_createError("array.sort.mismatching",t,null,n,i);if("number"!==h&&"string"!==h)throw e.$_createError("array.sort.unsupported",t,{type:h},n,i);return"number"===h?(c-u)*s:c<u?a:l};try{return{value:t.slice().sort(c)}}catch(e){return{errors:e}}},o.compare=function(e,t,r,n){return e===t?0:void 0===e?1:void 0===t?-1:null===e?n:null===t?r:null},array$1}function requireBoolean(){if(hasRequiredBoolean)return boolean$2;hasRequiredBoolean=1;const{assert:e}=requireLib$5(),t=requireAny(),r=requireCommon(),n=requireValues(),i={isBool:function(e){return"boolean"==typeof e}};return boolean$2=t.extend({type:"boolean",flags:{sensitive:{default:!1}},terms:{falsy:{init:null,manifest:"values"},truthy:{init:null,manifest:"values"}},coerce(e,{schema:t}){if("boolean"!=typeof e){if("string"==typeof e){const r=t._flags.sensitive?e:e.toLowerCase();e="true"===r||"false"!==r&&e}return"boolean"!=typeof e&&(e=t.$_terms.truthy&&t.$_terms.truthy.has(e,null,null,!t._flags.sensitive)||(!t.$_terms.falsy||!t.$_terms.falsy.has(e,null,null,!t._flags.sensitive))&&e),{value:e}}},validate(e,{error:t}){if("boolean"!=typeof e)return{value:e,errors:t("boolean.base")}},rules:{truthy:{method(...t){r.verifyFlat(t,"truthy");const i=this.clone();i.$_terms.truthy=i.$_terms.truthy||new n;for(let r=0;r<t.length;++r){const n=t[r];e(void 0!==n,"Cannot call truthy with undefined"),i.$_terms.truthy.add(n)}return i}},falsy:{method(...t){r.verifyFlat(t,"falsy");const i=this.clone();i.$_terms.falsy=i.$_terms.falsy||new n;for(let r=0;r<t.length;++r){const n=t[r];e(void 0!==n,"Cannot call falsy with undefined"),i.$_terms.falsy.add(n)}return i}},sensitive:{method(e=!0){return this.$_setFlag("sensitive",e)}}},cast:{number:{from:i.isBool,to:(e,t)=>e?1:0},string:{from:i.isBool,to:(e,t)=>e?"true":"false"}},manifest:{build:(e,t)=>(t.truthy&&(e=e.truthy(...t.truthy)),t.falsy&&(e=e.falsy(...t.falsy)),e)},messages:{"boolean.base":"{{#label}} must be a boolean"}}),boolean$2}function requireDate(){if(hasRequiredDate)return date$2;hasRequiredDate=1;const{assert:e}=requireLib$5(),t=requireAny(),r=requireCommon(),n=requireTemplate(),i={isDate:function(e){return e instanceof Date}};return date$2=t.extend({type:"date",coerce:{from:["number","string"],method:(e,{schema:t})=>({value:i.parse(e,t._flags.format)||e})},validate(e,{schema:t,error:r,prefs:n}){if(e instanceof Date&&!isNaN(e.getTime()))return;const i=t._flags.format;return n.convert&&i&&"string"==typeof e?{value:e,errors:r("date.format",{format:i})}:{value:e,errors:r("date.base")}},rules:{compare:{method:!1,validate(e,t,{date:n},{name:i,operator:s,args:o}){const a="now"===n?Date.now():n.getTime();return r.compare(e.getTime(),a,s)?e:t.error("date."+i,{limit:o.date,value:e})},args:[{name:"date",ref:!0,normalize:e=>"now"===e?e:i.parse(e),assert:e=>null!==e,message:"must have a valid date format"}]},format:{method(t){return e(["iso","javascript","unix"].includes(t),"Unknown date format",t),this.$_setFlag("format",t)}},greater:{method(e){return this.$_addRule({name:"greater",method:"compare",args:{date:e},operator:">"})}},iso:{method(){return this.format("iso")}},less:{method(e){return this.$_addRule({name:"less",method:"compare",args:{date:e},operator:"<"})}},max:{method(e){return this.$_addRule({name:"max",method:"compare",args:{date:e},operator:"<="})}},min:{method(e){return this.$_addRule({name:"min",method:"compare",args:{date:e},operator:">="})}},timestamp:{method(t="javascript"){return e(["javascript","unix"].includes(t),'"type" must be one of "javascript, unix"'),this.format(t)}}},cast:{number:{from:i.isDate,to:(e,t)=>e.getTime()},string:{from:i.isDate,to:(e,{prefs:t})=>n.date(e,t)}},messages:{"date.base":"{{#label}} must be a valid date","date.format":'{{#label}} must be in {msg("date.format." + #format) || #format} format',"date.greater":"{{#label}} must be greater than {{:#limit}}","date.less":"{{#label}} must be less than {{:#limit}}","date.max":"{{#label}} must be less than or equal to {{:#limit}}","date.min":"{{#label}} must be greater than or equal to {{:#limit}}","date.format.iso":"ISO 8601 date","date.format.javascript":"timestamp or number of milliseconds","date.format.unix":"timestamp or number of seconds"}}),i.parse=function(e,t){if(e instanceof Date)return e;if("string"!=typeof e&&(isNaN(e)||!isFinite(e)))return null;if(/^\s*$/.test(e))return null;if("iso"===t)return r.isIsoDate(e)?i.date(e.toString()):null;const n=e;if("string"==typeof e&&/^[+-]?\d+(\.\d+)?$/.test(e)&&(e=parseFloat(e)),t){if("javascript"===t)return i.date(1*e);if("unix"===t)return i.date(1e3*e);if("string"==typeof n)return null}return i.date(e)},i.date=function(e){const t=new Date(e);return isNaN(t.getTime())?null:t},date$2}var lib$2={},hasRequiredLib$2,keys,hasRequiredKeys,_function,hasRequired_function,link,hasRequiredLink,number,hasRequiredNumber,object$1,hasRequiredObject;function requireLib$2(){if(hasRequiredLib$2)return lib$2;hasRequiredLib$2=1;const{assert:e}=requireLib$5(),t={};return lib$2.Sorter=class{constructor(){this._items=[],this.nodes=[]}add(t,r){const n=[].concat((r=r??{}).before??[]),i=[].concat(r.after??[]),s=r.group??"?",o=r.sort??0;e(!n.includes(s),`Item cannot come before itself: ${s}`),e(!n.includes("?"),"Item cannot come before unassociated items"),e(!i.includes(s),`Item cannot come after itself: ${s}`),e(!i.includes("?"),"Item cannot come after unassociated items"),Array.isArray(t)||(t=[t]);for(const e of t){const t={seq:this._items.length,sort:o,before:n,after:i,group:s,node:e};this._items.push(t)}if(!r.manual){const t=this._sort();e(t,"item","?"!==s?`added into group ${s}`:"","created a dependencies error")}return this.nodes}merge(r){Array.isArray(r)||(r=[r]);for(const e of r)if(e)for(const t of e._items)this._items.push(Object.assign({},t));this._items.sort(t.mergeSort);for(let e=0;e<this._items.length;++e)this._items[e].seq=e;const n=this._sort();return e(n,"merge created a dependencies error"),this.nodes}sort(){const t=this._sort();return e(t,"sort created a dependencies error"),this.nodes}_sort(){const e={},t=Object.create(null),r=Object.create(null);for(const n of this._items){const i=n.seq,s=n.group;r[s]=r[s]??[],r[s].push(i),e[i]=n.before;for(const e of n.after)t[e]=t[e]??[],t[e].push(i)}for(const t in e){const n=[];for(const i in e[t]){const s=e[t][i];r[s]=r[s]??[],n.push(...r[s])}e[t]=n}for(const n in t)if(r[n])for(const i of r[n])e[i].push(...t[n]);const n={};for(const t in e){const r=e[t];for(const e of r)n[e]=n[e]??[],n[e].push(t)}const i={},s=[];for(let e=0;e<this._items.length;++e){let t=e;if(n[e]){t=null;for(let e=0;e<this._items.length;++e){if(!0===i[e])continue;n[e]||(n[e]=[]);const r=n[e].length;let s=0;for(let t=0;t<r;++t)i[n[e][t]]&&++s;if(s===r){t=e;break}}}null!==t&&(i[t]=!0,s.push(t))}if(s.length!==this._items.length)return!1;const o={};for(const e of this._items)o[e.seq]=e;this._items=[],this.nodes=[];for(const e of s){const t=o[e];this.nodes.push(t.node),this._items.push(t)}return!0}},t.mergeSort=(e,t)=>e.sort===t.sort?0:e.sort<t.sort?-1:1,lib$2}function requireKeys(){if(hasRequiredKeys)return keys;hasRequiredKeys=1;const{applyToDefaults:e,assert:t,clone:r}=requireLib$5(),n=requireLib$2(),i=requireAny(),s=requireCommon(),o=requireCompile(),a=requireErrors(),l=requireRef(),c=requireTemplate(),u={renameDefaults:{alias:!1,multiple:!1,override:!1}};return keys=i.extend({type:"_keys",properties:{typeof:"object"},flags:{unknown:{default:void 0}},terms:{dependencies:{init:null},keys:{init:null,manifest:{mapped:{from:"schema",to:"key"}}},patterns:{init:null},renames:{init:null}},args:(e,t)=>e.keys(t),validate(e,{schema:t,error:r,state:n,prefs:i}){if(!e||typeof e!==t.$_property("typeof")||Array.isArray(e))return{value:e,errors:r("object.base",{type:t.$_property("typeof")})};if(!(t.$_terms.renames||t.$_terms.dependencies||t.$_terms.keys||t.$_terms.patterns||t.$_terms.externals))return;e=u.clone(e,i);const s=[];if(t.$_terms.renames&&!u.rename(t,e,n,i,s))return{value:e,errors:s};if(!t.$_terms.keys&&!t.$_terms.patterns&&!t.$_terms.dependencies)return{value:e,errors:s};const o=new Set(Object.keys(e));if(t.$_terms.keys){const r=[e,...n.ancestors];for(const a of t.$_terms.keys){const t=a.key,l=e[t];o.delete(t);const c=n.localize([...n.path,t],r,a),u=a.schema.$_validate(l,c,i);if(u.errors){if(i.abortEarly)return{value:e,errors:u.errors};void 0!==u.value&&(e[t]=u.value),s.push(...u.errors)}else"strip"===a.schema._flags.result||void 0===u.value&&void 0!==l?delete e[t]:void 0!==u.value&&(e[t]=u.value)}}if(o.size||t._flags._hasPatternMatch){const r=u.unknown(t,e,o,s,n,i);if(r)return r}if(t.$_terms.dependencies)for(const r of t.$_terms.dependencies){if(null!==r.key&&!1===u.isPresent(r.options)(r.key.resolve(e,n,i,null,{shadow:!1})))continue;const o=u.dependencies[r.rel](t,r,e,n,i);if(o){const r=t.$_createError(o.code,e,o.context,n,i);if(i.abortEarly)return{value:e,errors:r};s.push(r)}}return{value:e,errors:s}},rules:{and:{method(...e){return s.verifyFlat(e,"and"),u.dependency(this,"and",null,e)}},append:{method(e){return null==e||0===Object.keys(e).length?this:this.keys(e)}},assert:{method(e,r,n){c.isTemplate(e)||(e=o.ref(e)),t(void 0===n||"string"==typeof n,"Message must be a string"),r=this.$_compile(r,{appendPath:!0});const i=this.$_addRule({name:"assert",args:{subject:e,schema:r,message:n}});return i.$_mutateRegister(e),i.$_mutateRegister(r),i},validate(e,{error:t,prefs:r,state:n},{subject:i,schema:s,message:o}){const a=i.resolve(e,n,r),c=l.isRef(i)?i.absolute(n):[];return s.$_match(a,n.localize(c,[e,...n.ancestors],s),r)?e:t("object.assert",{subject:i,message:o})},args:["subject","schema","message"],multi:!0},instance:{method(e,r){return t("function"==typeof e,"constructor must be a function"),r=r||e.name,this.$_addRule({name:"instance",args:{constructor:e,name:r}})},validate:(e,t,{constructor:r,name:n})=>e instanceof r?e:t.error("object.instance",{type:n,value:e}),args:["constructor","name"]},keys:{method(e){t(void 0===e||"object"==typeof e,"Object schema must be a valid object"),t(!s.isSchema(e),"Object schema cannot be a joi schema");const r=this.clone();if(e)if(Object.keys(e).length){r.$_terms.keys=r.$_terms.keys?r.$_terms.keys.filter(t=>!e.hasOwnProperty(t.key)):new u.Keys;for(const t in e)s.tryWithPath(()=>r.$_terms.keys.push({key:t,schema:this.$_compile(e[t])}),t)}else r.$_terms.keys=new u.Keys;else r.$_terms.keys=null;return r.$_mutateRebuild()}},length:{method(e){return this.$_addRule({name:"length",args:{limit:e},operator:"="})},validate:(e,t,{limit:r},{name:n,operator:i,args:o})=>s.compare(Object.keys(e).length,r,i)?e:t.error("object."+n,{limit:o.limit,value:e}),args:[{name:"limit",ref:!0,assert:s.limit,message:"must be a positive integer"}]},max:{method(e){return this.$_addRule({name:"max",method:"length",args:{limit:e},operator:"<="})}},min:{method(e){return this.$_addRule({name:"min",method:"length",args:{limit:e},operator:">="})}},nand:{method(...e){return s.verifyFlat(e,"nand"),u.dependency(this,"nand",null,e)}},or:{method(...e){return s.verifyFlat(e,"or"),u.dependency(this,"or",null,e)}},oxor:{method(...e){return u.dependency(this,"oxor",null,e)}},pattern:{method(e,r,n={}){const i=e instanceof RegExp;i||(e=this.$_compile(e,{appendPath:!0})),t(void 0!==r,"Invalid rule"),s.assertOptions(n,["fallthrough","matches"]),i&&t(!e.flags.includes("g")&&!e.flags.includes("y"),"pattern should not use global or sticky mode"),r=this.$_compile(r,{appendPath:!0});const o=this.clone();o.$_terms.patterns=o.$_terms.patterns||[];const a={[i?"regex":"schema"]:e,rule:r};return n.matches&&(a.matches=this.$_compile(n.matches),"array"!==a.matches.type&&(a.matches=a.matches.$_root.array().items(a.matches)),o.$_mutateRegister(a.matches),o.$_setFlag("_hasPatternMatch",!0,{clone:!1})),n.fallthrough&&(a.fallthrough=!0),o.$_terms.patterns.push(a),o.$_mutateRegister(r),o}},ref:{method(){return this.$_addRule("ref")},validate:(e,t)=>l.isRef(e)?e:t.error("object.refType",{value:e})},regex:{method(){return this.$_addRule("regex")},validate:(e,t)=>e instanceof RegExp?e:t.error("object.regex",{value:e})},rename:{method(r,n,i={}){t("string"==typeof r||r instanceof RegExp,"Rename missing the from argument"),t("string"==typeof n||n instanceof c,"Invalid rename to argument"),t(n!==r,"Cannot rename key to same name:",r),s.assertOptions(i,["alias","ignoreUndefined","override","multiple"]);const o=this.clone();o.$_terms.renames=o.$_terms.renames||[];for(const e of o.$_terms.renames)t(e.from!==r,"Cannot rename the same key multiple times");return n instanceof c&&o.$_mutateRegister(n),o.$_terms.renames.push({from:r,to:n,options:e(u.renameDefaults,i)}),o}},schema:{method(e="any"){return this.$_addRule({name:"schema",args:{type:e}})},validate:(e,t,{type:r})=>!s.isSchema(e)||"any"!==r&&e.type!==r?t.error("object.schema",{type:r}):e},unknown:{method(e){return this.$_setFlag("unknown",!1!==e)}},with:{method(e,t,r={}){return u.dependency(this,"with",e,t,r)}},without:{method(e,t,r={}){return u.dependency(this,"without",e,t,r)}},xor:{method(...e){return s.verifyFlat(e,"xor"),u.dependency(this,"xor",null,e)}}},overrides:{default(e,t){return void 0===e&&(e=s.symbols.deepDefault),this.$_parent("default",e,t)},isAsync(){if(this.$_terms.externals?.length)return!0;if(this.$_terms.keys?.length)for(const e of this.$_terms.keys)if(e.schema.isAsync())return!0;if(this.$_terms.patterns?.length)for(const e of this.$_terms.patterns)if(e.rule.isAsync())return!0;return!1}},rebuild(e){if(e.$_terms.keys){const t=new n.Sorter;for(const r of e.$_terms.keys)s.tryWithPath(()=>t.add(r,{after:r.schema.$_rootReferences(),group:r.key}),r.key);e.$_terms.keys=new u.Keys(...t.nodes)}},manifest:{build(e,t){if(t.keys&&(e=e.keys(t.keys)),t.dependencies)for(const{rel:r,key:n=null,peers:i,options:s}of t.dependencies)e=u.dependency(e,r,n,i,s);if(t.patterns)for(const{regex:r,schema:n,rule:i,fallthrough:s,matches:o}of t.patterns)e=e.pattern(r||n,i,{fallthrough:s,matches:o});if(t.renames)for(const{from:r,to:n,options:i}of t.renames)e=e.rename(r,n,i);return e}},messages:{"object.and":"{{#label}} contains {{#presentWithLabels}} without its required peers {{#missingWithLabels}}","object.assert":'{{#label}} is invalid because {if(#subject.key, `"` + #subject.key + `" failed to ` + (#message || "pass the assertion test"), #message || "the assertion failed")}',"object.base":"{{#label}} must be of type {{#type}}","object.instance":"{{#label}} must be an instance of {{:#type}}","object.length":'{{#label}} must have {{#limit}} key{if(#limit == 1, "", "s")}',"object.max":'{{#label}} must have less than or equal to {{#limit}} key{if(#limit == 1, "", "s")}',"object.min":'{{#label}} must have at least {{#limit}} key{if(#limit == 1, "", "s")}',"object.missing":"{{#label}} must contain at least one of {{#peersWithLabels}}","object.nand":"{{:#mainWithLabel}} must not exist simultaneously with {{#peersWithLabels}}","object.oxor":"{{#label}} contains a conflict between optional exclusive peers {{#peersWithLabels}}","object.pattern.match":"{{#label}} keys failed to match pattern requirements","object.refType":"{{#label}} must be a Joi reference","object.regex":"{{#label}} must be a RegExp object","object.rename.multiple":"{{#label}} cannot rename {{:#from}} because multiple renames are disabled and another key was already renamed to {{:#to}}","object.rename.override":"{{#label}} cannot rename {{:#from}} because override is disabled and target {{:#to}} exists","object.schema":"{{#label}} must be a Joi schema of {{#type}} type","object.unknown":"{{#label}} is not allowed","object.with":"{{:#mainWithLabel}} missing required peer {{:#peerWithLabel}}","object.without":"{{:#mainWithLabel}} conflict with forbidden peer {{:#peerWithLabel}}","object.xor":"{{#label}} contains a conflict between exclusive peers {{#peersWithLabels}}"}}),u.clone=function(e,t){if("object"==typeof e){if(t.nonEnumerables)return r(e,{shallow:!0});const n=Object.create(Object.getPrototypeOf(e));return Object.assign(n,e),n}const n=function(...t){return e.apply(this,t)};return n.prototype=r(e.prototype),Object.defineProperty(n,"name",{value:e.name,writable:!1}),Object.defineProperty(n,"length",{value:e.length,writable:!1}),Object.assign(n,e),n},u.dependency=function(e,r,n,i,a){t(null===n||"string"==typeof n,r,"key must be a strings"),a||(a=i.length>1&&"object"==typeof i[i.length-1]?i.pop():{}),s.assertOptions(a,["separator","isPresent"]),i=[].concat(i);const l=s.default(a.separator,"."),c=[];for(const e of i)t("string"==typeof e,r,"peers must be strings"),c.push(o.ref(e,{separator:l,ancestor:0,prefix:!1}));null!==n&&(n=o.ref(n,{separator:l,ancestor:0,prefix:!1}));const d=e.clone();return d.$_terms.dependencies=d.$_terms.dependencies||[],d.$_terms.dependencies.push(new u.Dependency(r,n,c,i,a)),d},u.dependencies={and(e,t,r,n,i){const s=[],o=[],a=t.peers.length,l=u.isPresent(t.options);for(const e of t.peers)!1===l(e.resolve(r,n,i,null,{shadow:!1}))?s.push(e.key):o.push(e.key);if(s.length!==a&&o.length!==a)return{code:"object.and",context:{present:o,presentWithLabels:u.keysToLabels(e,o),missing:s,missingWithLabels:u.keysToLabels(e,s)}}},nand(e,t,r,n,i){const s=[],o=u.isPresent(t.options);for(const e of t.peers)o(e.resolve(r,n,i,null,{shadow:!1}))&&s.push(e.key);if(s.length!==t.peers.length)return;const a=t.paths[0],l=t.paths.slice(1);return{code:"object.nand",context:{main:a,mainWithLabel:u.keysToLabels(e,a),peers:l,peersWithLabels:u.keysToLabels(e,l)}}},or(e,t,r,n,i){const s=u.isPresent(t.options);for(const e of t.peers)if(s(e.resolve(r,n,i,null,{shadow:!1})))return;return{code:"object.missing",context:{peers:t.paths,peersWithLabels:u.keysToLabels(e,t.paths)}}},oxor(e,t,r,n,i){const s=[],o=u.isPresent(t.options);for(const e of t.peers)o(e.resolve(r,n,i,null,{shadow:!1}))&&s.push(e.key);if(!s.length||1===s.length)return;const a={peers:t.paths,peersWithLabels:u.keysToLabels(e,t.paths)};return a.present=s,a.presentWithLabels=u.keysToLabels(e,s),{code:"object.oxor",context:a}},with(e,t,r,n,i){const s=u.isPresent(t.options);for(const o of t.peers)if(!1===s(o.resolve(r,n,i,null,{shadow:!1})))return{code:"object.with",context:{main:t.key.key,mainWithLabel:u.keysToLabels(e,t.key.key),peer:o.key,peerWithLabel:u.keysToLabels(e,o.key)}}},without(e,t,r,n,i){const s=u.isPresent(t.options);for(const o of t.peers)if(s(o.resolve(r,n,i,null,{shadow:!1})))return{code:"object.without",context:{main:t.key.key,mainWithLabel:u.keysToLabels(e,t.key.key),peer:o.key,peerWithLabel:u.keysToLabels(e,o.key)}}},xor(e,t,r,n,i){const s=[],o=u.isPresent(t.options);for(const e of t.peers)o(e.resolve(r,n,i,null,{shadow:!1}))&&s.push(e.key);if(1===s.length)return;const a={peers:t.paths,peersWithLabels:u.keysToLabels(e,t.paths)};return 0===s.length?{code:"object.missing",context:a}:(a.present=s,a.presentWithLabels=u.keysToLabels(e,s),{code:"object.xor",context:a})}},u.keysToLabels=function(e,t){return Array.isArray(t)?t.map(t=>e.$_mapLabels(t)):e.$_mapLabels(t)},u.isPresent=function(e){return"function"==typeof e.isPresent?e.isPresent:e=>void 0!==e},u.rename=function(e,t,r,n,i){const s={};for(const o of e.$_terms.renames){const a=[],l="string"!=typeof o.from;if(l)for(const e in t){if(void 0===t[e]&&o.options.ignoreUndefined)continue;if(e===o.to)continue;const r=o.from.exec(e);r&&a.push({from:e,to:o.to,match:r})}else!Object.prototype.hasOwnProperty.call(t,o.from)||void 0===t[o.from]&&o.options.ignoreUndefined||a.push(o);for(const u of a){const a=u.from;let d=u.to;if(d instanceof c&&(d=d.render(t,r,n,u.match)),a!==d){if(!o.options.multiple&&s[d]&&(i.push(e.$_createError("object.rename.multiple",t,{from:a,to:d,pattern:l},r,n)),n.abortEarly))return!1;if(Object.prototype.hasOwnProperty.call(t,d)&&!o.options.override&&!s[d]&&(i.push(e.$_createError("object.rename.override",t,{from:a,to:d,pattern:l},r,n)),n.abortEarly))return!1;void 0===t[a]?delete t[d]:t[d]=t[a],s[d]=!0,o.options.alias||delete t[a]}}}return!0},u.unknown=function(e,t,r,n,i,o){if(e.$_terms.patterns){let s=!1;const l=e.$_terms.patterns.map(e=>{if(e.matches)return s=!0,[]}),c=[t,...i.ancestors];for(const s of r){const a=t[s],u=[...i.path,s];for(let d=0;d<e.$_terms.patterns.length;++d){const h=e.$_terms.patterns[d];if(h.regex){const e=h.regex.test(s);if(i.mainstay.tracer.debug(i,"rule",`pattern.${d}`,e?"pass":"error"),!e)continue}else if(!h.schema.$_match(s,i.nest(h.schema,`pattern.${d}`),o))continue;r.delete(s);const f=i.localize(u,c,{schema:h.rule,key:s}),p=h.rule.$_validate(a,f,o);if(p.errors){if(o.abortEarly)return{value:t,errors:p.errors};n.push(...p.errors)}if(h.matches&&l[d].push(s),t[s]=p.value,!h.fallthrough)break}}if(s)for(let r=0;r<l.length;++r){const s=l[r];if(!s)continue;const u=e.$_terms.patterns[r].matches,d=i.localize(i.path,c,u),h=u.$_validate(s,d,o);if(h.errors){const r=a.details(h.errors,{override:!1});r.matches=s;const l=e.$_createError("object.pattern.match",t,r,i,o);if(o.abortEarly)return{value:t,errors:l};n.push(l)}}}if(!r.size||!e.$_terms.keys&&!e.$_terms.patterns)return;if(o.stripUnknown&&void 0===e._flags.unknown||o.skipFunctions){const e=!!o.stripUnknown&&(!0===o.stripUnknown||!!o.stripUnknown.objects);for(const n of r)e?(delete t[n],r.delete(n)):"function"==typeof t[n]&&r.delete(n)}if(!s.default(e._flags.unknown,o.allowUnknown))for(const s of r){const r=i.localize([...i.path,s],[]),a=e.$_createError("object.unknown",t[s],{child:s},r,o,{flags:!1});if(o.abortEarly)return{value:t,errors:a};n.push(a)}},u.Dependency=class{constructor(e,t,r,n,i){this.rel=e,this.key=t,this.peers=r,this.paths=n,this.options=i}describe(){const e={rel:this.rel,peers:this.paths};return null!==this.key&&(e.key=this.key.key),"."!==this.peers[0].separator&&(e.options={...e.options,separator:this.peers[0].separator}),this.options.isPresent&&(e.options={...e.options,isPresent:this.options.isPresent}),e}},u.Keys=class extends Array{concat(e){const t=this.slice(),r=new Map;for(let e=0;e<t.length;++e)r.set(t[e].key,e);for(const n of e){const e=n.key,i=r.get(e);void 0!==i?t[i]={key:e,schema:t[i].schema.concat(n.schema)}:t.push(n)}return t}},keys}function require_function(){if(hasRequired_function)return _function;hasRequired_function=1;const{assert:e}=requireLib$5(),t=requireKeys();return _function=t.extend({type:"function",properties:{typeof:"function"},rules:{arity:{method(t){return e(Number.isSafeInteger(t)&&t>=0,"n must be a positive integer"),this.$_addRule({name:"arity",args:{n:t}})},validate:(e,t,{n:r})=>e.length===r?e:t.error("function.arity",{n:r})},class:{method(){return this.$_addRule("class")},validate:(e,t)=>/^\s*class\s/.test(e.toString())?e:t.error("function.class",{value:e})},minArity:{method(t){return e(Number.isSafeInteger(t)&&t>0,"n must be a strict positive integer"),this.$_addRule({name:"minArity",args:{n:t}})},validate:(e,t,{n:r})=>e.length>=r?e:t.error("function.minArity",{n:r})},maxArity:{method(t){return e(Number.isSafeInteger(t)&&t>=0,"n must be a positive integer"),this.$_addRule({name:"maxArity",args:{n:t}})},validate:(e,t,{n:r})=>e.length<=r?e:t.error("function.maxArity",{n:r})}},messages:{"function.arity":"{{#label}} must have an arity of {{#n}}","function.class":"{{#label}} must be a class","function.maxArity":"{{#label}} must have an arity lesser or equal to {{#n}}","function.minArity":"{{#label}} must have an arity greater or equal to {{#n}}"}}),_function}function requireLink(){if(hasRequiredLink)return link;hasRequiredLink=1;const{assert:e}=requireLib$5(),t=requireAny(),r=requireCommon(),n=requireCompile(),i=requireErrors(),s={};return link=t.extend({type:"link",properties:{schemaChain:!0},terms:{link:{init:null,manifest:"single",register:!1}},args:(e,t)=>e.ref(t),validate(t,{schema:r,state:n,prefs:i}){e(r.$_terms.link,"Uninitialized link schema");const o=s.generate(r,t,n,i),a=r.$_terms.link[0].ref;return o.$_validate(t,n.nest(o,`link:${a.display}:${o.type}`),i)},generate:(e,t,r,n)=>s.generate(e,t,r,n),rules:{ref:{method(t){e(!this.$_terms.link,"Cannot reinitialize schema"),t=n.ref(t),e("value"===t.type||"local"===t.type,"Invalid reference type:",t.type),e("local"===t.type||"root"===t.ancestor||t.ancestor>0,"Link cannot reference itself");const r=this.clone();return r.$_terms.link=[{ref:t}],r}},relative:{method(e=!0){return this.$_setFlag("relative",e)}}},overrides:{concat(t){e(this.$_terms.link,"Uninitialized link schema"),e(r.isSchema(t),"Invalid schema object"),e("link"!==t.type,"Cannot merge type link with another link");const n=this.clone();return n.$_terms.whens||(n.$_terms.whens=[]),n.$_terms.whens.push({concat:t}),n.$_mutateRebuild()}},manifest:{build:(t,r)=>(e(r.link,"Invalid link description missing link"),t.ref(r.link))}}),s.generate=function(e,t,r,n){let i=r.mainstay.links.get(e);if(i)return i._generate(t,r,n).schema;const o=e.$_terms.link[0].ref,{perspective:a,path:l}=s.perspective(o,r);s.assert(a,"which is outside of schema boundaries",o,e,r,n);try{i=l.length?a.$_reach(l):a}catch{s.assert(!1,"to non-existing schema",o,e,r,n)}return s.assert("link"!==i.type,"which is another link",o,e,r,n),e._flags.relative||r.mainstay.links.set(e,i),i._generate(t,r,n).schema},s.perspective=function(e,t){if("local"===e.type){for(const{schema:r,key:n}of t.schemas){if((r._flags.id||n)===e.path[0])return{perspective:r,path:e.path.slice(1)};if(r.$_terms.shared)for(const t of r.$_terms.shared)if(t._flags.id===e.path[0])return{perspective:t,path:e.path.slice(1)}}return{perspective:null,path:null}}return"root"===e.ancestor?{perspective:t.schemas[t.schemas.length-1].schema,path:e.path}:{perspective:t.schemas[e.ancestor]&&t.schemas[e.ancestor].schema,path:e.path}},s.assert=function(t,r,n,s,o,a){t||e(!1,`"${i.label(s._flags,o,a)}" contains link reference "${n.display}" ${r}`)},link}function requireNumber(){if(hasRequiredNumber)return number;hasRequiredNumber=1;const{assert:e}=requireLib$5(),t=requireAny(),r=requireCommon(),n={numberRx:/^\s*[+-]?(?:(?:\d+(?:\.\d*)?)|(?:\.\d+))(?:e([+-]?\d+))?\s*$/i,precisionRx:/(?:\.(\d+))?(?:[eE]([+-]?\d+))?$/,exponentialPartRegex:/[eE][+-]?\d+$/,leadingSignAndZerosRegex:/^[+-]?(0*)?/,dotRegex:/\./,trailingZerosRegex:/0+$/,decimalPlaces(e){const t=e.toString(),r=t.indexOf("."),n=t.indexOf("e");return(r<0?0:(n<0?t.length:n)-r-1)+(n<0?0:Math.max(0,-parseInt(t.slice(n+1))))}};return number=t.extend({type:"number",flags:{unsafe:{default:!1}},coerce:{from:"string",method(e,{schema:t,error:r}){if(!e.match(n.numberRx))return;e=e.trim();const i={value:parseFloat(e)};if(0===i.value&&(i.value=0),!t._flags.unsafe)if(e.match(/e/i)){if(n.extractSignificantDigits(e)!==n.extractSignificantDigits(String(i.value)))return i.errors=r("number.unsafe"),i}else{const t=i.value.toString();if(t.match(/e/i))return i;if(t!==n.normalizeDecimal(e))return i.errors=r("number.unsafe"),i}return i}},validate(e,{schema:t,error:n,prefs:i}){if(e===1/0||e===-1/0)return{value:e,errors:n("number.infinity")};if(!r.isNumber(e))return{value:e,errors:n("number.base")};const s={value:e};if(i.convert){const e=t.$_getRule("precision");if(e){const t=Math.pow(10,e.args.limit);s.value=Math.round(s.value*t)/t}}return 0===s.value&&(s.value=0),!t._flags.unsafe&&(e>Number.MAX_SAFE_INTEGER||e<Number.MIN_SAFE_INTEGER)&&(s.errors=n("number.unsafe")),s},rules:{compare:{method:!1,validate:(e,t,{limit:n},{name:i,operator:s,args:o})=>r.compare(e,n,s)?e:t.error("number."+i,{limit:o.limit,value:e}),args:[{name:"limit",ref:!0,assert:r.isNumber,message:"must be a number"}]},greater:{method(e){return this.$_addRule({name:"greater",method:"compare",args:{limit:e},operator:">"})}},integer:{method(){return this.$_addRule("integer")},validate:(e,t)=>Math.trunc(e)-e===0?e:t.error("number.integer")},less:{method(e){return this.$_addRule({name:"less",method:"compare",args:{limit:e},operator:"<"})}},max:{method(e){return this.$_addRule({name:"max",method:"compare",args:{limit:e},operator:"<="})}},min:{method(e){return this.$_addRule({name:"min",method:"compare",args:{limit:e},operator:">="})}},multiple:{method(e){const t="number"==typeof e?n.decimalPlaces(e):null,r=Math.pow(10,t);return this.$_addRule({name:"multiple",args:{base:e,baseDecimalPlace:t,pfactor:r}})},validate:(e,t,{base:r,baseDecimalPlace:i,pfactor:s},o)=>n.decimalPlaces(e)>i?t.error("number.multiple",{multiple:o.args.base,value:e}):Math.round(s*e)%Math.round(s*r)===0?e:t.error("number.multiple",{multiple:o.args.base,value:e}),args:[{name:"base",ref:!0,assert:e=>"number"==typeof e&&isFinite(e)&&e>0,message:"must be a positive number"},"baseDecimalPlace","pfactor"],multi:!0},negative:{method(){return this.sign("negative")}},port:{method(){return this.$_addRule("port")},validate:(e,t)=>Number.isSafeInteger(e)&&e>=0&&e<=65535?e:t.error("number.port")},positive:{method(){return this.sign("positive")}},precision:{method(t){return e(Number.isSafeInteger(t),"limit must be an integer"),this.$_addRule({name:"precision",args:{limit:t}})},validate(e,t,{limit:r}){const i=e.toString().match(n.precisionRx);return Math.max((i[1]?i[1].length:0)-(i[2]?parseInt(i[2],10):0),0)<=r?e:t.error("number.precision",{limit:r,value:e})},convert:!0},sign:{method(t){return e(["negative","positive"].includes(t),"Invalid sign",t),this.$_addRule({name:"sign",args:{sign:t}})},validate:(e,t,{sign:r})=>"negative"===r&&e<0||"positive"===r&&e>0?e:t.error(`number.${r}`)},unsafe:{method(t=!0){return e("boolean"==typeof t,"enabled must be a boolean"),this.$_setFlag("unsafe",t)}}},cast:{string:{from:e=>"number"==typeof e,to:(e,t)=>e.toString()}},messages:{"number.base":"{{#label}} must be a number","number.greater":"{{#label}} must be greater than {{#limit}}","number.infinity":"{{#label}} cannot be infinity","number.integer":"{{#label}} must be an integer","number.less":"{{#label}} must be less than {{#limit}}","number.max":"{{#label}} must be less than or equal to {{#limit}}","number.min":"{{#label}} must be greater than or equal to {{#limit}}","number.multiple":"{{#label}} must be a multiple of {{#multiple}}","number.negative":"{{#label}} must be a negative number","number.port":"{{#label}} must be a valid port","number.positive":"{{#label}} must be a positive number","number.precision":"{{#label}} must have no more than {{#limit}} decimal places","number.unsafe":"{{#label}} must be a safe number"}}),n.extractSignificantDigits=function(e){return e.replace(n.exponentialPartRegex,"").replace(n.dotRegex,"").replace(n.trailingZerosRegex,"").replace(n.leadingSignAndZerosRegex,"")},n.normalizeDecimal=function(e){return(e=e.replace(/^\+/,"").replace(/\.0*$/,"").replace(/^(-?)\.([^\.]*)$/,"$10.$2").replace(/^(-?)0+([0-9])/,"$1$2")).includes(".")&&e.endsWith("0")&&(e=e.replace(/0+$/,"")),"-0"===e?"0":e},number}function requireObject(){if(hasRequiredObject)return object$1;hasRequiredObject=1;const e=requireKeys();return object$1=e.extend({type:"object",cast:{map:{from:e=>e&&"object"==typeof e,to:(e,t)=>new Map(Object.entries(e))}}})}const errorCodes={EMPTY_STRING:"Address must be a non-empty string",FORBIDDEN_UNICODE:"Address contains forbidden Unicode characters",MULTIPLE_AT_CHAR:"Address cannot contain more than one @ character",MISSING_AT_CHAR:"Address must contain one @ character",EMPTY_LOCAL:"Address local part cannot be empty",ADDRESS_TOO_LONG:"Address too long",LOCAL_TOO_LONG:"Address local part too long",EMPTY_LOCAL_SEGMENT:"Address local part contains empty dot-separated segment",INVALID_LOCAL_CHARS:"Address local part contains invalid character",DOMAIN_NON_EMPTY_STRING:"Domain must be a non-empty string",DOMAIN_TOO_LONG:"Domain too long",DOMAIN_INVALID_UNICODE_CHARS:"Domain contains forbidden Unicode characters",DOMAIN_INVALID_CHARS:"Domain contains invalid character",DOMAIN_INVALID_TLDS_CHARS:"Domain contains invalid tld character",DOMAIN_SEGMENTS_COUNT:"Domain lacks the minimum required number of segments",DOMAIN_SEGMENTS_COUNT_MAX:"Domain contains too many segments",DOMAIN_FORBIDDEN_TLDS:"Domain uses forbidden TLD",DOMAIN_EMPTY_SEGMENT:"Domain contains empty dot-separated segment",DOMAIN_LONG_SEGMENT:"Domain contains dot-separated segment that is too long"};function errorCode(e){return{code:e,error:errorCodes[e]}}const MIN_DOMAIN_SEGMENTS=2,NON_ASCII_RX$1=/[^\x00-\x7f]/,DOMAIN_CONTROL_RX=/[\x00-\x20@\:\/\\#!\$&\'\(\)\*\+,;=\?]/,TLD_SEGMENT_RX=/^[a-zA-Z](?:[a-zA-Z0-9\-]*[a-zA-Z0-9])?$/,DOMAIN_SEGMENT_RX=/^[a-zA-Z0-9](?:[a-zA-Z0-9\-]*[a-zA-Z0-9])?$/,DOMAIN_UNDERSCORE_SEGMENT_RX=/^[a-zA-Z0-9_](?:[a-zA-Z0-9\-]*[a-zA-Z0-9])?$/,URL_IMPL=require$$0$1.URL||URL;function isTldsAllow(e){return!!e.allow}function analyzeDomain(e,t={}){if(!e)return errorCode("DOMAIN_NON_EMPTY_STRING");if("string"!=typeof e)throw new Error("Invalid input: domain must be a string");if(e.length>256)return errorCode("DOMAIN_TOO_LONG");if(!!NON_ASCII_RX$1.test(e)){if(!1===t.allowUnicode)return errorCode("DOMAIN_INVALID_UNICODE_CHARS");e=e.normalize("NFC")}if(DOMAIN_CONTROL_RX.test(e))return errorCode("DOMAIN_INVALID_CHARS");e=punycode(e),t.allowFullyQualified&&"."===e[e.length-1]&&(e=e.slice(0,-1));const r=t.minDomainSegments||MIN_DOMAIN_SEGMENTS,n=e.split(".");if(n.length<r)return errorCode("DOMAIN_SEGMENTS_COUNT");if(t.maxDomainSegments&&n.length>t.maxDomainSegments)return errorCode("DOMAIN_SEGMENTS_COUNT_MAX");const i=t.tlds;if(i){const e=n[n.length-1].toLowerCase();if(isTldsAllow(i)){if(!i.allow.has(e))return errorCode("DOMAIN_FORBIDDEN_TLDS")}else if(i.deny.has(e))return errorCode("DOMAIN_FORBIDDEN_TLDS")}for(let e=0;e<n.length;++e){const r=n[e];if(!r.length)return errorCode("DOMAIN_EMPTY_SEGMENT");if(r.length>63)return errorCode("DOMAIN_LONG_SEGMENT");if(e<n.length-1){if(t.allowUnderscore){if(!DOMAIN_UNDERSCORE_SEGMENT_RX.test(r))return errorCode("DOMAIN_INVALID_CHARS")}else if(!DOMAIN_SEGMENT_RX.test(r))return errorCode("DOMAIN_INVALID_CHARS")}else if(!TLD_SEGMENT_RX.test(r))return errorCode("DOMAIN_INVALID_TLDS_CHARS")}return null}function isDomainValid(e,t){return!analyzeDomain(e,t)}function punycode(e){e.includes("%")&&(e=e.replace(/%/g,"%25"));try{return new URL_IMPL(`http://${e}`).host}catch(t){return e}}function validateDomainOptions(e){if(e){if("object"!=typeof e.tlds)throw new Error("Invalid options: tlds must be a boolean or an object");if(isTldsAllow(e.tlds)){if(e.tlds.allow instanceof Set==!1)throw new Error("Invalid options: tlds.allow must be a Set object or true");if(e.tlds.deny)throw new Error("Invalid options: cannot specify both tlds.allow and tlds.deny lists")}else if(e.tlds.deny instanceof Set==!1)throw new Error("Invalid options: tlds.deny must be a Set object")}}const NON_ASCII_RX=/[^\x00-\x7f]/,ENCODER_IMPL=new(require$$1$2.TextEncoder||TextEncoder);function analyzeEmail(e,t){return validateEmail(e,t)}function isEmailValid(e,t){return!validateEmail(e,t)}function validateEmail(e,t={}){if("string"!=typeof e)throw new Error("Invalid input: email must be a string");if(!e)return errorCode("EMPTY_STRING");const r=!NON_ASCII_RX.test(e);if(!r){if(!1===t.allowUnicode)return errorCode("FORBIDDEN_UNICODE");e=e.normalize("NFC")}const n=e.split("@");if(2!==n.length)return n.length>2?errorCode("MULTIPLE_AT_CHAR"):errorCode("MISSING_AT_CHAR");const[i,s]=n;if(!i)return errorCode("EMPTY_LOCAL");if(!t.ignoreLength){if(e.length>254)return errorCode("ADDRESS_TOO_LONG");if(ENCODER_IMPL.encode(i).length>64)return errorCode("LOCAL_TOO_LONG")}return validateLocal(i,r)||analyzeDomain(s,t)}function validateLocal(e,t){const r=e.split(".");for(const e of r){if(!e.length)return errorCode("EMPTY_LOCAL_SEGMENT");if(t){if(!ATEXT_RX.test(e))return errorCode("INVALID_LOCAL_CHARS")}else for(const t of e){if(ATEXT_RX.test(t))continue;const e=toBinary(t);if(!ATOM_RX.test(e))return errorCode("INVALID_LOCAL_CHARS")}}return null}function toBinary(e){return Array.from(ENCODER_IMPL.encode(e),e=>String.fromCharCode(e)).join("")}const ATEXT_RX=/^[\w!#\$%&'\*\+\-/=\?\^`\{\|\}~]+$/,ATOM_RX=new RegExp(["(?:[\\xc2-\\xdf][\\x80-\\xbf])","(?:\\xe0[\\xa0-\\xbf][\\x80-\\xbf])|(?:[\\xe1-\\xec][\\x80-\\xbf]{2})|(?:\\xed[\\x80-\\x9f][\\x80-\\xbf])|(?:[\\xee-\\xef][\\x80-\\xbf]{2})","(?:\\xf0[\\x90-\\xbf][\\x80-\\xbf]{2})|(?:[\\xf1-\\xf3][\\x80-\\xbf]{3})|(?:\\xf4[\\x80-\\x8f][\\x80-\\xbf]{2})"].join("|"));requireApplyToDefaults();var assertExports=requireAssert(),assert=getDefaultExportFromCjs(assertExports);requireBench(),requireBlock(),requireClone(),requireContain(),requireDeepEqual(),requireAssertError(),requireEscapeHeaderAttribute(),requireEscapeHtml(),requireEscapeJson();var escapeRegexExports=requireEscapeRegex(),escapeRegex$1=getDefaultExportFromCjs(escapeRegexExports);function generate(){const e={},t="\\dA-Fa-f",r="["+t+"]",n="\\w-\\.~",i="!\\$&'\\(\\)\\*\\+,;=",s="%"+t,o=n+s+i+":@",a="["+o+"]",l="(?:0{0,2}\\d|0?[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5])";e.ipv4address="(?:"+l+"\\.){3}"+l;const c=r+"{1,4}",u="(?:"+c+":"+c+"|"+e.ipv4address+")",d="(?:"+c+":){6}"+u,h="::(?:"+c+":){5}"+u,f="(?:"+c+")?::(?:"+c+":){4}"+u,p="(?:(?:"+c+":){0,1}"+c+")?::(?:"+c+":){3}"+u,m="(?:(?:"+c+":){0,2}"+c+")?::(?:"+c+":){2}"+u,_="(?:(?:"+c+":){0,3}"+c+")?::"+c+":"+u,g="(?:(?:"+c+":){0,4}"+c+")?::"+u,y="(?:(?:"+c+":){0,5}"+c+")?::"+c,v="(?:(?:"+c+":){0,6}"+c+")?::";e.ipv4Cidr="(?:\\d|[1-2]\\d|3[0-2])",e.ipv6Cidr="(?:0{0,2}\\d|0?[1-9]\\d|1[01]\\d|12[0-8])",e.ipv6address="(?:"+d+"|"+h+"|"+f+"|"+p+"|"+m+"|"+_+"|"+g+"|"+y+"|"+v+")",e.ipvFuture="v"+r+"+\\.["+n+i+":]+",e.scheme="[a-zA-Z][a-zA-Z\\d+-\\.]*",e.schemeRegex=new RegExp(e.scheme);const b="["+n+s+i+":]*",w="["+n+s+i+"]{1,255}",$="(?:"+("\\[(?:"+e.ipv6address+"|"+e.ipvFuture+")\\]")+"|"+e.ipv4address+"|"+w+")",R="(?:"+b+"@)?"+$+"(?::\\d*)?",E="(?:"+b+"@)?("+$+")(?::\\d*)?",S=a+"*",A=a+"+",O="(?:\\/"+S+")*",k="\\/(?:"+A+O+")?",I=A+O,T="["+n+s+i+"@]+"+O,C="(?:\\/\\/\\/"+S+O+")";return e.hierPart="(?:(?:\\/\\/"+R+O+")|"+k+"|"+I+"|"+C+")",e.hierPartCapture="(?:(?:\\/\\/"+E+O+")|"+k+"|"+I+")",e.relativeRef="(?:(?:\\/\\/"+R+O+")|"+k+"|"+T+"|)",e.relativeRefCapture="(?:(?:\\/\\/"+E+O+")|"+k+"|"+T+"|)",e.query="["+o+"\\/\\?]*(?=#|$)",e.queryWithSquareBrackets="["+o+"\\[\\]\\/\\?]*(?=#|$)",e.fragment="["+o+"\\/\\?]*",e}requireFlatten(),requireIgnore(),requireIntersect(),requireIsPromise(),requireMerge(),requireOnce(),requireReach(),requireReachTemplate(),requireStringify(),requireWait();const rfc3986=generate(),ipVersions={v4Cidr:rfc3986.ipv4Cidr,v6Cidr:rfc3986.ipv6Cidr,ipv4:rfc3986.ipv4address,ipv6:rfc3986.ipv6address,ipvfuture:rfc3986.ipvFuture};function createRegex(e){const t=rfc3986,r="(?:\\?"+(e.allowQuerySquareBrackets?t.queryWithSquareBrackets:t.query)+")?(?:#"+t.fragment+")?",n=e.domain?t.relativeRefCapture:t.relativeRef;if(e.relativeOnly)return wrap(n+r);let i="";if(e.scheme){assert(e.scheme instanceof RegExp||"string"==typeof e.scheme||Array.isArray(e.scheme),"scheme must be a RegExp, String, or Array");const r=[].concat(e.scheme);assert(r.length>=1,"scheme must have at least 1 scheme specified");const n=[];for(let e=0;e<r.length;++e){const i=r[e];assert(i instanceof RegExp||"string"==typeof i,"scheme at position "+e+" must be a RegExp or String"),i instanceof RegExp?n.push(i.source.toString()):(assert(t.schemeRegex.test(i),"scheme at position "+e+" must be a valid scheme"),n.push(escapeRegex$1(i)))}i=n.join("|")}const s="(?:"+(i?"(?:"+i+")":t.scheme)+":"+(e.domain?t.hierPartCapture:t.hierPart)+")";return wrap((e.allowRelative?"(?:"+s+"|"+n+")":s)+r,i)}function wrap(e,t=null){return{raw:e=`(?=.)(?!https?:/(?:$|[^/]))(?!https?:///)(?!https?:[^/])${e}`,regex:new RegExp(`^${e}$`),scheme:t}}const genericUriRegex=createRegex({});function uriRegex(e={}){return e.scheme||e.allowRelative||e.relativeOnly||e.allowQuerySquareBrackets||e.domain?createRegex(e):genericUriRegex}function ipRegex(e={}){const t=e.cidr||"optional";assert(["required","optional","forbidden"].includes(t),"options.cidr must be one of required, optional, forbidden"),assert(void 0===e.version||"string"==typeof e.version||Array.isArray(e.version),"options.version must be a string or an array of string");let r=e.version||["ipv4","ipv6","ipvfuture"];Array.isArray(r)||(r=[r]),assert(r.length>=1,"options.version must have at least 1 version specified");for(const e of r)assert("string"==typeof e&&e===e.toLowerCase(),"Invalid options.version value"),assert(["ipv4","ipv6","ipvfuture"].includes(e),"options.version contains unknown version "+e+" - must be one of ipv4, ipv6, ipvfuture");r=Array.from(new Set(r));const n=r.map(e=>{if("forbidden"===t)return ipVersions[e];const r=`\\/${"ipv4"===e?ipVersions.v4Cidr:ipVersions.v6Cidr}`;return"required"===t?`${ipVersions[e]}${r}`:`${ipVersions[e]}(?:${r})?`}),i=`(?:${n.join("|")})`,s=new RegExp(`^${i}$`);return{cidr:t,versions:r,regex:s,raw:i}}const HEX={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,a:10,A:10,b:11,B:11,c:12,C:12,d:13,D:13,e:14,E:14,f:15,F:15},UTF8={accept:12,reject:0,data:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,6,7,7,7,7,7,7,7,7,7,7,7,7,8,7,7,10,9,9,9,11,4,4,4,4,4,4,4,4,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0,12,0,0,0,0,24,36,48,60,72,84,96,0,12,12,12,0,0,0,0,0,0,0,0,0,0,0,24,0,0,0,0,0,0,0,0,0,24,24,24,0,0,0,0,0,0,0,0,0,24,24,0,0,0,0,0,0,0,0,0,0,48,48,48,0,0,0,0,0,0,0,0,0,0,48,48,0,0,0,0,0,0,0,0,0,48,0,0,0,0,0,0,0,0,0,0,127,63,63,63,0,31,15,15,15,7,7,7]};function uriDecode(e){let t=e.indexOf("%");if(-1===t)return e;let r="",n=0,i=0,s=t,o=UTF8.accept;for(;t>-1&&t<e.length;){const a=resolveHex(e[t+1],4)|resolveHex(e[t+2],0),l=UTF8.data[a];if(o=UTF8.data[256+o+l],i=i<<6|a&UTF8.data[364+l],o!==UTF8.accept){if(o===UTF8.reject)return null;if(t+=3,t>=e.length||"%"!==e[t])return null}else r+=e.slice(n,s),r+=i<=65535?String.fromCharCode(i):String.fromCharCode(55232+(i>>10),56320+(1023&i)),i=0,n=t+3,t=e.indexOf("%",n),s=t}return r+e.slice(n)}function resolveHex(e,t){const r=HEX[e];return void 0===r?255:r<<t}var esm=Object.freeze({__proto__:null,analyzeDomain:analyzeDomain,analyzeEmail:analyzeEmail,errorCodes:errorCodes,ipRegex:ipRegex,isDomainValid:isDomainValid,isEmailValid:isEmailValid,uriDecode:uriDecode,uriRegex:uriRegex,validateDomainOptions:validateDomainOptions}),require$$1=getAugmentedNamespace(esm),commonjs={},tlds={},hasRequiredTlds,hasRequiredCommonjs,string$2,hasRequiredString,symbol,hasRequiredSymbol,binary,hasRequiredBinary,lib$1,hasRequiredLib$1;function requireTlds(){return hasRequiredTlds||(hasRequiredTlds=1,Object.defineProperty(tlds,"__esModule",{value:!0}),tlds.TLDS=void 0,tlds.TLDS=["AAA","AARP","ABB","ABBOTT","ABBVIE","ABC","ABLE","ABOGADO","ABUDHABI","AC","ACADEMY","ACCENTURE","ACCOUNTANT","ACCOUNTANTS","ACO","ACTOR","AD","ADS","ADULT","AE","AEG","AERO","AETNA","AF","AFL","AFRICA","AG","AGAKHAN","AGENCY","AI","AIG","AIRBUS","AIRFORCE","AIRTEL","AKDN","AL","ALIBABA","ALIPAY","ALLFINANZ","ALLSTATE","ALLY","ALSACE","ALSTOM","AM","AMAZON","AMERICANEXPRESS","AMERICANFAMILY","AMEX","AMFAM","AMICA","AMSTERDAM","ANALYTICS","ANDROID","ANQUAN","ANZ","AO","AOL","APARTMENTS","APP","APPLE","AQ","AQUARELLE","AR","ARAB","ARAMCO","ARCHI","ARMY","ARPA","ART","ARTE","AS","ASDA","ASIA","ASSOCIATES","AT","ATHLETA","ATTORNEY","AU","AUCTION","AUDI","AUDIBLE","AUDIO","AUSPOST","AUTHOR","AUTO","AUTOS","AW","AWS","AX","AXA","AZ","AZURE","BA","BABY","BAIDU","BANAMEX","BAND","BANK","BAR","BARCELONA","BARCLAYCARD","BARCLAYS","BAREFOOT","BARGAINS","BASEBALL","BASKETBALL","BAUHAUS","BAYERN","BB","BBC","BBT","BBVA","BCG","BCN","BD","BE","BEATS","BEAUTY","BEER","BERLIN","BEST","BESTBUY","BET","BF","BG","BH","BHARTI","BI","BIBLE","BID","BIKE","BING","BINGO","BIO","BIZ","BJ","BLACK","BLACKFRIDAY","BLOCKBUSTER","BLOG","BLOOMBERG","BLUE","BM","BMS","BMW","BN","BNPPARIBAS","BO","BOATS","BOEHRINGER","BOFA","BOM","BOND","BOO","BOOK","BOOKING","BOSCH","BOSTIK","BOSTON","BOT","BOUTIQUE","BOX","BR","BRADESCO","BRIDGESTONE","BROADWAY","BROKER","BROTHER","BRUSSELS","BS","BT","BUILD","BUILDERS","BUSINESS","BUY","BUZZ","BV","BW","BY","BZ","BZH","CA","CAB","CAFE","CAL","CALL","CALVINKLEIN","CAM","CAMERA","CAMP","CANON","CAPETOWN","CAPITAL","CAPITALONE","CAR","CARAVAN","CARDS","CARE","CAREER","CAREERS","CARS","CASA","CASE","CASH","CASINO","CAT","CATERING","CATHOLIC","CBA","CBN","CBRE","CC","CD","CENTER","CEO","CERN","CF","CFA","CFD","CG","CH","CHANEL","CHANNEL","CHARITY","CHASE","CHAT","CHEAP","CHINTAI","CHRISTMAS","CHROME","CHURCH","CI","CIPRIANI","CIRCLE","CISCO","CITADEL","CITI","CITIC","CITY","CK","CL","CLAIMS","CLEANING","CLICK","CLINIC","CLINIQUE","CLOTHING","CLOUD","CLUB","CLUBMED","CM","CN","CO","COACH","CODES","COFFEE","COLLEGE","COLOGNE","COM","COMMBANK","COMMUNITY","COMPANY","COMPARE","COMPUTER","COMSEC","CONDOS","CONSTRUCTION","CONSULTING","CONTACT","CONTRACTORS","COOKING","COOL","COOP","CORSICA","COUNTRY","COUPON","COUPONS","COURSES","CPA","CR","CREDIT","CREDITCARD","CREDITUNION","CRICKET","CROWN","CRS","CRUISE","CRUISES","CU","CUISINELLA","CV","CW","CX","CY","CYMRU","CYOU","CZ","DAD","DANCE","DATA","DATE","DATING","DATSUN","DAY","DCLK","DDS","DE","DEAL","DEALER","DEALS","DEGREE","DELIVERY","DELL","DELOITTE","DELTA","DEMOCRAT","DENTAL","DENTIST","DESI","DESIGN","DEV","DHL","DIAMONDS","DIET","DIGITAL","DIRECT","DIRECTORY","DISCOUNT","DISCOVER","DISH","DIY","DJ","DK","DM","DNP","DO","DOCS","DOCTOR","DOG","DOMAINS","DOT","DOWNLOAD","DRIVE","DTV","DUBAI","DUNLOP","DUPONT","DURBAN","DVAG","DVR","DZ","EARTH","EAT","EC","ECO","EDEKA","EDU","EDUCATION","EE","EG","EMAIL","EMERCK","ENERGY","ENGINEER","ENGINEERING","ENTERPRISES","EPSON","EQUIPMENT","ER","ERICSSON","ERNI","ES","ESQ","ESTATE","ET","EU","EUROVISION","EUS","EVENTS","EXCHANGE","EXPERT","EXPOSED","EXPRESS","EXTRASPACE","FAGE","FAIL","FAIRWINDS","FAITH","FAMILY","FAN","FANS","FARM","FARMERS","FASHION","FAST","FEDEX","FEEDBACK","FERRARI","FERRERO","FI","FIDELITY","FIDO","FILM","FINAL","FINANCE","FINANCIAL","FIRE","FIRESTONE","FIRMDALE","FISH","FISHING","FIT","FITNESS","FJ","FK","FLICKR","FLIGHTS","FLIR","FLORIST","FLOWERS","FLY","FM","FO","FOO","FOOD","FOOTBALL","FORD","FOREX","FORSALE","FORUM","FOUNDATION","FOX","FR","FREE","FRESENIUS","FRL","FROGANS","FRONTIER","FTR","FUJITSU","FUN","FUND","FURNITURE","FUTBOL","FYI","GA","GAL","GALLERY","GALLO","GALLUP","GAME","GAMES","GAP","GARDEN","GAY","GB","GBIZ","GD","GDN","GE","GEA","GENT","GENTING","GEORGE","GF","GG","GGEE","GH","GI","GIFT","GIFTS","GIVES","GIVING","GL","GLASS","GLE","GLOBAL","GLOBO","GM","GMAIL","GMBH","GMO","GMX","GN","GODADDY","GOLD","GOLDPOINT","GOLF","GOO","GOODYEAR","GOOG","GOOGLE","GOP","GOT","GOV","GP","GQ","GR","GRAINGER","GRAPHICS","GRATIS","GREEN","GRIPE","GROCERY","GROUP","GS","GT","GU","GUCCI","GUGE","GUIDE","GUITARS","GURU","GW","GY","HAIR","HAMBURG","HANGOUT","HAUS","HBO","HDFC","HDFCBANK","HEALTH","HEALTHCARE","HELP","HELSINKI","HERE","HERMES","HIPHOP","HISAMITSU","HITACHI","HIV","HK","HKT","HM","HN","HOCKEY","HOLDINGS","HOLIDAY","HOMEDEPOT","HOMEGOODS","HOMES","HOMESENSE","HONDA","HORSE","HOSPITAL","HOST","HOSTING","HOT","HOTELS","HOTMAIL","HOUSE","HOW","HR","HSBC","HT","HU","HUGHES","HYATT","HYUNDAI","IBM","ICBC","ICE","ICU","ID","IE","IEEE","IFM","IKANO","IL","IM","IMAMAT","IMDB","IMMO","IMMOBILIEN","IN","INC","INDUSTRIES","INFINITI","INFO","ING","INK","INSTITUTE","INSURANCE","INSURE","INT","INTERNATIONAL","INTUIT","INVESTMENTS","IO","IPIRANGA","IQ","IR","IRISH","IS","ISMAILI","IST","ISTANBUL","IT","ITAU","ITV","JAGUAR","JAVA","JCB","JE","JEEP","JETZT","JEWELRY","JIO","JLL","JM","JMP","JNJ","JO","JOBS","JOBURG","JOT","JOY","JP","JPMORGAN","JPRS","JUEGOS","JUNIPER","KAUFEN","KDDI","KE","KERRYHOTELS","KERRYPROPERTIES","KFH","KG","KH","KI","KIA","KIDS","KIM","KINDLE","KITCHEN","KIWI","KM","KN","KOELN","KOMATSU","KOSHER","KP","KPMG","KPN","KR","KRD","KRED","KUOKGROUP","KW","KY","KYOTO","KZ","LA","LACAIXA","LAMBORGHINI","LAMER","LAND","LANDROVER","LANXESS","LASALLE","LAT","LATINO","LATROBE","LAW","LAWYER","LB","LC","LDS","LEASE","LECLERC","LEFRAK","LEGAL","LEGO","LEXUS","LGBT","LI","LIDL","LIFE","LIFEINSURANCE","LIFESTYLE","LIGHTING","LIKE","LILLY","LIMITED","LIMO","LINCOLN","LINK","LIVE","LIVING","LK","LLC","LLP","LOAN","LOANS","LOCKER","LOCUS","LOL","LONDON","LOTTE","LOTTO","LOVE","LPL","LPLFINANCIAL","LR","LS","LT","LTD","LTDA","LU","LUNDBECK","LUXE","LUXURY","LV","LY","MA","MADRID","MAIF","MAISON","MAKEUP","MAN","MANAGEMENT","MANGO","MAP","MARKET","MARKETING","MARKETS","MARRIOTT","MARSHALLS","MATTEL","MBA","MC","MCKINSEY","MD","ME","MED","MEDIA","MEET","MELBOURNE","MEME","MEMORIAL","MEN","MENU","MERCKMSD","MG","MH","MIAMI","MICROSOFT","MIL","MINI","MINT","MIT","MITSUBISHI","MK","ML","MLB","MLS","MM","MMA","MN","MO","MOBI","MOBILE","MODA","MOE","MOI","MOM","MONASH","MONEY","MONSTER","MORMON","MORTGAGE","MOSCOW","MOTO","MOTORCYCLES","MOV","MOVIE","MP","MQ","MR","MS","MSD","MT","MTN","MTR","MU","MUSEUM","MUSIC","MV","MW","MX","MY","MZ","NA","NAB","NAGOYA","NAME","NAVY","NBA","NC","NE","NEC","NET","NETBANK","NETFLIX","NETWORK","NEUSTAR","NEW","NEWS","NEXT","NEXTDIRECT","NEXUS","NF","NFL","NG","NGO","NHK","NI","NICO","NIKE","NIKON","NINJA","NISSAN","NISSAY","NL","NO","NOKIA","NORTON","NOW","NOWRUZ","NOWTV","NP","NR","NRA","NRW","NTT","NU","NYC","NZ","OBI","OBSERVER","OFFICE","OKINAWA","OLAYAN","OLAYANGROUP","OLLO","OM","OMEGA","ONE","ONG","ONL","ONLINE","OOO","OPEN","ORACLE","ORANGE","ORG","ORGANIC","ORIGINS","OSAKA","OTSUKA","OTT","OVH","PA","PAGE","PANASONIC","PARIS","PARS","PARTNERS","PARTS","PARTY","PAY","PCCW","PE","PET","PF","PFIZER","PG","PH","PHARMACY","PHD","PHILIPS","PHONE","PHOTO","PHOTOGRAPHY","PHOTOS","PHYSIO","PICS","PICTET","PICTURES","PID","PIN","PING","PINK","PIONEER","PIZZA","PK","PL","PLACE","PLAY","PLAYSTATION","PLUMBING","PLUS","PM","PN","PNC","POHL","POKER","POLITIE","PORN","POST","PR","PRAXI","PRESS","PRIME","PRO","PROD","PRODUCTIONS","PROF","PROGRESSIVE","PROMO","PROPERTIES","PROPERTY","PROTECTION","PRU","PRUDENTIAL","PS","PT","PUB","PW","PWC","PY","QA","QPON","QUEBEC","QUEST","RACING","RADIO","RE","READ","REALESTATE","REALTOR","REALTY","RECIPES","RED","REDUMBRELLA","REHAB","REISE","REISEN","REIT","RELIANCE","REN","RENT","RENTALS","REPAIR","REPORT","REPUBLICAN","REST","RESTAURANT","REVIEW","REVIEWS","REXROTH","RICH","RICHARDLI","RICOH","RIL","RIO","RIP","RO","ROCKS","RODEO","ROGERS","ROOM","RS","RSVP","RU","RUGBY","RUHR","RUN","RW","RWE","RYUKYU","SA","SAARLAND","SAFE","SAFETY","SAKURA","SALE","SALON","SAMSCLUB","SAMSUNG","SANDVIK","SANDVIKCOROMANT","SANOFI","SAP","SARL","SAS","SAVE","SAXO","SB","SBI","SBS","SC","SCB","SCHAEFFLER","SCHMIDT","SCHOLARSHIPS","SCHOOL","SCHULE","SCHWARZ","SCIENCE","SCOT","SD","SE","SEARCH","SEAT","SECURE","SECURITY","SEEK","SELECT","SENER","SERVICES","SEVEN","SEW","SEX","SEXY","SFR","SG","SH","SHANGRILA","SHARP","SHELL","SHIA","SHIKSHA","SHOES","SHOP","SHOPPING","SHOUJI","SHOW","SI","SILK","SINA","SINGLES","SITE","SJ","SK","SKI","SKIN","SKY","SKYPE","SL","SLING","SM","SMART","SMILE","SN","SNCF","SO","SOCCER","SOCIAL","SOFTBANK","SOFTWARE","SOHU","SOLAR","SOLUTIONS","SONG","SONY","SOY","SPA","SPACE","SPORT","SPOT","SR","SRL","SS","ST","STADA","STAPLES","STAR","STATEBANK","STATEFARM","STC","STCGROUP","STOCKHOLM","STORAGE","STORE","STREAM","STUDIO","STUDY","STYLE","SU","SUCKS","SUPPLIES","SUPPLY","SUPPORT","SURF","SURGERY","SUZUKI","SV","SWATCH","SWISS","SX","SY","SYDNEY","SYSTEMS","SZ","TAB","TAIPEI","TALK","TAOBAO","TARGET","TATAMOTORS","TATAR","TATTOO","TAX","TAXI","TC","TCI","TD","TDK","TEAM","TECH","TECHNOLOGY","TEL","TEMASEK","TENNIS","TEVA","TF","TG","TH","THD","THEATER","THEATRE","TIAA","TICKETS","TIENDA","TIPS","TIRES","TIROL","TJ","TJMAXX","TJX","TK","TKMAXX","TL","TM","TMALL","TN","TO","TODAY","TOKYO","TOOLS","TOP","TORAY","TOSHIBA","TOTAL","TOURS","TOWN","TOYOTA","TOYS","TR","TRADE","TRADING","TRAINING","TRAVEL","TRAVELERS","TRAVELERSINSURANCE","TRUST","TRV","TT","TUBE","TUI","TUNES","TUSHU","TV","TVS","TW","TZ","UA","UBANK","UBS","UG","UK","UNICOM","UNIVERSITY","UNO","UOL","UPS","US","UY","UZ","VA","VACATIONS","VANA","VANGUARD","VC","VE","VEGAS","VENTURES","VERISIGN","VERSICHERUNG","VET","VG","VI","VIAJES","VIDEO","VIG","VIKING","VILLAS","VIN","VIP","VIRGIN","VISA","VISION","VIVA","VIVO","VLAANDEREN","VN","VODKA","VOLVO","VOTE","VOTING","VOTO","VOYAGE","VU","WALES","WALMART","WALTER","WANG","WANGGOU","WATCH","WATCHES","WEATHER","WEATHERCHANNEL","WEBCAM","WEBER","WEBSITE","WED","WEDDING","WEIBO","WEIR","WF","WHOSWHO","WIEN","WIKI","WILLIAMHILL","WIN","WINDOWS","WINE","WINNERS","WME","WOLTERSKLUWER","WOODSIDE","WORK","WORKS","WORLD","WOW","WS","WTC","WTF","XBOX","XEROX","XIHUAN","XIN","XN--11B4C3D","XN--1CK2E1B","XN--1QQW23A","XN--2SCRJ9C","XN--30RR7Y","XN--3BST00M","XN--3DS443G","XN--3E0B707E","XN--3HCRJ9C","XN--3PXU8K","XN--42C2D9A","XN--45BR5CYL","XN--45BRJ9C","XN--45Q11C","XN--4DBRK0CE","XN--4GBRIM","XN--54B7FTA0CC","XN--55QW42G","XN--55QX5D","XN--5SU34J936BGSG","XN--5TZM5G","XN--6FRZ82G","XN--6QQ986B3XL","XN--80ADXHKS","XN--80AO21A","XN--80AQECDR1A","XN--80ASEHDB","XN--80ASWG","XN--8Y0A063A","XN--90A3AC","XN--90AE","XN--90AIS","XN--9DBQ2A","XN--9ET52U","XN--9KRT00A","XN--B4W605FERD","XN--BCK1B9A5DRE4C","XN--C1AVG","XN--C2BR7G","XN--CCK2B3B","XN--CCKWCXETD","XN--CG4BKI","XN--CLCHC0EA0B2G2A9GCD","XN--CZR694B","XN--CZRS0T","XN--CZRU2D","XN--D1ACJ3B","XN--D1ALF","XN--E1A4C","XN--ECKVDTC9D","XN--EFVY88H","XN--FCT429K","XN--FHBEI","XN--FIQ228C5HS","XN--FIQ64B","XN--FIQS8S","XN--FIQZ9S","XN--FJQ720A","XN--FLW351E","XN--FPCRJ9C3D","XN--FZC2C9E2C","XN--FZYS8D69UVGM","XN--G2XX48C","XN--GCKR3F0F","XN--GECRJ9C","XN--GK3AT1E","XN--H2BREG3EVE","XN--H2BRJ9C","XN--H2BRJ9C8C","XN--HXT814E","XN--I1B6B1A6A2E","XN--IMR513N","XN--IO0A7I","XN--J1AEF","XN--J1AMH","XN--J6W193G","XN--JLQ480N2RG","XN--JVR189M","XN--KCRX77D1X4A","XN--KPRW13D","XN--KPRY57D","XN--KPUT3I","XN--L1ACC","XN--LGBBAT1AD8J","XN--MGB9AWBF","XN--MGBA3A3EJT","XN--MGBA3A4F16A","XN--MGBA7C0BBN0A","XN--MGBAAM7A8H","XN--MGBAB2BD","XN--MGBAH1A3HJKRD","XN--MGBAI9AZGQP6J","XN--MGBAYH7GPA","XN--MGBBH1A","XN--MGBBH1A71E","XN--MGBC0A9AZCG","XN--MGBCA7DZDO","XN--MGBCPQ6GPA1A","XN--MGBERP4A5D4AR","XN--MGBGU82A","XN--MGBI4ECEXP","XN--MGBPL2FH","XN--MGBT3DHD","XN--MGBTX2B","XN--MGBX4CD0AB","XN--MIX891F","XN--MK1BU44C","XN--MXTQ1M","XN--NGBC5AZD","XN--NGBE9E0A","XN--NGBRX","XN--NODE","XN--NQV7F","XN--NQV7FS00EMA","XN--NYQY26A","XN--O3CW4H","XN--OGBPF8FL","XN--OTU796D","XN--P1ACF","XN--P1AI","XN--PGBS0DH","XN--PSSY2U","XN--Q7CE6A","XN--Q9JYB4C","XN--QCKA1PMC","XN--QXA6A","XN--QXAM","XN--RHQV96G","XN--ROVU88B","XN--RVC1E0AM3E","XN--S9BRJ9C","XN--SES554G","XN--T60B56A","XN--TCKWE","XN--TIQ49XQYJ","XN--UNUP4Y","XN--VERMGENSBERATER-CTB","XN--VERMGENSBERATUNG-PWB","XN--VHQUV","XN--VUQ861B","XN--W4R85EL8FHU5DNRA","XN--W4RS40L","XN--WGBH1C","XN--WGBL6A","XN--XHQ521B","XN--XKC2AL3HYE2A","XN--XKC2DL3A5EE0H","XN--Y9A3AQ","XN--YFRO4I67O","XN--YGBI2AMMX","XN--ZFR164B","XXX","XYZ","YACHTS","YAHOO","YAMAXUN","YANDEX","YE","YODOBASHI","YOGA","YOKOHAMA","YOU","YOUTUBE","YT","YUN","ZA","ZAPPOS","ZARA","ZERO","ZIP","ZM","ZONE","ZUERICH","ZW"]),tlds}function requireCommonjs(){if(hasRequiredCommonjs)return commonjs;hasRequiredCommonjs=1,Object.defineProperty(commonjs,"__esModule",{value:!0}),commonjs.tlds=void 0;const e=requireTlds();return commonjs.tlds=new Set(e.TLDS.map(e=>e.toLowerCase())),commonjs}function requireString(){if(hasRequiredString)return string$2;hasRequiredString=1;const{assert:e,escapeRegex:t}=requireLib$5(),{isDomainValid:r,isEmailValid:n,ipRegex:i,uriRegex:s}=require$$1,o=requireCommonjs(),a=requireAny(),l=requireCommon(),c={tlds:o.tlds instanceof Set&&{tlds:{allow:o.tlds,deny:null}},base64Regex:{true:{true:/^(?:[\w\-]{2}[\w\-]{2})*(?:[\w\-]{2}==|[\w\-]{3}=)?$/,false:/^(?:[A-Za-z0-9+\/]{2}[A-Za-z0-9+\/]{2})*(?:[A-Za-z0-9+\/]{2}==|[A-Za-z0-9+\/]{3}=)?$/},false:{true:/^(?:[\w\-]{2}[\w\-]{2})*(?:[\w\-]{2}(==)?|[\w\-]{3}=?)?$/,false:/^(?:[A-Za-z0-9+\/]{2}[A-Za-z0-9+\/]{2})*(?:[A-Za-z0-9+\/]{2}(==)?|[A-Za-z0-9+\/]{3}=?)?$/}},dataUriRegex:/^data:[\w+.-]+\/[\w+.-]+;((charset=[\w-]+|base64),)?(.*)$/,hexRegex:{withPrefix:/^0x[0-9a-f]+$/i,withOptionalPrefix:/^(?:0x)?[0-9a-f]+$/i,withoutPrefix:/^[0-9a-f]+$/i},ipRegex:i({cidr:"forbidden"}).regex,isoDurationRegex:/^P(?!$)(\d+Y)?(\d+M)?(\d+W)?(\d+D)?(T(?=\d)(\d+H)?(\d+M)?(\d+S)?)?$/,guidBrackets:{"{":"}","[":"]","(":")","":""},guidVersions:{uuidv1:"1",uuidv2:"2",uuidv3:"3",uuidv4:"4",uuidv5:"5",uuidv6:"6",uuidv7:"7",uuidv8:"8"},guidSeparators:new Set([void 0,!0,!1,"-",":"]),normalizationForms:["NFC","NFD","NFKC","NFKD"]};return string$2=a.extend({type:"string",flags:{insensitive:{default:!1},truncate:{default:!1}},terms:{replacements:{init:null}},coerce:{from:"string",method(e,{schema:t,state:r,prefs:n}){const i=t.$_getRule("normalize");i&&(e=e.normalize(i.args.form));const s=t.$_getRule("case");s&&(e="upper"===s.args.direction?e.toLocaleUpperCase():e.toLocaleLowerCase());const o=t.$_getRule("trim");if(o&&o.args.enabled&&(e=e.trim()),t.$_terms.replacements)for(const r of t.$_terms.replacements)e=e.replace(r.pattern,r.replacement);const a=t.$_getRule("hex");if(a&&a.args.options.byteAligned&&e.length%2!=0&&(e=`0${e}`),t.$_getRule("isoDate")){const t=c.isoDate(e);t&&(e=t)}if(t._flags.truncate){const i=t.$_getRule("max");if(i){let s=i.args.limit;if(l.isResolvable(s)&&(s=s.resolve(e,r,n),!l.limit(s)))return{value:e,errors:t.$_createError("any.ref",s,{ref:i.args.limit,arg:"limit",reason:"must be a positive integer"},r,n)};e=e.slice(0,s)}}return{value:e}}},validate(e,{schema:t,error:r}){if("string"!=typeof e)return{value:e,errors:r("string.base")};if(""===e){const n=t.$_getRule("min");if(n&&0===n.args.limit)return;return{value:e,errors:r("string.empty")}}},rules:{alphanum:{method(){return this.$_addRule("alphanum")},validate:(e,t)=>/^[a-zA-Z0-9]+$/.test(e)?e:t.error("string.alphanum")},base64:{method(t={}){return l.assertOptions(t,["paddingRequired","urlSafe"]),t={urlSafe:!1,paddingRequired:!0,...t},e("boolean"==typeof t.paddingRequired,"paddingRequired must be boolean"),e("boolean"==typeof t.urlSafe,"urlSafe must be boolean"),this.$_addRule({name:"base64",args:{options:t}})},validate:(e,t,{options:r})=>c.base64Regex[r.paddingRequired][r.urlSafe].test(e)?e:t.error("string.base64")},case:{method(t){return e(["lower","upper"].includes(t),"Invalid case:",t),this.$_addRule({name:"case",args:{direction:t}})},validate:(e,t,{direction:r})=>"lower"===r&&e===e.toLocaleLowerCase()||"upper"===r&&e===e.toLocaleUpperCase()?e:t.error(`string.${r}case`),convert:!0},creditCard:{method(){return this.$_addRule("creditCard")},validate(e,t){let r=e.length,n=0,i=1;for(;r--;){const t=e.charAt(r)*i;n+=t-9*(t>9),i^=3}return n>0&&n%10==0?e:t.error("string.creditCard")}},dataUri:{method(t={}){return l.assertOptions(t,["paddingRequired"]),t={paddingRequired:!0,...t},e("boolean"==typeof t.paddingRequired,"paddingRequired must be boolean"),this.$_addRule({name:"dataUri",args:{options:t}})},validate(e,t,{options:r}){const n=e.match(c.dataUriRegex);if(n){if(!n[2])return e;if("base64"!==n[2])return e;if(c.base64Regex[r.paddingRequired].false.test(n[3]))return e}return t.error("string.dataUri")}},domain:{method(e){e&&l.assertOptions(e,["allowFullyQualified","allowUnicode","allowUnderscore","maxDomainSegments","minDomainSegments","tlds"]);const t=c.addressOptions(e);return this.$_addRule({name:"domain",args:{options:e},address:t})},validate:(e,t,n,{address:i})=>r(e,i)?e:t.error("string.domain")},email:{method(r={}){l.assertOptions(r,["allowFullyQualified","allowUnicode","ignoreLength","maxDomainSegments","minDomainSegments","multiple","separator","tlds"]),e(void 0===r.multiple||"boolean"==typeof r.multiple,"multiple option must be an boolean");const n=c.addressOptions(r),i=new RegExp(`\\s*[${r.separator?t(r.separator):","}]\\s*`);return this.$_addRule({name:"email",args:{options:r},regex:i,address:n})},validate(e,t,{options:r},{regex:i,address:s}){const o=r.multiple?e.split(i):[e],a=[];for(const e of o)n(e,s)||a.push(e);return a.length?t.error("string.email",{value:e,invalids:a}):e}},guid:{alias:"uuid",method(r={}){l.assertOptions(r,["version","separator","wrapper"]),e(void 0===r.wrapper||"boolean"==typeof r.wrapper||"string"==typeof r.wrapper&&"string"==typeof c.guidBrackets[r.wrapper],`"wrapper" must be true, false, or one of "${Object.keys(c.guidBrackets).filter(Boolean).join('", "')}"`);let n="";if(r.version){const t=[].concat(r.version);e(t.length>=1,"version must have at least 1 valid version specified");const i=new Set;for(let r=0;r<t.length;++r){const s=t[r];e("string"==typeof s,"version at position "+r+" must be a string");const o=c.guidVersions[s.toLowerCase()];e(o,"version at position "+r+" must be one of "+Object.keys(c.guidVersions).join(", ")),e(!i.has(o),"version at position "+r+" must not be a duplicate"),n+=o,i.add(o)}}e(c.guidSeparators.has(r.separator),'separator must be one of true, false, "-", or ":"');const i=void 0===r.separator?"[:-]?":!0===r.separator?"[:-]":!1===r.separator?"[]?":`\\${r.separator}`;let s,o;void 0===r.wrapper?(s="[\\[{\\(]?",o="[\\]}\\)]?"):!0===r.wrapper?(s="[\\[{\\(]",o="[\\]}\\)]"):!1===r.wrapper?(s="",o=""):(s=t(r.wrapper),o=t(c.guidBrackets[r.wrapper]));const a=new RegExp(`^(${s})[0-9A-F]{8}(${i})[0-9A-F]{4}\\2?[${n||"0-9A-F"}][0-9A-F]{3}\\2?[${n?"89AB":"0-9A-F"}][0-9A-F]{3}\\2?[0-9A-F]{12}(${o})$`,"i");return this.$_addRule({name:"guid",args:{options:r},regex:a})},validate(e,t,r,{regex:n}){const i=n.exec(e);if(!i)return t.error("string.guid");const s=i[1],o=i[i.length-1];return(s||o)&&c.guidBrackets[s]!==o?t.error("string.guid"):e}},hex:{method(t={}){return l.assertOptions(t,["byteAligned","prefix"]),t={byteAligned:!1,prefix:!1,...t},e("boolean"==typeof t.byteAligned,"byteAligned must be boolean"),e("boolean"==typeof t.prefix||"optional"===t.prefix,'prefix must be boolean or "optional"'),this.$_addRule({name:"hex",args:{options:t}})},validate:(e,t,{options:r})=>("optional"===r.prefix?c.hexRegex.withOptionalPrefix:!0===r.prefix?c.hexRegex.withPrefix:c.hexRegex.withoutPrefix).test(e)?r.byteAligned&&e.length%2!=0?t.error("string.hexAlign"):e:t.error("string.hex")},hostname:{method(){return this.$_addRule("hostname")},validate:(e,t)=>r(e,{minDomainSegments:1})||c.ipRegex.test(e)?e:t.error("string.hostname")},insensitive:{method(){return this.$_setFlag("insensitive",!0)}},ip:{method(e={}){l.assertOptions(e,["cidr","version"]);const{cidr:t,versions:r,regex:n}=i(e),s=e.version?r:void 0;return this.$_addRule({name:"ip",args:{options:{cidr:t,version:s}},regex:n})},validate:(e,t,{options:r},{regex:n})=>n.test(e)?e:r.version?t.error("string.ipVersion",{value:e,cidr:r.cidr,version:r.version}):t.error("string.ip",{value:e,cidr:r.cidr})},isoDate:{method(){return this.$_addRule("isoDate")},validate:(e,{error:t})=>c.isoDate(e)?e:t("string.isoDate")},isoDuration:{method(){return this.$_addRule("isoDuration")},validate:(e,t)=>c.isoDurationRegex.test(e)?e:t.error("string.isoDuration")},length:{method(e,t){return c.length(this,"length",e,"=",t)},validate(e,t,{limit:r,encoding:n},{name:i,operator:s,args:o}){const a=n?Buffer&&Buffer.byteLength(e,n):e.length;return l.compare(a,r,s)?e:t.error("string."+i,{limit:o.limit,value:e,encoding:n})},args:[{name:"limit",ref:!0,assert:l.limit,message:"must be a positive integer"},"encoding"]},lowercase:{method(){return this.case("lower")}},max:{method(e,t){return c.length(this,"max",e,"<=",t)},args:["limit","encoding"]},min:{method(e,t){return c.length(this,"min",e,">=",t)},args:["limit","encoding"]},normalize:{method(t="NFC"){return e(c.normalizationForms.includes(t),"normalization form must be one of "+c.normalizationForms.join(", ")),this.$_addRule({name:"normalize",args:{form:t}})},validate:(e,{error:t},{form:r})=>e===e.normalize(r)?e:t("string.normalize",{value:e,form:r}),convert:!0},pattern:{alias:"regex",method(t,r={}){e(t instanceof RegExp,"regex must be a RegExp"),e(!t.flags.includes("g")&&!t.flags.includes("y"),"regex should not use global or sticky mode"),"string"==typeof r&&(r={name:r}),l.assertOptions(r,["invert","name"]);const n=["string.pattern",r.invert?".invert":"",r.name?".name":".base"].join("");return this.$_addRule({name:"pattern",args:{regex:t,options:r},errorCode:n})},validate:(e,t,{regex:r,options:n},{errorCode:i})=>r.test(e)^n.invert?e:t.error(i,{name:n.name,regex:r,value:e}),args:["regex","options"],multi:!0},replace:{method(r,n){"string"==typeof r&&(r=new RegExp(t(r),"g")),e(r instanceof RegExp,"pattern must be a RegExp"),e("string"==typeof n,"replacement must be a String");const i=this.clone();return i.$_terms.replacements||(i.$_terms.replacements=[]),i.$_terms.replacements.push({pattern:r,replacement:n}),i}},token:{method(){return this.$_addRule("token")},validate:(e,t)=>/^\w+$/.test(e)?e:t.error("string.token")},trim:{method(t=!0){return e("boolean"==typeof t,"enabled must be a boolean"),this.$_addRule({name:"trim",args:{enabled:t}})},validate:(e,t,{enabled:r})=>r&&e!==e.trim()?t.error("string.trim"):e,convert:!0},truncate:{method(t=!0){return e("boolean"==typeof t,"enabled must be a boolean"),this.$_setFlag("truncate",t)}},uppercase:{method(){return this.case("upper")}},uri:{method(e={}){l.assertOptions(e,["allowRelative","allowQuerySquareBrackets","domain","relativeOnly","scheme","encodeUri"]),e.domain&&l.assertOptions(e.domain,["allowFullyQualified","allowUnicode","maxDomainSegments","minDomainSegments","tlds"]);const{regex:t,scheme:r}=s(e),n=e.domain?c.addressOptions(e.domain):null;return this.$_addRule({name:"uri",args:{options:e},regex:t,domain:n,scheme:r})},validate(e,t,{options:n},{regex:i,domain:s,scheme:o}){if(["http:/","https:/"].includes(e))return t.error("string.uri");let a=i.exec(e);if(!a&&t.prefs.convert&&n.encodeUri){const t=encodeURI(e);a=i.exec(t),a&&(e=t)}if(a){const i=a[1]||a[2];return!s||n.allowRelative&&!i||r(i,s)?e:t.error("string.domain",{value:i})}return n.relativeOnly?t.error("string.uriRelativeOnly"):n.scheme?t.error("string.uriCustomScheme",{scheme:o,value:e}):t.error("string.uri")}}},manifest:{build(e,t){if(t.replacements)for(const{pattern:r,replacement:n}of t.replacements)e=e.replace(r,n);return e}},messages:{"string.alphanum":"{{#label}} must only contain alpha-numeric characters","string.base":"{{#label}} must be a string","string.base64":"{{#label}} must be a valid base64 string","string.creditCard":"{{#label}} must be a credit card","string.dataUri":"{{#label}} must be a valid dataUri string","string.domain":"{{#label}} must contain a valid domain name","string.email":"{{#label}} must be a valid email","string.empty":"{{#label}} is not allowed to be empty","string.guid":"{{#label}} must be a valid GUID","string.hex":"{{#label}} must only contain hexadecimal characters","string.hexAlign":"{{#label}} hex decoded representation must be byte aligned","string.hostname":"{{#label}} must be a valid hostname","string.ip":"{{#label}} must be a valid ip address with a {{#cidr}} CIDR","string.ipVersion":"{{#label}} must be a valid ip address of one of the following versions {{#version}} with a {{#cidr}} CIDR","string.isoDate":"{{#label}} must be in iso format","string.isoDuration":"{{#label}} must be a valid ISO 8601 duration","string.length":"{{#label}} length must be {{#limit}} characters long","string.lowercase":"{{#label}} must only contain lowercase characters","string.max":"{{#label}} length must be less than or equal to {{#limit}} characters long","string.min":"{{#label}} length must be at least {{#limit}} characters long","string.normalize":"{{#label}} must be unicode normalized in the {{#form}} form","string.token":"{{#label}} must only contain alpha-numeric and underscore characters","string.pattern.base":"{{#label}} with value {:[.]} fails to match the required pattern: {{#regex}}","string.pattern.name":"{{#label}} with value {:[.]} fails to match the {{#name}} pattern","string.pattern.invert.base":"{{#label}} with value {:[.]} matches the inverted pattern: {{#regex}}","string.pattern.invert.name":"{{#label}} with value {:[.]} matches the inverted {{#name}} pattern","string.trim":"{{#label}} must not have leading or trailing whitespace","string.uri":"{{#label}} must be a valid uri","string.uriCustomScheme":"{{#label}} must be a valid uri with a scheme matching the {{#scheme}} pattern","string.uriRelativeOnly":"{{#label}} must be a valid relative uri","string.uppercase":"{{#label}} must only contain uppercase characters"}}),c.addressOptions=function(t){if(!t)return c.tlds||t;if(e(void 0===t.minDomainSegments||Number.isSafeInteger(t.minDomainSegments)&&t.minDomainSegments>0,"minDomainSegments must be a positive integer"),e(void 0===t.maxDomainSegments||Number.isSafeInteger(t.maxDomainSegments)&&t.maxDomainSegments>0,"maxDomainSegments must be a positive integer"),!1===t.tlds)return t;if(!0===t.tlds||void 0===t.tlds)return e(c.tlds,"Built-in TLD list disabled"),Object.assign({},t,c.tlds);e("object"==typeof t.tlds,"tlds must be true, false, or an object");const r=t.tlds.deny;if(r)return Array.isArray(r)&&(t=Object.assign({},t,{tlds:{deny:new Set(r)}})),e(t.tlds.deny instanceof Set,"tlds.deny must be an array, Set, or boolean"),e(!t.tlds.allow,"Cannot specify both tlds.allow and tlds.deny lists"),c.validateTlds(t.tlds.deny,"tlds.deny"),t;const n=t.tlds.allow;return n?!0===n?(e(c.tlds,"Built-in TLD list disabled"),Object.assign({},t,c.tlds)):(Array.isArray(n)&&(t=Object.assign({},t,{tlds:{allow:new Set(n)}})),e(t.tlds.allow instanceof Set,"tlds.allow must be an array, Set, or boolean"),c.validateTlds(t.tlds.allow,"tlds.allow"),t):{...t,tlds:!1}},c.validateTlds=function(t,n){for(const i of t)e(r(i,{minDomainSegments:1,maxDomainSegments:1}),`${n} must contain valid top level domain names`)},c.isoDate=function(e){if(!l.isIsoDate(e))return null;/.*T.*[+-]\d\d$/.test(e)&&(e+="00");const t=new Date(e);return isNaN(t.getTime())?null:t.toISOString()},c.length=function(t,r,n,i,s){return e(!s||Buffer&&Buffer.isEncoding(s),"Invalid encoding:",s),t.$_addRule({name:r,method:"length",args:{limit:n,encoding:s},operator:i})},string$2}function requireSymbol(){if(hasRequiredSymbol)return symbol;hasRequiredSymbol=1;const{assert:e}=requireLib$5(),t=requireAny(),r={};return r.Map=class extends Map{slice(){return new r.Map(this)}},symbol=t.extend({type:"symbol",terms:{map:{init:new r.Map}},coerce:{method(e,{schema:t,error:r}){const n=t.$_terms.map.get(e);return n&&(e=n),t._flags.only&&"symbol"!=typeof e?{value:e,errors:r("symbol.map",{map:t.$_terms.map})}:{value:e}}},validate(e,{error:t}){if("symbol"!=typeof e)return{value:e,errors:t("symbol.base")}},rules:{map:{method(t){t&&!t[Symbol.iterator]&&"object"==typeof t&&(t=Object.entries(t)),e(t&&t[Symbol.iterator],"Iterable must be an iterable or object");const r=this.clone(),n=[];for(const i of t){e(i&&i[Symbol.iterator],"Entry must be an iterable");const[t,s]=i;e("object"!=typeof t&&"function"!=typeof t&&"symbol"!=typeof t,"Key must not be of type object, function, or Symbol"),e("symbol"==typeof s,"Value must be a Symbol"),r.$_terms.map.set(t,s),n.push(s)}return r.valid(...n)}}},manifest:{build:(e,t)=>(t.map&&(e=e.map(t.map)),e)},messages:{"symbol.base":"{{#label}} must be a symbol","symbol.map":"{{#label}} must be one of {{#map}}"}})}function requireBinary(){if(hasRequiredBinary)return binary;hasRequiredBinary=1;const{assert:e}=requireLib$5(),t=requireAny(),r=requireCommon();return binary=t.extend({type:"binary",coerce:{from:["string","object"],method(e,{schema:t}){if("string"==typeof e||null!==e&&"Buffer"===e.type)try{return{value:Buffer.from(e,t._flags.encoding)}}catch{}}},validate(e,{error:t}){if(!Buffer.isBuffer(e))return{value:e,errors:t("binary.base")}},rules:{encoding:{method(t){return e(Buffer.isEncoding(t),"Invalid encoding:",t),this.$_setFlag("encoding",t)}},length:{method(e){return this.$_addRule({name:"length",method:"length",args:{limit:e},operator:"="})},validate:(e,t,{limit:n},{name:i,operator:s,args:o})=>r.compare(e.length,n,s)?e:t.error("binary."+i,{limit:o.limit,value:e}),args:[{name:"limit",ref:!0,assert:r.limit,message:"must be a positive integer"}]},max:{method(e){return this.$_addRule({name:"max",method:"length",args:{limit:e},operator:"<="})}},min:{method(e){return this.$_addRule({name:"min",method:"length",args:{limit:e},operator:">="})}}},cast:{string:{from:e=>Buffer.isBuffer(e),to:(e,t)=>e.toString()}},messages:{"binary.base":"{{#label}} must be a buffer or a string","binary.length":"{{#label}} must be {{#limit}} bytes","binary.max":"{{#label}} must be less than or equal to {{#limit}} bytes","binary.min":"{{#label}} must be at least {{#limit}} bytes"}})}function requireLib$1(){if(hasRequiredLib$1)return lib$1;hasRequiredLib$1=1;const{assert:e,clone:t}=requireLib$5(),r=requireCache(),n=requireCommon(),i=requireCompile(),s=requireErrors(),o=requireExtend(),a=requireManifest(),l=requireRef(),c=requireTemplate(),u=requireTrace();let d;const h={types:{alternatives:requireAlternatives(),any:requireAny(),array:requireArray(),boolean:requireBoolean(),date:requireDate(),function:require_function(),link:requireLink(),number:requireNumber(),object:requireObject(),string:requireString(),symbol:requireSymbol()},aliases:{alt:"alternatives",bool:"boolean",func:"function"}};return Buffer&&(h.types.binary=requireBinary()),h.root=function(){const t={_types:new Set(Object.keys(h.types))};for(const r of t._types)t[r]=function(...t){return e(!t.length||["alternatives","link","object"].includes(r),"The",r,"type does not allow arguments"),h.generate(this,h.types[r],t)};for(const e of["allow","custom","disallow","equal","exist","forbidden","invalid","not","only","optional","options","prefs","preferences","required","strip","valid","when"])t[e]=function(...t){return this.any()[e](...t)};Object.assign(t,h.methods);for(const e in h.aliases){const r=h.aliases[e];t[e]=t[r]}return t.x=t.expression,u.setup&&u.setup(t),t},h.methods={ValidationError:s.ValidationError,version:n.version,cache:r.provider,assert(e,t,...r){h.assert(e,t,!0,r)},attempt:(e,t,...r)=>h.assert(e,t,!1,r),build(t){return e("function"==typeof a.build,"Manifest functionality disabled"),a.build(this,t)},checkPreferences(e){n.checkPreferences(e)},compile(e,t){return i.compile(this,e,t)},defaults(t){e("function"==typeof t,"modifier must be a function");const r=Object.assign({},this);for(const i of r._types){const s=t(r[i]());e(n.isSchema(s),"modifier must return a valid schema object"),r[i]=function(...e){return h.generate(this,s,e)}}return r},expression:(...e)=>new c(...e),extend(...t){n.verifyFlat(t,"extend"),d=d||requireSchemas(),e(t.length,"You need to provide at least one extension"),this.assert(t,d.extensions);const r=Object.assign({},this);r._types=new Set(r._types);for(let n of t){"function"==typeof n&&(n=n(r)),this.assert(n,d.extension);const t=h.expandExtension(n,r);for(const n of t){e(void 0===r[n.type]||r._types.has(n.type),"Cannot override name",n.type);const t=n.base||this.any(),i=o.type(t,n);r._types.add(n.type),r[n.type]=function(...e){return h.generate(this,i,e)}}}return r},isError:s.ValidationError.isError,isExpression:c.isTemplate,isRef:l.isRef,isSchema:n.isSchema,in:(...e)=>l.in(...e),override:n.symbols.override,ref:(...e)=>l.create(...e),types(){const e={};for(const t of this._types)e[t]=this[t]();for(const t in h.aliases)e[t]=this[t]();return e}},h.assert=function(e,r,i,o){const a=o[0]instanceof Error||"string"==typeof o[0]?o[0]:null,l=null!==a?o[1]:o[0],c=r.validate(e,n.preferences({errors:{stack:!0}},l||{}));let u=c.error;if(!u)return c.value;if(a instanceof Error)throw a;const d=i&&"function"==typeof u.annotate?u.annotate():u.message;throw u instanceof s.ValidationError==!1&&(u=t(u)),u.message=a?`${a} ${d}`:d,u},h.generate=function(t,r,n){return e(t,"Must be invoked on a Joi instance."),r.$_root=t,r._definition.args&&n.length?r._definition.args(r,...n):r},h.expandExtension=function(e,t){if("string"==typeof e.type)return[e];const r=[];for(const n of t._types)if(e.type.test(n)){const i=Object.assign({},e);i.type=n,i.base=t[n](),r.push(i)}return r},lib$1=h.root()}var libExports$1=requireLib$1(),BaseJoi=getDefaultExportFromCjs(libExports$1),e$i={defaults:{collection:null,hidden:!1,singleton:!1,icon:null,note:null,translations:null,display_template:null,accountability:"all"},data:[{collection:"directus_access",icon:"admin_panel_settings",note:"$t:directus_collection.directus_access",display_template:"{{ policy.name }}",sort_field:"sort"},{collection:"directus_activity",note:"$t:directus_collection.directus_activity",accountability:null},{collection:"directus_collections",icon:"database",note:"$t:directus_collection.directus_collections"},{collection:"directus_comments",note:"$t:directus_collection.directus_comments"},{collection:"directus_fields",icon:"input",note:"$t:directus_collection.directus_fields"},{collection:"directus_files",icon:"folder",note:"$t:directus_collection.directus_files",display_template:"{{ $thumbnail }} {{ title }}"},{collection:"directus_folders",note:"$t:directus_collection.directus_folders",display_template:"{{ name }}"},{collection:"directus_migrations",note:"$t:directus_collection.directus_migrations"},{collection:"directus_permissions",icon:"admin_panel_settings",note:"$t:directus_collection.directus_permissions"},{collection:"directus_policies",icon:"admin_panel_settings",note:"$t:directus_collection.directus_policies"},{collection:"directus_presets",icon:"bookmark",note:"$t:directus_collection.directus_presets",accountability:null},{collection:"directus_relations",icon:"merge_type",note:"$t:directus_collection.directus_relations"},{collection:"directus_revisions",note:"$t:directus_collection.directus_revisions",accountability:null},{collection:"directus_roles",icon:"supervised_user_circle",note:"$t:directus_collection.directus_roles"},{collection:"directus_sessions",note:"$t:directus_collection.directus_sessions"},{collection:"directus_settings",singleton:!0,note:"$t:directus_collection.directus_settings"},{collection:"directus_users",archive_field:"status",archive_value:"archived",unarchive_value:"draft",icon:"people_alt",note:"$t:directus_collection.directus_users",display_template:"{{ first_name }} {{ last_name }}"},{collection:"directus_webhooks",note:"$t:directus_collection.directus_webhooks"},{collection:"directus_dashboards",note:"$t:directus_collection.directus_dashboards"},{collection:"directus_panels",note:"$t:directus_collection.directus_panels"},{collection:"directus_notifications",note:"$t:directus_collection.directus_notifications"},{collection:"directus_shares",icon:"share",note:"$t:directus_collection.directus_shares"},{collection:"directus_flows",note:"$t:directus_collection.directus_flows"},{collection:"directus_operations",note:"$t:directus_collection.directus_operations"},{collection:"directus_translations",note:"$t:directus_collection.directus_translations"},{collection:"directus_versions",note:"$t:directus_collection.directus_versions"},{collection:"directus_extensions",note:"$t:directus_collection.directus_extensions"}]};e$i.data.map(e=>({...e$i.defaults,...e,system:!0})),e$i.data.map(e=>e.collection);var i={defaults:{many_collection:"directus_users",many_field:null,one_collection:null,one_field:null,one_allowed_collections:null,one_collection_field:null,one_deselect_action:"nullify",junction_field:null,sort_field:null},data:[{many_collection:"directus_collections",many_field:"group",one_collection:"directus_collections"},{many_collection:"directus_comments",many_field:"collection",one_collection:"directus_collections"},{many_collection:"directus_comments",many_field:"user_created",one_collection:"directus_users"},{many_collection:"directus_comments",many_field:"user_updated",one_collection:"directus_users"},{many_collection:"directus_users",many_field:"role",one_collection:"directus_roles",one_field:"users"},{many_collection:"directus_users",many_field:"avatar",one_collection:"directus_files"},{many_collection:"directus_revisions",many_field:"activity",one_collection:"directus_activity",one_field:"revisions"},{many_collection:"directus_revisions",many_field:"parent",one_collection:"directus_revisions"},{many_collection:"directus_revisions",many_field:"version",one_collection:"directus_versions"},{many_collection:"directus_presets",many_field:"user",one_collection:"directus_users"},{many_collection:"directus_presets",many_field:"role",one_collection:"directus_roles"},{many_collection:"directus_folders",many_field:"parent",one_collection:"directus_folders"},{many_collection:"directus_files",many_field:"folder",one_collection:"directus_folders"},{many_collection:"directus_files",many_field:"uploaded_by",one_collection:"directus_users"},{many_collection:"directus_files",many_field:"modified_by",one_collection:"directus_users"},{many_collection:"directus_fields",many_field:"collection",one_collection:"directus_collections",one_field:"fields"},{many_collection:"directus_fields",many_field:"group",one_collection:"directus_fields"},{many_collection:"directus_activity",many_field:"user",one_collection:"directus_users"},{many_collection:"directus_settings",many_field:"project_logo",one_collection:"directus_files"},{many_collection:"directus_settings",many_field:"public_foreground",one_collection:"directus_files"},{many_collection:"directus_settings",many_field:"public_background",one_collection:"directus_files"},{many_collection:"directus_settings",many_field:"public_favicon",one_collection:"directus_files"},{many_collection:"directus_settings",many_field:"storage_default_folder",one_collection:"directus_folders"},{many_collection:"directus_settings",many_field:"public_registration_role",one_collection:"directus_roles"},{many_collection:"directus_panels",many_field:"dashboard",one_collection:"directus_dashboards",one_field:"panels"},{many_collection:"directus_panels",many_field:"user_created",one_collection:"directus_users"},{many_collection:"directus_flows",many_field:"operation",one_collection:"directus_operations"},{many_collection:"directus_flows",many_field:"user_created",one_collection:"directus_users"},{many_collection:"directus_operations",many_field:"flow",one_collection:"directus_flows",one_field:"operations",one_deselect_action:"delete"},{many_collection:"directus_operations",many_field:"resolve",one_collection:"directus_operations"},{many_collection:"directus_operations",many_field:"reject",one_collection:"directus_operations"},{many_collection:"directus_operations",many_field:"user_created",one_collection:"directus_users"},{many_collection:"directus_sessions",many_field:"user",one_collection:"directus_users"},{many_collection:"directus_sessions",many_field:"share",one_collection:"directus_shares"},{many_collection:"directus_dashboards",many_field:"user_created",one_collection:"directus_users"},{many_collection:"directus_notifications",many_field:"recipient",one_collection:"directus_users"},{many_collection:"directus_notifications",many_field:"sender",one_collection:"directus_users"},{many_collection:"directus_shares",many_field:"role",one_collection:"directus_roles"},{many_collection:"directus_shares",many_field:"collection",one_collection:"directus_collections"},{many_collection:"directus_shares",many_field:"user_created",one_collection:"directus_users"},{many_collection:"directus_versions",many_field:"collection",one_collection:"directus_collections"},{many_collection:"directus_versions",many_field:"user_created",one_collection:"directus_users"},{many_collection:"directus_versions",many_field:"user_updated",one_collection:"directus_users"},{many_collection:"directus_permissions",many_field:"policy",one_collection:"directus_policies",one_field:"permissions",one_deselect_action:"delete"},{many_collection:"directus_access",many_field:"policy",one_collection:"directus_policies",one_field:"roles",one_deselect_action:"delete",junction_field:"role"},{many_collection:"directus_access",many_field:"policy",one_collection:"directus_policies",one_field:"users",one_deselect_action:"delete",junction_field:"user"},{many_collection:"directus_access",many_field:"role",one_collection:"directus_roles",one_field:"policies",one_deselect_action:"delete",junction_field:"policy",sort_field:"sort"},{many_collection:"directus_access",many_field:"user",one_collection:"directus_users",one_field:"policies",one_deselect_action:"delete",junction_field:"policy",sort_field:"sort"},{many_collection:"directus_roles",many_field:"parent",one_collection:"directus_roles",one_field:"children"},{many_collection:"directus_webhooks",many_field:"migrated_flow",one_collection:"directus_flows"}]};i.data.map(e=>({...i.defaults,...e,system:!0}));var o={collection:null,field:null,special:null,interface:null,options:null,display:null,display_options:null,readonly:!1,hidden:!1,sort:null,width:"full",group:null,translations:null,note:null,conditions:null,required:!1},s={table:"directus_access",fields:[{field:"id",special:["uuid"],hidden:!0,width:"half"},{field:"role",hidden:!0,width:"half",special:["m2o"]},{field:"user",hidden:!0,width:"half",special:["m2o"]},{field:"policy",hidden:!0,width:"half",special:["m2o"]},{field:"sort",hidden:!0,width:"half"}]},c={table:"directus_activity",fields:[{field:"id",width:"half"},{field:"item",width:"half"},{field:"action",display:"labels",display_options:{choices:[{text:"$t:field_options.directus_activity.create",value:"create",foreground:"var(--theme--primary)",background:"var(--theme--primary-subdued)"},{text:"$t:field_options.directus_activity.update",value:"update",foreground:"var(--blue)",background:"var(--blue-25)"},{text:"$t:field_options.directus_activity.delete",value:"delete",foreground:"var(--theme--danger)",background:"var(--danger-25)"},{text:"$t:field_options.directus_activity.login",value:"login",foreground:"var(--purple)",background:"var(--purple-25)"}]},width:"half"},{field:"collection",display:"collection",display_options:{icon:!0},width:"half"},{field:"timestamp",display:"datetime",special:["date-created","cast-timestamp"],options:{relative:!0},width:"half"},{field:"user",display:"user",width:"half"},{field:"user_agent",display:"formatted-value",display_options:{font:"monospace"},width:"half"},{field:"origin",display:"formatted-value",display_options:{font:"monospace"},width:"half"},{field:"ip",display:"formatted-value",display_options:{font:"monospace"},width:"half"},{field:"revisions",interface:"list-o2m",special:["o2m"],options:{fields:["collection","item"]},width:"half"}]},l={table:"directus_collections",fields:[{field:"collection_divider",special:["alias","no-data"],interface:"presentation-divider",options:{icon:"box",title:"$t:field_options.directus_collections.collection_setup"},width:"full"},{field:"collection",interface:"input",options:{font:"monospace"},readonly:!0,width:"half"},{field:"note",interface:"input",options:{placeholder:"$t:field_options.directus_collections.note_placeholder"},width:"half"},{field:"icon",interface:"select-icon",options:null,width:"half"},{field:"color",interface:"select-color",options:{placeholder:"$t:interfaces.select-color.placeholder"},width:"half"},{field:"display_template",interface:"system-display-template",options:{collectionField:"collection"},width:"full"},{field:"hidden",special:["cast-boolean"],interface:"boolean",options:{label:"$t:field_options.directus_collections.hidden_label"},width:"half"},{field:"singleton",special:["cast-boolean"],interface:"boolean",options:{label:"$t:singleton_label"},width:"half"},{field:"translations",special:["cast-json"],interface:"list",options:{template:"{{ translation }} ({{ language }})",fields:[{field:"language",name:"$t:language",type:"string",schema:{default_value:"en-US"},meta:{interface:"system-language",width:"half",required:!0}},{field:"translation",name:"$t:field_options.directus_collections.collection_name",type:"string",meta:{interface:"input",width:"half",required:!0,options:{placeholder:"$t:field_options.directus_collections.translation_placeholder"}}},{field:"singular",name:"$t:field_options.directus_collections.singular_unit",type:"string",meta:{interface:"input",width:"half",options:{placeholder:"$t:field_options.directus_collections.translation_placeholder"}}},{field:"plural",name:"$t:field_options.directus_collections.plural_unit",type:"string",meta:{interface:"input",width:"half",options:{placeholder:"$t:field_options.directus_collections.translation_placeholder"}}}]},width:"full"},{field:"preview_divider",special:["alias","no-data"],interface:"presentation-divider",options:{icon:"preview",title:"$t:field_options.directus_collections.preview_divider"},width:"full"},{field:"preview_url",interface:"system-display-template",options:{collectionField:"collection",injectVersionField:!0},width:"full"},{field:"content_versioning_divider",special:["alias","no-data"],interface:"presentation-divider",options:{icon:"published_with_changes",title:"$t:field_options.directus_collections.content_versioning_divider"},width:"full"},{field:"versioning",interface:"boolean",special:["cast-boolean"],options:{label:"$t:field_options.directus_collections.enable_versioning"},width:"half"},{field:"archive_divider",special:["alias","no-data"],interface:"presentation-divider",options:{icon:"archive",title:"$t:field_options.directus_collections.archive_divider"},width:"full"},{field:"archive_field",interface:"system-field",options:{collectionField:"collection",allowNone:!0,placeholder:"$t:field_options.directus_collections.archive_field_placeholder"},width:"half"},{field:"archive_app_filter",interface:"boolean",special:["cast-boolean"],options:{label:"$t:field_options.directus_collections.archive_app_filter"},width:"half"},{field:"archive_value",interface:"input",options:{font:"monospace",iconRight:"archive",placeholder:"$t:field_options.directus_collections.archive_value"},width:"half"},{field:"unarchive_value",interface:"input",options:{font:"monospace",iconRight:"unarchive",placeholder:"$t:field_options.directus_collections.unarchive_value"},width:"half"},{field:"sort_divider",special:["alias","no-data"],interface:"presentation-divider",options:{icon:"sort",title:"$t:field_options.directus_collections.sort_divider"},width:"full"},{field:"sort_field",interface:"system-field",options:{collectionField:"collection",placeholder:"$t:field_options.directus_collections.sort_field",typeAllowList:["float","decimal","integer"],allowNone:!0,allowPrimaryKey:!1,allowForeignKeys:!1},width:"half"},{field:"accountability_divider",special:["alias","no-data"],interface:"presentation-divider",options:{icon:"admin_panel_settings",title:"$t:field_options.directus_collections.accountability_divider"},width:"full"},{field:"accountability",interface:"select-dropdown",options:{choices:[{text:"$t:field_options.directus_collections.track_activity_revisions",value:"all"},{text:"$t:field_options.directus_collections.only_track_activity",value:"activity"},{text:"$t:field_options.directus_collections.do_not_track_anything",value:null}]},width:"half"},{field:"duplication_divider",special:["alias","no-data"],interface:"presentation-divider",options:{icon:"content_copy",title:"$t:field_options.directus_collections.duplication_divider"}},{field:"item_duplication_fields",special:["cast-json"],interface:"system-field-tree",options:{collectionField:"collection"}},{field:"sort",hidden:!0},{field:"group",hidden:!0},{field:"collapse",hidden:!0}]},u={table:"directus_comments",fields:[{field:"id",special:["uuid"],readonly:!0,hidden:!0},{field:"collection"},{field:"item"},{field:"comment"},{field:"date_created",special:["date-created","cast-timestamp"]},{field:"date_updated",special:["date-updated","cast-timestamp"]},{field:"user_created",special:["user-created"]},{field:"user_updated",special:["user-updated"]}]},d={table:"directus_dashboards",fields:[{field:"id",special:["uuid"]},{field:"name"},{field:"icon"},{field:"panels",special:["o2m"]},{field:"date_created",special:["date-created","cast-timestamp"]},{field:"user_created",special:["user-created"]},{field:"note"},{field:"color"}]},f={table:"directus_extensions",fields:[{collection:"directus_extensions",field:"id",special:["uuid"]},{collection:"directus_extensions",field:"folder"},{collection:"directus_extensions",field:"source"},{collection:"directus_extensions",field:"bundle"},{collection:"directus_extensions",field:"enabled",special:["cast-boolean"]}]},p={table:"directus_fields",fields:[{collection:"directus_fields",field:"id",width:"half"},{collection:"directus_fields",field:"collection",width:"half"},{collection:"directus_fields",field:"field",width:"half"},{collection:"directus_fields",field:"special",hidden:!0,special:["cast-csv"],width:"half"},{collection:"directus_fields",field:"interface",width:"half"},{collection:"directus_fields",field:"options",hidden:!0,special:["cast-json"],width:"half"},{collection:"directus_fields",field:"display",width:"half"},{collection:"directus_fields",field:"display_options",hidden:!0,special:["cast-json"],width:"half"},{collection:"directus_fields",field:"readonly",hidden:!0,special:["cast-boolean"],width:"half"},{collection:"directus_fields",field:"hidden",hidden:!0,special:["cast-boolean"],width:"half"},{collection:"directus_fields",field:"required",hidden:!0,special:["cast-boolean"],width:"half"},{collection:"directus_fields",field:"sort",width:"half"},{collection:"directus_fields",field:"width",width:"half"},{collection:"directus_fields",field:"group",width:"half"},{collection:"directus_fields",field:"translations",hidden:!0,special:["cast-json"],width:"half"},{collection:"directus_fields",field:"note",width:"half"},{collection:"directus_fields",field:"conditions",hidden:!0,special:["cast-json"]},{collection:"directus_fields",field:"validation",hidden:!0,special:["cast-json"]},{collection:"directus_fields",field:"validation_message",hidden:!0}]},m={table:"directus_files",fields:[{field:"id",hidden:!0,interface:"input",special:["uuid"]},{field:"title",interface:"input",options:{iconRight:"title",placeholder:"$t:field_options.directus_files.title"},width:"full"},{field:"description",interface:"input-multiline",width:"full",options:{placeholder:"$t:field_options.directus_files.description"}},{field:"tags",interface:"tags",options:{iconRight:"local_offer"},special:["cast-json"],width:"full",display:"labels",display_options:{choices:null,format:!1}},{field:"location",interface:"input",options:{iconRight:"place",placeholder:"$t:field_options.directus_files.location"},width:"half"},{field:"storage",interface:"input",options:{iconRight:"storage"},width:"half",readonly:!0},{field:"focal_point_divider",interface:"presentation-divider",options:{icon:"image_search",title:"$t:field_options.directus_files.focal_point_divider"},special:["alias","no-data"],width:"full"},{field:"focal_point_x",width:"half"},{field:"focal_point_y",width:"half"},{field:"storage_divider",interface:"presentation-divider",options:{icon:"insert_drive_file",title:"$t:field_options.directus_files.storage_divider"},special:["alias","no-data"],width:"full"},{field:"filename_disk",interface:"input",options:{iconRight:"publish",placeholder:"$t:field_options.directus_files.filename_disk"},readonly:!0,width:"half"},{field:"filename_download",interface:"input",options:{iconRight:"get_app",placeholder:"$t:field_options.directus_files.filename_download"},width:"half"},{field:"metadata",hidden:!0,special:["cast-json"]},{field:"type",display:"mime-type",readonly:!0},{field:"filesize",display:"filesize",readonly:!0},{field:"created_on",interface:"datetime",display:"datetime",width:"half",special:["date-created"],readonly:!0},{field:"modified_by",interface:"select-dropdown-m2o",special:["user-updated"],width:"half",display:"user",readonly:!0,options:{template:"{{avatar.$thumbnail}} {{first_name}} {{last_name}}"}},{field:"modified_on",interface:"datetime",special:["date-created","date-updated"],width:"half",display:"datetime",readonly:!0},{field:"embed",width:"half",hidden:!0},{field:"uploaded_by",display:"user",width:"half",hidden:!0,special:["user-created"]},{field:"uploaded_on",display:"datetime",width:"half",hidden:!0},{field:"folder",width:"half",readonly:!0,special:["m2o"],display:"related-values",display_options:{template:"{{ name }}"}},{field:"width",width:"half",readonly:!0},{field:"height",width:"half",readonly:!0},{field:"charset",width:"half",readonly:!0},{field:"duration",width:"half",readonly:!0},{field:"tus_id",width:"half",hidden:!0},{field:"tus_data",width:"half",hidden:!0,special:["cast-json"]}]},h={table:"directus_flows",fields:[{field:"id",special:["uuid"]},{field:"name"},{field:"icon"},{field:"color"},{field:"description"},{field:"status"},{field:"trigger"},{field:"accountability"},{field:"options",special:["cast-json"]},{field:"operation"},{field:"operations",special:["o2m"]},{field:"date_created",special:["date-created"]},{field:"user_created",special:["user-created"]}]},g={table:"directus_folders",fields:[{field:"id",interface:"input",special:["uuid"],width:"half"},{field:"parent",width:"half"},{field:"name",width:"full"}]},_={table:"directus_migrations",fields:[{collection:"directus_migrations",field:"version"},{collection:"directus_migrations",field:"name"},{collection:"directus_migrations",field:"timestamp"}]},v={table:"directus_notifications",fields:[{field:"id"},{field:"timestamp",special:["date-created","cast-timestamp"]},{field:"status"},{field:"recipient"},{field:"sender"},{field:"subject"},{field:"message"},{field:"collection"},{field:"item"}]},y={table:"directus_operations",fields:[{field:"id",special:["uuid"]},{field:"name"},{field:"key"},{field:"type"},{field:"position_x"},{field:"position_y"},{field:"options",special:["cast-json"]},{field:"resolve"},{field:"reject"},{field:"flow"},{field:"date_created",special:["date-created"]},{field:"user_created",special:["user-created"]}]},b={table:"directus_panels",fields:[{field:"id",special:["uuid"]},{field:"name"},{field:"icon"},{field:"color"},{field:"note"},{field:"type"},{field:"show_header",special:["cast-boolean"]},{field:"position_x"},{field:"position_y"},{field:"width"},{field:"height"},{field:"options",special:["cast-json"]},{field:"date_created",special:["date-created","cast-timestamp"]},{field:"user_created",special:["user-created"]},{field:"dashboard"}]},x={table:"directus_permissions",fields:[{field:"permissions",hidden:!0,special:["cast-json"],width:"half"},{field:"presets",hidden:!0,special:["cast-json"],width:"half"},{field:"policy",hidden:!0,interface:"select-dropdown-m2o",width:"half",special:["m2o"]},{field:"collection",width:"half"},{field:"id",width:"half"},{field:"fields",width:"half",special:["cast-csv"]},{field:"action",width:"half"},{field:"validation",width:"half",special:["cast-json"]}]},S={table:"directus_policies",fields:[{field:"id",hidden:!0,special:["uuid"]},{field:"name",required:!0,width:"half",display:"formatted-value",display_options:{translate:!0}},{field:"icon",interface:"select-icon",display:"icon",width:"half"},{field:"description",interface:"input",options:{placeholder:"$t:field_options.directus_policies.description"},width:"full",display:"formatted-value",display_options:{translate:!0}},{field:"permissions",interface:"system-permissions",special:["o2m"]},{field:"app_access",interface:"boolean",special:["cast-boolean"],width:"half"},{field:"admin_access",interface:"boolean",special:["cast-boolean"],width:"half"},{field:"ip_access",interface:"tags",options:{placeholder:"$t:field_options.directus_policies.ip_access"},special:["cast-csv"],width:"full"},{field:"enforce_tfa",note:"$t:field_options.directus_policies.enforce_tfa",interface:"boolean",special:["cast-boolean"],width:"half"},{field:"assigned_to_divider",interface:"presentation-divider",options:{title:"$t:field_options.directus_policies.assigned_to"},special:["alias","no-data"],width:"full"},{field:"users",interface:"list-m2m",options:{template:"{{ user.first_name }} {{ user.last_name }}",junctionFilter:{user:{_nnull:!0}}},special:["m2m"]},{field:"roles",interface:"list-m2m",options:{template:"{{ role.name }}",junctionFilter:{role:{_nnull:!0}}},special:["m2m"]}]},C={table:"directus_presets",fields:[{field:"filter",hidden:!0,special:["cast-json"]},{field:"layout_query",hidden:!0,special:["cast-json"]},{field:"layout_options",hidden:!0,special:["cast-json"]},{field:"role",width:"half",special:["m2o"],display:"related-values",display_options:{template:"{{ name }}"}},{field:"user",width:"half",special:["m2o"],display:"related-values",display_options:{template:"{{ email }}"}},{field:"id",width:"half"},{field:"bookmark",width:"half"},{field:"icon",width:"half",display:"icon"},{field:"color",width:"half",display:"color"},{field:"search",width:"half"},{field:"collection",width:"half"},{field:"layout",width:"half"},{field:"refresh_interval"}]},w={table:"directus_relations",fields:[{field:"id",width:"half"},{field:"many_collection",width:"half"},{field:"many_field",width:"half"},{field:"one_collection",width:"half"},{field:"one_field",width:"half"},{field:"one_collection_field",width:"half"},{field:"one_allowed_collections",special:["cast-csv"],width:"half"},{field:"junction_field",width:"half"},{field:"sort_field",width:"half"},{field:"one_deselect_action",width:"half"}]},T={table:"directus_revisions",fields:[{field:"id",width:"half"},{field:"activity",width:"half"},{field:"collection",width:"half"},{field:"item",width:"half"},{field:"data",hidden:!0,special:["cast-json"]},{field:"delta",hidden:!0,special:["cast-json"]},{field:"parent",width:"half"},{field:"version",width:"half"}]},E={table:"directus_roles",fields:[{field:"id",hidden:!0,interface:"input",special:["uuid"]},{field:"name",required:!0,interface:"input",options:{placeholder:"$t:field_options.directus_roles.name"},width:"half",display:"formatted-value",display_options:{translate:!0}},{field:"icon",interface:"select-icon",display:"icon",width:"half"},{field:"description",interface:"input",options:{placeholder:"$t:field_options.directus_roles.description"},width:"full",display:"formatted-value",display_options:{translate:!0}},{field:"parent",interface:"select-dropdown-m2o",note:"$t:field_options.directus_roles.parent_note",options:{template:"{{ name }}",filter:{id:{_neq:"{{ id }}"}}},special:["m2o"],width:"half",display:"related-values",display_options:{template:"{{ name }}"}},{field:"children",hidden:!0,interface:"list-o2m-tree-view",note:"$t:field_options.directus_roles.children_note",special:["o2m"],options:{displayTemplate:"{{ name }}",enableCreate:!1,fields:["name"],filter:{id:{_neq:"{{ id }}"}}},display:"related-values",display_options:{template:"{{ name }}"},width:"full"},{field:"policies",interface:"list-m2m",options:{layout:"list"},display:"related-values",special:["m2m"],width:"full"},{field:"users_group",interface:"group-raw",special:["alias","no-data","group"]},{field:"users_divider",interface:"presentation-divider",options:{icon:"people_alt",title:"$t:users"},special:["alias","no-data"],width:"full",group:"users_group"},{field:"users",interface:"list-o2m",special:["o2m"],options:{fields:["first_name","last_name"]},width:"full",group:"users_group"}]},D={table:"directus_sessions",fields:[{field:"token",width:"half"},{field:"user",width:"half"},{field:"expires",width:"half"},{field:"ip",width:"half"},{field:"user_agent",width:"half"},{field:"origin",width:"half"},{field:"share",width:"half"},{field:"next_token",width:"half"}]},O={table:"directus_settings",fields:[{field:"id",hidden:!0},{field:"project_name",interface:"input",options:{iconRight:"title",placeholder:"$t:field_options.directus_settings.project_name_placeholder"},width:"half"},{field:"project_descriptor",interface:"input",options:{iconRight:"title",placeholder:"$t:field_options.directus_settings.project_name_placeholder"},width:"half"},{field:"project_url",interface:"input",options:{iconRight:"link",placeholder:"https://example.com"},width:"half"},{field:"default_language",interface:"system-language",options:{iconRight:"language",placeholder:"en-US"},width:"half"},{field:"modules_divider",interface:"presentation-divider",options:{icon:"menu_open",title:"$t:modules"},special:["alias","no-data"],width:"full"},{field:"module_bar",interface:"system-modules",special:["cast-json"]},{field:"visual_editor_divider",interface:"presentation-divider",options:{icon:"edit_square",title:"$t:visual_editor"},special:["alias","no-data"],width:"full"},{field:"visual_editor_urls",interface:"list",special:["cast-json"],options:{template:"{{url}}",fields:[{field:"url",name:"$t:url",schema:{is_nullable:!1},meta:{interface:"text-input",required:!0,options:{iconRight:"link",placeholder:"https://example.com"}}}]}},{field:"security_divider",interface:"presentation-divider",options:{icon:"shield",title:"$t:security"},special:["alias","no-data"],width:"full"},{field:"auth_password_policy",interface:"select-dropdown",options:{choices:[{value:null,text:"$t:field_options.directus_settings.auth_password_policy.none_text"},{value:"/^.{8,}$/",text:"$t:field_options.directus_settings.auth_password_policy.weak_text"},{value:"/(?=^.{8,}$)(?=.*\\d)(?=.*[a-z])(?=.*[A-Z])(?=.*[!@#$%^&*()_+}{';'?>.<,])(?!.*\\s).*$/",text:"$t:field_options.directus_settings.auth_password_policy.strong_text"}],allowOther:!0},width:"half"},{field:"auth_login_attempts",interface:"input",options:{iconRight:"lock",placeholder:"$t:unlimited"},width:"half"},{field:"public_registration_divider",interface:"presentation-divider",options:{icon:"person_add",title:"$t:fields.directus_settings.public_registration"},special:["alias","no-data"],width:"full"},{field:"public_registration",interface:"boolean",note:"$t:fields.directus_settings.public_registration_note",width:"half",options:{label:"$t:enabled"},special:["cast-boolean"]},{field:"public_registration_role",interface:"select-dropdown-m2o",note:"$t:fields.directus_settings.public_registration_role_note",options:{template:"{{ name }}"},special:["m2o"],width:"half",display:"related-values",display_options:{template:"{{ name }}"}},{field:"public_registration_verify_email",interface:"boolean",note:"$t:fields.directus_settings.public_registration_verify_email_note",width:"half",options:{label:"$t:enabled"},special:["cast-boolean"]},{field:"public_registration_email_filter",interface:"system-filter",note:"$t:fields.directus_settings.public_registration_email_filter_note",options:{collectionName:"directus_users",collectionField:"email",fieldName:"email"},special:["cast-json"],width:"half"},{field:"files_divider",interface:"presentation-divider",options:{icon:"folder",title:"$t:fields.directus_settings.files_and_thumbnails"},special:["alias","no-data"],width:"full"},{field:"storage_asset_transform",interface:"select-dropdown",options:{choices:[{value:"all",text:"$t:fields.directus_settings.transformations_all"},{value:"none",text:"$t:fields.directus_settings.transformations_none"},{value:"presets",text:"$t:fields.directus_settings.transformations_presets"}]},width:"half"},{field:"storage_default_folder",interface:"system-folder",width:"half",note:"$t:interfaces.system-folder.field_hint"},{field:"storage_asset_presets",interface:"list",options:{fields:[{field:"key",name:"$t:key",type:"string",schema:{is_nullable:!1},meta:{interface:"input",options:{slug:!0,onlyOnCreate:!1},width:"full",required:!0}},{field:"fit",name:"$t:field_options.directus_settings.storage_asset_presets.fit_label",type:"string",schema:{is_nullable:!1},meta:{interface:"select-dropdown",options:{choices:[{value:"contain",text:"$t:field_options.directus_settings.storage_asset_presets.fit.contain_text"},{value:"cover",text:"$t:field_options.directus_settings.storage_asset_presets.fit.cover_text"},{value:"inside",text:"$t:field_options.directus_settings.storage_asset_presets.fit.fit_text"},{value:"outside",text:"$t:field_options.directus_settings.storage_asset_presets.fit.outside_text"}]},width:"half"}},{field:"width",name:"$t:width",type:"integer",schema:{is_nullable:!1},meta:{interface:"input",width:"half"}},{field:"height",name:"$t:height",type:"integer",schema:{is_nullable:!1},meta:{interface:"input",width:"half"}},{field:"quality",type:"integer",name:"$t:quality",schema:{default_value:80,is_nullable:!1},meta:{interface:"slider",options:{max:100,min:0,step:1},width:"half"}},{field:"withoutEnlargement",name:"$t:field_options.directus_settings.storage_asset_presets.upscaling",type:"boolean",schema:{default_value:!1},meta:{interface:"boolean",width:"half",options:{label:"$t:no_upscale"}}},{field:"format",name:"$t:format",type:"string",schema:{is_nullable:!1,default_value:""},meta:{interface:"select-dropdown",options:{allowNone:!0,choices:[{value:"auto",text:"Auto"},{value:"jpeg",text:"JPEG"},{value:"png",text:"PNG"},{value:"webp",text:"WebP"},{value:"tiff",text:"Tiff"},{value:"avif",text:"AVIF"}]},width:"half"}},{field:"transforms",name:"$t:field_options.directus_settings.additional_transforms",type:"json",schema:{is_nullable:!1,default_value:[]},meta:{note:"$t:field_options.directus_settings.transforms_note",interface:"json",options:{template:'[\n  ["blur", 45],\n  ["grayscale"],\n  ["extend", { "right": 500, "background": "rgb(255, 0, 0)" }]\n]\n',placeholder:'[\n  ["blur", 45],\n  ["grayscale"],\n  ["extend", { "right": 500, "background": "rgb(255, 0, 0)" }]\n]\n'},width:"full"}}],template:"{{key}}"},special:["cast-json"],width:"full"},{field:"reporting_divider",interface:"presentation-divider",options:{icon:"feedback",title:"$t:fields.directus_settings.reporting"},special:["alias","no-data"],width:"full"},{field:"report_feature_url",interface:"input",options:{iconRight:"link",placeholder:"https://example.com/feature"},width:"half"},{field:"report_bug_url",interface:"input",options:{iconRight:"link",placeholder:"https://example.com/bug"},width:"half"},{field:"report_error_url",interface:"system-display-template",options:{placeholder:"https://example.com/error",fields:[{name:"Error",field:"error",key:"error",path:"error",children:[{name:"Name",field:"name",key:"error.name",path:"error.name"},{name:"Message",field:"message",key:"error.message",path:"error.message"}]},{name:"Navigator",field:"navigator",key:"navigator",path:"navigator",children:[{name:"Language",field:"language",key:"navigator.language",path:"navigator.language"},{name:"User Agent",field:"userAgent",key:"navigator.userAgent",path:"navigator.userAgent"}]},{name:"Route",field:"route",key:"route",path:"route",children:[{name:"Full Path",field:"fullPath",key:"route.fullPath",path:"route.fullPath"},{name:"Hash",field:"hash",key:"route.hash",path:"route.hash"},{name:"Name",field:"name",key:"route.name",path:"route.name"},{name:"Path",field:"path",key:"route.path",path:"route.path"},{name:"Query",field:"query",key:"route.query",path:"route.query"}]},{name:"User",field:"user",key:"user",path:"user",children:[{name:"ID",field:"id",key:"user.id",path:"user.id"},{name:"First Name",field:"first_name",key:"user.first_name",path:"user.first_name"},{name:"Last Name",field:"last_name",key:"user.last_name",path:"user.last_name"},{name:"Status",field:"status",key:"user.status",path:"user.status"},{name:"Title",field:"title",key:"user.title",path:"user.title"},{name:"Description",field:"description",key:"user.description",path:"user.description"},{name:"Location",field:"location",key:"user.location",path:"user.location"}]},{name:"Role",field:"role",key:"role",path:"role",children:[{name:"ID",field:"id",key:"role.id",path:"role.id"},{name:"Name",field:"name",key:"role.name",path:"role.name"}]}]},width:"full"},{field:"map_divider",interface:"presentation-divider",options:{icon:"map",title:"$t:fields.directus_settings.mapping"},special:["alias","no-data"],width:"full"},{field:"mapbox_key",interface:"input",options:{icon:"key",title:"$t:field_options.directus_settings.mapbox_key",placeholder:"$t:field_options.directus_settings.mapbox_placeholder",iconLeft:"vpn_key",font:"monospace"},width:"full"},{field:"basemaps",interface:"list",special:["cast-json"],options:{template:"{{name}}",fields:[{field:"name",name:"$t:name",schema:{is_nullable:!1},meta:{interface:"text-input",required:!0,options:{placeholder:"$t:field_options.directus_settings.basemaps_name_placeholder"}}},{field:"type",name:"$t:type",meta:{interface:"select-dropdown",options:{choices:[{value:"raster",text:"$t:field_options.directus_settings.basemaps_raster"},{value:"tile",text:"$t:field_options.directus_settings.basemaps_tile"},{value:"style",text:"$t:field_options.directus_settings.basemaps_style"}]}}},{field:"url",name:"$t:url",schema:{is_nullable:!1},meta:{interface:"text-input",options:{placeholder:"http://{a-c}.tile.openstreetmap.org/{z}/{x}/{y}.png"}}},{field:"tileSize",name:"$t:tile_size",type:"integer",schema:{is_nullable:!0},meta:{interface:"input",options:{placeholder:"512"},conditions:[{name:"typeNeqRaster",rule:{type:{_neq:"raster"}},hidden:!0}]}},{field:"attribution",name:"$t:fields.directus_settings.attribution",type:"string",schema:{is_nullable:!0},meta:{interface:"input",options:{placeholder:"$t:fields.directus_settings.attribution_placeholder"}}}]}},{field:"image_editor",interface:"presentation-divider",options:{icon:"image",title:"$t:fields.directus_settings.image_editor"},special:["alias","no-data"],width:"full"},{field:"custom_aspect_ratios",interface:"list",special:["cast-json"],options:{template:"{{text}}",fields:[{field:"text",name:"$t:text",type:"string",meta:{interface:"text-input",width:"half",required:!0,options:{placeholder:"$t:text"}}},{field:"value",name:"$t:value",type:"float",meta:{interface:"input",width:"half",required:!0,options:{placeholder:"$t:value"}}}]}},{field:"project_id",hidden:!0},{field:"accepted_terms",interface:"boolean",width:"half",hidden:!0,options:{label:"$t:accepted"},special:["cast-boolean"]},{field:"theming_group",interface:"group-raw",special:["alias","no-data","group"]},{field:"branding_divider",interface:"presentation-divider",options:{icon:"palette",title:"$t:fields.directus_settings.branding"},special:["alias","no-data"],width:"full",group:"theming_group"},{field:"project_color",interface:"select-color",note:"$t:field_options.directus_settings.project_color_note",width:"half",group:"theming_group"},{field:"project_logo",interface:"file",note:"$t:field_options.directus_settings.project_logo_note",width:"half",group:"theming_group"},{field:"public_foreground",interface:"file",width:"half",group:"theming_group"},{field:"public_background",interface:"file",width:"half",group:"theming_group"},{field:"public_favicon",interface:"file",note:"$t:field_options.directus_settings.project_favicon_note",width:"half",group:"theming_group"},{field:"public_note",interface:"input",options:{placeholder:"$t:field_options.directus_settings.public_note_placeholder",iconRight:"info"},width:"half",group:"theming_group"},{field:"theming_divider",interface:"presentation-divider",options:{icon:"palette",title:"$t:fields.directus_settings.theming"},special:["alias","no-data"],width:"full",group:"theming_group"},{field:"default_appearance",interface:"select-dropdown",width:"half",options:{choices:[{value:"auto",text:"$t:appearance_auto"},{value:"light",text:"$t:appearance_light"},{value:"dark",text:"$t:appearance_dark"}]},group:"theming_group"},{field:"default_theme_light",width:"full",interface:"system-theme",options:{appearance:"light"},group:"theming_group"},{field:"theme_light_overrides",width:"full",interface:"system-theme-overrides",options:{appearance:"light"},group:"theming_group",special:["cast-json"]},{field:"default_theme_dark",width:"full",interface:"system-theme",options:{appearance:"dark"},group:"theming_group"},{field:"theme_dark_overrides",width:"full",interface:"system-theme-overrides",options:{appearance:"dark"},group:"theming_group",special:["cast-json"]},{field:"custom_css",interface:"input-code",options:{language:"css",lineNumber:!0,template:"#app, #main-content, body {\n  --v-button-background-color: #6644FF !important;\n  --v-button-background-color-hover: #5E41EC !important;\n}\n"},width:"full",group:"theming_group"},{field:"ai_group",interface:"group-raw",special:["alias","no-data","group"]},{field:"mcp_divider",interface:"presentation-divider",options:{icon:"automation",title:"$t:model_context_protocol"},special:["alias","no-data"],width:"full",group:"ai_group"},{field:"mcp_notice",interface:"presentation-notice",options:{icon:"info",text:"$t:fields.directus_settings.mcp_notice"},special:["alias","no-data"],width:"full",group:"ai_group"},{field:"mcp_enabled",interface:"boolean",group:"ai_group",special:["cast-boolean"],note:"$t:fields.directus_settings.mcp_enabled_note",width:"half",options:{label:"$t:enabled"}},{field:"mcp_allow_deletes",interface:"boolean",group:"ai_group",special:["cast-boolean"],note:"$t:fields.directus_settings.mcp_allow_deletes_note",width:"half",options:{label:"$t:fields.directus_settings.mcp_allow_deletes"},conditions:[{name:"mcp_enabled",rule:{mcp_enabled:{_neq:!0}},readonly:!0}]},{field:"mcp_prompts_collection",interface:"system-collection",group:"ai_group",width:"half",note:"$t:fields.directus_settings.mcp_prompts_collection_note",options:{label:"$t:fields.directus_settings.mcp_prompts_collection",includeSingleton:!1,allowNone:!0},conditions:[{name:"mcp_enabled",rule:{mcp_enabled:{_neq:!0}},readonly:!0}]},{field:"mcp_prompts_collection_validation",interface:"system-mcp-prompts-collection-validation",group:"ai_group",width:"half",special:["alias","no-data"],conditions:[{name:"mcp_enabled",rule:{mcp_enabled:{_neq:!0}},hidden:!0}]},{field:"mcp_system_prompt_divider",interface:"presentation-divider",options:{inlineTitle:!0,color:"var(--theme--foreground-subdued)",title:"$t:fields.directus_settings.mcp_system_prompt_divider"},special:["alias","no-data"],width:"full",group:"ai_group"},{field:"mcp_system_prompt_enabled",interface:"boolean",group:"ai_group",special:["cast-boolean"],width:"half-left",note:"$t:fields.directus_settings.mcp_system_prompt_enabled_note",options:{label:"$t:enabled"},conditions:[{name:"mcp_enabled",rule:{mcp_enabled:{_neq:!0}},readonly:!0}]},{field:"mcp_system_prompt",interface:"input-rich-text-md",group:"ai_group",width:"full",note:"$t:fields.directus_settings.mcp_system_prompt_note",options:{label:"$t:fields.directus_settings.mcp_system_prompt"},conditions:[{name:"mcp_enabled",rule:{mcp_enabled:{_neq:!0}},readonly:!0},{name:"mcp_system_prompt_enabled",rule:{mcp_system_prompt_enabled:{_neq:!0}},readonly:!0}]}]},k={table:"directus_shares",fields:[{field:"id",special:["uuid"],readonly:!0,hidden:!0},{field:"name"},{field:"collection",width:"half",hidden:!0},{field:"item",width:"half",hidden:!0},{field:"role",interface:"select-dropdown-m2o",width:"half",options:{template:"{{name}}"}},{field:"password",special:["hash","conceal"],interface:"input-hash",options:{iconRight:"lock",masked:!0},width:"half",note:"$t:shared_leave_blank_for_passwordless_access"},{field:"date_start",width:"half",note:"$t:shared_leave_blank_for_unlimited"},{field:"date_end",width:"half",note:"$t:shared_leave_blank_for_unlimited"},{field:"max_uses",width:"half",note:"$t:shared_leave_blank_for_unlimited"},{field:"times_used",width:"half",readonly:!0},{field:"date_created",special:["date-created","cast-timestamp"],width:"half",readonly:!0,conditions:[{name:"notCreatedYet",rule:{id:{_null:!0}},hidden:!0}]},{field:"user_created",special:["user-created"],interface:"select-dropdown-m2o",width:"half",display:"user",options:{template:"{{avatar.$thumbnail}} {{first_name}} {{last_name}}"},readonly:!0,conditions:[{name:"notCreatedYet",rule:{id:{_null:!0}},hidden:!0}]}]},A={table:"directus_translations",fields:[{field:"id",hidden:!0,sort:1,special:["uuid"]},{field:"key",width:"half",sort:2,required:!0,interface:"input",options:{font:"monospace",placeholder:"$t:translation_key_placeholder"}},{field:"language",interface:"system-language",width:"half",sort:3,required:!0},{field:"value",interface:"input-multiline",sort:4,required:!0,options:{placeholder:"$t:enter_a_value"}}]},j={table:"directus_users",fields:[{field:"first_name",interface:"input",options:{iconRight:"account_circle"},width:"half"},{field:"last_name",interface:"input",options:{iconRight:"account_circle"},width:"half"},{field:"email",interface:"input",options:{iconRight:"email"},width:"half"},{field:"password",special:["hash","conceal"],interface:"input-hash",options:{iconRight:"lock",masked:!0},width:"half"},{field:"avatar",interface:"file",width:"full",display:"image"},{field:"location",interface:"input",options:{iconRight:"place"},width:"half"},{field:"title",interface:"input",options:{iconRight:"work"},width:"half"},{field:"description",interface:"input-multiline",width:"full"},{field:"tags",interface:"tags",special:["cast-json"],width:"full",options:{iconRight:"local_offer"},display:"labels",display_options:{choices:null,format:!1}},{field:"preferences_divider",interface:"presentation-divider",options:{icon:"face",title:"$t:fields.directus_users.user_preferences"},special:["alias","no-data"],width:"full"},{field:"language",interface:"system-language",width:"half",options:{includeProjectDefault:!0}},{field:"text_direction",interface:"select-dropdown",options:{choices:[{value:"auto",text:"$t:text_direction_auto"},{value:"ltr",text:"$t:text_direction_ltr"},{value:"rtl",text:"$t:text_direction_rtl"}]},width:"half"},{field:"tfa_secret",interface:"system-mfa-setup",special:["conceal"],width:"half"},{field:"email_notifications",interface:"boolean",width:"half",special:["cast-boolean"]},{field:"theming_divider",interface:"presentation-divider",options:{icon:"palette",title:"$t:theme"},special:["alias","no-data"],width:"full"},{field:"appearance",interface:"select-dropdown",options:{choices:[{value:null,text:"$t:default_sync_with_project"},{value:"auto",text:"$t:appearance_auto"},{value:"light",text:"$t:appearance_light"},{value:"dark",text:"$t:appearance_dark"}]},width:"half"},{field:"theme_light",width:"full",interface:"system-theme",options:{appearance:"light",includeNull:!0}},{field:"theme_light_overrides",width:"full",interface:"system-theme-overrides",options:{appearance:"light"},special:["cast-json"]},{field:"theme_dark",width:"full",interface:"system-theme",options:{appearance:"dark",includeNull:!0}},{field:"theme_dark_overrides",width:"full",interface:"system-theme-overrides",options:{appearance:"dark"},special:["cast-json"]},{field:"admin_divider",interface:"presentation-divider",options:{icon:"verified_user",title:"$t:fields.directus_users.admin_options",color:"var(--theme--danger)"},special:["alias","no-data"],width:"full"},{field:"status",interface:"select-dropdown",options:{choices:[{text:"$t:fields.directus_users.status_draft",value:"draft"},{text:"$t:fields.directus_users.status_invited",value:"invited"},{text:"$t:fields.directus_users.status_unverified",value:"unverified"},{text:"$t:fields.directus_users.status_active",value:"active"},{text:"$t:fields.directus_users.status_suspended",value:"suspended"},{text:"$t:fields.directus_users.status_archived",value:"archived"}]},width:"half"},{field:"role",interface:"select-dropdown-m2o",options:{template:"{{ name }}"},special:["m2o"],width:"half",display:"related-values",display_options:{template:"{{ name }}"}},{field:"policies",interface:"list-m2m",options:{layout:"list"},display:"related-values",special:["m2m"],width:"full"},{field:"token",interface:"system-token",special:["conceal"],width:"full"},{field:"id",special:["uuid"],interface:"input",options:{iconRight:"vpn_key"},width:"full"},{field:"last_page",width:"half"},{field:"last_access",width:"half",display:"datetime",readonly:!0,display_options:{relative:!0}},{field:"provider",width:"half",interface:"select-dropdown",options:{choices:[{text:"$t:default_provider",value:"default"}]}},{field:"external_identifier",width:"half",options:{iconRight:"account_circle"},interface:"input"},{field:"auth_data",hidden:!0}]},M={table:"directus_versions",fields:[{field:"id",special:["uuid"],readonly:!0,hidden:!0},{field:"key"},{field:"name"},{field:"collection"},{field:"item"},{field:"hash",readonly:!0,hidden:!0},{field:"date_created",special:["date-created","cast-timestamp"]},{field:"date_updated",special:["date-updated","cast-timestamp"]},{field:"user_created",special:["user-created"]},{field:"user_updated",special:["user-updated"]},{field:"delta",special:["cast-json"]}]},N={table:"directus_webhooks",fields:[{field:"id",hidden:!0},{field:"name",interface:"input",options:{iconRight:"title"},width:"full"},{field:"method",interface:"select-dropdown",display:"labels",display_options:{choices:[{value:"POST",foreground:"var(--theme--primary)",background:"var(--theme--primary-subdued)"},{value:"GET",foreground:"var(--theme--secondary)",background:"var(--secondary-25)"}],format:!1},options:{choices:["GET","POST"]},width:"half"},{field:"url",interface:"input",options:{iconRight:"link"},width:"half"},{field:"status",interface:"select-dropdown",display:"labels",display_options:{showAsDot:!0,choices:[{text:"$t:field_options.directus_webhooks.status_options_active",value:"active",foreground:"var(--theme--primary-background)",background:"var(--theme--primary)"},{text:"$t:field_options.directus_webhooks.status_options_inactive",value:"inactive",foreground:"var(--theme--foreground)",background:"var(--background-normal-alt)"}]},options:{choices:[{text:"$t:field_options.directus_webhooks.status_options_active",value:"active"},{text:"$t:field_options.directus_webhooks.status_options_inactive",value:"inactive"}]},width:"half"},{field:"data",interface:"boolean",options:{label:"$t:fields.directus_webhooks.data_label"},special:["cast-boolean"],width:"half",display:"boolean"},{field:"headers",special:["cast-json"],interface:"list",options:{template:"{{ header }}: {{ value }}",addLabel:"$t:field_options.directus_webhooks.headers.add",fields:[{field:"header",name:"$t:field_options.directus_webhooks.headers.header",type:"string",meta:{interface:"input",width:"half"}},{field:"value",name:"$t:field_options.directus_webhooks.headers.value",type:"string",meta:{interface:"input",width:"half"}}]},width:"full"},{field:"triggers_divider",interface:"presentation-divider",options:{icon:"api",title:"$t:fields.directus_webhooks.triggers"},special:["alias","no-data"],width:"full"},{field:"actions",interface:"select-multiple-checkbox",options:{choices:[{text:"$t:create",value:"create"},{text:"$t:update",value:"update"},{text:"$t:delete_label",value:"delete"}]},special:["cast-csv"],width:"full",display:"labels",display_options:{choices:[{text:"$t:create",value:"create",foreground:"var(--theme--primary)",background:"var(--theme--primary-subdued)"},{text:"$t:update",value:"update",foreground:"var(--blue)",background:"var(--blue-25)"},{text:"$t:delete_label",value:"delete",foreground:"var(--theme--danger)",background:"var(--danger-25)"},{text:"$t:login",value:"login",foreground:"var(--purple)",background:"var(--purple-25)"}]}},{field:"collections",interface:"system-collections",special:["cast-csv"],width:"full",display:"labels",display_options:{choices:null,format:!1}},{field:"was_active_before_deprecation",hidden:!0},{field:"migrated_flow",hidden:!0}]};const P=[];function F(e){let{fields:t,table:r}=e;t.forEach((e,t)=>{P.push({system:!0,...o,...e,collection:r,sort:t+1})})}F(s),F(c),F(l),F(u),F(d),F(f),F(p),F(m),F(h),F(g),F(_),F(v),F(y),F(b),F(x),F(S),F(C),F(w),F(T),F(E),F(D),F(O),F(k),F(A),F(j),F(M),F(N);var I=[{collection:"directus_activity",action:"read",permissions:{user:{_eq:"$CURRENT_USER"}}},{collection:"directus_comments",action:"read",permissions:{user_created:{_eq:"$CURRENT_USER"}}},{collection:"directus_comments",action:"create",validation:{comment:{_nnull:!0}}},{collection:"directus_comments",action:"update",permissions:{user_created:{_eq:"$CURRENT_USER"}},fields:["comment"]},{collection:"directus_comments",action:"delete",permissions:{user_created:{_eq:"$CURRENT_USER"}}},{collection:"directus_presets",action:"read",permissions:{_or:[{user:{_eq:"$CURRENT_USER"}},{_and:[{user:{_null:!0}},{role:{_eq:"$CURRENT_ROLE"}}]},{_and:[{user:{_null:!0}},{role:{_null:!0}}]}]}},{collection:"directus_presets",action:"create",validation:{user:{_eq:"$CURRENT_USER"}}},{collection:"directus_presets",action:"update",permissions:{user:{_eq:"$CURRENT_USER"}},validation:{user:{_eq:"$CURRENT_USER"}}},{collection:"directus_presets",action:"delete",permissions:{user:{_eq:"$CURRENT_USER"}}},{collection:"directus_roles",action:"read",permissions:{id:{_in:"$CURRENT_ROLES"}}},{collection:"directus_settings",action:"read"},{collection:"directus_translations",action:"read"},{collection:"directus_notifications",action:"read",permissions:{recipient:{_eq:"$CURRENT_USER"}}},{collection:"directus_notifications",action:"update",permissions:{recipient:{_eq:"$CURRENT_USER"}},fields:["status"]},{collection:"directus_shares",action:"read",permissions:{user_created:{_eq:"$CURRENT_USER"}}},{collection:"directus_users",action:"read",permissions:{id:{_eq:"$CURRENT_USER"}},fields:["id","first_name","last_name","last_page","email","password","location","title","description","tags","preferences_divider","avatar","language","appearance","theme_light","theme_dark","tfa_secret","status","role"]}],L=[{collection:"directus_collections",action:"read"},{collection:"directus_fields",action:"read"},{collection:"directus_relations",action:"read"},{collection:"directus_translations",action:"read"}];const R={policy:null,permissions:{},validation:null,presets:null,fields:["*"],system:!0},z=L.map(e=>({...R,...e}));function $constructor(e,t,r){function n(r,n){var i;Object.defineProperty(r,"_zod",{value:r._zod??{},enumerable:!1}),(i=r._zod).traits??(i.traits=new Set),r._zod.traits.add(e),t(r,n);for(const e in o.prototype)e in r||Object.defineProperty(r,e,{value:o.prototype[e].bind(r)});r._zod.constr=o,r._zod.def=n}const i=r?.Parent??Object;class s extends i{}function o(e){var t;const i=r?.Parent?new s:this;n(i,e),(t=i._zod).deferred??(t.deferred=[]);for(const e of i._zod.deferred)e();return i}return Object.defineProperty(s,"name",{value:e}),Object.defineProperty(o,"init",{value:n}),Object.defineProperty(o,Symbol.hasInstance,{value:t=>!!(r?.Parent&&t instanceof r.Parent)||t?._zod?.traits?.has(e)}),Object.defineProperty(o,"name",{value:e}),o}[...z,...I].map(e=>({...R,...e}));class $ZodAsyncError extends Error{constructor(){super("Encountered Promise during synchronous parse. Use .parseAsync() instead.")}}const globalConfig={};function config(e){return globalConfig}function getEnumValues(e){const t=Object.values(e).filter(e=>"number"==typeof e),r=Object.entries(e).filter(([e,r])=>-1===t.indexOf(+e)).map(([e,t])=>t);return r}function jsonStringifyReplacer(e,t){return"bigint"==typeof t?t.toString():t}function cached(e){return{get value(){{const t=e();return Object.defineProperty(this,"value",{value:t}),t}}}}function nullish(e){return null==e}function cleanRegex(e){const t=e.startsWith("^")?1:0,r=e.endsWith("$")?e.length-1:e.length;return e.slice(t,r)}const EVALUATING=Symbol("evaluating");function defineLazy(e,t,r){let n;Object.defineProperty(e,t,{get(){if(n!==EVALUATING)return void 0===n&&(n=EVALUATING,n=r()),n},set(r){Object.defineProperty(e,t,{value:r})},configurable:!0})}function assignProp(e,t,r){Object.defineProperty(e,t,{value:r,writable:!0,enumerable:!0,configurable:!0})}function mergeDefs(...e){const t={};for(const r of e){const e=Object.getOwnPropertyDescriptors(r);Object.assign(t,e)}return Object.defineProperties({},t)}function esc(e){return JSON.stringify(e)}const captureStackTrace="captureStackTrace"in Error?Error.captureStackTrace:(...e)=>{};function isObject$1(e){return"object"==typeof e&&null!==e&&!Array.isArray(e)}const allowsEval=cached(()=>{if("undefined"!=typeof navigator&&navigator?.userAgent?.includes("Cloudflare"))return!1;try{return new Function(""),!0}catch(e){return!1}});function isPlainObject$1(e){if(!1===isObject$1(e))return!1;const t=e.constructor;if(void 0===t)return!0;const r=t.prototype;return!1!==isObject$1(r)&&!1!==Object.prototype.hasOwnProperty.call(r,"isPrototypeOf")}const propertyKeyTypes=new Set(["string","number","symbol"]);function escapeRegex(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function clone(e,t,r){const n=new e._zod.constr(t??e._zod.def);return t&&!r?.parent||(n._zod.parent=e),n}function normalizeParams(e){const t=e;if(!t)return{};if("string"==typeof t)return{error:()=>t};if(void 0!==t?.message){if(void 0!==t?.error)throw new Error("Cannot specify both `message` and `error` params");t.error=t.message}return delete t.message,"string"==typeof t.error?{...t,error:()=>t.error}:t}function optionalKeys(e){return Object.keys(e).filter(t=>"optional"===e[t]._zod.optin&&"optional"===e[t]._zod.optout)}function pick(e,t){const r=e._zod.def;return clone(e,mergeDefs(e._zod.def,{get shape(){const e={};for(const n in t){if(!(n in r.shape))throw new Error(`Unrecognized key: "${n}"`);t[n]&&(e[n]=r.shape[n])}return assignProp(this,"shape",e),e},checks:[]}))}function omit(e,t){const r=e._zod.def,n=mergeDefs(e._zod.def,{get shape(){const n={...e._zod.def.shape};for(const e in t){if(!(e in r.shape))throw new Error(`Unrecognized key: "${e}"`);t[e]&&delete n[e]}return assignProp(this,"shape",n),n},checks:[]});return clone(e,n)}function extend(e,t){if(!isPlainObject$1(t))throw new Error("Invalid input to extend: expected a plain object");const r=mergeDefs(e._zod.def,{get shape(){const r={...e._zod.def.shape,...t};return assignProp(this,"shape",r),r},checks:[]});return clone(e,r)}function merge(e,t){const r=mergeDefs(e._zod.def,{get shape(){const r={...e._zod.def.shape,...t._zod.def.shape};return assignProp(this,"shape",r),r},get catchall(){return t._zod.def.catchall},checks:[]});return clone(e,r)}function partial(e,t,r){const n=mergeDefs(t._zod.def,{get shape(){const n=t._zod.def.shape,i={...n};if(r)for(const t in r){if(!(t in n))throw new Error(`Unrecognized key: "${t}"`);r[t]&&(i[t]=e?new e({type:"optional",innerType:n[t]}):n[t])}else for(const t in n)i[t]=e?new e({type:"optional",innerType:n[t]}):n[t];return assignProp(this,"shape",i),i},checks:[]});return clone(t,n)}function required(e,t,r){const n=mergeDefs(t._zod.def,{get shape(){const n=t._zod.def.shape,i={...n};if(r)for(const t in r){if(!(t in i))throw new Error(`Unrecognized key: "${t}"`);r[t]&&(i[t]=new e({type:"nonoptional",innerType:n[t]}))}else for(const t in n)i[t]=new e({type:"nonoptional",innerType:n[t]});return assignProp(this,"shape",i),i},checks:[]});return clone(t,n)}function aborted(e,t=0){for(let r=t;r<e.issues.length;r++)if(!0!==e.issues[r]?.continue)return!0;return!1}function prefixIssues(e,t){return t.map(t=>{var r;return(r=t).path??(r.path=[]),t.path.unshift(e),t})}function unwrapMessage(e){return"string"==typeof e?e:e?.message}function finalizeIssue(e,t,r){const n={...e,path:e.path??[]};if(!e.message){const i=unwrapMessage(e.inst?._zod.def?.error?.(e))??unwrapMessage(t?.error?.(e))??unwrapMessage(r.customError?.(e))??unwrapMessage(r.localeError?.(e))??"Invalid input";n.message=i}return delete n.inst,delete n.continue,t?.reportInput||delete n.input,n}function getLengthableOrigin(e){return Array.isArray(e)?"array":"string"==typeof e?"string":"unknown"}function issue(...e){const[t,r,n]=e;return"string"==typeof t?{message:t,code:"custom",input:r,inst:n}:{...t}}const initializer$1=(e,t)=>{e.name="$ZodError",Object.defineProperty(e,"_zod",{value:e._zod,enumerable:!1}),Object.defineProperty(e,"issues",{value:t,enumerable:!1}),e.message=JSON.stringify(t,jsonStringifyReplacer,2),Object.defineProperty(e,"toString",{value:()=>e.message,enumerable:!1})},$ZodError=$constructor("$ZodError",initializer$1),$ZodRealError=$constructor("$ZodError",initializer$1,{Parent:Error});function flattenError(e,t=e=>e.message){const r={},n=[];for(const i of e.issues)i.path.length>0?(r[i.path[0]]=r[i.path[0]]||[],r[i.path[0]].push(t(i))):n.push(t(i));return{formErrors:n,fieldErrors:r}}function formatError(e,t){const r=t||function(e){return e.message},n={_errors:[]},i=e=>{for(const t of e.issues)if("invalid_union"===t.code&&t.errors.length)t.errors.map(e=>i({issues:e}));else if("invalid_key"===t.code)i({issues:t.issues});else if("invalid_element"===t.code)i({issues:t.issues});else if(0===t.path.length)n._errors.push(r(t));else{let e=n,i=0;for(;i<t.path.length;){const n=t.path[i];i===t.path.length-1?(e[n]=e[n]||{_errors:[]},e[n]._errors.push(r(t))):e[n]=e[n]||{_errors:[]},e=e[n],i++}}};return i(e),n}const _parse=e=>(t,r,n,i)=>{const s=n?Object.assign(n,{async:!1}):{async:!1},o=t._zod.run({value:r,issues:[]},s);if(o instanceof Promise)throw new $ZodAsyncError;if(o.issues.length){const t=new(i?.Err??e)(o.issues.map(e=>finalizeIssue(e,s,config())));throw captureStackTrace(t,i?.callee),t}return o.value},_parseAsync=e=>async(t,r,n,i)=>{const s=n?Object.assign(n,{async:!0}):{async:!0};let o=t._zod.run({value:r,issues:[]},s);if(o instanceof Promise&&(o=await o),o.issues.length){const t=new(i?.Err??e)(o.issues.map(e=>finalizeIssue(e,s,config())));throw captureStackTrace(t,i?.callee),t}return o.value},_safeParse=e=>(t,r,n)=>{const i=n?{...n,async:!1}:{async:!1},s=t._zod.run({value:r,issues:[]},i);if(s instanceof Promise)throw new $ZodAsyncError;return s.issues.length?{success:!1,error:new(e??$ZodError)(s.issues.map(e=>finalizeIssue(e,i,config())))}:{success:!0,data:s.value}},safeParse$1=_safeParse($ZodRealError),_safeParseAsync=e=>async(t,r,n)=>{const i=n?Object.assign(n,{async:!0}):{async:!0};let s=t._zod.run({value:r,issues:[]},i);return s instanceof Promise&&(s=await s),s.issues.length?{success:!1,error:new e(s.issues.map(e=>finalizeIssue(e,i,config())))}:{success:!0,data:s.value}},safeParseAsync$1=_safeParseAsync($ZodRealError),cuid=/^[cC][^\s-]{8,}$/,cuid2=/^[0-9a-z]+$/,ulid=/^[0-9A-HJKMNP-TV-Za-hjkmnp-tv-z]{26}$/,xid=/^[0-9a-vA-V]{20}$/,ksuid=/^[A-Za-z0-9]{27}$/,nanoid=/^[a-zA-Z0-9_-]{21}$/,duration$1=/^P(?:(\d+W)|(?!.*W)(?=\d|T\d)(\d+Y)?(\d+M)?(\d+D)?(T(?=\d)(\d+H)?(\d+M)?(\d+([.,]\d+)?S)?)?)$/,guid=/^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12})$/,uuid=e=>e?new RegExp(`^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-${e}[0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12})$`):/^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[1-8][0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12}|00000000-0000-0000-0000-000000000000)$/,email=/^(?!\.)(?!.*\.\.)([A-Za-z0-9_'+\-\.]*)[A-Za-z0-9_+-]@([A-Za-z0-9][A-Za-z0-9\-]*\.)+[A-Za-z]{2,}$/,_emoji$1="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$";function emoji(){return new RegExp(_emoji$1,"u")}const ipv4=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,ipv6=/^(([0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}|::|([0-9a-fA-F]{1,4})?::([0-9a-fA-F]{1,4}:?){0,6})$/,cidrv4=/^((25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/([0-9]|[1-2][0-9]|3[0-2])$/,cidrv6=/^(([0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}|::|([0-9a-fA-F]{1,4})?::([0-9a-fA-F]{1,4}:?){0,6})\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,base64=/^$|^(?:[0-9a-zA-Z+/]{4})*(?:(?:[0-9a-zA-Z+/]{2}==)|(?:[0-9a-zA-Z+/]{3}=))?$/,base64url=/^[A-Za-z0-9_-]*$/,hostname=/^(?=.{1,253}\.?$)[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[-0-9a-zA-Z]{0,61}[0-9a-zA-Z])?)*\.?$/,e164=/^\+(?:[0-9]){6,14}[0-9]$/,dateSource="(?:(?:\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-(?:(?:0[13578]|1[02])-(?:0[1-9]|[12]\\d|3[01])|(?:0[469]|11)-(?:0[1-9]|[12]\\d|30)|(?:02)-(?:0[1-9]|1\\d|2[0-8])))",date$1=new RegExp(`^${dateSource}$`);function timeSource(e){const t="(?:[01]\\d|2[0-3]):[0-5]\\d";return"number"==typeof e.precision?-1===e.precision?`${t}`:0===e.precision?`${t}:[0-5]\\d`:`${t}:[0-5]\\d\\.\\d{${e.precision}}`:`${t}(?::[0-5]\\d(?:\\.\\d+)?)?`}function time$1(e){return new RegExp(`^${timeSource(e)}$`)}function datetime$1(e){const t=timeSource({precision:e.precision}),r=["Z"];e.local&&r.push(""),e.offset&&r.push("([+-](?:[01]\\d|2[0-3]):[0-5]\\d)");const n=`${t}(?:${r.join("|")})`;return new RegExp(`^${dateSource}T(?:${n})$`)}const string$1=e=>new RegExp(`^${e?`[\\s\\S]{${e?.minimum??0},${e?.maximum??""}}`:"[\\s\\S]*"}$`),boolean$1=/true|false/i,lowercase=/^[^A-Z]*$/,uppercase=/^[^a-z]*$/,$ZodCheck=$constructor("$ZodCheck",(e,t)=>{var r;e._zod??(e._zod={}),e._zod.def=t,(r=e._zod).onattach??(r.onattach=[])}),$ZodCheckMaxLength=$constructor("$ZodCheckMaxLength",(e,t)=>{var r;$ZodCheck.init(e,t),(r=e._zod.def).when??(r.when=e=>{const t=e.value;return!nullish(t)&&void 0!==t.length}),e._zod.onattach.push(e=>{const r=e._zod.bag.maximum??Number.POSITIVE_INFINITY;t.maximum<r&&(e._zod.bag.maximum=t.maximum)}),e._zod.check=r=>{const n=r.value;if(n.length<=t.maximum)return;const i=getLengthableOrigin(n);r.issues.push({origin:i,code:"too_big",maximum:t.maximum,inclusive:!0,input:n,inst:e,continue:!t.abort})}}),$ZodCheckMinLength=$constructor("$ZodCheckMinLength",(e,t)=>{var r;$ZodCheck.init(e,t),(r=e._zod.def).when??(r.when=e=>{const t=e.value;return!nullish(t)&&void 0!==t.length}),e._zod.onattach.push(e=>{const r=e._zod.bag.minimum??Number.NEGATIVE_INFINITY;t.minimum>r&&(e._zod.bag.minimum=t.minimum)}),e._zod.check=r=>{const n=r.value;if(n.length>=t.minimum)return;const i=getLengthableOrigin(n);r.issues.push({origin:i,code:"too_small",minimum:t.minimum,inclusive:!0,input:n,inst:e,continue:!t.abort})}}),$ZodCheckLengthEquals=$constructor("$ZodCheckLengthEquals",(e,t)=>{var r;$ZodCheck.init(e,t),(r=e._zod.def).when??(r.when=e=>{const t=e.value;return!nullish(t)&&void 0!==t.length}),e._zod.onattach.push(e=>{const r=e._zod.bag;r.minimum=t.length,r.maximum=t.length,r.length=t.length}),e._zod.check=r=>{const n=r.value,i=n.length;if(i===t.length)return;const s=getLengthableOrigin(n),o=i>t.length;r.issues.push({origin:s,...o?{code:"too_big",maximum:t.length}:{code:"too_small",minimum:t.length},inclusive:!0,exact:!0,input:r.value,inst:e,continue:!t.abort})}}),$ZodCheckStringFormat=$constructor("$ZodCheckStringFormat",(e,t)=>{var r,n;$ZodCheck.init(e,t),e._zod.onattach.push(e=>{const r=e._zod.bag;r.format=t.format,t.pattern&&(r.patterns??(r.patterns=new Set),r.patterns.add(t.pattern))}),t.pattern?(r=e._zod).check??(r.check=r=>{t.pattern.lastIndex=0,t.pattern.test(r.value)||r.issues.push({origin:"string",code:"invalid_format",format:t.format,input:r.value,...t.pattern?{pattern:t.pattern.toString()}:{},inst:e,continue:!t.abort})}):(n=e._zod).check??(n.check=()=>{})}),$ZodCheckRegex=$constructor("$ZodCheckRegex",(e,t)=>{$ZodCheckStringFormat.init(e,t),e._zod.check=r=>{t.pattern.lastIndex=0,t.pattern.test(r.value)||r.issues.push({origin:"string",code:"invalid_format",format:"regex",input:r.value,pattern:t.pattern.toString(),inst:e,continue:!t.abort})}}),$ZodCheckLowerCase=$constructor("$ZodCheckLowerCase",(e,t)=>{t.pattern??(t.pattern=lowercase),$ZodCheckStringFormat.init(e,t)}),$ZodCheckUpperCase=$constructor("$ZodCheckUpperCase",(e,t)=>{t.pattern??(t.pattern=uppercase),$ZodCheckStringFormat.init(e,t)}),$ZodCheckIncludes=$constructor("$ZodCheckIncludes",(e,t)=>{$ZodCheck.init(e,t);const r=escapeRegex(t.includes),n=new RegExp("number"==typeof t.position?`^.{${t.position}}${r}`:r);t.pattern=n,e._zod.onattach.push(e=>{const t=e._zod.bag;t.patterns??(t.patterns=new Set),t.patterns.add(n)}),e._zod.check=r=>{r.value.includes(t.includes,t.position)||r.issues.push({origin:"string",code:"invalid_format",format:"includes",includes:t.includes,input:r.value,inst:e,continue:!t.abort})}}),$ZodCheckStartsWith=$constructor("$ZodCheckStartsWith",(e,t)=>{$ZodCheck.init(e,t);const r=new RegExp(`^${escapeRegex(t.prefix)}.*`);t.pattern??(t.pattern=r),e._zod.onattach.push(e=>{const t=e._zod.bag;t.patterns??(t.patterns=new Set),t.patterns.add(r)}),e._zod.check=r=>{r.value.startsWith(t.prefix)||r.issues.push({origin:"string",code:"invalid_format",format:"starts_with",prefix:t.prefix,input:r.value,inst:e,continue:!t.abort})}}),$ZodCheckEndsWith=$constructor("$ZodCheckEndsWith",(e,t)=>{$ZodCheck.init(e,t);const r=new RegExp(`.*${escapeRegex(t.suffix)}$`);t.pattern??(t.pattern=r),e._zod.onattach.push(e=>{const t=e._zod.bag;t.patterns??(t.patterns=new Set),t.patterns.add(r)}),e._zod.check=r=>{r.value.endsWith(t.suffix)||r.issues.push({origin:"string",code:"invalid_format",format:"ends_with",suffix:t.suffix,input:r.value,inst:e,continue:!t.abort})}}),$ZodCheckOverwrite=$constructor("$ZodCheckOverwrite",(e,t)=>{$ZodCheck.init(e,t),e._zod.check=e=>{e.value=t.tx(e.value)}});class Doc{constructor(e=[]){this.content=[],this.indent=0,this&&(this.args=e)}indented(e){this.indent+=1,e(this),this.indent-=1}write(e){if("function"==typeof e)return e(this,{execution:"sync"}),void e(this,{execution:"async"});const t=e.split("\n").filter(e=>e),r=Math.min(...t.map(e=>e.length-e.trimStart().length)),n=t.map(e=>e.slice(r)).map(e=>" ".repeat(2*this.indent)+e);for(const e of n)this.content.push(e)}compile(){const e=Function,t=this?.args,r=[...(this?.content??[""]).map(e=>`  ${e}`)];return new e(...t,r.join("\n"))}}const version$1={major:4,minor:0,patch:14},$ZodType=$constructor("$ZodType",(e,t)=>{var r;e??(e={}),e._zod.def=t,e._zod.bag=e._zod.bag||{},e._zod.version=version$1;const n=[...e._zod.def.checks??[]];e._zod.traits.has("$ZodCheck")&&n.unshift(e);for(const t of n)for(const r of t._zod.onattach)r(e);if(0===n.length)(r=e._zod).deferred??(r.deferred=[]),e._zod.deferred?.push(()=>{e._zod.run=e._zod.parse});else{const t=(e,t,r)=>{let n,i=aborted(e);for(const s of t){if(s._zod.def.when){if(!s._zod.def.when(e))continue}else if(i)continue;const t=e.issues.length,o=s._zod.check(e);if(o instanceof Promise&&!1===r?.async)throw new $ZodAsyncError;if(n||o instanceof Promise)n=(n??Promise.resolve()).then(async()=>{await o;e.issues.length!==t&&(i||(i=aborted(e,t)))});else{if(e.issues.length===t)continue;i||(i=aborted(e,t))}}return n?n.then(()=>e):e};e._zod.run=(r,i)=>{const s=e._zod.parse(r,i);if(s instanceof Promise){if(!1===i.async)throw new $ZodAsyncError;return s.then(e=>t(e,n,i))}return t(s,n,i)}}e["~standard"]={validate:t=>{try{const r=safeParse$1(e,t);return r.success?{value:r.data}:{issues:r.error?.issues}}catch(r){return safeParseAsync$1(e,t).then(e=>e.success?{value:e.data}:{issues:e.error?.issues})}},vendor:"zod",version:1}}),$ZodString=$constructor("$ZodString",(e,t)=>{$ZodType.init(e,t),e._zod.pattern=[...e?._zod.bag?.patterns??[]].pop()??string$1(e._zod.bag),e._zod.parse=(r,n)=>{if(t.coerce)try{r.value=String(r.value)}catch(n){}return"string"==typeof r.value||r.issues.push({expected:"string",code:"invalid_type",input:r.value,inst:e}),r}}),$ZodStringFormat=$constructor("$ZodStringFormat",(e,t)=>{$ZodCheckStringFormat.init(e,t),$ZodString.init(e,t)}),$ZodGUID=$constructor("$ZodGUID",(e,t)=>{t.pattern??(t.pattern=guid),$ZodStringFormat.init(e,t)}),$ZodUUID=$constructor("$ZodUUID",(e,t)=>{if(t.version){const e={v1:1,v2:2,v3:3,v4:4,v5:5,v6:6,v7:7,v8:8}[t.version];if(void 0===e)throw new Error(`Invalid UUID version: "${t.version}"`);t.pattern??(t.pattern=uuid(e))}else t.pattern??(t.pattern=uuid());$ZodStringFormat.init(e,t)}),$ZodEmail=$constructor("$ZodEmail",(e,t)=>{t.pattern??(t.pattern=email),$ZodStringFormat.init(e,t)}),$ZodURL=$constructor("$ZodURL",(e,t)=>{$ZodStringFormat.init(e,t),e._zod.check=r=>{try{const n=r.value.trim(),i=new URL(n);return t.hostname&&(t.hostname.lastIndex=0,t.hostname.test(i.hostname)||r.issues.push({code:"invalid_format",format:"url",note:"Invalid hostname",pattern:hostname.source,input:r.value,inst:e,continue:!t.abort})),t.protocol&&(t.protocol.lastIndex=0,t.protocol.test(i.protocol.endsWith(":")?i.protocol.slice(0,-1):i.protocol)||r.issues.push({code:"invalid_format",format:"url",note:"Invalid protocol",pattern:t.protocol.source,input:r.value,inst:e,continue:!t.abort})),void(t.normalize?r.value=i.href:r.value=n)}catch(n){r.issues.push({code:"invalid_format",format:"url",input:r.value,inst:e,continue:!t.abort})}}}),$ZodEmoji=$constructor("$ZodEmoji",(e,t)=>{t.pattern??(t.pattern=emoji()),$ZodStringFormat.init(e,t)}),$ZodNanoID=$constructor("$ZodNanoID",(e,t)=>{t.pattern??(t.pattern=nanoid),$ZodStringFormat.init(e,t)}),$ZodCUID=$constructor("$ZodCUID",(e,t)=>{t.pattern??(t.pattern=cuid),$ZodStringFormat.init(e,t)}),$ZodCUID2=$constructor("$ZodCUID2",(e,t)=>{t.pattern??(t.pattern=cuid2),$ZodStringFormat.init(e,t)}),$ZodULID=$constructor("$ZodULID",(e,t)=>{t.pattern??(t.pattern=ulid),$ZodStringFormat.init(e,t)}),$ZodXID=$constructor("$ZodXID",(e,t)=>{t.pattern??(t.pattern=xid),$ZodStringFormat.init(e,t)}),$ZodKSUID=$constructor("$ZodKSUID",(e,t)=>{t.pattern??(t.pattern=ksuid),$ZodStringFormat.init(e,t)}),$ZodISODateTime=$constructor("$ZodISODateTime",(e,t)=>{t.pattern??(t.pattern=datetime$1(t)),$ZodStringFormat.init(e,t)}),$ZodISODate=$constructor("$ZodISODate",(e,t)=>{t.pattern??(t.pattern=date$1),$ZodStringFormat.init(e,t)}),$ZodISOTime=$constructor("$ZodISOTime",(e,t)=>{t.pattern??(t.pattern=time$1(t)),$ZodStringFormat.init(e,t)}),$ZodISODuration=$constructor("$ZodISODuration",(e,t)=>{t.pattern??(t.pattern=duration$1),$ZodStringFormat.init(e,t)}),$ZodIPv4=$constructor("$ZodIPv4",(e,t)=>{t.pattern??(t.pattern=ipv4),$ZodStringFormat.init(e,t),e._zod.onattach.push(e=>{e._zod.bag.format="ipv4"})}),$ZodIPv6=$constructor("$ZodIPv6",(e,t)=>{t.pattern??(t.pattern=ipv6),$ZodStringFormat.init(e,t),e._zod.onattach.push(e=>{e._zod.bag.format="ipv6"}),e._zod.check=r=>{try{new URL(`http://[${r.value}]`)}catch{r.issues.push({code:"invalid_format",format:"ipv6",input:r.value,inst:e,continue:!t.abort})}}}),$ZodCIDRv4=$constructor("$ZodCIDRv4",(e,t)=>{t.pattern??(t.pattern=cidrv4),$ZodStringFormat.init(e,t)}),$ZodCIDRv6=$constructor("$ZodCIDRv6",(e,t)=>{t.pattern??(t.pattern=cidrv6),$ZodStringFormat.init(e,t),e._zod.check=r=>{const[n,i]=r.value.split("/");try{if(!i)throw new Error;const e=Number(i);if(`${e}`!==i)throw new Error;if(e<0||e>128)throw new Error;new URL(`http://[${n}]`)}catch{r.issues.push({code:"invalid_format",format:"cidrv6",input:r.value,inst:e,continue:!t.abort})}}});function isValidBase64(e){if(""===e)return!0;if(e.length%4!=0)return!1;try{return atob(e),!0}catch{return!1}}const $ZodBase64=$constructor("$ZodBase64",(e,t)=>{t.pattern??(t.pattern=base64),$ZodStringFormat.init(e,t),e._zod.onattach.push(e=>{e._zod.bag.contentEncoding="base64"}),e._zod.check=r=>{isValidBase64(r.value)||r.issues.push({code:"invalid_format",format:"base64",input:r.value,inst:e,continue:!t.abort})}});function isValidBase64URL(e){if(!base64url.test(e))return!1;const t=e.replace(/[-_]/g,e=>"-"===e?"+":"/");return isValidBase64(t.padEnd(4*Math.ceil(t.length/4),"="))}const $ZodBase64URL=$constructor("$ZodBase64URL",(e,t)=>{t.pattern??(t.pattern=base64url),$ZodStringFormat.init(e,t),e._zod.onattach.push(e=>{e._zod.bag.contentEncoding="base64url"}),e._zod.check=r=>{isValidBase64URL(r.value)||r.issues.push({code:"invalid_format",format:"base64url",input:r.value,inst:e,continue:!t.abort})}}),$ZodE164=$constructor("$ZodE164",(e,t)=>{t.pattern??(t.pattern=e164),$ZodStringFormat.init(e,t)});function isValidJWT(e,t=null){try{const r=e.split(".");if(3!==r.length)return!1;const[n]=r;if(!n)return!1;const i=JSON.parse(atob(n));return(!("typ"in i)||"JWT"===i?.typ)&&(!!i.alg&&(!t||"alg"in i&&i.alg===t))}catch{return!1}}const $ZodJWT=$constructor("$ZodJWT",(e,t)=>{$ZodStringFormat.init(e,t),e._zod.check=r=>{isValidJWT(r.value,t.alg)||r.issues.push({code:"invalid_format",format:"jwt",input:r.value,inst:e,continue:!t.abort})}}),$ZodBoolean=$constructor("$ZodBoolean",(e,t)=>{$ZodType.init(e,t),e._zod.pattern=boolean$1,e._zod.parse=(r,n)=>{if(t.coerce)try{r.value=Boolean(r.value)}catch(e){}const i=r.value;return"boolean"==typeof i||r.issues.push({expected:"boolean",code:"invalid_type",input:i,inst:e}),r}}),$ZodUnknown=$constructor("$ZodUnknown",(e,t)=>{$ZodType.init(e,t),e._zod.parse=e=>e}),$ZodNever=$constructor("$ZodNever",(e,t)=>{$ZodType.init(e,t),e._zod.parse=(t,r)=>(t.issues.push({expected:"never",code:"invalid_type",input:t.value,inst:e}),t)});function handleArrayResult(e,t,r){e.issues.length&&t.issues.push(...prefixIssues(r,e.issues)),t.value[r]=e.value}const $ZodArray=$constructor("$ZodArray",(e,t)=>{$ZodType.init(e,t),e._zod.parse=(r,n)=>{const i=r.value;if(!Array.isArray(i))return r.issues.push({expected:"array",code:"invalid_type",input:i,inst:e}),r;r.value=Array(i.length);const s=[];for(let e=0;e<i.length;e++){const o=i[e],a=t.element._zod.run({value:o,issues:[]},n);a instanceof Promise?s.push(a.then(t=>handleArrayResult(t,r,e))):handleArrayResult(a,r,e)}return s.length?Promise.all(s).then(()=>r):r}});function handlePropertyResult(e,t,r,n){e.issues.length&&t.issues.push(...prefixIssues(r,e.issues)),void 0===e.value?r in n&&(t.value[r]=void 0):t.value[r]=e.value}const $ZodObject=$constructor("$ZodObject",(e,t)=>{$ZodType.init(e,t);const r=cached(()=>{const e=Object.keys(t.shape);for(const r of e)if(!(t.shape[r]instanceof $ZodType))throw new Error(`Invalid element at key "${r}": expected a Zod schema`);const r=optionalKeys(t.shape);return{shape:t.shape,keys:e,keySet:new Set(e),numKeys:e.length,optionalKeys:new Set(r)}});defineLazy(e._zod,"propValues",()=>{const e=t.shape,r={};for(const t in e){const n=e[t]._zod;if(n.values){r[t]??(r[t]=new Set);for(const e of n.values)r[t].add(e)}}return r});let n;const i=isObject$1,s=!globalConfig.jitless,o=s&&allowsEval.value,a=t.catchall;let l;e._zod.parse=(c,u)=>{l??(l=r.value);const d=c.value;if(!i(d))return c.issues.push({expected:"object",code:"invalid_type",input:d,inst:e}),c;const h=[];if(s&&o&&!1===u?.async&&!0!==u.jitless)n||(n=(e=>{const t=new Doc(["shape","payload","ctx"]),n=r.value,i=e=>{const t=esc(e);return`shape[${t}]._zod.run({ value: input[${t}], issues: [] }, ctx)`};t.write("const input = payload.value;");const s=Object.create(null);let o=0;for(const e of n.keys)s[e]="key_"+o++;t.write("const newResult = {}");for(const e of n.keys){const r=s[e],n=esc(e);t.write(`const ${r} = ${i(e)};`),t.write(`\n        if (${r}.issues.length) {\n          payload.issues = payload.issues.concat(${r}.issues.map(iss => ({\n            ...iss,\n            path: iss.path ? [${n}, ...iss.path] : [${n}]\n          })));\n        }\n        \n        if (${r}.value === undefined) {\n          if (${n} in input) {\n            newResult[${n}] = undefined;\n          }\n        } else {\n          newResult[${n}] = ${r}.value;\n        }\n      `)}t.write("payload.value = newResult;"),t.write("return payload;");const a=t.compile();return(t,r)=>a(e,t,r)})(t.shape)),c=n(c,u);else{c.value={};const e=l.shape;for(const t of l.keys){const r=e[t]._zod.run({value:d[t],issues:[]},u);r instanceof Promise?h.push(r.then(e=>handlePropertyResult(e,c,t,d))):handlePropertyResult(r,c,t,d)}}if(!a)return h.length?Promise.all(h).then(()=>c):c;const f=[],p=l.keySet,m=a._zod,_=m.def.type;for(const e of Object.keys(d)){if(p.has(e))continue;if("never"===_){f.push(e);continue}const t=m.run({value:d[e],issues:[]},u);t instanceof Promise?h.push(t.then(t=>handlePropertyResult(t,c,e,d))):handlePropertyResult(t,c,e,d)}return f.length&&c.issues.push({code:"unrecognized_keys",keys:f,input:d,inst:e}),h.length?Promise.all(h).then(()=>c):c}});function handleUnionResults(e,t,r,n){for(const r of e)if(0===r.issues.length)return t.value=r.value,t;const i=e.filter(e=>!aborted(e));return 1===i.length?(t.value=i[0].value,i[0]):(t.issues.push({code:"invalid_union",input:t.value,inst:r,errors:e.map(e=>e.issues.map(e=>finalizeIssue(e,n,config())))}),t)}const $ZodUnion=$constructor("$ZodUnion",(e,t)=>{$ZodType.init(e,t),defineLazy(e._zod,"optin",()=>t.options.some(e=>"optional"===e._zod.optin)?"optional":void 0),defineLazy(e._zod,"optout",()=>t.options.some(e=>"optional"===e._zod.optout)?"optional":void 0),defineLazy(e._zod,"values",()=>{if(t.options.every(e=>e._zod.values))return new Set(t.options.flatMap(e=>Array.from(e._zod.values)))}),defineLazy(e._zod,"pattern",()=>{if(t.options.every(e=>e._zod.pattern)){const e=t.options.map(e=>e._zod.pattern);return new RegExp(`^(${e.map(e=>cleanRegex(e.source)).join("|")})$`)}});const r=1===t.options.length,n=t.options[0]._zod.run;e._zod.parse=(i,s)=>{if(r)return n(i,s);let o=!1;const a=[];for(const e of t.options){const t=e._zod.run({value:i.value,issues:[]},s);if(t instanceof Promise)a.push(t),o=!0;else{if(0===t.issues.length)return t;a.push(t)}}return o?Promise.all(a).then(t=>handleUnionResults(t,i,e,s)):handleUnionResults(a,i,e,s)}}),$ZodIntersection=$constructor("$ZodIntersection",(e,t)=>{$ZodType.init(e,t),e._zod.parse=(e,r)=>{const n=e.value,i=t.left._zod.run({value:n,issues:[]},r),s=t.right._zod.run({value:n,issues:[]},r);return i instanceof Promise||s instanceof Promise?Promise.all([i,s]).then(([t,r])=>handleIntersectionResults(e,t,r)):handleIntersectionResults(e,i,s)}});function mergeValues(e,t){if(e===t)return{valid:!0,data:e};if(e instanceof Date&&t instanceof Date&&+e===+t)return{valid:!0,data:e};if(isPlainObject$1(e)&&isPlainObject$1(t)){const r=Object.keys(t),n=Object.keys(e).filter(e=>-1!==r.indexOf(e)),i={...e,...t};for(const r of n){const n=mergeValues(e[r],t[r]);if(!n.valid)return{valid:!1,mergeErrorPath:[r,...n.mergeErrorPath]};i[r]=n.data}return{valid:!0,data:i}}if(Array.isArray(e)&&Array.isArray(t)){if(e.length!==t.length)return{valid:!1,mergeErrorPath:[]};const r=[];for(let n=0;n<e.length;n++){const i=mergeValues(e[n],t[n]);if(!i.valid)return{valid:!1,mergeErrorPath:[n,...i.mergeErrorPath]};r.push(i.data)}return{valid:!0,data:r}}return{valid:!1,mergeErrorPath:[]}}function handleIntersectionResults(e,t,r){if(t.issues.length&&e.issues.push(...t.issues),r.issues.length&&e.issues.push(...r.issues),aborted(e))return e;const n=mergeValues(t.value,r.value);if(!n.valid)throw new Error(`Unmergable intersection. Error path: ${JSON.stringify(n.mergeErrorPath)}`);return e.value=n.data,e}const $ZodRecord=$constructor("$ZodRecord",(e,t)=>{$ZodType.init(e,t),e._zod.parse=(r,n)=>{const i=r.value;if(!isPlainObject$1(i))return r.issues.push({expected:"record",code:"invalid_type",input:i,inst:e}),r;const s=[];if(t.keyType._zod.values){const o=t.keyType._zod.values;r.value={};for(const e of o)if("string"==typeof e||"number"==typeof e||"symbol"==typeof e){const o=t.valueType._zod.run({value:i[e],issues:[]},n);o instanceof Promise?s.push(o.then(t=>{t.issues.length&&r.issues.push(...prefixIssues(e,t.issues)),r.value[e]=t.value})):(o.issues.length&&r.issues.push(...prefixIssues(e,o.issues)),r.value[e]=o.value)}let a;for(const e in i)o.has(e)||(a=a??[],a.push(e));a&&a.length>0&&r.issues.push({code:"unrecognized_keys",input:i,inst:e,keys:a})}else{r.value={};for(const o of Reflect.ownKeys(i)){if("__proto__"===o)continue;const a=t.keyType._zod.run({value:o,issues:[]},n);if(a instanceof Promise)throw new Error("Async schemas not supported in object keys currently");if(a.issues.length){r.issues.push({code:"invalid_key",origin:"record",issues:a.issues.map(e=>finalizeIssue(e,n,config())),input:o,path:[o],inst:e}),r.value[a.value]=a.value;continue}const l=t.valueType._zod.run({value:i[o],issues:[]},n);l instanceof Promise?s.push(l.then(e=>{e.issues.length&&r.issues.push(...prefixIssues(o,e.issues)),r.value[a.value]=e.value})):(l.issues.length&&r.issues.push(...prefixIssues(o,l.issues)),r.value[a.value]=l.value)}}return s.length?Promise.all(s).then(()=>r):r}}),$ZodEnum=$constructor("$ZodEnum",(e,t)=>{$ZodType.init(e,t);const r=getEnumValues(t.entries),n=new Set(r);e._zod.values=n,e._zod.pattern=new RegExp(`^(${r.filter(e=>propertyKeyTypes.has(typeof e)).map(e=>"string"==typeof e?escapeRegex(e):e.toString()).join("|")})$`),e._zod.parse=(t,i)=>{const s=t.value;return n.has(s)||t.issues.push({code:"invalid_value",values:r,input:s,inst:e}),t}}),$ZodLiteral=$constructor("$ZodLiteral",(e,t)=>{if($ZodType.init(e,t),0===t.values.length)throw new Error("Cannot create literal schema with no valid values");e._zod.values=new Set(t.values),e._zod.pattern=new RegExp(`^(${t.values.map(e=>"string"==typeof e?escapeRegex(e):e?escapeRegex(e.toString()):String(e)).join("|")})$`),e._zod.parse=(r,n)=>{const i=r.value;return e._zod.values.has(i)||r.issues.push({code:"invalid_value",values:t.values,input:i,inst:e}),r}}),$ZodTransform=$constructor("$ZodTransform",(e,t)=>{$ZodType.init(e,t),e._zod.parse=(e,r)=>{const n=t.transform(e.value,e);if(r.async){return(n instanceof Promise?n:Promise.resolve(n)).then(t=>(e.value=t,e))}if(n instanceof Promise)throw new $ZodAsyncError;return e.value=n,e}});function handleOptionalResult(e,t){return e.issues.length&&void 0===t?{issues:[],value:void 0}:e}const $ZodOptional=$constructor("$ZodOptional",(e,t)=>{$ZodType.init(e,t),e._zod.optin="optional",e._zod.optout="optional",defineLazy(e._zod,"values",()=>t.innerType._zod.values?new Set([...t.innerType._zod.values,void 0]):void 0),defineLazy(e._zod,"pattern",()=>{const e=t.innerType._zod.pattern;return e?new RegExp(`^(${cleanRegex(e.source)})?$`):void 0}),e._zod.parse=(e,r)=>{if("optional"===t.innerType._zod.optin){const n=t.innerType._zod.run(e,r);return n instanceof Promise?n.then(t=>handleOptionalResult(t,e.value)):handleOptionalResult(n,e.value)}return void 0===e.value?e:t.innerType._zod.run(e,r)}}),$ZodNullable=$constructor("$ZodNullable",(e,t)=>{$ZodType.init(e,t),defineLazy(e._zod,"optin",()=>t.innerType._zod.optin),defineLazy(e._zod,"optout",()=>t.innerType._zod.optout),defineLazy(e._zod,"pattern",()=>{const e=t.innerType._zod.pattern;return e?new RegExp(`^(${cleanRegex(e.source)}|null)$`):void 0}),defineLazy(e._zod,"values",()=>t.innerType._zod.values?new Set([...t.innerType._zod.values,null]):void 0),e._zod.parse=(e,r)=>null===e.value?e:t.innerType._zod.run(e,r)}),$ZodDefault=$constructor("$ZodDefault",(e,t)=>{$ZodType.init(e,t),e._zod.optin="optional",defineLazy(e._zod,"values",()=>t.innerType._zod.values),e._zod.parse=(e,r)=>{if(void 0===e.value)return e.value=t.defaultValue,e;const n=t.innerType._zod.run(e,r);return n instanceof Promise?n.then(e=>handleDefaultResult(e,t)):handleDefaultResult(n,t)}});function handleDefaultResult(e,t){return void 0===e.value&&(e.value=t.defaultValue),e}const $ZodPrefault=$constructor("$ZodPrefault",(e,t)=>{$ZodType.init(e,t),e._zod.optin="optional",defineLazy(e._zod,"values",()=>t.innerType._zod.values),e._zod.parse=(e,r)=>(void 0===e.value&&(e.value=t.defaultValue),t.innerType._zod.run(e,r))}),$ZodNonOptional=$constructor("$ZodNonOptional",(e,t)=>{$ZodType.init(e,t),defineLazy(e._zod,"values",()=>{const e=t.innerType._zod.values;return e?new Set([...e].filter(e=>void 0!==e)):void 0}),e._zod.parse=(r,n)=>{const i=t.innerType._zod.run(r,n);return i instanceof Promise?i.then(t=>handleNonOptionalResult(t,e)):handleNonOptionalResult(i,e)}});function handleNonOptionalResult(e,t){return e.issues.length||void 0!==e.value||e.issues.push({code:"invalid_type",expected:"nonoptional",input:e.value,inst:t}),e}const $ZodCatch=$constructor("$ZodCatch",(e,t)=>{$ZodType.init(e,t),defineLazy(e._zod,"optin",()=>t.innerType._zod.optin),defineLazy(e._zod,"optout",()=>t.innerType._zod.optout),defineLazy(e._zod,"values",()=>t.innerType._zod.values),e._zod.parse=(e,r)=>{const n=t.innerType._zod.run(e,r);return n instanceof Promise?n.then(n=>(e.value=n.value,n.issues.length&&(e.value=t.catchValue({...e,error:{issues:n.issues.map(e=>finalizeIssue(e,r,config()))},input:e.value}),e.issues=[]),e)):(e.value=n.value,n.issues.length&&(e.value=t.catchValue({...e,error:{issues:n.issues.map(e=>finalizeIssue(e,r,config()))},input:e.value}),e.issues=[]),e)}}),$ZodPipe=$constructor("$ZodPipe",(e,t)=>{$ZodType.init(e,t),defineLazy(e._zod,"values",()=>t.in._zod.values),defineLazy(e._zod,"optin",()=>t.in._zod.optin),defineLazy(e._zod,"optout",()=>t.out._zod.optout),defineLazy(e._zod,"propValues",()=>t.in._zod.propValues),e._zod.parse=(e,r)=>{const n=t.in._zod.run(e,r);return n instanceof Promise?n.then(e=>handlePipeResult(e,t,r)):handlePipeResult(n,t,r)}});function handlePipeResult(e,t,r){return e.issues.length?e:t.out._zod.run({value:e.value,issues:e.issues},r)}const $ZodReadonly=$constructor("$ZodReadonly",(e,t)=>{$ZodType.init(e,t),defineLazy(e._zod,"propValues",()=>t.innerType._zod.propValues),defineLazy(e._zod,"values",()=>t.innerType._zod.values),defineLazy(e._zod,"optin",()=>t.innerType._zod.optin),defineLazy(e._zod,"optout",()=>t.innerType._zod.optout),e._zod.parse=(e,r)=>{const n=t.innerType._zod.run(e,r);return n instanceof Promise?n.then(handleReadonlyResult):handleReadonlyResult(n)}});function handleReadonlyResult(e){return e.value=Object.freeze(e.value),e}const $ZodCustom=$constructor("$ZodCustom",(e,t)=>{$ZodCheck.init(e,t),$ZodType.init(e,t),e._zod.parse=(e,t)=>e,e._zod.check=r=>{const n=r.value,i=t.fn(n);if(i instanceof Promise)return i.then(t=>handleRefineResult(t,r,n,e));handleRefineResult(i,r,n,e)}});function handleRefineResult(e,t,r,n){if(!e){const e={code:"custom",input:r,inst:n,path:[...n._zod.def.path??[]],continue:!n._zod.def.abort};n._zod.def.params&&(e.params=n._zod.def.params),t.issues.push(issue(e))}}class $ZodRegistry{constructor(){this._map=new Map,this._idmap=new Map}add(e,...t){const r=t[0];if(this._map.set(e,r),r&&"object"==typeof r&&"id"in r){if(this._idmap.has(r.id))throw new Error(`ID ${r.id} already exists in the registry`);this._idmap.set(r.id,e)}return this}clear(){return this._map=new Map,this._idmap=new Map,this}remove(e){const t=this._map.get(e);return t&&"object"==typeof t&&"id"in t&&this._idmap.delete(t.id),this._map.delete(e),this}get(e){const t=e._zod.parent;if(t){const r={...this.get(t)??{}};delete r.id;const n={...r,...this._map.get(e)};return Object.keys(n).length?n:void 0}return this._map.get(e)}has(e){return this._map.has(e)}}function registry(){return new $ZodRegistry}const globalRegistry=registry();function _string(e,t){return new e({type:"string",...normalizeParams(t)})}function _email(e,t){return new e({type:"string",format:"email",check:"string_format",abort:!1,...normalizeParams(t)})}function _guid(e,t){return new e({type:"string",format:"guid",check:"string_format",abort:!1,...normalizeParams(t)})}function _uuid(e,t){return new e({type:"string",format:"uuid",check:"string_format",abort:!1,...normalizeParams(t)})}function _uuidv4(e,t){return new e({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v4",...normalizeParams(t)})}function _uuidv6(e,t){return new e({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v6",...normalizeParams(t)})}function _uuidv7(e,t){return new e({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v7",...normalizeParams(t)})}function _url(e,t){return new e({type:"string",format:"url",check:"string_format",abort:!1,...normalizeParams(t)})}function _emoji(e,t){return new e({type:"string",format:"emoji",check:"string_format",abort:!1,...normalizeParams(t)})}function _nanoid(e,t){return new e({type:"string",format:"nanoid",check:"string_format",abort:!1,...normalizeParams(t)})}function _cuid(e,t){return new e({type:"string",format:"cuid",check:"string_format",abort:!1,...normalizeParams(t)})}function _cuid2(e,t){return new e({type:"string",format:"cuid2",check:"string_format",abort:!1,...normalizeParams(t)})}function _ulid(e,t){return new e({type:"string",format:"ulid",check:"string_format",abort:!1,...normalizeParams(t)})}function _xid(e,t){return new e({type:"string",format:"xid",check:"string_format",abort:!1,...normalizeParams(t)})}function _ksuid(e,t){return new e({type:"string",format:"ksuid",check:"string_format",abort:!1,...normalizeParams(t)})}function _ipv4(e,t){return new e({type:"string",format:"ipv4",check:"string_format",abort:!1,...normalizeParams(t)})}function _ipv6(e,t){return new e({type:"string",format:"ipv6",check:"string_format",abort:!1,...normalizeParams(t)})}function _cidrv4(e,t){return new e({type:"string",format:"cidrv4",check:"string_format",abort:!1,...normalizeParams(t)})}function _cidrv6(e,t){return new e({type:"string",format:"cidrv6",check:"string_format",abort:!1,...normalizeParams(t)})}function _base64(e,t){return new e({type:"string",format:"base64",check:"string_format",abort:!1,...normalizeParams(t)})}function _base64url(e,t){return new e({type:"string",format:"base64url",check:"string_format",abort:!1,...normalizeParams(t)})}function _e164(e,t){return new e({type:"string",format:"e164",check:"string_format",abort:!1,...normalizeParams(t)})}function _jwt(e,t){return new e({type:"string",format:"jwt",check:"string_format",abort:!1,...normalizeParams(t)})}function _isoDateTime(e,t){return new e({type:"string",format:"datetime",check:"string_format",offset:!1,local:!1,precision:null,...normalizeParams(t)})}function _isoDate(e,t){return new e({type:"string",format:"date",check:"string_format",...normalizeParams(t)})}function _isoTime(e,t){return new e({type:"string",format:"time",check:"string_format",precision:null,...normalizeParams(t)})}function _isoDuration(e,t){return new e({type:"string",format:"duration",check:"string_format",...normalizeParams(t)})}function _boolean(e,t){return new e({type:"boolean",...normalizeParams(t)})}function _unknown(e){return new e({type:"unknown"})}function _never(e,t){return new e({type:"never",...normalizeParams(t)})}function _maxLength(e,t){return new $ZodCheckMaxLength({check:"max_length",...normalizeParams(t),maximum:e})}function _minLength(e,t){return new $ZodCheckMinLength({check:"min_length",...normalizeParams(t),minimum:e})}function _length(e,t){return new $ZodCheckLengthEquals({check:"length_equals",...normalizeParams(t),length:e})}function _regex(e,t){return new $ZodCheckRegex({check:"string_format",format:"regex",...normalizeParams(t),pattern:e})}function _lowercase(e){return new $ZodCheckLowerCase({check:"string_format",format:"lowercase",...normalizeParams(e)})}function _uppercase(e){return new $ZodCheckUpperCase({check:"string_format",format:"uppercase",...normalizeParams(e)})}function _includes(e,t){return new $ZodCheckIncludes({check:"string_format",format:"includes",...normalizeParams(t),includes:e})}function _startsWith(e,t){return new $ZodCheckStartsWith({check:"string_format",format:"starts_with",...normalizeParams(t),prefix:e})}function _endsWith(e,t){return new $ZodCheckEndsWith({check:"string_format",format:"ends_with",...normalizeParams(t),suffix:e})}function _overwrite(e){return new $ZodCheckOverwrite({check:"overwrite",tx:e})}function _normalize(e){return _overwrite(t=>t.normalize(e))}function _trim(){return _overwrite(e=>e.trim())}function _toLowerCase(){return _overwrite(e=>e.toLowerCase())}function _toUpperCase(){return _overwrite(e=>e.toUpperCase())}function _array(e,t,r){return new e({type:"array",element:t,...normalizeParams(r)})}function _refine(e,t,r){return new e({type:"custom",check:"custom",fn:t,...normalizeParams(r)})}function _superRefine(e){const t=_check(r=>(r.addIssue=e=>{if("string"==typeof e)r.issues.push(issue(e,r.value,t._zod.def));else{const n=e;n.fatal&&(n.continue=!1),n.code??(n.code="custom"),n.input??(n.input=r.value),n.inst??(n.inst=t),n.continue??(n.continue=!t._zod.def.abort),r.issues.push(issue(n))}},e(r.value,r)));return t}function _check(e,t){const r=new $ZodCheck({check:"custom",...normalizeParams(t)});return r._zod.check=e,r}const ZodISODateTime=$constructor("ZodISODateTime",(e,t)=>{$ZodISODateTime.init(e,t),ZodStringFormat.init(e,t)});function datetime(e){return _isoDateTime(ZodISODateTime,e)}const ZodISODate=$constructor("ZodISODate",(e,t)=>{$ZodISODate.init(e,t),ZodStringFormat.init(e,t)});function date(e){return _isoDate(ZodISODate,e)}const ZodISOTime=$constructor("ZodISOTime",(e,t)=>{$ZodISOTime.init(e,t),ZodStringFormat.init(e,t)});function time(e){return _isoTime(ZodISOTime,e)}const ZodISODuration=$constructor("ZodISODuration",(e,t)=>{$ZodISODuration.init(e,t),ZodStringFormat.init(e,t)});function duration(e){return _isoDuration(ZodISODuration,e)}const initializer=(e,t)=>{$ZodError.init(e,t),e.name="ZodError",Object.defineProperties(e,{format:{value:t=>formatError(e,t)},flatten:{value:t=>flattenError(e,t)},addIssue:{value:t=>{e.issues.push(t),e.message=JSON.stringify(e.issues,jsonStringifyReplacer,2)}},addIssues:{value:t=>{e.issues.push(...t),e.message=JSON.stringify(e.issues,jsonStringifyReplacer,2)}},isEmpty:{get:()=>0===e.issues.length}})},ZodRealError=$constructor("ZodError",initializer,{Parent:Error}),parse=_parse(ZodRealError),parseAsync=_parseAsync(ZodRealError),safeParse=_safeParse(ZodRealError),safeParseAsync=_safeParseAsync(ZodRealError),ZodType=$constructor("ZodType",(e,t)=>($ZodType.init(e,t),e.def=t,Object.defineProperty(e,"_def",{value:t}),e.check=(...r)=>e.clone({...t,checks:[...t.checks??[],...r.map(e=>"function"==typeof e?{_zod:{check:e,def:{check:"custom"},onattach:[]}}:e)]}),e.clone=(t,r)=>clone(e,t,r),e.brand=()=>e,e.register=(t,r)=>(t.add(e,r),e),e.parse=(t,r)=>parse(e,t,r,{callee:e.parse}),e.safeParse=(t,r)=>safeParse(e,t,r),e.parseAsync=async(t,r)=>parseAsync(e,t,r,{callee:e.parseAsync}),e.safeParseAsync=async(t,r)=>safeParseAsync(e,t,r),e.spa=e.safeParseAsync,e.refine=(t,r)=>e.check(refine(t,r)),e.superRefine=t=>e.check(superRefine(t)),e.overwrite=t=>e.check(_overwrite(t)),e.optional=()=>optional(e),e.nullable=()=>nullable(e),e.nullish=()=>optional(nullable(e)),e.nonoptional=t=>nonoptional(e,t),e.array=()=>array(e),e.or=t=>union([e,t]),e.and=t=>intersection(e,t),e.transform=t=>pipe(e,transform(t)),e.default=t=>_default(e,t),e.prefault=t=>prefault(e,t),e.catch=t=>_catch(e,t),e.pipe=t=>pipe(e,t),e.readonly=()=>readonly(e),e.describe=t=>{const r=e.clone();return globalRegistry.add(r,{description:t}),r},Object.defineProperty(e,"description",{get:()=>globalRegistry.get(e)?.description,configurable:!0}),e.meta=(...t)=>{if(0===t.length)return globalRegistry.get(e);const r=e.clone();return globalRegistry.add(r,t[0]),r},e.isOptional=()=>e.safeParse(void 0).success,e.isNullable=()=>e.safeParse(null).success,e)),_ZodString=$constructor("_ZodString",(e,t)=>{$ZodString.init(e,t),ZodType.init(e,t);const r=e._zod.bag;e.format=r.format??null,e.minLength=r.minimum??null,e.maxLength=r.maximum??null,e.regex=(...t)=>e.check(_regex(...t)),e.includes=(...t)=>e.check(_includes(...t)),e.startsWith=(...t)=>e.check(_startsWith(...t)),e.endsWith=(...t)=>e.check(_endsWith(...t)),e.min=(...t)=>e.check(_minLength(...t)),e.max=(...t)=>e.check(_maxLength(...t)),e.length=(...t)=>e.check(_length(...t)),e.nonempty=(...t)=>e.check(_minLength(1,...t)),e.lowercase=t=>e.check(_lowercase(t)),e.uppercase=t=>e.check(_uppercase(t)),e.trim=()=>e.check(_trim()),e.normalize=(...t)=>e.check(_normalize(...t)),e.toLowerCase=()=>e.check(_toLowerCase()),e.toUpperCase=()=>e.check(_toUpperCase())}),ZodString=$constructor("ZodString",(e,t)=>{$ZodString.init(e,t),_ZodString.init(e,t),e.email=t=>e.check(_email(ZodEmail,t)),e.url=t=>e.check(_url(ZodURL,t)),e.jwt=t=>e.check(_jwt(ZodJWT,t)),e.emoji=t=>e.check(_emoji(ZodEmoji,t)),e.guid=t=>e.check(_guid(ZodGUID,t)),e.uuid=t=>e.check(_uuid(ZodUUID,t)),e.uuidv4=t=>e.check(_uuidv4(ZodUUID,t)),e.uuidv6=t=>e.check(_uuidv6(ZodUUID,t)),e.uuidv7=t=>e.check(_uuidv7(ZodUUID,t)),e.nanoid=t=>e.check(_nanoid(ZodNanoID,t)),e.guid=t=>e.check(_guid(ZodGUID,t)),e.cuid=t=>e.check(_cuid(ZodCUID,t)),e.cuid2=t=>e.check(_cuid2(ZodCUID2,t)),e.ulid=t=>e.check(_ulid(ZodULID,t)),e.base64=t=>e.check(_base64(ZodBase64,t)),e.base64url=t=>e.check(_base64url(ZodBase64URL,t)),e.xid=t=>e.check(_xid(ZodXID,t)),e.ksuid=t=>e.check(_ksuid(ZodKSUID,t)),e.ipv4=t=>e.check(_ipv4(ZodIPv4,t)),e.ipv6=t=>e.check(_ipv6(ZodIPv6,t)),e.cidrv4=t=>e.check(_cidrv4(ZodCIDRv4,t)),e.cidrv6=t=>e.check(_cidrv6(ZodCIDRv6,t)),e.e164=t=>e.check(_e164(ZodE164,t)),e.datetime=t=>e.check(datetime(t)),e.date=t=>e.check(date(t)),e.time=t=>e.check(time(t)),e.duration=t=>e.check(duration(t))});function string(e){return _string(ZodString,e)}const ZodStringFormat=$constructor("ZodStringFormat",(e,t)=>{$ZodStringFormat.init(e,t),_ZodString.init(e,t)}),ZodEmail=$constructor("ZodEmail",(e,t)=>{$ZodEmail.init(e,t),ZodStringFormat.init(e,t)}),ZodGUID=$constructor("ZodGUID",(e,t)=>{$ZodGUID.init(e,t),ZodStringFormat.init(e,t)}),ZodUUID=$constructor("ZodUUID",(e,t)=>{$ZodUUID.init(e,t),ZodStringFormat.init(e,t)}),ZodURL=$constructor("ZodURL",(e,t)=>{$ZodURL.init(e,t),ZodStringFormat.init(e,t)}),ZodEmoji=$constructor("ZodEmoji",(e,t)=>{$ZodEmoji.init(e,t),ZodStringFormat.init(e,t)}),ZodNanoID=$constructor("ZodNanoID",(e,t)=>{$ZodNanoID.init(e,t),ZodStringFormat.init(e,t)}),ZodCUID=$constructor("ZodCUID",(e,t)=>{$ZodCUID.init(e,t),ZodStringFormat.init(e,t)}),ZodCUID2=$constructor("ZodCUID2",(e,t)=>{$ZodCUID2.init(e,t),ZodStringFormat.init(e,t)}),ZodULID=$constructor("ZodULID",(e,t)=>{$ZodULID.init(e,t),ZodStringFormat.init(e,t)}),ZodXID=$constructor("ZodXID",(e,t)=>{$ZodXID.init(e,t),ZodStringFormat.init(e,t)}),ZodKSUID=$constructor("ZodKSUID",(e,t)=>{$ZodKSUID.init(e,t),ZodStringFormat.init(e,t)}),ZodIPv4=$constructor("ZodIPv4",(e,t)=>{$ZodIPv4.init(e,t),ZodStringFormat.init(e,t)}),ZodIPv6=$constructor("ZodIPv6",(e,t)=>{$ZodIPv6.init(e,t),ZodStringFormat.init(e,t)}),ZodCIDRv4=$constructor("ZodCIDRv4",(e,t)=>{$ZodCIDRv4.init(e,t),ZodStringFormat.init(e,t)}),ZodCIDRv6=$constructor("ZodCIDRv6",(e,t)=>{$ZodCIDRv6.init(e,t),ZodStringFormat.init(e,t)}),ZodBase64=$constructor("ZodBase64",(e,t)=>{$ZodBase64.init(e,t),ZodStringFormat.init(e,t)}),ZodBase64URL=$constructor("ZodBase64URL",(e,t)=>{$ZodBase64URL.init(e,t),ZodStringFormat.init(e,t)}),ZodE164=$constructor("ZodE164",(e,t)=>{$ZodE164.init(e,t),ZodStringFormat.init(e,t)}),ZodJWT=$constructor("ZodJWT",(e,t)=>{$ZodJWT.init(e,t),ZodStringFormat.init(e,t)}),ZodBoolean=$constructor("ZodBoolean",(e,t)=>{$ZodBoolean.init(e,t),ZodType.init(e,t)});function boolean(e){return _boolean(ZodBoolean,e)}const ZodUnknown=$constructor("ZodUnknown",(e,t)=>{$ZodUnknown.init(e,t),ZodType.init(e,t)});function unknown(){return _unknown(ZodUnknown)}const ZodNever=$constructor("ZodNever",(e,t)=>{$ZodNever.init(e,t),ZodType.init(e,t)});function never(e){return _never(ZodNever,e)}const ZodArray=$constructor("ZodArray",(e,t)=>{$ZodArray.init(e,t),ZodType.init(e,t),e.element=t.element,e.min=(t,r)=>e.check(_minLength(t,r)),e.nonempty=t=>e.check(_minLength(1,t)),e.max=(t,r)=>e.check(_maxLength(t,r)),e.length=(t,r)=>e.check(_length(t,r)),e.unwrap=()=>e.element});function array(e,t){return _array(ZodArray,e,t)}const ZodObject=$constructor("ZodObject",(e,t)=>{$ZodObject.init(e,t),ZodType.init(e,t),defineLazy(e,"shape",()=>t.shape),e.keyof=()=>_enum(Object.keys(e._zod.def.shape)),e.catchall=t=>e.clone({...e._zod.def,catchall:t}),e.passthrough=()=>e.clone({...e._zod.def,catchall:unknown()}),e.loose=()=>e.clone({...e._zod.def,catchall:unknown()}),e.strict=()=>e.clone({...e._zod.def,catchall:never()}),e.strip=()=>e.clone({...e._zod.def,catchall:void 0}),e.extend=t=>extend(e,t),e.merge=t=>merge(e,t),e.pick=t=>pick(e,t),e.omit=t=>omit(e,t),e.partial=(...t)=>partial(ZodOptional,e,t[0]),e.required=(...t)=>required(ZodNonOptional,e,t[0])});function object(e,t){const r={type:"object",get shape(){return assignProp(this,"shape",{...e}),this.shape},...normalizeParams(t)};return new ZodObject(r)}const ZodUnion=$constructor("ZodUnion",(e,t)=>{$ZodUnion.init(e,t),ZodType.init(e,t),e.options=t.options});function union(e,t){return new ZodUnion({type:"union",options:e,...normalizeParams(t)})}const ZodIntersection=$constructor("ZodIntersection",(e,t)=>{$ZodIntersection.init(e,t),ZodType.init(e,t)});function intersection(e,t){return new ZodIntersection({type:"intersection",left:e,right:t})}const ZodRecord=$constructor("ZodRecord",(e,t)=>{$ZodRecord.init(e,t),ZodType.init(e,t),e.keyType=t.keyType,e.valueType=t.valueType});function record(e,t,r){return new ZodRecord({type:"record",keyType:e,valueType:t,...normalizeParams(r)})}const ZodEnum=$constructor("ZodEnum",(e,t)=>{$ZodEnum.init(e,t),ZodType.init(e,t),e.enum=t.entries,e.options=Object.values(t.entries);const r=new Set(Object.keys(t.entries));e.extract=(e,n)=>{const i={};for(const n of e){if(!r.has(n))throw new Error(`Key ${n} not found in enum`);i[n]=t.entries[n]}return new ZodEnum({...t,checks:[],...normalizeParams(n),entries:i})},e.exclude=(e,n)=>{const i={...t.entries};for(const t of e){if(!r.has(t))throw new Error(`Key ${t} not found in enum`);delete i[t]}return new ZodEnum({...t,checks:[],...normalizeParams(n),entries:i})}});function _enum(e,t){const r=Array.isArray(e)?Object.fromEntries(e.map(e=>[e,e])):e;return new ZodEnum({type:"enum",entries:r,...normalizeParams(t)})}const ZodLiteral=$constructor("ZodLiteral",(e,t)=>{$ZodLiteral.init(e,t),ZodType.init(e,t),e.values=new Set(t.values),Object.defineProperty(e,"value",{get(){if(t.values.length>1)throw new Error("This schema contains multiple valid literal values. Use `.values` instead.");return t.values[0]}})});function literal(e,t){return new ZodLiteral({type:"literal",values:Array.isArray(e)?e:[e],...normalizeParams(t)})}const ZodTransform=$constructor("ZodTransform",(e,t)=>{$ZodTransform.init(e,t),ZodType.init(e,t),e._zod.parse=(r,n)=>{r.addIssue=n=>{if("string"==typeof n)r.issues.push(issue(n,r.value,t));else{const t=n;t.fatal&&(t.continue=!1),t.code??(t.code="custom"),t.input??(t.input=r.value),t.inst??(t.inst=e),r.issues.push(issue(t))}};const i=t.transform(r.value,r);return i instanceof Promise?i.then(e=>(r.value=e,r)):(r.value=i,r)}});function transform(e){return new ZodTransform({type:"transform",transform:e})}const ZodOptional=$constructor("ZodOptional",(e,t)=>{$ZodOptional.init(e,t),ZodType.init(e,t),e.unwrap=()=>e._zod.def.innerType});function optional(e){return new ZodOptional({type:"optional",innerType:e})}const ZodNullable=$constructor("ZodNullable",(e,t)=>{$ZodNullable.init(e,t),ZodType.init(e,t),e.unwrap=()=>e._zod.def.innerType});function nullable(e){return new ZodNullable({type:"nullable",innerType:e})}const ZodDefault=$constructor("ZodDefault",(e,t)=>{$ZodDefault.init(e,t),ZodType.init(e,t),e.unwrap=()=>e._zod.def.innerType,e.removeDefault=e.unwrap});function _default(e,t){return new ZodDefault({type:"default",innerType:e,get defaultValue(){return"function"==typeof t?t():t}})}const ZodPrefault=$constructor("ZodPrefault",(e,t)=>{$ZodPrefault.init(e,t),ZodType.init(e,t),e.unwrap=()=>e._zod.def.innerType});function prefault(e,t){return new ZodPrefault({type:"prefault",innerType:e,get defaultValue(){return"function"==typeof t?t():t}})}const ZodNonOptional=$constructor("ZodNonOptional",(e,t)=>{$ZodNonOptional.init(e,t),ZodType.init(e,t),e.unwrap=()=>e._zod.def.innerType});function nonoptional(e,t){return new ZodNonOptional({type:"nonoptional",innerType:e,...normalizeParams(t)})}const ZodCatch=$constructor("ZodCatch",(e,t)=>{$ZodCatch.init(e,t),ZodType.init(e,t),e.unwrap=()=>e._zod.def.innerType,e.removeCatch=e.unwrap});function _catch(e,t){return new ZodCatch({type:"catch",innerType:e,catchValue:"function"==typeof t?t:()=>t})}const ZodPipe=$constructor("ZodPipe",(e,t)=>{$ZodPipe.init(e,t),ZodType.init(e,t),e.in=t.in,e.out=t.out});function pipe(e,t){return new ZodPipe({type:"pipe",in:e,out:t})}const ZodReadonly=$constructor("ZodReadonly",(e,t)=>{$ZodReadonly.init(e,t),ZodType.init(e,t),e.unwrap=()=>e._zod.def.innerType});function readonly(e){return new ZodReadonly({type:"readonly",innerType:e})}const ZodCustom=$constructor("ZodCustom",(e,t)=>{$ZodCustom.init(e,t),ZodType.init(e,t)});function refine(e,t={}){return _refine(ZodCustom,e,t)}function superRefine(e){return _superRefine(e)}const EXTENSION_PKG_KEY="directus:extension",SplitEntrypoint=object({app:string(),api:string()}),ExtensionSandboxRequestedScopes=object({request:optional(object({urls:array(string()),methods:array(union([literal("GET"),literal("POST"),literal("PATCH"),literal("PUT"),literal("DELETE")]))})),log:optional(object({})),sleep:optional(object({}))}),ExtensionSandboxOptions=optional(object({enabled:boolean(),requestedScopes:ExtensionSandboxRequestedScopes})),ExtensionOptionsBundleEntry=union([object({type:_enum(API_EXTENSION_TYPES),name:string(),source:string()}),object({type:_enum(APP_EXTENSION_TYPES),name:string(),source:string()}),object({type:_enum(HYBRID_EXTENSION_TYPES),name:string(),source:SplitEntrypoint})]),ExtensionOptionsBase=object({host:string(),hidden:boolean().optional()}),ExtensionOptionsApp=object({type:_enum(APP_EXTENSION_TYPES),path:string(),source:string()}),ExtensionOptionsApi=object({type:_enum(API_EXTENSION_TYPES),path:string(),source:string(),sandbox:ExtensionSandboxOptions}),ExtensionOptionsHybrid=object({type:_enum(HYBRID_EXTENSION_TYPES),path:SplitEntrypoint,source:SplitEntrypoint,sandbox:ExtensionSandboxOptions}),ExtensionOptionsBundle=object({type:literal("bundle"),partial:boolean().optional(),path:SplitEntrypoint,entries:array(ExtensionOptionsBundleEntry)});array(ExtensionOptionsBundleEntry);const ExtensionOptions=ExtensionOptionsBase.and(union([ExtensionOptionsApp,ExtensionOptionsApi,ExtensionOptionsHybrid,ExtensionOptionsBundle]));function defineEndpoint(e){return e}object({name:string(),version:string(),type:union([literal("module"),literal("commonjs")]).optional(),description:string().optional(),icon:string().optional(),dependencies:record(string(),string()).optional(),devDependencies:record(string(),string()).optional(),[EXTENSION_PKG_KEY]:ExtensionOptions});const e$h=e=>{let t=(e,r=[])=>{if("object"==typeof e){let n=[];for(let i in e){let s=e[i]??[];if(Array.isArray(s))for(let e of s)n.push(t(e,[...r,i]));else if("object"==typeof s)for(let e of Object.keys(s)){let o=s[e];for(let s of o)n.push(t(s,[...r,`${i}:${e}`]))}}return n.flatMap(e=>e)}return[...r,String(e)].join(".")};return e.flatMap(e=>t(e))},t$p=e=>{let t={};Array.isArray(e.fields)&&e.fields.length>0&&(t.fields=e$h(e.fields).join(",")),e.filter&&Object.keys(e.filter).length>0&&(t.filter=JSON.stringify(e.filter)),e.search&&(t.search=e.search),"sort"in e&&e.sort&&(t.sort="string"==typeof e.sort?e.sort:e.sort.join(",")),"number"==typeof e.limit&&e.limit>=-1&&(t.limit=String(e.limit)),"number"==typeof e.offset&&e.offset>=0&&(t.offset=String(e.offset)),"number"==typeof e.page&&e.page>=1&&(t.page=String(e.page)),e.deep&&Object.keys(e.deep).length>0&&(t.deep=JSON.stringify(e.deep)),e.alias&&Object.keys(e.alias).length>0&&(t.alias=JSON.stringify(e.alias)),e.aggregate&&Object.keys(e.aggregate).length>0&&(t.aggregate=JSON.stringify(e.aggregate)),e.groupBy&&e.groupBy.length>0&&(t.groupBy=e.groupBy.join(","));for(let[r,n]of Object.entries(e))r in t||(t[r]="string"==typeof n||"number"==typeof n||"boolean"==typeof n?String(n):JSON.stringify(n));return t},t$o=(e,t)=>(e.endsWith("/")&&(e=e.slice(0,-1)),t.startsWith("/")||(t="/"+t),e+t),n$3=(e,t,r)=>{let n="/"===e.pathname?t:t$o(e.pathname,t),i=new globalThis.URL(n,e);if(r)for(let[e,t]of Object.entries(t$p(r)))if(t&&"object"==typeof t&&!Array.isArray(t))for(let[r,n]of Object.entries(t))i.searchParams.set(`${e}[${r}]`,String(n));else i.searchParams.set(e,t);return i};function e$g(e){return!("object"!=typeof e||!e)&&("headers"in e&&"ok"in e&&"json"in e&&"function"==typeof e.json&&"text"in e&&"function"==typeof e.json)}async function t$n(e){if("object"==typeof e&&e){if(e$g(e)){let t=e.headers.get("Content-Type")?.toLowerCase();if(t?.startsWith("application/json")||t?.startsWith("application/health+json")){let t=await e.json();if(!e.ok||"errors"in t)throw t;return"data"in t?t.data:t}if(t?.startsWith("text/html")||t?.startsWith("text/plain")){let t=await e.text();if(!e.ok)throw t;return t}return 204===e.status?null:e}if("errors"in e)throw e;return"data"in e?e.data:e}}const t$m=async(e,t,r=globalThis.fetch)=>(t.headers="object"!=typeof t.headers||Array.isArray(t.headers)?{}:t.headers,r(e,t).then(e=>t$n(e).catch(t=>{let r={message:"",errors:t&&"object"==typeof t&&"errors"in t?t.errors:t,response:e};return t&&"object"==typeof t&&"data"in t&&(r.data=t.data),Array.isArray(r.errors)&&r.errors[0]?.message&&(r.message=r.errors[0].message),Promise.reject(r)}))),e$f=e=>t=>{let r=e??null;return{getToken:async()=>r,async setToken(e){r=e}}},e$e={fetch:globalThis.fetch,WebSocket:globalThis.WebSocket,URL:globalThis.URL,logger:globalThis.console},t$l=(e,t={})=>{let r=t.globals?{...e$e,...t.globals}:e$e;return{globals:r,url:new r.URL(e),with(e){return{...this,...e(this)}}}},e$d=(e,t)=>()=>({path:"/comments",params:t??{},body:JSON.stringify(e),method:"POST"}),t$k=(e,t)=>()=>({path:"/dashboards",params:t??{},body:JSON.stringify(e),method:"POST"}),e$c=(e,t)=>()=>({path:"/files",method:"POST",body:e,params:t??{},headers:{"Content-Type":"multipart/form-data"}}),t$j=(e,t)=>()=>({path:"/flows",params:t??{},body:JSON.stringify(e),method:"POST"}),e$b=(e,t)=>()=>({path:"/folders",params:t??{},body:JSON.stringify(e),method:"POST"});function e$a(e){return"directus_access.directus_activity.directus_collections.directus_comments.directus_fields.directus_files.directus_folders.directus_migrations.directus_permissions.directus_policies.directus_presets.directus_relations.directus_revisions.directus_roles.directus_sessions.directus_settings.directus_users.directus_webhooks.directus_dashboards.directus_panels.directus_notifications.directus_shares.directus_flows.directus_operations.directus_translations.directus_versions.directus_extensions".split(".").includes(e)}const t$i=(e,t,r)=>()=>{let n=String(e);if(e$a(n))throw Error("Cannot use createItems for core collections");return{path:`/items/${n}`,params:r??{},body:JSON.stringify(t),method:"POST"}},e$9=(e,t)=>()=>({path:"/operations",params:t??{},body:JSON.stringify(e),method:"POST"}),t$h=(e,t)=>()=>({path:"/panels",params:t??{},body:JSON.stringify(e),method:"POST"}),t$g=(e,t)=>()=>({path:"/permissions",params:t??{},body:JSON.stringify(e),method:"POST"}),t$f=(e,t)=>()=>({path:"/policies",params:t??{},body:JSON.stringify(e),method:"POST"}),e$8=(e,t)=>()=>({path:"/presets",params:t??{},body:JSON.stringify(e),method:"POST"}),t$e=(e,t)=>()=>({path:"/roles",params:t??{},body:JSON.stringify(e),method:"POST"}),e$7=(e,t)=>()=>({path:"/translations",params:t??{},body:JSON.stringify(e),method:"POST"}),t$d=(e,t)=>()=>({path:"/users",params:t??{},body:JSON.stringify(e),method:"POST"}),e$6=(e,t)=>{if(0===e.length)throw Error(t)},t$c=(e,t)=>{if(e$a(String(e)))throw Error(t)},t$b=e=>()=>({path:"/comments",params:e??{},method:"GET"}),t$a=e=>()=>({path:"/dashboards",params:e??{},method:"GET"}),e$5=()=>()=>({path:"/extensions/",method:"GET"}),t$9=e=>()=>({path:"/files",params:e??{},method:"GET"}),t$8=e=>()=>({path:"/flows",params:e??{},method:"GET"}),t$7=e=>()=>({path:"/folders",params:e??{},method:"GET"}),n$2=(e,t)=>()=>(e$6(String(e),"Collection cannot be empty"),t$c(e,"Cannot use readItems for core collections"),{path:`/items/${e}`,params:t??{},method:"GET"}),t$6=e=>()=>({path:"/panels",params:e??{},method:"GET"}),t$5=e=>()=>({path:"/permissions",params:e??{},method:"GET"}),t$4=e=>()=>({path:"/policies",params:e??{},method:"GET"}),t$3=e=>()=>({path:"/roles",params:e??{},method:"GET"}),e$4=e=>()=>({path:"/settings",params:e??{},method:"GET"}),t$2=e=>()=>({path:"/translations",params:e??{},method:"GET"}),t$1=e=>()=>({path:"/users",params:e??{},method:"GET"}),r$5=e=>()=>({path:"/users/me",params:e??{},method:"GET"}),e$3=e=>()=>({method:"POST",path:"/schema/apply",body:JSON.stringify(e)}),e$2=(e,t=!1)=>()=>({method:"POST",path:"/schema/diff",params:t?{force:t}:{},body:JSON.stringify(e)}),t=(e,t,r,n)=>()=>(e$6(e,"Keys cannot be empty"),e$6(t,"Field cannot be empty"),{path:`/fields/${e}/${t}`,params:n??{},body:JSON.stringify(r),method:"PATCH"}),r$4=(e,t,r)=>()=>(e$6(e,"Key cannot be empty"),{path:`/folders/${e}`,params:r??{},body:JSON.stringify(t),method:"PATCH"}),r$3=(e,t,r)=>()=>(e$6(String(e),"Collection cannot be empty"),t$c(e,"Cannot use updateItems for core collections"),{path:`/items/${e}`,params:r??{},body:JSON.stringify(t),method:"PATCH"}),r$2=(e,t,r)=>()=>(e$6(e,"Key cannot be empty"),{path:`/operations/${e}`,params:r??{},body:JSON.stringify(t),method:"PATCH"}),r$1=(e,t,r)=>()=>(e$6(e,"Key cannot be empty"),{path:`/roles/${e}`,params:r??{},body:JSON.stringify(t),method:"PATCH"}),e$1=(e,t)=>()=>({path:"/settings",params:t??{},body:JSON.stringify(e),method:"PATCH"}),n$1=(e,t,r)=>()=>(e$6(String(e),"Collection cannot be empty"),t$c(e,"Cannot use updateSingleton for core collections"),{path:`/items/${e}`,params:r??{},body:JSON.stringify(t),method:"PATCH"}),n={},r=(e={})=>t=>{let r={...n,...e};return{async request(n){let i=n();if(i.headers||={},"Content-Type"in i.headers?"multipart/form-data"===i.headers["Content-Type"]&&delete i.headers["Content-Type"]:i.headers["Content-Type"]="application/json","getToken"in this&&!("Authorization"in i.headers)){let e=await this.getToken();e&&(i.headers.Authorization=`Bearer ${e}`)}let s=n$3(t.url,i.path,i.params),o={method:i.method??"GET",headers:i.headers??{}};"credentials"in r&&(o.credentials=r.credentials),i.body&&(o.body=i.body),i.onRequest&&(o=await i.onRequest(o)),r.onRequest&&(o=await r.onRequest(o));let a=await t$m(s.toString(),o,t.globals.fetch);return"onResponse"in i&&(a=await i.onResponse(a,o)),"onResponse"in e&&(a=await e.onResponse(a,o)),a}}};function e(e){return()=>e}function toArray(e){return"string"==typeof e?e.split(","):Array.isArray(e)?e:[e]}async function notifyUser(e,t,r){await e.createOne({status:"inbox",subject:r.name,recipient:t.user,message:Array.isArray(r.errors)&&r.errors.length>0?r.errors[0]?.message:JSON.stringify(r)})}async function createTmpFile(){const e=await createTmpDirectory(),t=createHash("sha1").update((new Date).toString()).digest("hex").slice(0,8),r=path.join(e.path,t);try{const e=await fs.open(r,"wx");await e.close()}catch(t){throw await e.cleanup(),t}return{path:r,cleanup:async function(){await fs.unlink(r),await e.cleanup()}}}async function createTmpDirectory(){const e=await fs.mkdtemp(path.join(tmpdir(),"directus-"));return{path:e,cleanup:async function(){return await fs.rmdir(e)}}}async function saveToFile(e,t,r,n,i){const s=await createTmpFile().catch(()=>null);if(!s)return;const o=JSON.stringify(e);return await appendFile(s.path,o),await r.uploadOne(createReadStream(s.path),{title:t,folder:n,filename_download:`${t}.json`,storage:i,type:"application/json"})}async function validate_system({roles:e,policies:t,permissions:r,users:n,access:i,folders:s,dashboards:o,flows:a,panels:l,operations:c,settings:u,translations:d,presets:h,extensions:f,comments:p,shares:m,scope:_,system_errors:g}){return!!_&&(!g&&(!_.users||Array.isArray(e)&&e.length>0&&Array.isArray(t)&&t.length>0&&Array.isArray(r)&&r.length>0&&Array.isArray(n)&&n.length>0&&Array.isArray(i)&&i.length>0&&Array.isArray(m))&&(!_.content||Array.isArray(s))&&(!_.dashboards||Array.isArray(o)&&Array.isArray(l))&&(!_.flows||Array.isArray(a)&&Array.isArray(c))&&u&&Array.isArray(d)&&(!_.presets||Array.isArray(h)&&h.length>0)&&(!_.extensions||Array.isArray(f))&&(!_.comments||Array.isArray(p)))}async function validate_data({fullData:e,singletons:t,files:r,data_errors:n,scope:i}){return!!i&&(!n&&(!i.content||null!=e&&null!=t&&null!=r))}async function validate_migration(e){let t=!0;return e.forEach(e=>{"response"in e||(console.error(`${e.name} ${e?.errors[0]}`),t=!1)}),t}BaseJoi.extend({type:"string",base:BaseJoi.string(),messages:{"string.contains":"{{#label}} must contain [{{#substring}}]","string.icontains":"{{#label}} must contain case insensitive [{{#substring}}]","string.ncontains":"{{#label}} can't contain [{{#substring}}]"},rules:{contains:{args:[{name:"substring",ref:!0,assert:e=>"string"==typeof e,message:"must be a string"}],method(e){return this.$_addRule({name:"contains",args:{substring:e}})},validate:(e,t,{substring:r})=>!1===e.includes(r)?t.error("string.contains",{substring:r}):e},icontains:{args:[{name:"substring",ref:!0,assert:e=>"string"==typeof e,message:"must be a string"}],method(e){return this.$_addRule({name:"icontains",args:{substring:e}})},validate:(e,t,{substring:r})=>!1===e.toLowerCase().includes(r.toLowerCase())?t.error("string.icontains",{substring:r}):e},ncontains:{args:[{name:"substring",ref:!0,assert:e=>"string"==typeof e,message:"must be a string"}],method(e){return this.$_addRule({name:"ncontains",args:{substring:e}})},validate:(e,t,{substring:r})=>!0===e.includes(r)?t.error("string.ncontains",{substring:r}):e}}});var parser={},hasRequiredParser,DLList_1,hasRequiredDLList,Events_1,hasRequiredEvents,Queues_1,hasRequiredQueues,BottleneckError_1,hasRequiredBottleneckError,Job_1,hasRequiredJob,LocalDatastore_1,hasRequiredLocalDatastore;function requireParser(){return hasRequiredParser||(hasRequiredParser=1,parser.load=function(e,t,r={}){var n,i,s;for(n in t)s=t[n],r[n]=null!=(i=e[n])?i:s;return r},parser.overwrite=function(e,t,r={}){var n,i;for(n in e)i=e[n],void 0!==t[n]&&(r[n]=i);return r}),parser}function requireDLList(){return hasRequiredDLList?DLList_1:(hasRequiredDLList=1,e=class{constructor(e,t){this.incr=e,this.decr=t,this._first=null,this._last=null,this.length=0}push(e){var t;this.length++,"function"==typeof this.incr&&this.incr(),t={value:e,prev:this._last,next:null},null!=this._last?(this._last.next=t,this._last=t):this._first=this._last=t}shift(){var e;if(null!=this._first)return this.length--,"function"==typeof this.decr&&this.decr(),e=this._first.value,null!=(this._first=this._first.next)?this._first.prev=null:this._last=null,e}first(){if(null!=this._first)return this._first.value}getArray(){var e,t,r;for(e=this._first,r=[];null!=e;)r.push((t=e,e=e.next,t.value));return r}forEachShift(e){var t;for(t=this.shift();null!=t;)e(t),t=this.shift()}debug(){var e,t,r,n,i;for(e=this._first,i=[];null!=e;)i.push((t=e,e=e.next,{value:t.value,prev:null!=(r=t.prev)?r.value:void 0,next:null!=(n=t.next)?n.value:void 0}));return i}},DLList_1=e);var e}function requireEvents(){if(hasRequiredEvents)return Events_1;function e(e,t,r,n,i,s,o){try{var a=e[s](o),l=a.value}catch(e){return void r(e)}a.done?t(l):Promise.resolve(l).then(n,i)}function t(t){return function(){var r=this,n=arguments;return new Promise(function(i,s){var o=t.apply(r,n);function a(t){e(o,i,s,a,l,"next",t)}function l(t){e(o,i,s,a,l,"throw",t)}a(void 0)})}}var r;return hasRequiredEvents=1,r=class{constructor(e){if(this.instance=e,this._events={},null!=this.instance.on||null!=this.instance.once||null!=this.instance.removeAllListeners)throw new Error("An Emitter already exists for this object");this.instance.on=(e,t)=>this._addListener(e,"many",t),this.instance.once=(e,t)=>this._addListener(e,"once",t),this.instance.removeAllListeners=(e=null)=>null!=e?delete this._events[e]:this._events={}}_addListener(e,t,r){var n;return null==(n=this._events)[e]&&(n[e]=[]),this._events[e].push({cb:r,status:t}),this.instance}listenerCount(e){return null!=this._events[e]?this._events[e].length:0}trigger(e,...r){var n=this;return t(function*(){var i,s;try{if("debug"!==e&&n.trigger("debug",`Event triggered: ${e}`,r),null==n._events[e])return;return n._events[e]=n._events[e].filter(function(e){return"none"!==e.status}),s=n._events[e].map(function(){var e=t(function*(e){var t,i;if("none"!==e.status){"once"===e.status&&(e.status="none");try{return"function"==typeof(null!=(i="function"==typeof e.cb?e.cb(...r):void 0)?i.then:void 0)?yield i:i}catch(e){return t=e,n.trigger("error",t),null}}});return function(t){return e.apply(this,arguments)}}()),(yield Promise.all(s)).find(function(e){return null!=e})}catch(e){return i=e,n.trigger("error",i),null}})()}},Events_1=r}function requireQueues(){return hasRequiredQueues?Queues_1:(hasRequiredQueues=1,e=requireDLList(),t=requireEvents(),r=class{constructor(r){this.Events=new t(this),this._length=0,this._lists=function(){var t,n,i;for(i=[],t=1,n=r;1<=n?t<=n:t>=n;1<=n?++t:--t)i.push(new e(()=>this.incr(),()=>this.decr()));return i}.call(this)}incr(){if(0===this._length++)return this.Events.trigger("leftzero")}decr(){if(0===--this._length)return this.Events.trigger("zero")}push(e){return this._lists[e.options.priority].push(e)}queued(e){return null!=e?this._lists[e].length:this._length}shiftAll(e){return this._lists.forEach(function(t){return t.forEachShift(e)})}getFirst(e=this._lists){var t,r,n;for(t=0,r=e.length;t<r;t++)if((n=e[t]).length>0)return n;return[]}shiftLastFrom(e){return this.getFirst(this._lists.slice(e).reverse()).shift()}},Queues_1=r);var e,t,r}function requireBottleneckError(){return hasRequiredBottleneckError?BottleneckError_1:(hasRequiredBottleneckError=1,e=class extends Error{},BottleneckError_1=e);var e}function requireJob(){if(hasRequiredJob)return Job_1;function e(e,t,r,n,i,s,o){try{var a=e[s](o),l=a.value}catch(e){return void r(e)}a.done?t(l):Promise.resolve(l).then(n,i)}function t(t){return function(){var r=this,n=arguments;return new Promise(function(i,s){var o=t.apply(r,n);function a(t){e(o,i,s,a,l,"next",t)}function l(t){e(o,i,s,a,l,"throw",t)}a(void 0)})}}var r,n;return hasRequiredJob=1,n=requireParser(),r=requireBottleneckError(),Job_1=class{constructor(e,t,r,i,s,o,a,l){this.task=e,this.args=t,this.rejectOnDrop=s,this.Events=o,this._states=a,this.Promise=l,this.options=n.load(r,i),this.options.priority=this._sanitizePriority(this.options.priority),this.options.id===i.id&&(this.options.id=`${this.options.id}-${this._randomIndex()}`),this.promise=new this.Promise((e,t)=>{this._resolve=e,this._reject=t}),this.retryCount=0}_sanitizePriority(e){var t;return(t=~~e!==e?5:e)<0?0:t>9?9:t}_randomIndex(){return Math.random().toString(36).slice(2)}doDrop({error:e,message:t="This job has been dropped by Bottleneck"}={}){return!!this._states.remove(this.options.id)&&(this.rejectOnDrop&&this._reject(null!=e?e:new r(t)),this.Events.trigger("dropped",{args:this.args,options:this.options,task:this.task,promise:this.promise}),!0)}_assertStatus(e){var t;if((t=this._states.jobStatus(this.options.id))!==e&&("DONE"!==e||null!==t))throw new r(`Invalid job status ${t}, expected ${e}. Please open an issue at https://github.com/SGrondin/bottleneck/issues`)}doReceive(){return this._states.start(this.options.id),this.Events.trigger("received",{args:this.args,options:this.options})}doQueue(e,t){return this._assertStatus("RECEIVED"),this._states.next(this.options.id),this.Events.trigger("queued",{args:this.args,options:this.options,reachedHWM:e,blocked:t})}doRun(){return 0===this.retryCount?(this._assertStatus("QUEUED"),this._states.next(this.options.id)):this._assertStatus("EXECUTING"),this.Events.trigger("scheduled",{args:this.args,options:this.options})}doExecute(e,r,n,i){var s=this;return t(function*(){var t,o,a;0===s.retryCount?(s._assertStatus("RUNNING"),s._states.next(s.options.id)):s._assertStatus("EXECUTING"),o={args:s.args,options:s.options,retryCount:s.retryCount},s.Events.trigger("executing",o);try{if(a=yield null!=e?e.schedule(s.options,s.task,...s.args):s.task(...s.args),r())return s.doDone(o),yield i(s.options,o),s._assertStatus("DONE"),s._resolve(a)}catch(e){return t=e,s._onFailure(t,o,r,n,i)}})()}doExpire(e,t,n){var i,s;return this._states.jobStatus("RUNNING"===this.options.id)&&this._states.next(this.options.id),this._assertStatus("EXECUTING"),s={args:this.args,options:this.options,retryCount:this.retryCount},i=new r(`This job timed out after ${this.options.expiration} ms.`),this._onFailure(i,s,e,t,n)}_onFailure(e,r,n,i,s){var o=this;return t(function*(){var t,a;if(n())return null!=(t=yield o.Events.trigger("failed",e,r))?(a=~~t,o.Events.trigger("retry",`Retrying ${o.options.id} after ${a} ms`,r),o.retryCount++,i(a)):(o.doDone(r),yield s(o.options,r),o._assertStatus("DONE"),o._reject(e))})()}doDone(e){return this._assertStatus("EXECUTING"),this._states.next(this.options.id),this.Events.trigger("done",e)}}}function requireLocalDatastore(){if(hasRequiredLocalDatastore)return LocalDatastore_1;function e(e,t,r,n,i,s,o){try{var a=e[s](o),l=a.value}catch(e){return void r(e)}a.done?t(l):Promise.resolve(l).then(n,i)}function t(t){return function(){var r=this,n=arguments;return new Promise(function(i,s){var o=t.apply(r,n);function a(t){e(o,i,s,a,l,"next",t)}function l(t){e(o,i,s,a,l,"throw",t)}a(void 0)})}}var r,n,i;return hasRequiredLocalDatastore=1,i=requireParser(),r=requireBottleneckError(),n=class{constructor(e,t,r){this.instance=e,this.storeOptions=t,this.clientId=this.instance._randomIndex(),i.load(r,r,this),this._nextRequest=this._lastReservoirRefresh=this._lastReservoirIncrease=Date.now(),this._running=0,this._done=0,this._unblockTime=0,this.ready=this.Promise.resolve(),this.clients={},this._startHeartbeat()}_startHeartbeat(){var e;return null==this.heartbeat&&(null!=this.storeOptions.reservoirRefreshInterval&&null!=this.storeOptions.reservoirRefreshAmount||null!=this.storeOptions.reservoirIncreaseInterval&&null!=this.storeOptions.reservoirIncreaseAmount)?"function"==typeof(e=this.heartbeat=setInterval(()=>{var e,t,r,n,i;if(n=Date.now(),null!=this.storeOptions.reservoirRefreshInterval&&n>=this._lastReservoirRefresh+this.storeOptions.reservoirRefreshInterval&&(this._lastReservoirRefresh=n,this.storeOptions.reservoir=this.storeOptions.reservoirRefreshAmount,this.instance._drainAll(this.computeCapacity())),null!=this.storeOptions.reservoirIncreaseInterval&&n>=this._lastReservoirIncrease+this.storeOptions.reservoirIncreaseInterval){var s=this.storeOptions;if(e=s.reservoirIncreaseAmount,r=s.reservoirIncreaseMaximum,i=s.reservoir,this._lastReservoirIncrease=n,(t=null!=r?Math.min(e,r-i):e)>0)return this.storeOptions.reservoir+=t,this.instance._drainAll(this.computeCapacity())}},this.heartbeatInterval)).unref?e.unref():void 0:clearInterval(this.heartbeat)}__publish__(e){var r=this;return t(function*(){return yield r.yieldLoop(),r.instance.Events.trigger("message",e.toString())})()}__disconnect__(e){var r=this;return t(function*(){return yield r.yieldLoop(),clearInterval(r.heartbeat),r.Promise.resolve()})()}yieldLoop(e=0){return new this.Promise(function(t,r){return setTimeout(t,e)})}computePenalty(){var e;return null!=(e=this.storeOptions.penalty)?e:15*this.storeOptions.minTime||5e3}__updateSettings__(e){var r=this;return t(function*(){return yield r.yieldLoop(),i.overwrite(e,e,r.storeOptions),r._startHeartbeat(),r.instance._drainAll(r.computeCapacity()),!0})()}__running__(){var e=this;return t(function*(){return yield e.yieldLoop(),e._running})()}__queued__(){var e=this;return t(function*(){return yield e.yieldLoop(),e.instance.queued()})()}__done__(){var e=this;return t(function*(){return yield e.yieldLoop(),e._done})()}__groupCheck__(e){var r=this;return t(function*(){return yield r.yieldLoop(),r._nextRequest+r.timeout<e})()}computeCapacity(){var e,t,r=this.storeOptions;return e=r.maxConcurrent,t=r.reservoir,null!=e&&null!=t?Math.min(e-this._running,t):null!=e?e-this._running:null!=t?t:null}conditionsCheck(e){var t;return null==(t=this.computeCapacity())||e<=t}__incrementReservoir__(e){var r=this;return t(function*(){var t;return yield r.yieldLoop(),t=r.storeOptions.reservoir+=e,r.instance._drainAll(r.computeCapacity()),t})()}__currentReservoir__(){var e=this;return t(function*(){return yield e.yieldLoop(),e.storeOptions.reservoir})()}isBlocked(e){return this._unblockTime>=e}check(e,t){return this.conditionsCheck(e)&&this._nextRequest-t<=0}__check__(e){var r=this;return t(function*(){var t;return yield r.yieldLoop(),t=Date.now(),r.check(e,t)})()}__register__(e,r,n){var i=this;return t(function*(){var e,t;return yield i.yieldLoop(),e=Date.now(),i.conditionsCheck(r)?(i._running+=r,null!=i.storeOptions.reservoir&&(i.storeOptions.reservoir-=r),t=Math.max(i._nextRequest-e,0),i._nextRequest=e+t+i.storeOptions.minTime,{success:!0,wait:t,reservoir:i.storeOptions.reservoir}):{success:!1}})()}strategyIsBlock(){return 3===this.storeOptions.strategy}__submit__(e,n){var i=this;return t(function*(){var t,s,o;if(yield i.yieldLoop(),null!=i.storeOptions.maxConcurrent&&n>i.storeOptions.maxConcurrent)throw new r(`Impossible to add a job having a weight of ${n} to a limiter having a maxConcurrent setting of ${i.storeOptions.maxConcurrent}`);return s=Date.now(),o=null!=i.storeOptions.highWater&&e===i.storeOptions.highWater&&!i.check(n,s),(t=i.strategyIsBlock()&&(o||i.isBlocked(s)))&&(i._unblockTime=s+i.computePenalty(),i._nextRequest=i._unblockTime+i.storeOptions.minTime,i.instance._dropAllQueued()),{reachedHWM:o,blocked:t,strategy:i.storeOptions.strategy}})()}__free__(e,r){var n=this;return t(function*(){return yield n.yieldLoop(),n._running-=r,n._done+=r,n.instance._drainAll(n.computeCapacity()),{running:n._running}})()}},LocalDatastore_1=n}var Scripts={},require$$0={"blacklist_client.lua":"local blacklist = ARGV[num_static_argv + 1]\n\nif redis.call('zscore', client_last_seen_key, blacklist) then\n  redis.call('zadd', client_last_seen_key, 0, blacklist)\nend\n\n\nreturn {}\n","check.lua":"local weight = tonumber(ARGV[num_static_argv + 1])\n\nlocal capacity = process_tick(now, false)['capacity']\nlocal nextRequest = tonumber(redis.call('hget', settings_key, 'nextRequest'))\n\nreturn conditions_check(capacity, weight) and nextRequest - now <= 0\n","conditions_check.lua":"local conditions_check = function (capacity, weight)\n  return capacity == nil or weight <= capacity\nend\n","current_reservoir.lua":"return process_tick(now, false)['reservoir']\n","done.lua":"process_tick(now, false)\n\nreturn tonumber(redis.call('hget', settings_key, 'done'))\n","free.lua":"local index = ARGV[num_static_argv + 1]\n\nredis.call('zadd', job_expirations_key, 0, index)\n\nreturn process_tick(now, false)['running']\n","get_time.lua":"redis.replicate_commands()\n\nlocal get_time = function ()\n  local time = redis.call('time')\n\n  return tonumber(time[1]..string.sub(time[2], 1, 3))\nend\n","group_check.lua":"return not (redis.call('exists', settings_key) == 1)\n","heartbeat.lua":"process_tick(now, true)\n","increment_reservoir.lua":"local incr = tonumber(ARGV[num_static_argv + 1])\n\nredis.call('hincrby', settings_key, 'reservoir', incr)\n\nlocal reservoir = process_tick(now, true)['reservoir']\n\nlocal groupTimeout = tonumber(redis.call('hget', settings_key, 'groupTimeout'))\nrefresh_expiration(0, 0, groupTimeout)\n\nreturn reservoir\n","init.lua":"local clear = tonumber(ARGV[num_static_argv + 1])\nlocal limiter_version = ARGV[num_static_argv + 2]\nlocal num_local_argv = num_static_argv + 2\n\nif clear == 1 then\n  redis.call('del', unpack(KEYS))\nend\n\nif redis.call('exists', settings_key) == 0 then\n  -- Create\n  local args = {'hmset', settings_key}\n\n  for i = num_local_argv + 1, #ARGV do\n    table.insert(args, ARGV[i])\n  end\n\n  redis.call(unpack(args))\n  redis.call('hmset', settings_key,\n    'nextRequest', now,\n    'lastReservoirRefresh', now,\n    'lastReservoirIncrease', now,\n    'running', 0,\n    'done', 0,\n    'unblockTime', 0,\n    'capacityPriorityCounter', 0\n  )\n\nelse\n  -- Apply migrations\n  local settings = redis.call('hmget', settings_key,\n    'id',\n    'version'\n  )\n  local id = settings[1]\n  local current_version = settings[2]\n\n  if current_version ~= limiter_version then\n    local version_digits = {}\n    for k, v in string.gmatch(current_version, \"([^.]+)\") do\n      table.insert(version_digits, tonumber(k))\n    end\n\n    -- 2.10.0\n    if version_digits[2] < 10 then\n      redis.call('hsetnx', settings_key, 'reservoirRefreshInterval', '')\n      redis.call('hsetnx', settings_key, 'reservoirRefreshAmount', '')\n      redis.call('hsetnx', settings_key, 'lastReservoirRefresh', '')\n      redis.call('hsetnx', settings_key, 'done', 0)\n      redis.call('hset', settings_key, 'version', '2.10.0')\n    end\n\n    -- 2.11.1\n    if version_digits[2] < 11 or (version_digits[2] == 11 and version_digits[3] < 1) then\n      if redis.call('hstrlen', settings_key, 'lastReservoirRefresh') == 0 then\n        redis.call('hmset', settings_key,\n          'lastReservoirRefresh', now,\n          'version', '2.11.1'\n        )\n      end\n    end\n\n    -- 2.14.0\n    if version_digits[2] < 14 then\n      local old_running_key = 'b_'..id..'_running'\n      local old_executing_key = 'b_'..id..'_executing'\n\n      if redis.call('exists', old_running_key) == 1 then\n        redis.call('rename', old_running_key, job_weights_key)\n      end\n      if redis.call('exists', old_executing_key) == 1 then\n        redis.call('rename', old_executing_key, job_expirations_key)\n      end\n      redis.call('hset', settings_key, 'version', '2.14.0')\n    end\n\n    -- 2.15.2\n    if version_digits[2] < 15 or (version_digits[2] == 15 and version_digits[3] < 2) then\n      redis.call('hsetnx', settings_key, 'capacityPriorityCounter', 0)\n      redis.call('hset', settings_key, 'version', '2.15.2')\n    end\n\n    -- 2.17.0\n    if version_digits[2] < 17 then\n      redis.call('hsetnx', settings_key, 'clientTimeout', 10000)\n      redis.call('hset', settings_key, 'version', '2.17.0')\n    end\n\n    -- 2.18.0\n    if version_digits[2] < 18 then\n      redis.call('hsetnx', settings_key, 'reservoirIncreaseInterval', '')\n      redis.call('hsetnx', settings_key, 'reservoirIncreaseAmount', '')\n      redis.call('hsetnx', settings_key, 'reservoirIncreaseMaximum', '')\n      redis.call('hsetnx', settings_key, 'lastReservoirIncrease', now)\n      redis.call('hset', settings_key, 'version', '2.18.0')\n    end\n\n  end\n\n  process_tick(now, false)\nend\n\nlocal groupTimeout = tonumber(redis.call('hget', settings_key, 'groupTimeout'))\nrefresh_expiration(0, 0, groupTimeout)\n\nreturn {}\n","process_tick.lua":"local process_tick = function (now, always_publish)\n\n  local compute_capacity = function (maxConcurrent, running, reservoir)\n    if maxConcurrent ~= nil and reservoir ~= nil then\n      return math.min((maxConcurrent - running), reservoir)\n    elseif maxConcurrent ~= nil then\n      return maxConcurrent - running\n    elseif reservoir ~= nil then\n      return reservoir\n    else\n      return nil\n    end\n  end\n\n  local settings = redis.call('hmget', settings_key,\n    'id',\n    'maxConcurrent',\n    'running',\n    'reservoir',\n    'reservoirRefreshInterval',\n    'reservoirRefreshAmount',\n    'lastReservoirRefresh',\n    'reservoirIncreaseInterval',\n    'reservoirIncreaseAmount',\n    'reservoirIncreaseMaximum',\n    'lastReservoirIncrease',\n    'capacityPriorityCounter',\n    'clientTimeout'\n  )\n  local id = settings[1]\n  local maxConcurrent = tonumber(settings[2])\n  local running = tonumber(settings[3])\n  local reservoir = tonumber(settings[4])\n  local reservoirRefreshInterval = tonumber(settings[5])\n  local reservoirRefreshAmount = tonumber(settings[6])\n  local lastReservoirRefresh = tonumber(settings[7])\n  local reservoirIncreaseInterval = tonumber(settings[8])\n  local reservoirIncreaseAmount = tonumber(settings[9])\n  local reservoirIncreaseMaximum = tonumber(settings[10])\n  local lastReservoirIncrease = tonumber(settings[11])\n  local capacityPriorityCounter = tonumber(settings[12])\n  local clientTimeout = tonumber(settings[13])\n\n  local initial_capacity = compute_capacity(maxConcurrent, running, reservoir)\n\n  --\n  -- Process 'running' changes\n  --\n  local expired = redis.call('zrangebyscore', job_expirations_key, '-inf', '('..now)\n\n  if #expired > 0 then\n    redis.call('zremrangebyscore', job_expirations_key, '-inf', '('..now)\n\n    local flush_batch = function (batch, acc)\n      local weights = redis.call('hmget', job_weights_key, unpack(batch))\n                      redis.call('hdel',  job_weights_key, unpack(batch))\n      local clients = redis.call('hmget', job_clients_key, unpack(batch))\n                      redis.call('hdel',  job_clients_key, unpack(batch))\n\n      -- Calculate sum of removed weights\n      for i = 1, #weights do\n        acc['total'] = acc['total'] + (tonumber(weights[i]) or 0)\n      end\n\n      -- Calculate sum of removed weights by client\n      local client_weights = {}\n      for i = 1, #clients do\n        local removed = tonumber(weights[i]) or 0\n        if removed > 0 then\n          acc['client_weights'][clients[i]] = (acc['client_weights'][clients[i]] or 0) + removed\n        end\n      end\n    end\n\n    local acc = {\n      ['total'] = 0,\n      ['client_weights'] = {}\n    }\n    local batch_size = 1000\n\n    -- Compute changes to Zsets and apply changes to Hashes\n    for i = 1, #expired, batch_size do\n      local batch = {}\n      for j = i, math.min(i + batch_size - 1, #expired) do\n        table.insert(batch, expired[j])\n      end\n\n      flush_batch(batch, acc)\n    end\n\n    -- Apply changes to Zsets\n    if acc['total'] > 0 then\n      redis.call('hincrby', settings_key, 'done', acc['total'])\n      running = tonumber(redis.call('hincrby', settings_key, 'running', -acc['total']))\n    end\n\n    for client, weight in pairs(acc['client_weights']) do\n      redis.call('zincrby', client_running_key, -weight, client)\n    end\n  end\n\n  --\n  -- Process 'reservoir' changes\n  --\n  local reservoirRefreshActive = reservoirRefreshInterval ~= nil and reservoirRefreshAmount ~= nil\n  if reservoirRefreshActive and now >= lastReservoirRefresh + reservoirRefreshInterval then\n    reservoir = reservoirRefreshAmount\n    redis.call('hmset', settings_key,\n      'reservoir', reservoir,\n      'lastReservoirRefresh', now\n    )\n  end\n\n  local reservoirIncreaseActive = reservoirIncreaseInterval ~= nil and reservoirIncreaseAmount ~= nil\n  if reservoirIncreaseActive and now >= lastReservoirIncrease + reservoirIncreaseInterval then\n    local num_intervals = math.floor((now - lastReservoirIncrease) / reservoirIncreaseInterval)\n    local incr = reservoirIncreaseAmount * num_intervals\n    if reservoirIncreaseMaximum ~= nil then\n      incr = math.min(incr, reservoirIncreaseMaximum - (reservoir or 0))\n    end\n    if incr > 0 then\n      reservoir = (reservoir or 0) + incr\n    end\n    redis.call('hmset', settings_key,\n      'reservoir', reservoir,\n      'lastReservoirIncrease', lastReservoirIncrease + (num_intervals * reservoirIncreaseInterval)\n    )\n  end\n\n  --\n  -- Clear unresponsive clients\n  --\n  local unresponsive = redis.call('zrangebyscore', client_last_seen_key, '-inf', (now - clientTimeout))\n  local unresponsive_lookup = {}\n  local terminated_clients = {}\n  for i = 1, #unresponsive do\n    unresponsive_lookup[unresponsive[i]] = true\n    if tonumber(redis.call('zscore', client_running_key, unresponsive[i])) == 0 then\n      table.insert(terminated_clients, unresponsive[i])\n    end\n  end\n  if #terminated_clients > 0 then\n    redis.call('zrem', client_running_key,         unpack(terminated_clients))\n    redis.call('hdel', client_num_queued_key,      unpack(terminated_clients))\n    redis.call('zrem', client_last_registered_key, unpack(terminated_clients))\n    redis.call('zrem', client_last_seen_key,       unpack(terminated_clients))\n  end\n\n  --\n  -- Broadcast capacity changes\n  --\n  local final_capacity = compute_capacity(maxConcurrent, running, reservoir)\n\n  if always_publish or (initial_capacity ~= nil and final_capacity == nil) then\n    -- always_publish or was not unlimited, now unlimited\n    redis.call('publish', 'b_'..id, 'capacity:'..(final_capacity or ''))\n\n  elseif initial_capacity ~= nil and final_capacity ~= nil and final_capacity > initial_capacity then\n    -- capacity was increased\n    -- send the capacity message to the limiter having the lowest number of running jobs\n    -- the tiebreaker is the limiter having not registered a job in the longest time\n\n    local lowest_concurrency_value = nil\n    local lowest_concurrency_clients = {}\n    local lowest_concurrency_last_registered = {}\n    local client_concurrencies = redis.call('zrange', client_running_key, 0, -1, 'withscores')\n\n    for i = 1, #client_concurrencies, 2 do\n      local client = client_concurrencies[i]\n      local concurrency = tonumber(client_concurrencies[i+1])\n\n      if (\n        lowest_concurrency_value == nil or lowest_concurrency_value == concurrency\n      ) and (\n        not unresponsive_lookup[client]\n      ) and (\n        tonumber(redis.call('hget', client_num_queued_key, client)) > 0\n      ) then\n        lowest_concurrency_value = concurrency\n        table.insert(lowest_concurrency_clients, client)\n        local last_registered = tonumber(redis.call('zscore', client_last_registered_key, client))\n        table.insert(lowest_concurrency_last_registered, last_registered)\n      end\n    end\n\n    if #lowest_concurrency_clients > 0 then\n      local position = 1\n      local earliest = lowest_concurrency_last_registered[1]\n\n      for i,v in ipairs(lowest_concurrency_last_registered) do\n        if v < earliest then\n          position = i\n          earliest = v\n        end\n      end\n\n      local next_client = lowest_concurrency_clients[position]\n      redis.call('publish', 'b_'..id,\n        'capacity-priority:'..(final_capacity or '')..\n        ':'..next_client..\n        ':'..capacityPriorityCounter\n      )\n      redis.call('hincrby', settings_key, 'capacityPriorityCounter', '1')\n    else\n      redis.call('publish', 'b_'..id, 'capacity:'..(final_capacity or ''))\n    end\n  end\n\n  return {\n    ['capacity'] = final_capacity,\n    ['running'] = running,\n    ['reservoir'] = reservoir\n  }\nend\n","queued.lua":"local clientTimeout = tonumber(redis.call('hget', settings_key, 'clientTimeout'))\nlocal valid_clients = redis.call('zrangebyscore', client_last_seen_key, (now - clientTimeout), 'inf')\nlocal client_queued = redis.call('hmget', client_num_queued_key, unpack(valid_clients))\n\nlocal sum = 0\nfor i = 1, #client_queued do\n  sum = sum + tonumber(client_queued[i])\nend\n\nreturn sum\n","refresh_expiration.lua":"local refresh_expiration = function (now, nextRequest, groupTimeout)\n\n  if groupTimeout ~= nil then\n    local ttl = (nextRequest + groupTimeout) - now\n\n    for i = 1, #KEYS do\n      redis.call('pexpire', KEYS[i], ttl)\n    end\n  end\n\nend\n","refs.lua":"local settings_key = KEYS[1]\nlocal job_weights_key = KEYS[2]\nlocal job_expirations_key = KEYS[3]\nlocal job_clients_key = KEYS[4]\nlocal client_running_key = KEYS[5]\nlocal client_num_queued_key = KEYS[6]\nlocal client_last_registered_key = KEYS[7]\nlocal client_last_seen_key = KEYS[8]\n\nlocal now = tonumber(ARGV[1])\nlocal client = ARGV[2]\n\nlocal num_static_argv = 2\n","register.lua":"local index = ARGV[num_static_argv + 1]\nlocal weight = tonumber(ARGV[num_static_argv + 2])\nlocal expiration = tonumber(ARGV[num_static_argv + 3])\n\nlocal state = process_tick(now, false)\nlocal capacity = state['capacity']\nlocal reservoir = state['reservoir']\n\nlocal settings = redis.call('hmget', settings_key,\n  'nextRequest',\n  'minTime',\n  'groupTimeout'\n)\nlocal nextRequest = tonumber(settings[1])\nlocal minTime = tonumber(settings[2])\nlocal groupTimeout = tonumber(settings[3])\n\nif conditions_check(capacity, weight) then\n\n  redis.call('hincrby', settings_key, 'running', weight)\n  redis.call('hset', job_weights_key, index, weight)\n  if expiration ~= nil then\n    redis.call('zadd', job_expirations_key, now + expiration, index)\n  end\n  redis.call('hset', job_clients_key, index, client)\n  redis.call('zincrby', client_running_key, weight, client)\n  redis.call('hincrby', client_num_queued_key, client, -1)\n  redis.call('zadd', client_last_registered_key, now, client)\n\n  local wait = math.max(nextRequest - now, 0)\n  local newNextRequest = now + wait + minTime\n\n  if reservoir == nil then\n    redis.call('hset', settings_key,\n      'nextRequest', newNextRequest\n    )\n  else\n    reservoir = reservoir - weight\n    redis.call('hmset', settings_key,\n      'reservoir', reservoir,\n      'nextRequest', newNextRequest\n    )\n  end\n\n  refresh_expiration(now, newNextRequest, groupTimeout)\n\n  return {true, wait, reservoir}\n\nelse\n  return {false}\nend\n","register_client.lua":"local queued = tonumber(ARGV[num_static_argv + 1])\n\n-- Could have been re-registered concurrently\nif not redis.call('zscore', client_last_seen_key, client) then\n  redis.call('zadd', client_running_key, 0, client)\n  redis.call('hset', client_num_queued_key, client, queued)\n  redis.call('zadd', client_last_registered_key, 0, client)\nend\n\nredis.call('zadd', client_last_seen_key, now, client)\n\nreturn {}\n","running.lua":"return process_tick(now, false)['running']\n","submit.lua":"local queueLength = tonumber(ARGV[num_static_argv + 1])\nlocal weight = tonumber(ARGV[num_static_argv + 2])\n\nlocal capacity = process_tick(now, false)['capacity']\n\nlocal settings = redis.call('hmget', settings_key,\n  'id',\n  'maxConcurrent',\n  'highWater',\n  'nextRequest',\n  'strategy',\n  'unblockTime',\n  'penalty',\n  'minTime',\n  'groupTimeout'\n)\nlocal id = settings[1]\nlocal maxConcurrent = tonumber(settings[2])\nlocal highWater = tonumber(settings[3])\nlocal nextRequest = tonumber(settings[4])\nlocal strategy = tonumber(settings[5])\nlocal unblockTime = tonumber(settings[6])\nlocal penalty = tonumber(settings[7])\nlocal minTime = tonumber(settings[8])\nlocal groupTimeout = tonumber(settings[9])\n\nif maxConcurrent ~= nil and weight > maxConcurrent then\n  return redis.error_reply('OVERWEIGHT:'..weight..':'..maxConcurrent)\nend\n\nlocal reachedHWM = (highWater ~= nil and queueLength == highWater\n  and not (\n    conditions_check(capacity, weight)\n    and nextRequest - now <= 0\n  )\n)\n\nlocal blocked = strategy == 3 and (reachedHWM or unblockTime >= now)\n\nif blocked then\n  local computedPenalty = penalty\n  if computedPenalty == nil then\n    if minTime == 0 then\n      computedPenalty = 5000\n    else\n      computedPenalty = 15 * minTime\n    end\n  end\n\n  local newNextRequest = now + computedPenalty + minTime\n\n  redis.call('hmset', settings_key,\n    'unblockTime', now + computedPenalty,\n    'nextRequest', newNextRequest\n  )\n\n  local clients_queued_reset = redis.call('hkeys', client_num_queued_key)\n  local queued_reset = {}\n  for i = 1, #clients_queued_reset do\n    table.insert(queued_reset, clients_queued_reset[i])\n    table.insert(queued_reset, 0)\n  end\n  redis.call('hmset', client_num_queued_key, unpack(queued_reset))\n\n  redis.call('publish', 'b_'..id, 'blocked:')\n\n  refresh_expiration(now, newNextRequest, groupTimeout)\nend\n\nif not blocked and not reachedHWM then\n  redis.call('hincrby', client_num_queued_key, client, 1)\nend\n\nreturn {reachedHWM, blocked, strategy}\n","update_settings.lua":"local args = {'hmset', settings_key}\n\nfor i = num_static_argv + 1, #ARGV do\n  table.insert(args, ARGV[i])\nend\n\nredis.call(unpack(args))\n\nprocess_tick(now, true)\n\nlocal groupTimeout = tonumber(redis.call('hget', settings_key, 'groupTimeout'))\nrefresh_expiration(0, 0, groupTimeout)\n\nreturn {}\n","validate_client.lua":"if not redis.call('zscore', client_last_seen_key, client) then\n  return redis.error_reply('UNKNOWN_CLIENT')\nend\n\nredis.call('zadd', client_last_seen_key, now, client)\n","validate_keys.lua":"if not (redis.call('exists', settings_key) == 1) then\n  return redis.error_reply('SETTINGS_KEY_NOT_FOUND')\nend\n"},hasRequiredScripts,RedisConnection_1,hasRequiredRedisConnection,IORedisConnection_1,hasRequiredIORedisConnection,RedisDatastore_1,hasRequiredRedisDatastore,States_1,hasRequiredStates,Sync_1,hasRequiredSync;function requireScripts(){return hasRequiredScripts||(hasRequiredScripts=1,e=Scripts,t={refs:(r=require$$0)["refs.lua"],validate_keys:r["validate_keys.lua"],validate_client:r["validate_client.lua"],refresh_expiration:r["refresh_expiration.lua"],process_tick:r["process_tick.lua"],conditions_check:r["conditions_check.lua"],get_time:r["get_time.lua"]},e.allKeys=function(e){return[`b_${e}_settings`,`b_${e}_job_weights`,`b_${e}_job_expirations`,`b_${e}_job_clients`,`b_${e}_client_running`,`b_${e}_client_num_queued`,`b_${e}_client_last_registered`,`b_${e}_client_last_seen`]},n={init:{keys:e.allKeys,headers:["process_tick"],refresh_expiration:!0,code:r["init.lua"]},group_check:{keys:e.allKeys,headers:[],refresh_expiration:!1,code:r["group_check.lua"]},register_client:{keys:e.allKeys,headers:["validate_keys"],refresh_expiration:!1,code:r["register_client.lua"]},blacklist_client:{keys:e.allKeys,headers:["validate_keys","validate_client"],refresh_expiration:!1,code:r["blacklist_client.lua"]},heartbeat:{keys:e.allKeys,headers:["validate_keys","validate_client","process_tick"],refresh_expiration:!1,code:r["heartbeat.lua"]},update_settings:{keys:e.allKeys,headers:["validate_keys","validate_client","process_tick"],refresh_expiration:!0,code:r["update_settings.lua"]},running:{keys:e.allKeys,headers:["validate_keys","validate_client","process_tick"],refresh_expiration:!1,code:r["running.lua"]},queued:{keys:e.allKeys,headers:["validate_keys","validate_client"],refresh_expiration:!1,code:r["queued.lua"]},done:{keys:e.allKeys,headers:["validate_keys","validate_client","process_tick"],refresh_expiration:!1,code:r["done.lua"]},check:{keys:e.allKeys,headers:["validate_keys","validate_client","process_tick","conditions_check"],refresh_expiration:!1,code:r["check.lua"]},submit:{keys:e.allKeys,headers:["validate_keys","validate_client","process_tick","conditions_check"],refresh_expiration:!0,code:r["submit.lua"]},register:{keys:e.allKeys,headers:["validate_keys","validate_client","process_tick","conditions_check"],refresh_expiration:!0,code:r["register.lua"]},free:{keys:e.allKeys,headers:["validate_keys","validate_client","process_tick"],refresh_expiration:!0,code:r["free.lua"]},current_reservoir:{keys:e.allKeys,headers:["validate_keys","validate_client","process_tick"],refresh_expiration:!1,code:r["current_reservoir.lua"]},increment_reservoir:{keys:e.allKeys,headers:["validate_keys","validate_client","process_tick"],refresh_expiration:!0,code:r["increment_reservoir.lua"]}},e.names=Object.keys(n),e.keys=function(e,t){return n[e].keys(t)},e.payload=function(e){var r;return r=n[e],Array.prototype.concat(t.refs,r.headers.map(function(e){return t[e]}),r.refresh_expiration?t.refresh_expiration:"",r.code).join("\n")}),Scripts;var e,t,r,n}function requireRedisConnection(){if(hasRequiredRedisConnection)return RedisConnection_1;function asyncGeneratorStep(e,t,r,n,i,s,o){try{var a=e[s](o),l=a.value}catch(e){return void r(e)}a.done?t(l):Promise.resolve(l).then(n,i)}function _asyncToGenerator(e){return function(){var t=this,r=arguments;return new Promise(function(n,i){var s=e.apply(t,r);function o(e){asyncGeneratorStep(s,n,i,o,a,"next",e)}function a(e){asyncGeneratorStep(s,n,i,o,a,"throw",e)}o(void 0)})}}var Events,RedisConnection,Scripts,parser;return hasRequiredRedisConnection=1,parser=requireParser(),Events=requireEvents(),Scripts=requireScripts(),RedisConnection=function(){class RedisConnection{constructor(options={}){parser.load(options,this.defaults,this),null==this.Redis&&(this.Redis=eval("require")("redis")),null==this.Events&&(this.Events=new Events(this)),this.terminated=!1,null==this.client&&(this.client=this.Redis.createClient(this.clientOptions)),this.subscriber=this.client.duplicate(),this.limiters={},this.shas={},this.ready=this.Promise.all([this._setup(this.client,!1),this._setup(this.subscriber,!0)]).then(()=>this._loadScripts()).then(()=>({client:this.client,subscriber:this.subscriber}))}_setup(e,t){return e.setMaxListeners(0),new this.Promise((r,n)=>(e.on("error",e=>this.Events.trigger("error",e)),t&&e.on("message",(e,t)=>{var r;return null!=(r=this.limiters[e])?r._store.onMessage(e,t):void 0}),e.ready?r():e.once("ready",r)))}_loadScript(e){return new this.Promise((t,r)=>{var n;return n=Scripts.payload(e),this.client.multi([["script","load",n]]).exec((n,i)=>null!=n?r(n):(this.shas[e]=i[0],t(i[0])))})}_loadScripts(){return this.Promise.all(Scripts.names.map(e=>this._loadScript(e)))}__runCommand__(e){var t=this;return _asyncToGenerator(function*(){return yield t.ready,new t.Promise((r,n)=>t.client.multi([e]).exec_atomic(function(e,t){return null!=e?n(e):r(t[0])}))})()}__addLimiter__(e){return this.Promise.all([e.channel(),e.channel_client()].map(t=>new this.Promise((r,n)=>{var i;return i=n=>{if(n===t)return this.subscriber.removeListener("subscribe",i),this.limiters[t]=e,r()},this.subscriber.on("subscribe",i),this.subscriber.subscribe(t)})))}__removeLimiter__(e){var t=this;return this.Promise.all([e.channel(),e.channel_client()].map(function(){var e=_asyncToGenerator(function*(e){return t.terminated||(yield new t.Promise((r,n)=>t.subscriber.unsubscribe(e,function(t,i){return null!=t?n(t):i===e?r():void 0}))),delete t.limiters[e]});return function(t){return e.apply(this,arguments)}}()))}__scriptArgs__(e,t,r,n){var i;return i=Scripts.keys(e,t),[this.shas[e],i.length].concat(i,r,n)}__scriptFn__(e){return this.client.evalsha.bind(this.client)}disconnect(e=!0){var t,r,n,i;for(t=0,n=(i=Object.keys(this.limiters)).length;t<n;t++)r=i[t],clearInterval(this.limiters[r]._store.heartbeat);return this.limiters={},this.terminated=!0,this.client.end(e),this.subscriber.end(e),this.Promise.resolve()}}return RedisConnection.prototype.datastore="redis",RedisConnection.prototype.defaults={Redis:null,clientOptions:{},client:null,Promise:Promise,Events:null},RedisConnection}.call(void 0),RedisConnection_1=RedisConnection,RedisConnection_1}function requireIORedisConnection(){if(hasRequiredIORedisConnection)return IORedisConnection_1;function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function _iterableToArrayLimit(e,t){var r=[],n=!0,i=!1,s=void 0;try{for(var o,a=e[Symbol.iterator]();!(n=(o=a.next()).done)&&(r.push(o.value),!t||r.length!==t);n=!0);}catch(e){i=!0,s=e}finally{try{n||null==a.return||a.return()}finally{if(i)throw s}}return r}function _arrayWithHoles(e){if(Array.isArray(e))return e}function asyncGeneratorStep(e,t,r,n,i,s,o){try{var a=e[s](o),l=a.value}catch(e){return void r(e)}a.done?t(l):Promise.resolve(l).then(n,i)}function _asyncToGenerator(e){return function(){var t=this,r=arguments;return new Promise(function(n,i){var s=e.apply(t,r);function o(e){asyncGeneratorStep(s,n,i,o,a,"next",e)}function a(e){asyncGeneratorStep(s,n,i,o,a,"throw",e)}o(void 0)})}}var Events,IORedisConnection,Scripts,parser;return hasRequiredIORedisConnection=1,parser=requireParser(),Events=requireEvents(),Scripts=requireScripts(),IORedisConnection=function(){class IORedisConnection{constructor(options={}){parser.load(options,this.defaults,this),null==this.Redis&&(this.Redis=eval("require")("ioredis")),null==this.Events&&(this.Events=new Events(this)),this.terminated=!1,null!=this.clusterNodes?(this.client=new this.Redis.Cluster(this.clusterNodes,this.clientOptions),this.subscriber=new this.Redis.Cluster(this.clusterNodes,this.clientOptions)):null!=this.client&&null==this.client.duplicate?this.subscriber=new this.Redis.Cluster(this.client.startupNodes,this.client.options):(null==this.client&&(this.client=new this.Redis(this.clientOptions)),this.subscriber=this.client.duplicate()),this.limiters={},this.ready=this.Promise.all([this._setup(this.client,!1),this._setup(this.subscriber,!0)]).then(()=>(this._loadScripts(),{client:this.client,subscriber:this.subscriber}))}_setup(e,t){return e.setMaxListeners(0),new this.Promise((r,n)=>(e.on("error",e=>this.Events.trigger("error",e)),t&&e.on("message",(e,t)=>{var r;return null!=(r=this.limiters[e])?r._store.onMessage(e,t):void 0}),"ready"===e.status?r():e.once("ready",r)))}_loadScripts(){return Scripts.names.forEach(e=>this.client.defineCommand(e,{lua:Scripts.payload(e)}))}__runCommand__(e){var t=this;return _asyncToGenerator(function*(){yield t.ready;var r=_slicedToArray(yield t.client.pipeline([e]).exec(),1),n=_slicedToArray(r[0],2);return n[0],n[1]})()}__addLimiter__(e){return this.Promise.all([e.channel(),e.channel_client()].map(t=>new this.Promise((r,n)=>this.subscriber.subscribe(t,()=>(this.limiters[t]=e,r())))))}__removeLimiter__(e){var t=this;return[e.channel(),e.channel_client()].forEach(function(){var e=_asyncToGenerator(function*(e){return t.terminated||(yield t.subscriber.unsubscribe(e)),delete t.limiters[e]});return function(t){return e.apply(this,arguments)}}())}__scriptArgs__(e,t,r,n){var i;return[(i=Scripts.keys(e,t)).length].concat(i,r,n)}__scriptFn__(e){return this.client[e].bind(this.client)}disconnect(e=!0){var t,r,n,i;for(t=0,n=(i=Object.keys(this.limiters)).length;t<n;t++)r=i[t],clearInterval(this.limiters[r]._store.heartbeat);return this.limiters={},this.terminated=!0,e?this.Promise.all([this.client.quit(),this.subscriber.quit()]):(this.client.disconnect(),this.subscriber.disconnect(),this.Promise.resolve())}}return IORedisConnection.prototype.datastore="ioredis",IORedisConnection.prototype.defaults={Redis:null,clientOptions:{},clusterNodes:null,client:null,Promise:Promise,Events:null},IORedisConnection}.call(void 0),IORedisConnection_1=IORedisConnection,IORedisConnection_1}function requireRedisDatastore(){if(hasRequiredRedisDatastore)return RedisDatastore_1;function e(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=[],n=!0,i=!1,s=void 0;try{for(var o,a=e[Symbol.iterator]();!(n=(o=a.next()).done)&&(r.push(o.value),!t||r.length!==t);n=!0);}catch(e){i=!0,s=e}finally{try{n||null==a.return||a.return()}finally{if(i)throw s}}return r}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function t(e,t,r,n,i,s,o){try{var a=e[s](o),l=a.value}catch(e){return void r(e)}a.done?t(l):Promise.resolve(l).then(n,i)}function r(e){return function(){var r=this,n=arguments;return new Promise(function(i,s){var o=e.apply(r,n);function a(e){t(o,i,s,a,l,"next",e)}function l(e){t(o,i,s,a,l,"throw",e)}a(void 0)})}}var n,i,s,o,a;return hasRequiredRedisDatastore=1,a=requireParser(),n=requireBottleneckError(),s=requireRedisConnection(),i=requireIORedisConnection(),o=class{constructor(e,t,r){this.instance=e,this.storeOptions=t,this.originalId=this.instance.id,this.clientId=this.instance._randomIndex(),a.load(r,r,this),this.clients={},this.capacityPriorityCounters={},this.sharedConnection=null!=this.connection,null==this.connection&&(this.connection="redis"===this.instance.datastore?new s({Redis:this.Redis,clientOptions:this.clientOptions,Promise:this.Promise,Events:this.instance.Events}):"ioredis"===this.instance.datastore?new i({Redis:this.Redis,clientOptions:this.clientOptions,clusterNodes:this.clusterNodes,Promise:this.Promise,Events:this.instance.Events}):void 0),this.instance.connection=this.connection,this.instance.datastore=this.connection.datastore,this.ready=this.connection.ready.then(e=>(this.clients=e,this.runScript("init",this.prepareInitSettings(this.clearDatastore)))).then(()=>this.connection.__addLimiter__(this.instance)).then(()=>this.runScript("register_client",[this.instance.queued()])).then(()=>{var e;return"function"==typeof(e=this.heartbeat=setInterval(()=>this.runScript("heartbeat",[]).catch(e=>this.instance.Events.trigger("error",e)),this.heartbeatInterval)).unref&&e.unref(),this.clients})}__publish__(e){var t=this;return r(function*(){return(yield t.ready).client.publish(t.instance.channel(),`message:${e.toString()}`)})()}onMessage(t,n){var i=this;return r(function*(){var t,s,o,a,l,c,u,d,h,f;try{u=n.indexOf(":");var p=[n.slice(0,u),n.slice(u+1)];if(o=p[1],"capacity"===(f=p[0]))return yield i.instance._drainAll(o.length>0?~~o:void 0);if("capacity-priority"===f){var m=e(o.split(":"),3);return h=m[0],d=m[1],s=m[2],t=h.length>0?~~h:void 0,d===i.clientId?(a=yield i.instance._drainAll(t),c=null!=t?t-(a||0):"",yield i.clients.client.publish(i.instance.channel(),`capacity-priority:${c}::${s}`)):""===d?(clearTimeout(i.capacityPriorityCounters[s]),delete i.capacityPriorityCounters[s],i.instance._drainAll(t)):i.capacityPriorityCounters[s]=setTimeout(r(function*(){var e;try{return delete i.capacityPriorityCounters[s],yield i.runScript("blacklist_client",[d]),yield i.instance._drainAll(t)}catch(t){return e=t,i.instance.Events.trigger("error",e)}}),1e3)}if("message"===f)return i.instance.Events.trigger("message",o);if("blocked"===f)return yield i.instance._dropAllQueued()}catch(e){return l=e,i.instance.Events.trigger("error",l)}})()}__disconnect__(e){return clearInterval(this.heartbeat),this.sharedConnection?this.connection.__removeLimiter__(this.instance):this.connection.disconnect(e)}runScript(e,t){var n=this;return r(function*(){return"init"!==e&&"register_client"!==e&&(yield n.ready),new n.Promise((r,i)=>{var s,o;return s=[Date.now(),n.clientId].concat(t),n.instance.Events.trigger("debug",`Calling Redis script: ${e}.lua`,s),o=n.connection.__scriptArgs__(e,n.originalId,s,function(e,t){return null!=e?i(e):r(t)}),n.connection.__scriptFn__(e)(...o)}).catch(r=>"SETTINGS_KEY_NOT_FOUND"===r.message?"heartbeat"===e?n.Promise.resolve():n.runScript("init",n.prepareInitSettings(!1)).then(()=>n.runScript(e,t)):"UNKNOWN_CLIENT"===r.message?n.runScript("register_client",[n.instance.queued()]).then(()=>n.runScript(e,t)):n.Promise.reject(r))})()}prepareArray(e){var t,r,n,i;for(n=[],t=0,r=e.length;t<r;t++)i=e[t],n.push(null!=i?i.toString():"");return n}prepareObject(e){var t,r,n;for(r in t=[],e)n=e[r],t.push(r,null!=n?n.toString():"");return t}prepareInitSettings(e){var t;return(t=this.prepareObject(Object.assign({},this.storeOptions,{id:this.originalId,version:this.instance.version,groupTimeout:this.timeout,clientTimeout:this.clientTimeout}))).unshift(e?1:0,this.instance.version),t}convertBool(e){return!!e}__updateSettings__(e){var t=this;return r(function*(){return yield t.runScript("update_settings",t.prepareObject(e)),a.overwrite(e,e,t.storeOptions)})()}__running__(){return this.runScript("running",[])}__queued__(){return this.runScript("queued",[])}__done__(){return this.runScript("done",[])}__groupCheck__(){var e=this;return r(function*(){return e.convertBool(yield e.runScript("group_check",[]))})()}__incrementReservoir__(e){return this.runScript("increment_reservoir",[e])}__currentReservoir__(){return this.runScript("current_reservoir",[])}__check__(e){var t=this;return r(function*(){return t.convertBool(yield t.runScript("check",t.prepareArray([e])))})()}__register__(t,n,i){var s=this;return r(function*(){var r,o,a,l=e(yield s.runScript("register",s.prepareArray([t,n,i])),3);return o=l[0],a=l[1],r=l[2],{success:s.convertBool(o),wait:a,reservoir:r}})()}__submit__(t,i){var s=this;return r(function*(){var r,o,a,l,c;try{var u=e(yield s.runScript("submit",s.prepareArray([t,i])),3);return l=u[0],r=u[1],c=u[2],{reachedHWM:s.convertBool(l),blocked:s.convertBool(r),strategy:c}}catch(t){if(0===(o=t).message.indexOf("OVERWEIGHT")){var d=e(o.message.split(":"),3);throw d[0],i=d[1],a=d[2],new n(`Impossible to add a job having a weight of ${i} to a limiter having a maxConcurrent setting of ${a}`)}throw o}})()}__free__(e,t){var n=this;return r(function*(){return{running:yield n.runScript("free",n.prepareArray([e]))}})()}},RedisDatastore_1=o}function requireStates(){return hasRequiredStates?States_1:(hasRequiredStates=1,e=requireBottleneckError(),t=class{constructor(e){this.status=e,this._jobs={},this.counts=this.status.map(function(){return 0})}next(e){var t,r;return r=(t=this._jobs[e])+1,null!=t&&r<this.status.length?(this.counts[t]--,this.counts[r]++,this._jobs[e]++):null!=t?(this.counts[t]--,delete this._jobs[e]):void 0}start(e){return this._jobs[e]=0,this.counts[0]++}remove(e){var t;return null!=(t=this._jobs[e])&&(this.counts[t]--,delete this._jobs[e]),null!=t}jobStatus(e){var t;return null!=(t=this.status[this._jobs[e]])?t:null}statusJobs(t){var r,n,i,s;if(null!=t){if((n=this.status.indexOf(t))<0)throw new e(`status must be one of ${this.status.join(", ")}`);for(r in s=[],i=this._jobs)i[r]===n&&s.push(r);return s}return Object.keys(this._jobs)}statusCounts(){return this.counts.reduce((e,t,r)=>(e[this.status[r]]=t,e),{})}},States_1=t);var e,t}function requireSync(){if(hasRequiredSync)return Sync_1;function e(e,t,r,n,i,s,o){try{var a=e[s](o),l=a.value}catch(e){return void r(e)}a.done?t(l):Promise.resolve(l).then(n,i)}function t(t){return function(){var r=this,n=arguments;return new Promise(function(i,s){var o=t.apply(r,n);function a(t){e(o,i,s,a,l,"next",t)}function l(t){e(o,i,s,a,l,"throw",t)}a(void 0)})}}var r;return hasRequiredSync=1,r=requireDLList(),Sync_1=class{constructor(e,t){this.schedule=this.schedule.bind(this),this.name=e,this.Promise=t,this._running=0,this._queue=new r}isEmpty(){return 0===this._queue.length}_tryToRun(){var e=this;return t(function*(){var r,n,i,s,o,a,l;if(e._running<1&&e._queue.length>0){e._running++;var c=e._queue.shift();return l=c.task,r=c.args,o=c.resolve,s=c.reject,n=yield t(function*(){try{return a=yield l(...r),function(){return o(a)}}catch(e){return i=e,function(){return s(i)}}})(),e._running--,e._tryToRun(),n()}})()}schedule(e,...t){var r,n,i;return i=n=null,r=new this.Promise(function(e,t){return i=e,n=t}),this._queue.push({task:e,args:t,resolve:i,reject:n}),this._tryToRun(),r}}}var version="2.19.5",require$$8={version:version},Group_1,hasRequiredGroup,Batcher_1,hasRequiredBatcher,Bottleneck_1,hasRequiredBottleneck,lib,hasRequiredLib;function requireGroup(){if(hasRequiredGroup)return Group_1;function e(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=[],n=!0,i=!1,s=void 0;try{for(var o,a=e[Symbol.iterator]();!(n=(o=a.next()).done)&&(r.push(o.value),!t||r.length!==t);n=!0);}catch(e){i=!0,s=e}finally{try{n||null==a.return||a.return()}finally{if(i)throw s}}return r}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function t(e,t,r,n,i,s,o){try{var a=e[s](o),l=a.value}catch(e){return void r(e)}a.done?t(l):Promise.resolve(l).then(n,i)}function r(e){return function(){var r=this,n=arguments;return new Promise(function(i,s){var o=e.apply(r,n);function a(e){t(o,i,s,a,l,"next",e)}function l(e){t(o,i,s,a,l,"throw",e)}a(void 0)})}}var n,i,s,o,a,l;return hasRequiredGroup=1,l=requireParser(),n=requireEvents(),o=requireRedisConnection(),s=requireIORedisConnection(),a=requireScripts(),i=function(){class t{constructor(e={}){this.deleteKey=this.deleteKey.bind(this),this.limiterOptions=e,l.load(this.limiterOptions,this.defaults,this),this.Events=new n(this),this.instances={},this.Bottleneck=requireBottleneck(),this._startAutoCleanup(),this.sharedConnection=null!=this.connection,null==this.connection&&("redis"===this.limiterOptions.datastore?this.connection=new o(Object.assign({},this.limiterOptions,{Events:this.Events})):"ioredis"===this.limiterOptions.datastore&&(this.connection=new s(Object.assign({},this.limiterOptions,{Events:this.Events}))))}key(e=""){var t;return null!=(t=this.instances[e])?t:(()=>{var t;return t=this.instances[e]=new this.Bottleneck(Object.assign(this.limiterOptions,{id:`${this.id}-${e}`,timeout:this.timeout,connection:this.connection})),this.Events.trigger("created",t,e),t})()}deleteKey(e=""){var t=this;return r(function*(){var r,n;return n=t.instances[e],t.connection&&(r=yield t.connection.__runCommand__(["del",...a.allKeys(`${t.id}-${e}`)])),null!=n&&(delete t.instances[e],yield n.disconnect()),null!=n||r>0})()}limiters(){var e,t,r,n;for(e in r=[],t=this.instances)n=t[e],r.push({key:e,limiter:n});return r}keys(){return Object.keys(this.instances)}clusterKeys(){var t=this;return r(function*(){var r,n,i,s,o,a,l;if(null==t.connection)return t.Promise.resolve(t.keys());for(o=[],r=null,l=`b_${t.id}-`.length,9;0!==r;){var c=e(yield t.connection.__runCommand__(["scan",null!=r?r:0,"match",`b_${t.id}-*_settings`,"count",1e4]),2);for(r=~~c[0],i=0,a=(n=c[1]).length;i<a;i++)s=n[i],o.push(s.slice(l,-9))}return o})()}_startAutoCleanup(){var e,t=this;return clearInterval(this.interval),"function"==typeof(e=this.interval=setInterval(r(function*(){var e,r,n,i,s,o;for(r in s=Date.now(),i=[],n=t.instances){o=n[r];try{(yield o._store.__groupCheck__(s))?i.push(t.deleteKey(r)):i.push(void 0)}catch(t){e=t,i.push(o.Events.trigger("error",e))}}return i}),this.timeout/2)).unref?e.unref():void 0}updateSettings(e={}){if(l.overwrite(e,this.defaults,this),l.overwrite(e,e,this.limiterOptions),null!=e.timeout)return this._startAutoCleanup()}disconnect(e=!0){var t;if(!this.sharedConnection)return null!=(t=this.connection)?t.disconnect(e):void 0}}return t.prototype.defaults={timeout:3e5,connection:null,Promise:Promise,id:"group-key"},t}.call(void 0),Group_1=i}function requireBatcher(){return hasRequiredBatcher?Batcher_1:(hasRequiredBatcher=1,r=requireParser(),t=requireEvents(),e=function(){class e{constructor(e={}){this.options=e,r.load(this.options,this.defaults,this),this.Events=new t(this),this._arr=[],this._resetPromise(),this._lastFlush=Date.now()}_resetPromise(){return this._promise=new this.Promise((e,t)=>this._resolve=e)}_flush(){return clearTimeout(this._timeout),this._lastFlush=Date.now(),this._resolve(),this.Events.trigger("batch",this._arr),this._arr=[],this._resetPromise()}add(e){var t;return this._arr.push(e),t=this._promise,this._arr.length===this.maxSize?this._flush():null!=this.maxTime&&1===this._arr.length&&(this._timeout=setTimeout(()=>this._flush(),this.maxTime)),t}}return e.prototype.defaults={maxTime:null,maxSize:null,Promise:Promise},e}.call(void 0),Batcher_1=e);var e,t,r}function requireBottleneck(){if(hasRequiredBottleneck)return Bottleneck_1;function e(e,t){return n(e)||function(e,t){var r=[],n=!0,i=!1,s=void 0;try{for(var o,a=e[Symbol.iterator]();!(n=(o=a.next()).done)&&(r.push(o.value),!t||r.length!==t);n=!0);}catch(e){i=!0,s=e}finally{try{n||null==a.return||a.return()}finally{if(i)throw s}}return r}(e,t)||r()}function t(e){return n(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||r()}function r(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function n(e){if(Array.isArray(e))return e}function i(e,t,r,n,i,s,o){try{var a=e[s](o),l=a.value}catch(e){return void r(e)}a.done?t(l):Promise.resolve(l).then(n,i)}function s(e){return function(){var t=this,r=arguments;return new Promise(function(n,s){var o=e.apply(t,r);function a(e){i(o,n,s,a,l,"next",e)}function l(e){i(o,n,s,a,l,"throw",e)}a(void 0)})}}hasRequiredBottleneck=1;var o,a,l,c,u,d,h,f,p,m=[].splice;return p=requireParser(),u=requireQueues(),l=requireJob(),c=requireLocalDatastore(),d=requireRedisDatastore(),a=requireEvents(),h=requireStates(),f=requireSync(),o=function(){class r{constructor(e={},...t){var n,i;this._addToQueue=this._addToQueue.bind(this),this._validateOptions(e,t),p.load(e,this.instanceDefaults,this),this._queues=new u(10),this._scheduled={},this._states=new h(["RECEIVED","QUEUED","RUNNING","EXECUTING"].concat(this.trackDoneStatus?["DONE"]:[])),this._limiter=null,this.Events=new a(this),this._submitLock=new f("submit",this.Promise),this._registerLock=new f("register",this.Promise),i=p.load(e,this.storeDefaults,{}),this._store=function(){if("redis"===this.datastore||"ioredis"===this.datastore||null!=this.connection)return n=p.load(e,this.redisStoreDefaults,{}),new d(this,i,n);if("local"===this.datastore)return n=p.load(e,this.localStoreDefaults,{}),new c(this,i,n);throw new r.prototype.BottleneckError(`Invalid datastore type: ${this.datastore}`)}.call(this),this._queues.on("leftzero",()=>{var e;return null!=(e=this._store.heartbeat)&&"function"==typeof e.ref?e.ref():void 0}),this._queues.on("zero",()=>{var e;return null!=(e=this._store.heartbeat)&&"function"==typeof e.unref?e.unref():void 0})}_validateOptions(e,t){if(null==e||"object"!=typeof e||0!==t.length)throw new r.prototype.BottleneckError("Bottleneck v2 takes a single object argument. Refer to https://github.com/SGrondin/bottleneck#upgrading-to-v2 if you're upgrading from Bottleneck v1.")}ready(){return this._store.ready}clients(){return this._store.clients}channel(){return`b_${this.id}`}channel_client(){return`b_${this.id}_${this._store.clientId}`}publish(e){return this._store.__publish__(e)}disconnect(e=!0){return this._store.__disconnect__(e)}chain(e){return this._limiter=e,this}queued(e){return this._queues.queued(e)}clusterQueued(){return this._store.__queued__()}empty(){return 0===this.queued()&&this._submitLock.isEmpty()}running(){return this._store.__running__()}done(){return this._store.__done__()}jobStatus(e){return this._states.jobStatus(e)}jobs(e){return this._states.statusJobs(e)}counts(){return this._states.statusCounts()}_randomIndex(){return Math.random().toString(36).slice(2)}check(e=1){return this._store.__check__(e)}_clearGlobalState(e){return null!=this._scheduled[e]&&(clearTimeout(this._scheduled[e].expiration),delete this._scheduled[e],!0)}_free(e,t,r,n){var i=this;return s(function*(){var t,s;try{if(s=(yield i._store.__free__(e,r.weight)).running,i.Events.trigger("debug",`Freed ${r.id}`,n),0===s&&i.empty())return i.Events.trigger("idle")}catch(e){return t=e,i.Events.trigger("error",t)}})()}_run(e,t,r){var n,i,s;return t.doRun(),n=this._clearGlobalState.bind(this,e),s=this._run.bind(this,e,t),i=this._free.bind(this,e,t),this._scheduled[e]={timeout:setTimeout(()=>t.doExecute(this._limiter,n,s,i),r),expiration:null!=t.options.expiration?setTimeout(function(){return t.doExpire(n,s,i)},r+t.options.expiration):void 0,job:t}}_drainOne(e){return this._registerLock.schedule(()=>{var t,r,n,i,s;if(0===this.queued())return this.Promise.resolve(null);s=this._queues.getFirst();var o=n=s.first();return i=o.options,t=o.args,null!=e&&i.weight>e?this.Promise.resolve(null):(this.Events.trigger("debug",`Draining ${i.id}`,{args:t,options:i}),r=this._randomIndex(),this._store.__register__(r,i.weight,i.expiration).then(({success:e,wait:o,reservoir:a})=>{var l;return this.Events.trigger("debug",`Drained ${i.id}`,{success:e,args:t,options:i}),e?(s.shift(),(l=this.empty())&&this.Events.trigger("empty"),0===a&&this.Events.trigger("depleted",l),this._run(r,n,o),this.Promise.resolve(i.weight)):this.Promise.resolve(null)}))})}_drainAll(e,t=0){return this._drainOne(e).then(r=>{var n;return null!=r?(n=null!=e?e-r:e,this._drainAll(n,t+r)):this.Promise.resolve(t)}).catch(e=>this.Events.trigger("error",e))}_dropAllQueued(e){return this._queues.shiftAll(function(t){return t.doDrop({message:e})})}stop(e={}){var t,n;return e=p.load(e,this.stopDefaults),n=e=>{var t;return t=()=>{var t;return(t=this._states.counts)[0]+t[1]+t[2]+t[3]===e},new this.Promise((e,r)=>t()?e():this.on("done",()=>{if(t())return this.removeAllListeners("done"),e()}))},t=e.dropWaitingJobs?(this._run=function(t,r){return r.doDrop({message:e.dropErrorMessage})},this._drainOne=()=>this.Promise.resolve(null),this._registerLock.schedule(()=>this._submitLock.schedule(()=>{var t,r,i;for(t in r=this._scheduled)i=r[t],"RUNNING"===this.jobStatus(i.job.options.id)&&(clearTimeout(i.timeout),clearTimeout(i.expiration),i.job.doDrop({message:e.dropErrorMessage}));return this._dropAllQueued(e.dropErrorMessage),n(0)}))):this.schedule({priority:9,weight:0},()=>n(1)),this._receive=function(t){return t._reject(new r.prototype.BottleneckError(e.enqueueErrorMessage))},this.stop=()=>this.Promise.reject(new r.prototype.BottleneckError("stop() has already been called")),t}_addToQueue(e){var t=this;return s(function*(){var n,i,s,o,a,l,c;n=e.args,o=e.options;try{var u=yield t._store.__submit__(t.queued(),o.weight);a=u.reachedHWM,i=u.blocked,c=u.strategy}catch(r){return s=r,t.Events.trigger("debug",`Could not queue ${o.id}`,{args:n,options:o,error:s}),e.doDrop({error:s}),!1}return i?(e.doDrop(),!0):a&&(null!=(l=c===r.prototype.strategy.LEAK?t._queues.shiftLastFrom(o.priority):c===r.prototype.strategy.OVERFLOW_PRIORITY?t._queues.shiftLastFrom(o.priority+1):c===r.prototype.strategy.OVERFLOW?e:void 0)&&l.doDrop(),null==l||c===r.prototype.strategy.OVERFLOW)?(null==l&&e.doDrop(),a):(e.doQueue(a,i),t._queues.push(e),yield t._drainAll(),a)})()}_receive(e){return null!=this._states.jobStatus(e.options.id)?(e._reject(new r.prototype.BottleneckError(`A job with the same id already exists (id=${e.options.id})`)),!1):(e.doReceive(),this._submitLock.schedule(this._addToQueue,e))}submit(...r){var n,i,s,o,a,c,u,d,h;"function"==typeof r[0]?(c=t(r),i=c[0],r=c.slice(1),u=e(m.call(r,-1),1),n=u[0],o=p.load({},this.jobDefaults)):(o=(d=t(r))[0],i=d[1],r=d.slice(2),h=e(m.call(r,-1),1),n=h[0],o=p.load(o,this.jobDefaults));return a=(...e)=>new this.Promise(function(t,r){return i(...e,function(...e){return(null!=e[0]?r:t)(e)})}),(s=new l(a,r,o,this.jobDefaults,this.rejectOnDrop,this.Events,this._states,this.Promise)).promise.then(function(e){return"function"==typeof n?n(...e):void 0}).catch(function(e){return Array.isArray(e)?"function"==typeof n?n(...e):void 0:"function"==typeof n?n(e):void 0}),this._receive(s)}schedule(...e){var r,n,i;if("function"==typeof e[0]){var s=t(e);i=s[0],e=s.slice(1),n={}}else{var o=t(e);n=o[0],i=o[1],e=o.slice(2)}return r=new l(i,e,n,this.jobDefaults,this.rejectOnDrop,this.Events,this._states,this.Promise),this._receive(r),r.promise}wrap(e){var t,r;return t=this.schedule.bind(this),(r=function(...r){return t(e.bind(this),...r)}).withOptions=function(r,...n){return t(r,e,...n)},r}updateSettings(e={}){var t=this;return s(function*(){return yield t._store.__updateSettings__(p.overwrite(e,t.storeDefaults)),p.overwrite(e,t.instanceDefaults,t),t})()}currentReservoir(){return this._store.__currentReservoir__()}incrementReservoir(e=0){return this._store.__incrementReservoir__(e)}}return r.default=r,r.Events=a,r.version=r.prototype.version=require$$8.version,r.strategy=r.prototype.strategy={LEAK:1,OVERFLOW:2,OVERFLOW_PRIORITY:4,BLOCK:3},r.BottleneckError=r.prototype.BottleneckError=requireBottleneckError(),r.Group=r.prototype.Group=requireGroup(),r.RedisConnection=r.prototype.RedisConnection=requireRedisConnection(),r.IORedisConnection=r.prototype.IORedisConnection=requireIORedisConnection(),r.Batcher=r.prototype.Batcher=requireBatcher(),r.prototype.jobDefaults={priority:5,weight:1,expiration:null,id:"<no-id>"},r.prototype.storeDefaults={maxConcurrent:null,minTime:0,highWater:null,strategy:r.prototype.strategy.LEAK,penalty:null,reservoir:null,reservoirRefreshInterval:null,reservoirRefreshAmount:null,reservoirIncreaseInterval:null,reservoirIncreaseAmount:null,reservoirIncreaseMaximum:null},r.prototype.localStoreDefaults={Promise:Promise,timeout:null,heartbeatInterval:250},r.prototype.redisStoreDefaults={Promise:Promise,timeout:null,heartbeatInterval:5e3,clientTimeout:1e4,Redis:null,clientOptions:{},clusterNodes:null,clearDatastore:!1,connection:null},r.prototype.instanceDefaults={datastore:"local",connection:null,id:"<no-id>",rejectOnDrop:!0,trackDoneStatus:!1,Promise:Promise},r.prototype.stopDefaults={enqueueErrorMessage:"This limiter has been stopped and cannot accept new jobs.",dropWaitingJobs:!0,dropErrorMessage:"This limiter has been stopped."},r}.call(void 0),Bottleneck_1=o}function requireLib(){return hasRequiredLib?lib:(hasRequiredLib=1,lib=requireBottleneck())}var libExports=requireLib(),Bottleneck=getDefaultExportFromCjs(libExports);class DirectusError extends Error{constructor(e){super(e.statusText),this.name="Directus Migration Error",this.headers=e.headers,this.status=e.status,this.response=e,this.errors=[],this.message=e.statusText}formatError(){if(0===this.errors.length)return`Directus Error: ${this.message} (Status: ${this.status})`;let e=`Directus Error: ${this.errors[0]?.message.trim()} (Status: ${this.status})`;return this.errors[0]?.extensions&&(e+=` ${JSON.stringify(this.errors[0].extensions)}`),e}async parseErrors(){try{const e=await this.response.json();e&&Array.isArray(e.errors)&&(this.errors=e.errors,this.message=this.formatError())}catch{}}}async function enhancedFetch(...e){const t=await fetch(...e);if(!t.ok){const e=new DirectusError(t);throw await e.parseErrors(),e}return t}async function initLimiter(){const e=new Bottleneck({maxConcurrent:2,minTime:100,reservoir:50,reservoirRefreshAmount:50,reservoirRefreshInterval:1e3,retryCount:3});return e.on("failed",async(e,t)=>{if(console.error(e.message),console.error(e.errors[0]?.message),e instanceof DirectusError){const t=e.headers?.get("Retry-After"),r=e.status;if(429===r){const e=t?1e3*Number.parseInt(t,10):6e4;return console.warn(`Rate limited. Retrying after ${e}ms`),e}if(503===r){const e=t?1e3*Number.parseInt(t,10):5e3;return console.warn(`Server under pressure. Retrying after ${e}ms`),e}if(400===r||401===r)return}if(t.retryCount<3){const e=Math.min(1e3*2**t.retryCount,3e4);return console.warn(`Request failed. Retrying after ${e}ms`),e}console.warn("Max retries reached, not retrying further")}),e.on("retry",(e,t)=>{console.error(e),console.warn(`Retrying job (attempt ${t.retryCount+1})`)}),e.on("depleted",e=>{e&&console.warn("Rate limit quota depleted. Requests will be queued.")}),e}const directusUserFields=["id","status","first_name","last_name","email","password","token","last_access","last_page","external_identifier","tfa_secret","auth_data","provider","role","language","avatar","title","description","location","tags","email_notifications"],directusRoleFields=["id","name","description","icon"],directusFileFields=["id","storage","filename_disk","filename_download","title","type","folder","uploaded_by","uploaded_on","modified_by","modified_on","charset","filesize","width","height","duration","embed","description","location","tags","metadata"],directusFolderFields=["id","name","parent"],directusFlowFields=["id","name","icon","color","description","status","trigger","accountability","options","operation","date_created","user_created"],directusOperationFields=["id","name","key","type","position_x","position_y","options","resolve","reject","flow","date_created","user_created"],directusDashboardFields=["id","name","icon","note","date_created","user_created","color"],directusPanelFields=["id","dashboard","name","icon","color","show_header","note","type","position_x","position_y","width","height","options","date_created","user_created"],directusSettingsFields=["id","project_name","project_url","project_color","project_logo","public_foreground","public_background","public_note","auth_login_attempts","auth_password_policy","storage_asset_transform","storage_asset_presets","custom_css","storage_default_folder","basemaps","mapbox_key","module_bar","project_descriptor","default_language","custom_aspect_ratios","public_favicon","default_appearance","default_theme_light","theme_light_overrides","default_theme_dark","theme_dark_overrides"],directusPolicyFields=["id","name","icon","description","ip_access","enforce_tfa","admin_access","app_access"],directusPresetFields=["bookmark","user","role","collection","search","layout","layout_query","layout_options","refresh_interval","filter","icon","color"];async function extractContent({res:e,services:t,accountability:r,schema:n,scope:i,folder:s,storage:o}){const{CollectionsService:a,FieldsService:l,FilesService:c,ItemsService:u}=t,d=new a({accountability:r,schema:n}),h=new l({accountability:r,schema:n}),f=new c({accountability:r,schema:n});try{e.write("* Fetching collections");const t=await d.readByQuery({limit:-1});e.write(" ...done\r\n\r\n"),e.write("* Fetching fields");const a=await getCollectionPrimaryKeys(h);e.write(" ...done\r\n\r\n"),e.write("* Fetching full data");const l=i.content?await loadFullData$1(t,u,a,r,n):[];e.write(" ..."),await saveToFile(l,"items_full_data",f,s,o),e.write("done\r\n\r\n"),e.write("* Fetching singletons");const c=i.content?await loadSingletons$1(t,u,r,n):[];e.write(" ..."),await saveToFile(c,"items_singleton",f,s,o),e.write("done\r\n\r\n"),e.write("* Fetching files");const p=i.content?await f.readByQuery({fields:directusFileFields,filter:{_or:[{folder:{_neq:s}},{folder:{_null:!0}}]},limit:-1}):[];return e.write(" ..."),await saveToFile(p,"files",f,s,o),e.write("done\r\n\r\n"),{collections:t,fullData:l,singletons:c,files:p,data_errors:null}}catch(e){return console.error(e),{collections:null,fullData:null,singletons:null,files:null,data_errors:e}}}async function extractData(e,t,r,n,i){let s=1;const o=[i];let a=[];const l=new t(e,{accountability:r,schema:n});for(;;)try{const e=await l.readByQuery({limit:100,page:s,sort:o});if(0===e.length)break;for(const t of e)a.push(t);if(e.length<100)break;s++}catch(e){console.error(e),a=null;break}return a}async function extractSingleton(e,t,r,n){const i=new t(e,{accountability:r,schema:n});return await i.readSingleton({})}async function loadFullData$1(e,t,r,n,i){const s=e.filter(e=>!e.collection.startsWith("directus_",0)).filter(e=>null!==e.schema).filter(e=>!e.meta?.singleton);return await Promise.all(s.map(async e=>{const s=e.collection,o=getPrimaryKey(r,s);return{collection:s,primaryKeyField:o,items:await extractData(s,t,n,i,o)}}))}async function loadSingletons$1(e,t,r,n){const i=e.filter(e=>!e.collection.startsWith("directus_",0)).filter(e=>e.meta?.singleton);return await Promise.all(i.map(async e=>{const i=e.collection;return{collection:i,item:await extractSingleton(i,t,r,n)}}))}async function getCollectionPrimaryKeys(e){const t=await e.readAll();if(!t)return;const r={};for(const e of t)e.schema&&e.schema?.is_primary_key&&(r[e.collection]=e.field);return r}function getPrimaryKey(e,t){return e[t]||console.error(`Collection ${t} not found in collections map`),e[t]}async function extractSystemData({res:e,services:t,accountability:r,schema:n,scope:i,folder:s,storage:o}){const{AccessService:a,CommentsService:l,DashboardsService:c,ExtensionsService:u,FilesService:d,FlowsService:h,FoldersService:f,OperationsService:p,PanelsService:m,PermissionsService:_,PoliciesService:g,PresetsService:y,RolesService:v,SettingsService:b,SharesService:w,TranslationsService:$,UsersService:R}=t,E=new v({accountability:r,schema:n}),S=new g({accountability:r,schema:n}),A=new _({accountability:r,schema:n}),O=new R({accountability:r,schema:n}),k=new a({accountability:r,schema:n}),I=new f({accountability:r,schema:n}),T=new d({accountability:r,schema:n}),C=new c({accountability:r,schema:n}),x=new h({accountability:r,schema:n}),N=new m({accountability:r,schema:n}),q=new p({accountability:r,schema:n}),P=new b({accountability:r,schema:n}),D=new $({accountability:r,schema:n}),L=new y({accountability:r,schema:n}),j=new u({accountability:r,schema:n}),F=new l({accountability:r,schema:n}),M=new w({accountability:r,schema:n});try{e.write(i.users?"* Fetching roles":"* Skipping roles\r\n\r\n");const t=i.users?await E.readByQuery({fields:directusRoleFields,limit:-1}):[];i.users&&(e.write(" ..."),await saveToFile(t,"roles",T,s,o),e.write("done\r\n\r\n")),e.write(i.users?"* Fetching policies":"* Skipping policies\r\n\r\n");const r=i.users?await S.readByQuery({fields:directusPolicyFields,limit:-1}):[];i.users&&(e.write(" ..."),await saveToFile(r,"policies",T,s,o),e.write("done\r\n\r\n")),e.write(i.users?"* Fetching permissions":"* Skipping permissions\r\n\r\n");const n=i.users?await A.readByQuery({limit:-1}):[];i.users&&(e.write(" ..."),await saveToFile(n,"permissions",T,s,o),e.write("done\r\n\r\n")),e.write(i.users?"* Fetching users":"* Skipping users\r\n\r\n");const a=i.users?await O.readByQuery({fields:directusUserFields,limit:-1}):[];i.users&&(e.write(" ..."),await saveToFile(a,"users",T,s,o),e.write("done\r\n\r\n")),e.write(i.users?"* Fetching access":"* Skipping access\r\n\r\n");const l=i.users?await k.readByQuery({limit:-1}):[];i.users&&(e.write(" ..."),await saveToFile(l,"access",T,s,o),e.write("done\r\n\r\n")),e.write(i.content?"* Fetching folders":"* Skipping folders\r\n\r\n");const c=i.content?await I.readByQuery({fields:directusFolderFields,filter:{id:{_neq:s}},limit:-1}):[];i.content&&(e.write(" ..."),await saveToFile(c,"folders",T,s,o),e.write("done\r\n\r\n")),e.write(i.dashboards?"* Fetching dashboards":"* Skipping dashboards\r\n\r\n");const u=i.dashboards?await C.readByQuery({fields:directusDashboardFields,limit:-1}):[];i.dashboards&&(e.write(" ..."),await saveToFile(u,"dashboards",T,s,o),e.write("done\r\n\r\n")),e.write(i.dashboards?"* Fetching panels":"* Skipping panels\r\n\r\n");const d=i.dashboards?await N.readByQuery({fields:directusPanelFields,limit:-1}):[];i.dashboards&&(e.write(" ..."),await saveToFile(d,"panels",T,s,o),e.write("done\r\n\r\n")),e.write(i.flows?"* Fetching flows":"* Skipping flows\r\n\r\n");const h=i.flows?await x.readByQuery({fields:directusFlowFields,limit:-1}):[];i.flows&&(e.write(" ..."),await saveToFile(h,"flows",T,s,o),e.write("done\r\n\r\n")),e.write(i.flows?"* Fetching operations":"* Skipping operations\r\n\r\n");const f=i.flows?await q.readByQuery({fields:directusOperationFields,limit:-1}):[];i.flows&&(e.write(" ..."),await saveToFile(f,"operations",T,s,o),e.write("done\r\n\r\n")),e.write("* Fetching settings");const p=await P.readSingleton({fields:directusSettingsFields});e.write(" ..."),await saveToFile(p,"settings",T,s,o),e.write("done\r\n\r\n"),e.write("* Fetching translations");const m=await D.readByQuery({limit:-1});e.write(" ..."),await saveToFile(m,"translations",T,s,o),e.write("done\r\n\r\n"),e.write(i.presets?"* Fetching presets":"* Skipping presets");const _=i.presets?await L.readByQuery({fields:directusPresetFields,limit:-1}):[];i.presets&&(e.write(" ..."),await saveToFile(_,"presets",T,s,o),e.write("done\r\n\r\n")),e.write(i.extensions?"* Fetching extensions":"* Skipping extensions\r\n\r\n");const g=i.extensions?await j.readAll():[];i.extensions&&(e.write(" ..."),await saveToFile(g,"extensions",T,s,o),e.write("done\r\n\r\n")),e.write(i.comments?"* Fetching comments":"* Skipping comments");const y=i.comments?await F.readByQuery({limit:-1}):[];i.comments&&(e.write(" ..."),await saveToFile(y,"comments",T,s,o),e.write("done\r\n\r\n")),e.write(i.users?"* Fetching shares":"* Skipping shares\r\n\r\n");const v=i.users?await M.readByQuery({limit:-1}):[];return i.users&&(e.write(" ..."),await saveToFile(v,"shares",T,s,o),e.write("done\r\n\r\n")),{roles:t,policies:r,permissions:n,users:a,access:l,folders:c,dashboards:u,flows:h,panels:d,operations:f,settings:p,translations:m,presets:_,extensions:g,comments:y,shares:v,system_errors:null}}catch(e){return console.error(e),{roles:null,policies:null,permissions:null,users:null,access:null,folders:null,dashboards:null,flows:null,panels:null,operations:null,settings:null,translations:null,presets:null,extensions:null,comments:null,shares:null,system_errors:e}}}async function getRoleIds(e,t){const r=t.find(e=>"Administrator"===e.name)?.id,n=await e.request(r$5()),i=n.role;return{email:n.email,legacyAdminRoleId:r,newAdminRoleId:i}}async function migrateAccess({res:e,client:t,access:r,roles:n,dry_run:i=!1}){if(!r||!n)return e.write("* Couldn't read data from extract\r\n\r\n"),{name:"Directus Error",status:404,errors:[{message:"No access records found"}]};if(0===r.length)return e.write("* No access records to migrate\r\n\r\n"),{response:"Empty",name:"Access"};e.write(`* [Local] Using ${r.length} access records\r\n\r\n`);try{e.write("* [Remote] Fetching Existing Access ...");const s=await t.request(()=>({method:"GET",params:{limit:-1},path:"/access"}));if(!s)return{name:"Directus Error",status:404,errors:[{message:"Issue Fetching Access"}]};e.write("done\r\n\r\n");const{legacyAdminRoleId:o,newAdminRoleId:a}=n?await getRoleIds(t,n):{legacyAdminRoleId:null,newAdminRoleId:null},l=new Map(s.map(e=>[e.id,e])),c=new Map(s.map(e=>[getCompositeKey(e),e]));e.write(`* [Remote] Uploading ${r.length} ${r.length>1?"Access record":"Access records"} `);for await(const n of r){if(l.has(n.id))continue;const r=getCompositeKey(n);c.has(r)||(null===n.role&&delete n.role,n.role===o&&(n.role=a),e.write("."),i||await t.request(()=>({body:JSON.stringify(n),method:"POST",path:"/access"})),l.set(n.id,n),c.set(r,n))}return e.write(i?"skipped\r\n\r\n":"done\r\n\r\n"),e.write("* Access Migration Complete\r\n\r\n"),{response:"Success",name:"Access"}}catch(t){const r=t;return e.write("error\r\n\r\n"),r.errors&&r.errors.length>0&&e.write(`${r.errors[0]?.message}\r\n\r\n`),r}}function getCompositeKey(e){return`${e.role??"null"}-${e.user??"null"}-${e.policy}`}async function migrateComments({res:e,client:t,comments:r,dry_run:n=!1}){if(!r)return e.write("* Couldn't read data from extract\r\n\r\n"),{name:"Directus Error",status:404,errors:[{message:"No comments found"}]};if(0===r.length)return e.write("* No comments to migrate\r\n\r\n"),{response:"Empty",name:"Comments"};e.write(`* [Local] Found ${r.length} comments\r\n\r\n`);try{e.write("* [Remote] Fetching Existing Comments ...");const i=await t.request(t$b({limit:-1}));if(!i)return{name:"Directus Error",status:404,errors:[{message:"Issue Fetching Comments"}]};e.write("done\r\n\r\n");const s=new Set(i.map(e=>e.id)),o=r.filter(e=>!s.has(e.id));return e.write(o.length>0?`* [Remote] Uploading ${o.length} ${o.length>1?"Comments":"Comment"} `:"* No Comments to migrate\r\n\r\n"),o.length>0&&(e.write("."),n||await t.request(e$d(o)),e.write(n?"skipped\r\n\r\n":"done\r\n\r\n")),e.write("* Comments Migration Complete\r\n\r\n"),{response:"Success",name:"Comments"}}catch(t){const r=t;return e.write("error\r\n\r\n"),r.errors&&r.errors.length>0&&e.write(`${r.errors[0]?.message}\r\n\r\n`),r}}async function migrateDashboards({res:e,client:t,dashboards:r,dry_run:n=!1}){if(!r)return e.write("* Couldn't read data from extract\r\n\r\n"),{name:"Directus Error",status:404,errors:[{message:"No dashboards found"}]};if(0===r.length)return e.write("* No dashboards to migrate\r\n\r\n"),{response:"Empty",name:"Insights"};e.write(`* [Local] Found ${r.length} dashboards\r\n\r\n`);try{e.write("* [Remote] Fetching Existing Dashboards ...");const i=await t.request(t$a({limit:-1}));if(!i)return{name:"Directus Error",status:404,errors:[{message:"Issue Fetching Dashboards"}]};e.write("done\r\n\r\n");const s=new Set(i.map(e=>e.id)),o=r.filter(e=>!s.has(e.id)).map(e=>{const t={...e};return delete t.panels,t});return e.write(o.length>0?`* [Remote] Uploading ${o.length} ${o.length>1?"Dashboards":"Dashboard"} `:"* No Dashboards to migrate\r\n\r\n"),o.length>0&&(await Promise.all(o.map(async r=>{e.write("."),await t.request(t$k(r))})),e.write(n?"skipped\r\n\r\n":"done\r\n\r\n"),e.write("* Dashboard Migration Complete\r\n\r\n")),{response:"Success",name:"Insights"}}catch(t){console.error(t);const r=t;return e.write("error\r\n\r\n"),r.errors&&r.errors.length>0&&e.write(`${r.errors[0]?.message}\r\n\r\n`),r}}function chunkArray(e,t){return Array.from({length:Math.ceil(e.length/t)},(r,n)=>e.slice(n*t,(n+1)*t))}const BATCH_SIZE=50;async function migrateData({res:e,client:t,fullData:r,singletons:n,dry_run:i=!1}){return r&&n?0===r.length&&0===n.length?(e.write("* No content to migrate\r\n\r\n"),{response:"Empty",name:"Content"}):(n&&await loadSkeletonSingletons(e,t,n,i),r&&(await loadSkeletonRecords(e,t,r,i),await loadFullData(e,t,r,i)),n&&await loadSingletons(e,t,n,i),{response:"Success",name:"Content"}):(e.write("* Couldn't read content from extract\r\n\r\n"),{name:"Directus Error",status:404,errors:[{message:"No content found"}]})}async function loadSkeletonRecords(e,t,r,n){e.write("* Loading skeleton records\r\n\r\n"),await Promise.all(r.map(async r=>{const i=r.collection,s=r.primaryKeyField,o=r.items;e.write(`* [Remote] Fetching existing data for ${i} ...`);const a=await getExistingPrimaryKeys(e,t,i,s);e.write("done\r\n\r\n");const l=o?.filter(e=>!a.has(e[s]));if(!l||0===l.length)return void e.write(`* Skipping ${i}: No new records to add\r\n\r\n`);const c=chunkArray(l,BATCH_SIZE).map(e=>e.map(e=>({[s]:e[s]})));await Promise.all(c.map(async(r,s)=>{e.write(`    * [Remote] Uploading ${i} content ${s+1} of ${c.length}\r\n\r\n`),await uploadBatch(e,t,i,r,t$i,n)})),e.write(`* ${l.length} ${l.length>1?"records":"record"} ${n?"processed for":"uploaded to"} ${i}\r\n\r\n`)})),e.write("* Skeleton records migrated\r\n\r\n\r\n\r\n")}async function getExistingPrimaryKeys(e,t,r,n){const i=new Set;let s=1;const o=[n];for(e.write(`* [Remote] Fetching ${r} primary keys\r\n\r\n`);;)try{const e=await t.request(n$2(r,{fields:[n],limit:100,page:s,sort:o}));if(0===e.length)break;for(const t of e)i.add(t[n]);if(e.length<100)break;s++}catch(t){console.error(t);const r=t;r.errors&&r.errors.length>0&&e.write(`${r.errors[0]?.message}\r\n\r\n`);break}return e.write("done\r\n\r\n"),i}async function uploadBatch(e,t,r,n,i,s){try{s||await t.request(i(r,n))}catch(t){console.error(t);const r=t;e.write("error\r\n\r\n"),r.errors&&r.errors.length>0&&e.write(`${r.errors[0]?.message}\r\n\r\n`)}}async function loadFullData(e,t,r,n){e.write("* Updating records with full data\r\n\r\n"),await Promise.all(r.map(async r=>{const i=r.collection,s=r.items;if(!s)return;const o=chunkArray(s,BATCH_SIZE).map(e=>e.map(({user_created:e,user_updated:t,...r})=>r));let a=0;await Promise.all(o.map(async r=>{a++,e.write(`* [Remote] Uploading ${i} content ${a} of ${o.length}\r\n\r\n`),await uploadBatch(e,t,i,r,r$3,n)}))})),e.write("* All collections updated with full data\r\n\r\n")}async function loadSingletons(e,t,r,n){e.write("* Loading data for singleton collections .."),await Promise.all(r.map(async r=>{const i=r.collection,s=r.item;try{const{user_created:r,user_updated:o,...a}=s;e.write("."),n||await t.request(n$1(i,a))}catch(t){console.error(t);const r=t;return e.write("error\r\n\r\n"),r.errors&&r.errors.length>0&&e.write(`${r.errors[0]?.message}\r\n\r\n`),r}})),e.write(n?"skipped\r\n\r\n":"done\r\n\r\n"),e.write("* Loaded data for singleton collections\r\n\r\n")}async function loadSkeletonSingletons(e,t,r,n){e.write("* Loading skeleton singletons\r\n\r\n"),await Promise.all(r.map(async r=>{const i=r.collection;try{n||await t.request(n$1(i,{}))}catch(t){console.error(t);const r=t;return e.write("error\r\n\r\n"),r.errors&&r.errors.length>0&&e.write(`${r.errors[0]?.message}\r\n\r\n`),r}})),e.write(n?"skipped\r\n\r\n":"done\r\n\r\n"),e.write("* Loaded skeletons for singleton collections\r\n\r\n")}async function installExtension(t,r){await r.request(e({body:JSON.stringify({extension:t.id,version:t.version}),method:"POST",path:"/extensions/registry/install"}))}async function migrateExtensions({res:e,client:t,extensions:r,dry_run:n=!1}){if(!r)return e.write("* Couldn't read data from extract\r\n\r\n"),{name:"Directus Error",status:404,errors:[{message:"No extensions found"}]};if(0===r.length)return e.write("* No extensions to migrate\r\n\r\n"),{response:"Empty",name:"Extensions"};e.write(`* [Local] Found ${r.length} extensions\r\n\r\n`);try{const i=await t.request(e$5()),s=r.filter(e=>"registry"===e.meta?.source&&!e.bundle),o=[...new Set(r.filter(e=>e.bundle).map(e=>e.bundle))],a=r.filter(e=>"local"===e.meta?.source),l=r.filter(e=>"registry"===e.meta?.source&&!e.bundle&&!i.some(t=>"id"in t&&t.id===e.id));if(e.write(`* Found ${r.length} extensions total: ${s.length} registry extensions (including ${o.length} bundles), and ${a.length} local extensions`),e.write(r.length>0?`* [Remote] Installing ${r.length} ${r.length>1?"Extensions":"Extension"} `:"No Extensions to migrate\r\n\r\n"),l.length>0){const r=await Promise.allSettled(l.map(async e=>{try{return n?`-- Skipped ${e.schema?.name}`:(await installExtension({id:e.id,version:e.meta?.folder},t),`-- Installed ${e.schema?.name}`)}catch(t){return console.error(t),`-- Failed to install ${e.schema?.name}`}}));for(const t of r)"fulfilled"===t.status&&e.write(`${t.value}\r\n\r\n`);e.write("* Finished installing extensions\r\n\r\n")}else e.write("* All extensions are already installed\r\n\r\n");return a.length>0&&(e.write(`* Note: ${a.length} local extensions need to be installed manually:\r\n\r\n`),a.forEach(t=>{"name"in t.schema&&e.write(`    * ${t.schema.name}\r\n\r\n`)})),e.write("* Extension Migration Complete\r\n\r\n"),{response:"Success",name:"Extensions"}}catch{return e.write("* No extensions found or extensions file is empty. Skipping extension installation.\r\n\r\n"),{response:"Skipped",name:"Extensions"}}}var __accessCheck=(e,t,r)=>{if(!t.has(e))throw TypeError("Cannot "+r)},__privateGet=(e,t,r)=>(__accessCheck(e,t,"read from private field"),r?r.call(e):t.get(e)),__privateAdd=(e,t,r)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,r)},__privateSet=(e,t,r,n)=>(__accessCheck(e,t,"write to private field"),t.set(e,r),r),__privateMethod=(e,t,r)=>(__accessCheck(e,t,"access private method"),r),isFunction=e=>"function"==typeof e,isObject=e=>"object"==typeof e&&null!=e&&!Array.isArray(e),isAsyncIterable=e=>isObject(e)&&isFunction(e[Symbol.asyncIterator]),MAX_CHUNK_SIZE=65536;async function*clonePart(e){if(e.byteLength<=MAX_CHUNK_SIZE)return void(yield e);let t=0;for(;t<e.byteLength;){const r=Math.min(e.byteLength-t,MAX_CHUNK_SIZE),n=e.buffer.slice(t,t+r);t+=n.byteLength,yield new Uint8Array(n)}}async function*readStream(e){const t=e.getReader();for(;;){const{done:e,value:r}=await t.read();if(e)break;yield r}}async function*chunkStream(e){for await(const t of e)yield*clonePart(t)}var getStreamIterator=e=>{if(isAsyncIterable(e))return chunkStream(e);if(isFunction(e.getReader))return chunkStream(readStream(e));throw new TypeError("Unsupported data source: Expected either ReadableStream or async iterable.")},_parts,_type,_size;async function*consumeNodeBlob(e){let t=0;for(;t!==e.size;){const r=e.slice(t,Math.min(e.size,t+MAX_CHUNK_SIZE)),n=await r.arrayBuffer();t+=n.byteLength,yield new Uint8Array(n)}}async function*consumeBlobParts(e,t=!1){for(const r of e)ArrayBuffer.isView(r)?t?yield*clonePart(r):yield r:isFunction(r.stream)?yield*getStreamIterator(r.stream()):yield*consumeNodeBlob(r)}function*sliceBlob(e,t,r=0,n){n??=t;let i=r<0?Math.max(t+r,0):Math.min(r,t),s=n<0?Math.max(t+n,0):Math.min(n,t);const o=Math.max(s-i,0);let a=0;for(const t of e){if(a>=o)break;const e=ArrayBuffer.isView(t)?t.byteLength:t.size;if(i&&e<=i)i-=e,s-=e;else{let r;ArrayBuffer.isView(t)?(r=t.subarray(i,Math.min(e,s)),a+=r.byteLength):(r=t.slice(i,Math.min(e,s)),a+=r.size),s-=e,i=0,yield r}}}var _Blob=class e{constructor(t=[],r={}){if(__privateAdd(this,_parts,[]),__privateAdd(this,_type,""),__privateAdd(this,_size,0),r??={},"object"!=typeof t||null===t)throw new TypeError("Failed to construct 'Blob': The provided value cannot be converted to a sequence.");if(!isFunction(t[Symbol.iterator]))throw new TypeError("Failed to construct 'Blob': The object must have a callable @@iterator property.");if("object"!=typeof r&&!isFunction(r))throw new TypeError("Failed to construct 'Blob': parameter 2 cannot convert to dictionary.");const n=new TextEncoder;for(const r of t){let t;t=ArrayBuffer.isView(r)?new Uint8Array(r.buffer.slice(r.byteOffset,r.byteOffset+r.byteLength)):r instanceof ArrayBuffer?new Uint8Array(r.slice(0)):r instanceof e?r:n.encode(String(r)),__privateSet(this,_size,__privateGet(this,_size)+(ArrayBuffer.isView(t)?t.byteLength:t.size)),__privateGet(this,_parts).push(t)}const i=void 0===r.type?"":String(r.type);__privateSet(this,_type,/^[\x20-\x7E]*$/.test(i)?i:"")}static[Symbol.hasInstance](e){return Boolean(e&&"object"==typeof e&&isFunction(e.constructor)&&(isFunction(e.stream)||isFunction(e.arrayBuffer))&&/^(Blob|File)$/.test(e[Symbol.toStringTag]))}get type(){return __privateGet(this,_type)}get size(){return __privateGet(this,_size)}slice(t,r,n){return new e(sliceBlob(__privateGet(this,_parts),this.size,t,r),{type:n})}async text(){const e=new TextDecoder;let t="";for await(const r of consumeBlobParts(__privateGet(this,_parts)))t+=e.decode(r,{stream:!0});return t+=e.decode(),t}async arrayBuffer(){const e=new Uint8Array(this.size);let t=0;for await(const r of consumeBlobParts(__privateGet(this,_parts)))e.set(r,t),t+=r.length;return e.buffer}stream(){const e=consumeBlobParts(__privateGet(this,_parts),!0);return new ReadableStream({async pull(t){const{value:r,done:n}=await e.next();if(n)return queueMicrotask(()=>t.close());t.enqueue(r)},async cancel(){await e.return()}})}get[Symbol.toStringTag](){return"Blob"}};_parts=new WeakMap,_type=new WeakMap,_size=new WeakMap;var Blob=_Blob;Object.defineProperties(Blob.prototype,{type:{enumerable:!0},size:{enumerable:!0},slice:{enumerable:!0},stream:{enumerable:!0},text:{enumerable:!0},arrayBuffer:{enumerable:!0}});var isBlob=e=>e instanceof Blob,_name,_lastModified,File=class extends Blob{constructor(e,t,r={}){if(super(e,r),__privateAdd(this,_name,void 0),__privateAdd(this,_lastModified,0),arguments.length<2)throw new TypeError(`Failed to construct 'File': 2 arguments required, but only ${arguments.length} present.`);__privateSet(this,_name,String(t));const n=void 0===r.lastModified?Date.now():Number(r.lastModified);Number.isNaN(n)||__privateSet(this,_lastModified,n)}static[Symbol.hasInstance](e){return e instanceof Blob&&"File"===e[Symbol.toStringTag]&&"string"==typeof e.name}get name(){return __privateGet(this,_name)}get webkitRelativePath(){return""}get lastModified(){return __privateGet(this,_lastModified)}get[Symbol.toStringTag](){return"File"}};_name=new WeakMap,_lastModified=new WeakMap;var isFile=e=>e instanceof File,_entries,_setEntry,setEntry_fn,FormData=class{constructor(){__privateAdd(this,_setEntry),__privateAdd(this,_entries,new Map)}static[Symbol.hasInstance](e){if(!e)return!1;const t=e;return Boolean(isFunction(t.constructor)&&"FormData"===t[Symbol.toStringTag]&&isFunction(t.append)&&isFunction(t.set)&&isFunction(t.get)&&isFunction(t.getAll)&&isFunction(t.has)&&isFunction(t.delete)&&isFunction(t.entries)&&isFunction(t.values)&&isFunction(t.keys)&&isFunction(t[Symbol.iterator])&&isFunction(t.forEach))}append(e,t,r){__privateMethod(this,_setEntry,setEntry_fn).call(this,{name:e,fileName:r,append:!0,rawValue:t,argsLength:arguments.length})}set(e,t,r){__privateMethod(this,_setEntry,setEntry_fn).call(this,{name:e,fileName:r,append:!1,rawValue:t,argsLength:arguments.length})}get(e){const t=__privateGet(this,_entries).get(String(e));return t?t[0]:null}getAll(e){const t=__privateGet(this,_entries).get(String(e));return t?t.slice():[]}has(e){return __privateGet(this,_entries).has(String(e))}delete(e){__privateGet(this,_entries).delete(String(e))}*keys(){for(const e of __privateGet(this,_entries).keys())yield e}*entries(){for(const e of this.keys()){const t=this.getAll(e);for(const r of t)yield[e,r]}}*values(){for(const[,e]of this)yield e}[Symbol.iterator](){return this.entries()}forEach(e,t){for(const[r,n]of this)e.call(t,n,r,this)}get[Symbol.toStringTag](){return"FormData"}};
/*! Based on fetch-blob. MIT License. Jimmy Wärting <https://jimmy.warting.se/opensource> & David Frank */
async function migrateFiles({res:e,client:t,service:r,files:n,dry_run:i=!1}){if(!n)return e.write("* Couldn't read data from extract\r\n\r\n"),{name:"Directus Error",status:404,errors:[{message:"No files found"}]};if(0===n.length)return e.write("* No files to migrate\r\n\r\n"),{response:"Empty",name:"Files"};e.write(`* [Local] Found ${n.length} files\r\n\r\n`);try{e.write("* [Remote] Fetching Existing Files ...");const s=await t.request(t$9({fields:["id","filename_disk"],limit:-1}));if(!s)return{name:"Directus Error",status:404,errors:[{message:"Issue Fetching Files"}]};e.write("done\r\n\r\n");const o=new Set(s.map(e=>e.id)),a=new Set(s.map(e=>e.filename_disk)),l=n.filter(e=>!o.has(e.id)&&!a.has(e.filename_disk));e.write(l.length>0?`* [Remote] Uploading ${l.length} ${l.length>1?"Files":"File"}\r\n\r\n`:"* No Files to migrate\r\n\r\n");const c=await Promise.all(l.map(async(n,s)=>{const o=n.filename_disk;let a,c;try{const e=await r.getAsset(n.id);a=e.stream,c=e.stat}catch(t){return e.write(`* [Remote] Error: Couldn't read ${o} from source [${s+1}/${l.length}]\r\n\r\n`),console.error(t),t}if(c.size<=0)return;if(!n.type)return void e.write(`* [Remote] Skipped ${o} [${s+1}/${l.length}]\r\n\r\n`);const u=new FormData;u.append("id",n.id),n.title&&u.append("title",n.title),n.description&&u.append("description",n.description),n.folder&&u.append("folder",n.folder);const d=await blob(a);if(u.append("file",d.slice(0,d.size,n.type),o),e.write(`* [Remote] ${o} ${c.size} bytes [${s+1}/${l.length}]\r\n\r\n`),!i)try{await t.request(e$c(u))}catch(t){return e.write(`* [Remote] Error: Couldn't upload ${o} [${s+1}/${l.length}]\r\n\r\n`),console.error(t),t}}));return c.some(e=>void 0!==e)?{name:"Directus Error",status:500,errors:c.filter(e=>void 0!==e)}:{response:"Success",name:"Files"}}catch(t){console.error(t);const r=t;return r.errors&&r.errors.length>0&&e.write(`${r.errors[0]?.message}\r\n\r\n`),r}}async function migrateOperations({res:e,client:t,operations:r,dry_run:n=!1}){if(!r)return e.write("* Couldn't read data from extract\r\n\r\n"),{name:"Directus Error",status:404,errors:[{message:"No operations found"}]};if(0===r.length)return e.write("* No operations to migrate\r\n\r\n"),{response:"Empty",name:"Operations"};e.write(`* [Local] Found ${r.length} operations\r\n\r\n`);try{const i=r.map(e=>{const t={...e};return delete t.reject,delete t.resolve,t});e.write(i.length>0?`* [Remote] Uploading ${i.length} ${i.length>1?"Operations":"Operation"} ...`:"* No Operations to migrate\r\n\r\n"),n||await t.request(e$9(i)),e.write(n?"skipped\r\n\r\n":"done\r\n\r\n");const s=await Promise.allSettled(r.map(e=>t.request(r$2(e.id,{reject:e.reject,resolve:e.resolve}))));for(const[t,r]of s.entries())"rejected"===r.status&&e.write(`* Error on Operation ${t}: ${r.reason}`);return e.write("* Operation Migration Complete\r\n\r\n"),{response:"Success",name:"Operations"}}catch(t){const r=t;return e.write("error\r\n\r\n"),r.errors&&r.errors.length>0&&e.write(`${r.errors[0]?.message}\r\n\r\n`),r}}async function migrateFlows({res:e,client:t,flows:r,operations:n,dry_run:i=!1}){if(!r||!n)return e.write("* Couldn't read data from extract\r\n\r\n"),{name:"Directus Error",status:404,errors:[{message:"No flows found"}]};if(0===r.length)return e.write("* No flows to migrate\r\n\r\n"),{response:"Empty",name:"Flows"};if(0===n.length)return e.write("* No operations to migrate\r\n\r\n"),{response:"Empty",name:"Operations"};e.write(`* [Local] Found ${r.length} flows\r\n\r\n`);try{e.write("* [Remote] Fetching Existing Flows ...");const s=await t.request(t$8({limit:-1}));if(!s)return{name:"Directus Error",status:404,errors:[{message:"Issue Fetching Flows"}]};e.write("done\r\n\r\n");const o=new Set(s.map(e=>e.id)),a=r.filter(e=>!o.has(e.id));if(e.write(a.length>0?`* [Remote] Uploading ${a.length} ${a.length>1?"Flows":"Flow"} `:"* No Flows to migrate\r\n\r\n"),a.length>0){const r=await Promise.allSettled(a.map(r=>(e.write("."),i?null:t.request(t$j(r)))));e.write(i?"skipped\r\n\r\n":"done\r\n\r\n");const s=new Set;for(const[t,n]of r.entries())"fulfilled"===n.status&&a[t]?s.add(a[t].id):"reason"in n&&e.write(`* [Error] ${n.reason}`);const o=n.filter(e=>s.has(e.flow));await migrateOperations({res:e,client:t,operations:o,dry_run:i})}return e.write("* Flows Migration Complete\r\n\r\n"),{response:"Success",name:"Flows"}}catch(t){const r=t;return r.errors&&r.errors.length>0&&e.write(`${r.errors[0]?.message}\r\n\r\n`),r}}async function migrateFolders({res:e,client:t,folders:r,dry_run:n=!1}){if(!r)return e.write("* Couldn't read data from extract\r\n\r\n"),{name:"Directus Error",status:404,errors:[{message:"No folders found"}]};if(0===r.length)return e.write("* No folders to migrate\r\n\r\n"),{response:"Empty",name:"Folders"};e.write(`* [Local] Found ${r.length} folders\r\n\r\n`);try{e.write("* [Remote] Fetching Existing Folders ...");const i=await t.request(t$7({limit:-1}));if(!i)return{name:"Directus Error",status:404,errors:[{message:"Issue Fetching Folders"}]};e.write("done\r\n\r\n");const s=new Set(i.map(e=>e.id)),o=r.filter(e=>!s.has(e.id));if(e.write(o.length>0?`* [Remote] Uploading ${o.length} ${o.length>1?"Folders":"Folder"} `:"* No Folders to migrate\r\n\r\n"),o.length>0){const r=o.map(e=>({id:e.id,name:e.name}));e.write("."),await t.request(e$b(r)),await Promise.all(o.map(async r=>{const{id:n,...i}=r;e.write("."),await t.request(r$4(n,i))})),e.write(n?"skipped\r\n\r\n":"done\r\n\r\n")}return e.write("* Folder Migration Complete\r\n\r\n"),{response:"Success",name:"Folders"}}catch(t){const r=t;return e.write("error\r\n\r\n"),r.errors&&r.errors.length>0&&e.write(`${r.errors[0]?.message}\r\n\r\n`),r}}async function migratePanels({res:e,client:t,panels:r,dry_run:n=!1}){if(!r)return e.write("* Couldn't read data from extract\r\n\r\n"),{name:"Directus Error",status:404,errors:[{message:"No panels found"}]};if(0===r.length)return e.write("* No panels to migrate\r\n\r\n"),{response:"Empty",name:"Panels"};e.write(`* [Local] Found ${r.length} panels\r\n\r\n`);try{e.write("* [Remote] Fetching Existing Panels ...");const i=await t.request(t$6({limit:-1}));if(!i)return{name:"Directus Error",status:404,errors:[{message:"Issue Fetching Panels"}]};e.write("done\r\n\r\n");const s=new Set(i.map(e=>e.id)),o=r.filter(e=>!s.has(e.id));return e.write(o.length>0?`* [Remote] Uploading ${o.length} ${o.length>1?"Panels":"Panel"} `:"* No Panels to migrate\r\n\r\n"),o.length>0&&(await Promise.all(o.map(async r=>{e.write("."),await t.request(t$h(r))})),e.write(n?"skipped\r\n\r\n":"done\r\n\r\n"),e.write("* Panel Migration Complete\r\n\r\n")),{response:"Success",name:"Panels"}}catch(t){const r=t;return e.write("error\r\n\r\n"),r.errors&&r.errors.length>0&&e.write(`${r.errors[0]?.message}\r\n\r\n`),r}}async function migratePermissions({res:e,client:t,permissions:r,dry_run:n=!1}){if(!r)return e.write("* Couldn't read data from extract\r\n\r\n"),{name:"Directus Error",status:404,errors:[{message:"No permissions found"}]};if(0===r.length)return e.write("* No permissions to migrate\r\n\r\n"),{response:"Empty",name:"Permissions"};e.write(`* [Local] Found ${r.length} permissions\r\n\r\n`);try{e.write("* [Remote] Fetching Existing Permissions ...");const i=await t.request(t$5({limit:-1}));if(!i)return{name:"Directus Error",status:404,errors:[{message:"No Permissions found"}]};e.write("done\r\n\r\n");const s=new Set(i.map(e=>`${e.collection}:${e.action}:${e.policy}`)),o=r.filter(e=>!s.has(`${e.collection}:${e.action}:${e.policy}`));if(e.write(o.length>0?`* [Remote] Uploading ${o.length} ${o.length>1?"Permissions":"Permission"} `:"* No Permissions to migrate\r\n\r\n"),o.length>0){for await(const r of o)e.write("."),n||await t.request(t$g(r));e.write(n?"skipped\r\n\r\n":"done\r\n\r\n")}return e.write("* Permission Migration Complete\r\n\r\n"),{response:"Success",name:"Permissions"}}catch(t){const r=t;return e.write("error\r\n\r\n"),r.errors&&r.errors.length>0&&e.write(`${r.errors[0]?.message}\r\n\r\n`),r}}async function migratePolicies({res:e,client:t,policies:r,dry_run:n=!1}){if(!r)return e.write("* Couldn't read data from extract\r\n\r\n"),{name:"Directus Error",status:404,errors:[{message:"No policies found"}]};if(0===r.length)return e.write("* No policies to migrate\r\n\r\n"),{response:"Empty",name:"Policies"};e.write(`* [Local] Found ${r.length} policies\r\n\r\n`);try{e.write("* [Remote] Fetching Existing Policies ...");const i=await t.request(t$4({limit:-1}));if(!i)return{name:"Directus Error",status:404,errors:[{message:"No Policies found"}]};e.write("done\r\n\r\n");const s=new Set(i.map(e=>e.id)),o="abf8a154-5b1c-4a46-ac9c-7300570f4f17",a=r.filter(e=>e.id!==o);if(e.write(a.length>0?`* [Remote] Uploading ${a.length} ${a.length>1?"Policies":"Policy"} `:"* No Policies to migrate\r\n\r\n"),a.length>0){const r=[];for await(const i of a)s.has(i.id)?r.push(i.name):(e.write("."),n||await t.request(t$f(i)),s.add(i.id));e.write(n?"skipped\r\n\r\n":"done\r\n\r\n"),r.forEach(t=>{e.write(`* Duplicate ID for ${t} - skipped\r\n\r\n`)})}return e.write("* Policy Migration Complete\r\n\r\n"),{response:"Success",name:"Policies"}}catch(t){const r=t;return e.write("error\r\n\r\n"),r.errors&&r.errors.length>0&&e.write(`${r.errors[0]?.message}\r\n\r\n`),r}}async function migratePresets({res:e,client:t,presets:r,dry_run:n=!1}){if(!r)return e.write("* Couldn't read data from extract\r\n\r\n"),{name:"Directus Error",status:404,errors:[{message:"No presets found"}]};if(0===r.length)return e.write("* No presets to migrate\r\n\r\n"),{response:"Empty",name:"Presets"};e.write(`* [Local] Found ${r.length} presets\r\n\r\n`);try{e.write(r.length>0?`* [Remote] Uploading ${r.length} ${r.length>1?"Presets":"Preset"} `:"* No Presets to migrate\r\n\r\n");const i=r.map(e=>{delete e.id;const t={...e};return t.user=null,t});return i.length>0?(e.write("."),n||await t.request(e$8(i)),e.write(n?"skipped\r\n\r\n":"done\r\n\r\n")):e.write("* No new presets to create\r\n\r\n"),e.write("* Preset Migration Complete\r\n\r\n"),{response:"Success",name:"Presets"}}catch(t){const r=t;return e.write("error\r\n\r\n"),r.errors&&r.errors.length>0&&e.write(`${r.errors[0]?.message}\r\n\r\n`),r}}async function migrateRoles({res:e,client:t,roles:r,dry_run:n}){if(!r)return e.write("* Couldn't read data from extract\r\n\r\n"),{name:"Directus Error",status:404,errors:[{message:"No roles found"}]};if(0===r.length)return e.write("* No roles to migrate\r\n\r\n"),{response:"Empty",name:"Roles"};e.write(`* [Local] Found ${r.length} roles\r\n\r\n`);const{legacyAdminRoleId:i,newAdminRoleId:s}=await getRoleIds(t,r);e.write("* [Remote] Fetching Existing Roles ...");const o=await t.request(t$3({limit:-1}));if(!o)return{name:"Directus Error",status:404,errors:[{message:"No Roles found"}]};e.write("done\r\n\r\n");const a=new Set(o.map(e=>e.id)),l=new Set(o.map(e=>e.name.toLowerCase())),c=r.filter(e=>"Administrator"!==e.name).filter(e=>!l.has(e.name.toLowerCase())).map(e=>{const t={...e};return delete t.users,delete t.parent,t}),u=[];if(e.write(c.length>0?`* [Remote] Uploading ${c.length} ${c.length>1?"Roles":"Role"} `:"* No Roles to migrate\r\n\r\n"),c.length>0){for await(const r of c)try{if(a.has(r.id))continue;e.write("."),n||await t.request(t$e(r)),a.add(r.id),l.add(r.name.toLowerCase())}catch(e){u.push(e)}e.write(n?"skipped\r\n\r\n":"done\r\n\r\n")}const d=r.filter(e=>null!==e.parent);if(e.write(d.length>0?`* [Remote] Updating ${d.length} Roles with parents `:"* No Roles to update\r\n\r\n"),d.length>0){for await(const r of d)try{r.parent===i&&(r.parent=s);const o={parent:r.parent};e.write("."),n||await t.request(r$1(r.id,o))}catch(e){u.push(e)}e.write(n?"skipped\r\n\r\n":"done\r\n\r\n")}return e.write("* Roles Migration Complete\r\n\r\n"),u.forEach(t=>{e.write(`${t.errors[0]?.message}\r\n\r\n`)}),u.length>0?{name:"Roles Migration Error",errors:u.map(e=>e.errors[0])}:{response:"Success",name:"Roles"}}async function migrateSchema({res:e,client:t,schema:r,dry_run:n=!1,force:i=!1}){try{e.write("1. Comparing Schemas ...");const s=i?await t.request(()=>({body:JSON.stringify(r),method:"POST",path:"/schema/diff?force=true"})):await t.request(e$2(r));return"hash"in s?(e.write("done\r\n\r\n"),e.write("2. Applying Schemas ..."),n?e.write("skipped\r\n\r\n"):(await(i?t.request(()=>({body:JSON.stringify(s),method:"POST",path:"/schema/apply?force=true"})):t.request(e$3(s))),e.write("done\r\n\r\n"))):e.write("match\r\n\r\n"),s}catch(t){const r=t;return e.write("error\r\n\r\n"),r.errors&&r.errors.length>0&&e.write(`${r.errors[0]?.message}\r\n\r\n`),r}}async function checkSchema({client:e,schema:t}){try{return await e.request(e$2(t))}catch(e){return e}}function isPlainObject(e){if(null===e||"object"!=typeof e)return!1;const t=Object.getPrototypeOf(e);return(null===t||t===Object.prototype||null===Object.getPrototypeOf(t))&&(!(Symbol.iterator in e)&&(!(Symbol.toStringTag in e)||"[object Module]"===Object.prototype.toString.call(e)))}function _defu(e,t,r=".",n){if(!isPlainObject(t))return _defu(e,{},r,n);const i=Object.assign({},t);for(const t in e){if("__proto__"===t||"constructor"===t)continue;const s=e[t];null!=s&&(n&&n(i,t,s,r)||(Array.isArray(s)&&Array.isArray(i[t])?i[t]=[...s,...i[t]]:isPlainObject(s)&&isPlainObject(i[t])?i[t]=_defu(s,i[t],(r?`${r}.`:"")+t.toString(),n):i[t]=s))}return i}function createDefu(e){return(...t)=>t.reduce((t,r)=>_defu(t,r,"",e),{})}_entries=new WeakMap,_setEntry=new WeakSet,setEntry_fn=function({name:e,rawValue:t,append:r,fileName:n,argsLength:i}){const s=r?"append":"set";if(i<2)throw new TypeError(`Failed to execute '${s}' on 'FormData': 2 arguments required, but only ${i} present.`);let o;if(e=String(e),isFile(t))o=void 0===n?t:new File([t],n,{type:t.type,lastModified:t.lastModified});else if(isBlob(t))o=new File([t],void 0===n?"blob":n,{type:t.type});else{if(n)throw new TypeError(`Failed to execute '${s}' on 'FormData': parameter 2 is not of type 'Blob'.`);o=String(t)}const a=__privateGet(this,_entries).get(e);a&&r?a.push(o):__privateGet(this,_entries).set(e,[o])};const customDefu=createDefu((e,t,r)=>Array.isArray(e[t])&&Array.isArray(r)?(e[t]=mergeArrays(t,e[t],r),!0):"string"==typeof e[t]&&"string"==typeof r?(e[t]=mergeJsonStrings(e[t],r),!0):void 0);function mergeArrays(e,t,r){const n={basemaps:["key"],custom_aspect_ratios:["key"],module_bar:["id","type"],storage_asset_presets:["key"]}[e];return n?t.concat(r.filter(e=>!t.some(t=>n.every(r=>t[r]===e[r])))):[...new Set([...t,...r])]}function mergeJsonStrings(e,t){try{return JSON.stringify(customDefu(JSON.parse(e),JSON.parse(t)))}catch{return t}}async function migrateSettings({res:e,client:t,settings:r,dry_run:n=!1}){e.write("* [Local] Loading Settings\r\n\r\n");try{const i=await t.request(e$4()),s=customDefu(i,r);return n||await t.request(e$1(s)),e.write("* Settings Migration Complete\r\n\r\n"),{response:"Success",name:"Settings"}}catch(t){console.error(t);const r=t;return e.write("error\r\n\r\n"),r.errors&&r.errors.length>0&&e.write(`${r.errors[0]?.message}\r\n\r\n`),r}}async function migrateTranslations({res:e,client:t,translations:r,dry_run:n=!1}){if(!r)return e.write("* Couldn't read data from extract\r\n\r\n"),{name:"Directus Error",status:404,errors:[{message:"No translations found"}]};if(0===r.length)return e.write("* No Translations to migrate\r\n\r\n"),{response:"Empty",name:"Translations"};e.write(`* [Local] Found ${r.length} translations\r\n\r\n`);try{const i=await t.request(t$2({limit:-1})),s=new Set(i.map(e=>`${e.language}_${e.key}`)),o=r.filter(e=>{const t=`${e.language}_${e.key}`;return!s.has(t)});return e.write(o.length>0?`* [Remote] Uploading ${o.length} ${o.length>1?"Translations":"Translation"} `:"* No Translations to migrate\r\n\r\n"),o.length>0&&(e.write("."),n||await t.request(e$7(o))),e.write(n?"skipped\r\n\r\n":"done\r\n\r\n"),e.write("* Translations Migration Complete\r\n\r\n"),{response:"Success",name:"Translations"}}catch(t){console.error(t);const r=t;return e.write("error\r\n\r\n"),r.errors&&r.errors.length>0&&e.write(`${r.errors[0]?.message}\r\n\r\n`),r}}async function migrateUsers({res:e,client:t,users:r,roles:n,dry_run:i=!1}){if(!r||!n)return e.write("* Couldn't read data from extract\r\n\r\n"),{name:"Directus Error",status:404,errors:[{message:"No users found"}]};if(0===r.length)return e.write("* No users to migrate\r\n\r\n"),{response:"Empty",name:"Users"};if(0===n.length)return e.write("* No roles found in the extract\r\n\r\n"),{name:"Directus Error",status:404,errors:[{message:"No roles found"}]};e.write(`* [Local] Found ${r.length} users\r\n\r\n`);try{e.write("* [Remote] Fetching Existing Roles for users ...");const{legacyAdminRoleId:s,newAdminRoleId:o}=await getRoleIds(t,n),a=await t.request(t$1({limit:-1}));if(!a)return{name:"Directus Error",status:404,errors:[{message:"No Users found in destination"}]};e.write("done\r\n\r\n");const l=r.map(e=>{const t=e.role===s;return e.role=t?o:e.role,delete e.last_page,delete e.token,delete e.policies,delete e.password,e});if(e.write(l.length>0?`* [Remote] Uploading ${l.length} ${l.length>1?"Users":"User"} `:"* No Users to migrate\r\n\r\n"),l.length>0){for await(const r of l){const n=a&&Array.isArray(a)?a.find(e=>e.id===r.id):void 0,s=a&&Array.isArray(a)?a.find(e=>e.email===r.email):void 0;n||(s&&delete r.email,null===r.email&&delete r.email,e.write("."),i||await t.request(t$d(r)))}e.write(i?"skipped\r\n\r\n":"done\r\n\r\n")}return e.write("* User Migration Complete\r\n\r\n"),{response:"Success",name:"Users"}}catch(t){const r=t;return e.write("error\r\n\r\n"),r.errors&&r.errors.length>0&&e.write(`${r.errors[0]?.message}\r\n\r\n`),r}}async function updateRequiredFields({res:e,client:r,service:n,collections:i,dry_run:s=!1,task:o}){const a=await n.readAll();if(!a||0===a.length)return e.write("* No fields to update\r\n\r\n"),{name:"Directus Error",status:404,errors:[{message:"No fields found"}]};if(!i||0===i.length)return e.write("* No collections found\r\n\r\n"),{name:"Directus Error",status:404,errors:[{message:"No collections found"}]};const l=i.filter(e=>!e.collection.startsWith("directus_")),c=[];for await(const n of l){const i=a.filter(e=>e.collection===n.collection&&!1===e.schema?.is_primary_key&&(!0===e.meta?.required||!1===e.schema?.is_nullable||!0===e.schema?.is_unique)).map(e=>"remove"===o?removeRequiredorIsNullable(e):e);e.write(`* [Remote] Updating ${i.length} fields in ${n.collection}\r\n\r\n`);for await(const n of i)try{e.write(`    * [Remote] Updating ${n.field} meta and schema\r\n\r\n`),s||await r.request(t(n.collection,n.field,{meta:{...n.meta},schema:{...n.schema}}))}catch(t){const r=t;r.errors&&r.errors.length>0&&e.write(`${r.errors[0]?.message}\r\n\r\n`),c.push(r)}}return c.length>0?{name:"Required Fields Error",errors:c.map(e=>e.errors[0])}:{response:"Success",name:"Required Fields"}}function removeRequiredorIsNullable(e){return!0===e.meta?.required&&(e.meta.required=!1),!1===e.schema?.is_nullable&&(e.schema.is_nullable=!0),!0===e.schema?.is_unique&&(e.schema.is_unique=!1),e}const icon='<span class="icon"><i></i></span>',spinner='<div class="progress-circular"><svg class="circle indeterminate" viewBox="0 0 30 30"><path class="circle-background" d="M12.5,0A12.5,12.5,0,1,1,0,12.5,12.5,12.5,0,0,1,12.5,0Z" transform="translate(2.5 2.5)"></path><path class="circle-path" d="M12.5,0A12.5,12.5,0,1,1,0,12.5,12.5,12.5,0,0,1,12.5,0Z" transform="translate(2.5 2.5)" style="stroke-dasharray: 54.95, 78.5;"></path></svg></div>';var e0=defineEndpoint({id:"migration",handler:(e,{env:t,services:n,database:i,getSchema:s})=>{const{AssetsService:o,FieldsService:a,FilesService:l,FoldersService:c,NotificationsService:u,SchemaService:d}=n,h=toArray(t.STORAGE_LOCATIONS)[0];e.get("/*",async(e,r,n)=>{const s="accountability"in e?e.accountability:null;if(s?.admin)if("/defaults"===e.url){const e={baseURL:t.MIGRATION_BUNDLE_DEFAULT_URL||"",token:t.MIGRATION_BUNDLE_DEFAULT_TOKEN||"",options:t.MIGRATION_BUNDLE_DEFAULT_OPTIONS?String(t.MIGRATION_BUNDLE_DEFAULT_OPTIONS).split(",").map(e=>e.trim()):[]};r.json(e)}else if("/presets"===e.url)try{const e=await i("directus_presets").where({collection:"migration_bundle",user:s.user}).orWhere(function(){this.where({collection:"migration_bundle",user:null,role:s.role})}).orWhere(function(){this.where({collection:"migration_bundle",user:null,role:null})}).whereNotNull("bookmark").orderBy([{column:"user",order:"desc",nulls:"last"},{column:"role",order:"desc",nulls:"last"},{column:"bookmark",order:"asc"}]);r.json({data:e})}catch(e){console.error("Failed to load presets:",e),r.json({data:[]})}else r.sendStatus(400);else n(new ForbiddenError)}),e.post("/*",async(e,t,f)=>{const p="accountability"in e?e.accountability:null;if(!p?.admin)return void f(new ForbiddenError);if("/presets"===e.url){try{const r={collection:"migration_bundle",bookmark:e.body.name||`Migration Config ${(new Date).toLocaleDateString()}`,user:"user"===e.body.scope?p.user:"global"===e.body.scope?null:p.user,role:"role"===e.body.scope?p.role:null,icon:"sync",color:"#2ECDA7",layout:"custom",layout_options:JSON.stringify({baseURL:e.body.baseURL,token:e.body.token,selectedOptions:e.body.options})};if(e.body.id)await i("directus_presets").where({id:e.body.id}).update(r),t.json({data:{...r,id:e.body.id}});else{const[e]=await i("directus_presets").insert(r);t.json({data:{...r,id:e}})}}catch(e){console.error("Failed to save preset:",e),t.status(500).json({error:"Failed to save preset"})}return}if(!["/run","/dry-run","/check"].includes(e.url))return void f(new ForbiddenError);const m="/dry-run"===e.url,_="/check"===e.url;if(!e.body.baseURL||!e.body.token||!e.body.scope)return void f(new ForbiddenError);const g=e.body.baseURL,y=e.body.token,v=e.body.scope,b=await s(),w=await initLimiter(),$=new l({accountability:p,schema:b}),R=new a({accountability:p,schema:b}),E=new c({accountability:p,schema:b}),S=new o({accountability:p,schema:b}),A=new u({accountability:p,schema:b}),O=new d({knex:i,accountability:p}),k=t$l(g,{globals:{fetch:w.wrap(enhancedFetch)}}).with(e$f(y)).with(r());if(_){const e=await O.snapshot(),r=await checkSchema({client:k,schema:e});if(r&&"errors"in r){const e=Array.isArray(r.errors)&&r.errors.length>0?r.errors[0]?.message:"Unknown";t.json({status:"danger",icon:"error",message:e})}else t.json({status:"success",icon:"check",message:"This instance is compatible for migration."})}else{t.writeHead(200,{"Content-Type":"text/plain","Transfer-Encoding":"chunked"}),t.write(m?"## Staring Dry Run Extraction\r\n\r\n":"## Staring Extraction\r\n\r\n");const e=`Migration ${(new Date).toISOString()}`,r=await E.createOne({name:e,parent:null});t.write(`Created new folder ${e}\r\n\r\n`);try{t.write(`<div class="pending"><h3>${spinner} Creating Schema Snapshot</h3>\r\n\r\n`);const e=await O.snapshot();await saveToFile(e,"schema",$,r,h),t.write(`</div><h3 class="done">${icon} Schema Snapshot Created</h3>\r\n\r\n`),t.write(`<div class="pending"><h3>${spinner} Extracting System Data</h3>\r\n\r\n`);const i=await extractSystemData({res:t,services:n,accountability:p,schema:b,scope:v,folder:r,storage:h});if(i.system_errors){const e=Array.isArray(i.system_errors.errors)&&i.system_errors.errors.length>0?i.system_errors.errors[0]?.message:"Unknown";t.write(`Error Occurred: ${e}\r\n`),console.error(i.system_errors),await notifyUser(A,p,i.system_errors)}t.write("Validating System Data: ");let s=await validate_system({...i,scope:v});t.write(s?`</div><h3 class="done">${icon} System Data Extracted</h3>\r\n\r\n`:`</div><h3 class="error">${icon} System Data Extract Failed</h3>\r\n\r\n`),t.write(`<div class="pending"><h3>${spinner} Extracting Content</h3>\r\n\r\n`);const o=await extractContent({res:t,services:n,accountability:p,schema:b,scope:v,folder:r,storage:h});t.write("Validating Content: "),s=s?await validate_data({...o,scope:v}):s,t.write(s?`</div><h3 class="done">${icon} Content Extracted</h3>\r\n\r\n`:`</div><h3 class="error">${icon} System Data Extract Failed</h3>\r\n\r\n`),t.write(m?"## Checking Destination\r\n\r\n":"## Starting Migration\r\n\r\n"),t.write(`<div class="pending"><h3>${spinner} Applying Schema</h3>\r\n\r\n`);const a=await migrateSchema({res:t,client:k,schema:e,dry_run:m,force:v.force});if("errors"in a){const e=Array.isArray(a.errors)&&a.errors.length>0?a.errors[0]?.message:"Unknown";await notifyUser(A,p,a),t.write(`</div><h3 class="error">${icon} Schema Failed to Apply</h3>\r\n\r\n`),t.write(`Error Occurred: ${e}\r\n\r\n`)}else{if(t.write(`</div><h3 class="done">${icon} Schema Applied</h3>\r\n\r\n`),v.users){t.write(`<div class="pending"><h3>${spinner} Migrating Users</h3>\r\n\r\n`);const e=await migrateRoles({res:t,client:k,roles:i.roles,dry_run:m}),r=await migratePolicies({res:t,client:k,policies:i.policies,dry_run:m}),n=await migratePermissions({res:t,client:k,permissions:i.permissions,dry_run:m}),s=await migrateUsers({res:t,client:k,users:i.users,roles:i.roles,dry_run:m}),o=await migrateAccess({res:t,client:k,access:i.access,roles:i.roles,dry_run:m}),a=await validate_migration([e,r,n,s,o]);t.write(a?`</div><h3 class="done">${icon} Users Migrated</h3>\r\n\r\n`:`</div><h3 class="error">${icon} Users Migration Failed</h3>\r\n\r\n`)}else t.write(`<h3 class="skipped">${icon} Users Skipped</h3>\r\n\r\n`);if(v.content){t.write(`<div class="pending"><h3>${spinner} Removing Field Requirements</h3>\r\n\r\n`);const e=await updateRequiredFields({res:t,client:k,service:R,collections:o.collections,dry_run:m,task:"remove"}),r=await validate_migration([e]);t.write(r?`</div><h3 class="done">${icon} Field Requirements Removed</h3>\r\n\r\n`:`</div><h3 class="error">${icon} Failed to Remove Field Requirements</h3>\r\n\r\n`),t.write(`<div class="pending"><h3>${spinner} Migrating Files</h3>\r\n\r\n`);const n=await migrateFolders({res:t,client:k,folders:i.folders,dry_run:m}),s=await migrateFiles({res:t,client:k,service:S,files:o.files,dry_run:m}),a=await validate_migration([n,s]);if(t.write(a?`</div><h3 class="done">${icon} Files Migrated</h3>\r\n\r\n`:`</div><h3 class="error">${icon} Files Migration Partially Failed</h3>\r\n\r\n`),r){t.write(`<div class="pending"><h3>${spinner} Migrating Collections</h3>\r\n\r\n`);const e=await migrateData({res:t,client:k,fullData:o.fullData,singletons:o.singletons,dry_run:m}),r=await validate_migration([e]);if(t.write(r?`</div><h3 class="done">${icon} Collections Migrated</h3>\r\n\r\n`:`</div><h3 class="error">${icon} Collections Migration Failed</h3>\r\n\r\n`),r)if(v.comments){t.write(`<div class="pending"><h3>${spinner} Migrating Comments</h3>\r\n\r\n`);const e=await migrateComments({res:t,client:k,comments:i.comments,dry_run:m}),r=await validate_migration([e]);t.write(r?`</div><h3 class="done">${icon} Comments Migrated</h3>\r\n\r\n`:`</div><h3 class="error">${icon} Comments Migration Failed</h3>\r\n\r\n`)}else t.write(`<h3 class="skipped">${icon} Comments Skipped</h3>\r\n\r\n`)}t.write(`<div class="pending"><h3>${spinner} Updating Required Fields</h3>\r\n\r\n`);const l=await updateRequiredFields({res:t,client:k,service:R,collections:o.collections,dry_run:m,task:"add"}),c=await validate_migration([l]);t.write(c?`</div><h3 class="done">${icon} Required Fields Updated</h3>\r\n\r\n`:`</div><h3 class="error">${icon} Failed to Update Required Fields</h3>\r\n\r\n`)}else t.write(`<h3 class="skipped">${icon} Content Skipped</h3>\r\n\r\n`);if(v.dashboards){t.write(`<div class="pending"><h3>${spinner} Migrating Insights</h3>\r\n\r\n`);const e=await migrateDashboards({res:t,client:k,dashboards:i.dashboards,dry_run:m}),r=await migratePanels({res:t,client:k,panels:i.panels,dry_run:m}),n=await validate_migration([e,r]);t.write(n?`</div><h3 class="done">${icon} Insights Migrated</h3>\r\n\r\n`:`</div><h3 class="error">${icon} Insights Migration Failed</h3>\r\n\r\n`)}else t.write(`<h3 class="skipped">${icon} Insights Skipped</h3>\r\n\r\n`);if(v.flows){t.write(`<div class="pending"><h3>${spinner} Migrating Flows</h3>\r\n\r\n`);const e=await migrateFlows({res:t,client:k,flows:i.flows,operations:i.operations,dry_run:m}),r=await validate_migration([e]);t.write(r?`</div><h3 class="done">${icon} Flows Migrated</h3>\r\n\r\n`:`</div><h3 class="error">${icon} Flows Migration Failed</h3>\r\n\r\n`)}else t.write(`<h3 class="skipped">${icon} Flows Skipped</h3>\r\n\r\n`);t.write(`<div class="pending"><h3>${spinner} Migrating Settings</h3>\r\n\r\n`);const e=await migrateSettings({res:t,client:k,settings:i.settings,dry_run:m}),r=await validate_migration([e]);t.write(r?`</div><h3 class="done">${icon} Settings Migrated</h3>\r\n\r\n`:`</div><h3 class="error">${icon} Settings Migration Failed</h3>\r\n\r\n`),t.write(`<div class="pending"><h3>${spinner} Migrating Translations</h3>\r\n\r\n`);const n=await migrateTranslations({res:t,client:k,translations:i.translations,dry_run:m}),s=await validate_migration([n]);if(t.write(s?`</div><h3 class="done">${icon} Translations Migrated</h3>\r\n\r\n`:`</div><h3 class="error">${icon} Translations Migration Failed</h3>\r\n\r\n`),v.presets){t.write(`<div class="pending"><h3>${spinner} Migrating Presets</h3>\r\n\r\n`);const e=await migratePresets({res:t,client:k,presets:i.presets,dry_run:m}),r=await validate_migration([e]);t.write(r?`</div><h3 class="done">${icon} Presets Migrated</h3>\r\n\r\n`:`</div><h3 class="error">${icon} Presets Migration Failed</h3>\r\n\r\n`)}else t.write(`<h3 class="skipped">${icon} Presets Skipped</h3>\r\n\r\n`);if(v.extensions){t.write(`<div class="pending"><h3>${spinner} Migrating Extensions</h3>\r\n\r\n`);const e=await migrateExtensions({res:t,client:k,extensions:i.extensions,dry_run:m}),r=await validate_migration([e]);t.write(r?`</div><h3 class="done">${icon} Extensions Migrated</h3>\r\n\r\n`:`</div><h3 class="error">${icon} Extensions Migration Failed</h3>\r\n\r\n`)}else t.write(`<h3 class="skipped">${icon} Extensions Skipped</h3>\r\n\r\n`)}t.write(`## Migration ${m?"Dry Run":""} Complete\r\n\r\n`),t.write(`The files can be download from the [file library](/admin/files/folders/${r}).\r\n\r\n`),t.end()}catch(e){t.write("An unknown error has occured. See log for details"),t.end(),console.error(e)}}}),e.delete("/presets/:id",async(e,t,r)=>{const n="accountability"in e?e.accountability:null;if(n?.admin)try{const r=Number.parseInt(e.params.id);await i("directus_presets").where({id:r,collection:"migration_bundle",user:n.user}).delete(),t.json({success:!0})}catch(e){console.error("Failed to delete preset:",e),t.status(500).json({error:"Failed to delete preset"})}else r(new ForbiddenError)})}});const hooks=[],endpoints=[{name:"migration-endpoint",config:e0}],operations=[];export{endpoints,hooks,operations};
